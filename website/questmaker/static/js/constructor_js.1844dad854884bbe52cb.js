(()=>{var e={909:(e,t,n)=>{var i={"./img/favicon.ico":644,"./img/img1.jpg":629,"./img/profile_defolt.png":741,"./img/telegram_scrin_on_phone.jpg":866};function o(e){var t=r(e);return n(t)}function r(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=909},644:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"img/favicon.3c12d881b58b8d3c3a244b67e5c425b4.ico"},629:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"img/img1.d726711a429f6db14fb54fa81420ccaa.jpg"},741:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"img/profile_defolt.7058d8507900218215d7f274f23fa4f9.png"},866:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"img/telegram_scrin_on_phone.c8d918b54cc9a541a09f523b33beeca3.jpg"}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/static/",(()=>{"use strict";function e(e,t,n){return"*"===e||(e.length>0?-1!==e.indexOf(t):!n)}function t(e,t,n){var i,o=e=e||{},r=t=t||{};if(n)for(i=0;i<n.length;i++)o[n[i]]=r[n[i]];else for(i in r)o[i]=r[i];return e}function i(e){return"[object Number]"===Object.prototype.toString.call(e)}function o(e){return"string"==typeof e}function r(e){return"boolean"==typeof e}function s(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function a(e){return"[object Function]"===Object.prototype.toString.call(e)}function l(e){if(o(e))return""+e;if(r(e))return!!e;if(u=e,"[object Date]"===Object.prototype.toString.call(u))return new Date(e.getTime());if(a(e))return e;if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++)t.push(l(e[n]));return t}if(s(e)){var i={};for(var c in e)i[c]=l(e[c]);return i}return e;var u}function c(e,t,n,c){var u,h,d={},p={};for(n=n||[],c=c||[],h=0;h<n.length;h++)d[n[h]]=!0;for(h=0;h<c.length;h++)p[c[h]]=!0;var f=l(e);for(h in t)if(null==f[h]||p[h])f[h]=t[h];else if(d[h])(u=[]).push.apply(u,Array.isArray(f[h])?f[h]:[f[h]]),u.push(t[h]),f[h]=u;else if(o(t[h])||r(t[h])||a(t[h])||i(t[h]))f[h]=t[h];else if(Array.isArray(t[h]))u=[],Array.isArray(f[h])&&u.push.apply(u,f[h]),u.push.apply(u,t[h]),f[h]=u;else if(s(t[h]))for(var v in s(f[h])||(f[h]={}),t[h])f[h][v]=t[h][v];return f}function u(e,t,n){for(var i=0;i<n.length;i++){var o=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(o===t)return o}return e}function h(e,t,n,i){return function e(r){if(null!=r){if(o(r))return function(e){var n=e.match(/(\${.*?})/g);if(null!=n)for(var i=0;i<n.length;i++){var o=t[n[i].substring(2,n[i].length-1)]||"";null!=o&&(e=e.replace(n[i],o))}return e}(r);if(!a(r)||i||null!=n&&0!==(r.name||"").indexOf(n)){if(Array.isArray(r)){for(var l=[],c=0;c<r.length;c++)l.push(e(r[c]));return l}if(s(r)){var u={};for(var h in r)u[h]=e(r[h]);return u}return r}return r(t)}}(e)}function d(e,t){if(!e)return null;for(var n=0;n<e.length;n++)t(e[n])}function p(e,t){if(e)for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}function f(e,t){var n=p(e,t);return-1===n?null:e[n]}function v(e,t){var n=null;return e.forEach((function(e){t(e)&&(n=e)})),n}function y(e){var t=[];return e.forEach((function(e){t.push(e)})),t}function g(e,t){var n=p(e,t);return n>-1&&e.splice(n,1),-1!==n}function m(e){if(null!=Array.fromArray)return Array.from(e);var t=[];return Array.prototype.push.apply(t,e),t}function _(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),-1!==n}function x(e,t,n,i){var o=e[t];return null==o&&(o=[],e[t]=o),o[i?"unshift":"push"](n),o}function b(e,t,n){return-1===e.indexOf(t)&&(n?e.unshift(t):e.push(t),!0)}for(var k=[],E=0;E<256;E++)k[E]=(E<16?"0":"")+E.toString(16);function C(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return k[255&e]+k[e>>8&255]+k[e>>16&255]+k[e>>24&255]+"-"+k[255&t]+k[t>>8&255]+"-"+k[t>>16&15|64]+k[t>>24&255]+"-"+k[63&n|128]+k[n>>8&255]+"-"+k[n>>16&255]+k[n>>24&255]+k[255&i]+k[i>>8&255]+k[i>>16&255]+k[i>>24&255]}function S(e,t,n){var i=e.x-t.x,o=e.y-t.y,r=Math.cos(n/360*Math.PI*2),s=Math.sin(n/360*Math.PI*2);return{x:i*r-o*s+t.x,y:o*r+i*s+t.y,cr:r,sr:s}}function P(e){if(null==e)return null;for(var t=e.replace(/^\s\s*/,""),n=/\s/,i=t.length;n.test(t.charAt(--i)););return t.slice(0,i+1)}function w(e,t){for(var n=[],i=0;i<e.length;i++)n.push(t(e[i]));return n}function A(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(e){}}function D(e,t,n){return function(){var i=null;try{null!=t&&(i=t.apply(this,arguments))}catch(e){A("jsPlumb function failed : "+e)}if(null!=e&&(null==n||i!==n))try{i=e.apply(this,arguments)}catch(e){A("wrapped function failed : "+e)}return i}}function M(e,t,n){return e.has(t)||e.set(t,n()),e.get(t)}function T(e,t){for(var n=e.__proto__;null!=n;){if(n instanceof t)return!0;n=n.__proto__}return!1}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function O(e,t,n){return t&&I(e.prototype,t),n&&I(e,n),e}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},L(e)}function F(e,t){return F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},F(e,t)}function B(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=L(e);if(t){var o=L(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return B(this,n)}}var H,N,X=function(){function e(){j(this,e),G(this,"_listeners",{}),G(this,"eventsSuspended",!1),G(this,"tick",!1),G(this,"eventsToDieOn",{ready:!0}),G(this,"queue",[])}return O(e,[{key:"fire",value:function(e,t,n){var i=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[e]){var o=this._listeners[e].length,r=0,s=!1;if(!this.shouldFireEvent||this.shouldFireEvent(e,t,n))for(;!s&&r<o&&!1!==i;){if(this.eventsToDieOn[e])this._listeners[e][r].apply(this,[t,n]);else try{i=this._listeners[e][r].apply(this,[t,n])}catch(t){A("jsPlumb: fire failed for event "+e+" : "+(t.message||t))}r++,null!=this._listeners&&null!=this._listeners[e]||(s=!0)}}this.tick=!1,this._drain()}return i}},{key:"_drain",value:function(){var e=this.queue.pop();e&&this.fire.apply(this,e)}},{key:"unbind",value:function(e,t){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof e)delete this._listeners[e];else if(e.__jsPlumb){var n;for(var i in e.__jsPlumb)n=e.__jsPlumb[i],_(this._listeners[n]||[],e)}}else 2===arguments.length&&_(this._listeners[e]||[],t);return this}},{key:"getListener",value:function(e){return this._listeners[e]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(e){this.eventsSuspended=e}},{key:"bind",value:function(e,t,n){var i=this,o=function(e){x(i._listeners,e,t,n),t.__jsPlumb=t.__jsPlumb||{},t.__jsPlumb[C()]=e};if("string"==typeof e)o(e);else if(null!=e.length)for(var r=0;r<e.length;r++)o(e[r]);return this}},{key:"silently",value:function(e){this.setSuspendEvents(!0);try{e()}catch(e){A("Cannot execute silent function "+e)}this.setSuspendEvents(!1)}}]),e}(),Y=(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(n,e);var t=R(n);function n(){return j(this,n),t.apply(this,arguments)}O(n,[{key:"shouldFireEvent",value:function(e,t,n){return!0}}])}(X),[null,[1,-1],[1,1],[-1,1],[-1,-1]]),V=[null,[-1,-1],[-1,1],[1,1],[1,-1]],z=2*Math.PI;function U(e,t){return t.x===e.x?t.y>e.y?1/0:-1/0:t.y===e.y?t.x>e.x?0:-0:(t.y-e.y)/(t.x-e.x)}function q(e,t){return Math.sqrt(Math.pow(t.y-e.y,2)+Math.pow(t.x-e.x,2))}function W(e,t){return t.x>e.x||t.x==e.x?t.y>e.y?2:1:t.y>e.y?3:4}function J(e,t){var n=e.x,i=e.x+e.w,o=e.y,r=e.y+e.h,s=t.x,a=t.x+t.w,l=t.y,c=t.y+t.h;return n<=s&&s<=i&&o<=l&&l<=r||n<=a&&a<=i&&o<=l&&l<=r||n<=s&&s<=i&&o<=c&&c<=r||n<=a&&s<=i&&o<=c&&c<=r||s<=n&&n<=a&&l<=o&&o<=c||s<=i&&i<=a&&l<=o&&o<=c||s<=n&&n<=a&&l<=r&&r<=c||s<=i&&n<=a&&l<=r&&r<=c}function Z(e,t,n){var i=U(e,t),o=W(e,t),r=n>0?Y[o]:V[o],s=Math.atan(i),a=Math.abs(n*Math.sin(s))*r[1],l=Math.abs(n*Math.cos(s))*r[0];return{x:e.x+l,y:e.y+a}}function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Circle="Circle",e.Ellipse="Ellipse",e.Triangle="Triangle",e.Diamond="Diamond",e.Rectangle="Rectangle",e.Square="Square"}(H||(H={})),function(e){e.Assign="Assign",e.AutoDefault="AutoDefault",e.Bottom="Bottom",e.BottomLeft="BottomLeft",e.BottomRight="BottomRight",e.Center="Center",e.Continuous="Continuous",e.ContinuousBottom="ContinuousBottom",e.ContinuousLeft="ContinuousLeft",e.ContinuousRight="ContinuousRight",e.ContinuousTop="ContinuousTop",e.ContinuousLeftRight="ContinuousLeftRight",e.ContinuousTopBottom="ContinuousTopBottom",e.Left="Left",e.Perimeter="Perimeter",e.Right="Right",e.Top="Top",e.TopLeft="TopLeft",e.TopRight="TopRight"}(N||(N={}));var K=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,$(this,"x1",void 0),$(this,"x2",void 0),$(this,"y1",void 0),$(this,"y2",void 0),$(this,"extents",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),$(this,"type",void 0),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2}var t,n,i;return t=e,(n=[{key:"findClosestPointOnPath",value:function(e,t){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(e,t,n,i){return[]}},{key:"boxIntersection",value:function(e,t,n,i){var o=[];return o.push.apply(o,this.lineIntersection(e,t,e+n,t)),o.push.apply(o,this.lineIntersection(e+n,t,e+n,t+i)),o.push.apply(o,this.lineIntersection(e+n,t+i,e,t+i)),o.push.apply(o,this.lineIntersection(e,t+i,e,t)),o}},{key:"boundingBoxIntersection",value:function(e){return this.boxIntersection(e.x,e.y,e.w,e.h)}}])&&Q(t.prototype,n),i&&Q(t,i),e}(),ee="undefined",te="default",ne="true",ie="false",oe="*";function re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ae(e,t,n){return t&&se(e.prototype,t),n&&se(e,n),e}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&he(e,t)}function ue(e){return ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ue(e)}function he(e,t){return he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},he(e,t)}function de(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pe(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?de(e):t}function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ue(e);if(t){var o=ue(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return pe(this,n)}}function ve(e,t,n){return ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ue(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},ve(e,t,n||e)}function ye(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,o,r=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);s=!0);}catch(e){a=!0,o=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}(e,t)||me(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e){return function(e){if(Array.isArray(e))return _e(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||me(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(e,t){if(e){if("string"==typeof e)return _e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_e(e,t):void 0}}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var xe={},be={},ke={},Ee={get:function(e,t,n){var i=xe[t];if(i)return new i(e,n);throw{message:"jsPlumb: unknown endpoint type '"+t+"'"}},clone:function(e){var t=ke[e.type];return Ee.get(e.endpoint,e.type,t.getParams(e))},compute:function(e,t,n,i){var o=be[e.type];if(null!=o)return o(e,t,n,i);A("jsPlumb: cannot find endpoint calculator for endpoint of type ",e.type)},registerHandler:function(e){ke[e.type]=e,xe[e.type]=e.cls,be[e.type]=e.compute}},Ce=function(){function e(t,n){re(this,e),this.endpoint=t,le(this,"typeId",void 0),le(this,"x",void 0),le(this,"y",void 0),le(this,"w",void 0),le(this,"h",void 0),le(this,"computedValue",void 0),le(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),le(this,"classes",[]),le(this,"instance",void 0),le(this,"type",void 0),n=n||{},this.instance=t.instance,t.cssClass&&this.classes.push(t.cssClass),n.cssClass&&this.classes.push(n.cssClass)}return ae(e,[{key:"addClass",value:function(e){this.classes.push(e),this.instance.addEndpointClass(this.endpoint,e)}},{key:"removeClass",value:function(e){this.classes=this.classes.filter((function(t){return t!==e})),this.instance.removeEndpointClass(this.endpoint,e)}},{key:"compute",value:function(e,t,n){this.computedValue=Ee.compute(this,e,t,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(e){this.instance.setEndpointVisible(this.endpoint,e)}}]),e}(),Se=function(e){ce(n,e);var t=fe(n);function n(e,i){var o;return re(this,n),le(de(o=t.call(this,e,i)),"radius",void 0),le(de(o),"defaultOffset",void 0),le(de(o),"defaultInnerRadius",void 0),le(de(o),"type",n.type),i=i||{},o.radius=i.radius||5,o.defaultOffset=.5*o.radius,o.defaultInnerRadius=o.radius/3,o}return n}(Ce);le(Se,"type","Dot");var Pe={type:Se.type,cls:Se,compute:function(e,t,n,i){var o=t.curX-e.radius,r=t.curY-e.radius,s=2*e.radius,a=2*e.radius;if(i&&i.stroke){var l=i.strokeWidth||1;o-=l,r-=l,s+=2*l,a+=2*l}return e.x=o,e.y=r,e.w=s,e.h=a,[o,r,s,a,e.radius]},getParams:function(e){return{radius:e.radius}}},we=function(e){ce(n,e);var t=fe(n);function n(e,i){var o;return re(this,n),le(de(o=t.call(this,e,i)),"type",n.type),o}return n}(Ce);le(we,"type","Blank");var Ae={type:we.type,cls:we,compute:function(e,t,n,i){return e.x=t.curX,e.y=t.curY,e.w=10,e.h=0,[t.curX,t.curY,10,0]},getParams:function(e){return{}}},De=function(e){ce(n,e);var t=fe(n);function n(e,i){var o;return re(this,n),le(de(o=t.call(this,e,i)),"width",void 0),le(de(o),"height",void 0),le(de(o),"type",n.type),i=i||{},o.width=i.width||10,o.height=i.height||10,o}return ae(n,null,[{key:"_getParams",value:function(e){return{width:e.width,height:e.height}}}]),n}(Ce);le(De,"type","Rectangle");var Me={type:De.type,cls:De,compute:function(e,t,n,i){var o=i.width||e.width,r=i.height||e.height,s=t.curX-o/2,a=t.curY-r/2;return e.x=s,e.y=a,e.w=o,e.h=r,[s,a,o,r]},getParams:function(e){return{width:e.width,height:e.height}}},Te=function(){function e(t,n){re(this,e),this.connection=t,le(this,"type",void 0),le(this,"edited",!1),le(this,"stub",void 0),le(this,"sourceStub",void 0),le(this,"targetStub",void 0),le(this,"maxStub",void 0),le(this,"typeId",void 0),le(this,"gap",void 0),le(this,"sourceGap",void 0),le(this,"targetGap",void 0),le(this,"segments",[]),le(this,"totalLength",0),le(this,"segmentProportions",[]),le(this,"segmentProportionalLengths",[]),le(this,"paintInfo",null),le(this,"strokeWidth",void 0),le(this,"x",void 0),le(this,"y",void 0),le(this,"w",void 0),le(this,"h",void 0),le(this,"segment",void 0),le(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),le(this,"cssClass",void 0),le(this,"hoverClass",void 0),le(this,"geometry",void 0),this.stub=n.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=n.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=n.cssClass||"",this.hoverClass=n.hoverClass||""}return ae(e,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(e,t){this.geometry=e,this.edited=null!=e&&!t}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(e){return this.geometry=e,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(e,t,n){return{x:e.x,y:e.y,ox:e.ox,oy:e.oy,curX:e.curX+t,curY:e.curY+n}}},{key:"resetBounds",value:function(){this.bounds={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}},{key:"findSegmentForPoint",value:function(e,t){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var o=this.segments[i].findClosestPointOnPath(e,t);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=this.segments[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+o.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function(e,t,n,i){for(var o=[],r=0;r<this.segments.length;r++)o.push.apply(o,this.segments[r].lineIntersection(e,t,n,i));return o}},{key:"boxIntersection",value:function(e,t,n,i){for(var o=[],r=0;r<this.segments.length;r++)o.push.apply(o,this.segments[r].boxIntersection(e,t,n,i));return o}},{key:"boundingBoxIntersection",value:function(e){for(var t=[],n=0;n<this.segments.length;n++)t.push.apply(t,this.segments[n].boundingBoxIntersection(e));return t}},{key:"_updateSegmentProportions",value:function(){for(var e=0,t=0;t<this.segments.length;t++){var n=this.segments[t].getLength();this.segmentProportionalLengths[t]=n/this.totalLength,this.segmentProportions[t]=[e,e+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(e,t){var n,i,o;if(t&&(e=e>0?e/this.totalLength:(this.totalLength+e)/this.totalLength),1===e)n=this.segments.length-1,o=1;else if(0===e)o=0,n=0;else if(e>=.5){for(n=0,o=0,i=this.segmentProportions.length-1;i>-1;i--)if(this.segmentProportions[i][1]>=e&&this.segmentProportions[i][0]<=e){n=i,o=(e-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(n=this.segmentProportions.length-1,o=1,i=0;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=e){n=i,o=(e-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:o,index:n}}},{key:"_addSegment",value:function(e,t){if(t.x1!==t.x2||t.y1!==t.y2){var n=new e(t);this.segments.push(n),this.totalLength+=n.getLength(),this.updateBounds(n)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(e){this.strokeWidth=e.strokeWidth;var t=e.sourcePos.curX,n=e.targetPos.curX,i=e.sourcePos.curY,o=e.targetPos.curY,r=W({x:t,y:i},{x:n,y:o}),s=n<t,a=o<i,l=[e.sourcePos.ox,e.sourcePos.oy],c=[e.targetPos.ox,e.targetPos.oy],u=s?n:t,h=a?o:i,d=Math.abs(n-t),p=Math.abs(o-i),f=0===l[0]&&0===l[1],v=0===c[0]&&0===c[1];if(f||v){var y=d>p?0:1,g=[1,0][y],m=0===y?t:i,_=0===y?n:o;f&&(l[y]=m>_?-1:1,l[g]=0),v&&(c[y]=m>_?1:-1,c[g]=0)}var x=s?d+this.sourceGap*l[0]:this.sourceGap*l[0],b=a?p+this.sourceGap*l[1]:this.sourceGap*l[1],k=s?this.targetGap*c[0]:d+this.targetGap*c[0],E=a?this.targetGap*c[1]:p+this.targetGap*c[1],C=l[0]*c[0]+l[1]*c[1],S={sx:x,sy:b,tx:k,ty:E,xSpan:Math.abs(k-x),ySpan:Math.abs(E-b),mx:(x+k)/2,my:(b+E)/2,so:l,to:c,x:u,y:h,w:d,h:p,segment:r,startStubX:x+l[0]*this.sourceStub,startStubY:b+l[1]*this.sourceStub,endStubX:k+c[0]*this.targetStub,endStubY:E+c[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(x-k)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(b-E)>this.sourceStub+this.targetStub,opposite:-1===C,perpendicular:0===C,orthogonal:1===C,sourceAxis:0===l[0]?"y":"x",points:[u,h,d,p,x,b,k,E],stubs:[this.sourceStub,this.targetStub]};return S.anchorOrientation=S.opposite?"opposite":S.orthogonal?"orthogonal":"perpendicular",S}},{key:"updateBounds",value:function(e){var t=e.extents;this.bounds.xmin=Math.min(this.bounds.xmin,t.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,t.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,t.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,t.ymax)}},{key:"dumpSegmentsToConsole",value:function(){A("SEGMENTS:");for(var e=0;e<this.segments.length;e++)A(this.segments[e].type,""+this.segments[e].getLength(),""+this.segmentProportions[e])}},{key:"pointOnPath",value:function(e,t){var n=this._findSegmentForLocation(e,t);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(e,t){var n=this._findSegmentForLocation(e,t);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(e,t,n){var i=this._findSegmentForLocation(e,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,t,!1)||{x:0,y:0}}},{key:"compute",value:function(e){this.paintInfo=this._prepareCompute(e),this._clearSegments(),this._compute(this.paintInfo,e),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(e,t){}}]),e}(),je=function(e){ce(n,e);var t=fe(n);function n(e){var i;return re(this,n),le(de(i=t.call(this,e)),"length",void 0),le(de(i),"m",void 0),le(de(i),"m2",void 0),le(de(i),"type",n.segmentType),i._setCoordinates({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),i}return ae(n,[{key:"getPath",value:function(e){return(e?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=U({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(e){this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this._recalc()}},{key:"pointOnPath",value:function(e,t){if(0!==e||t){if(1!==e||t){var n=t?e>0?e:this.length+e:e*this.length;return Z({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}return{x:this.x2,y:this.y2}}return{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(e,t){return this.m}},{key:"pointAlongPathFrom",value:function(e,t,n){var i=this.pointOnPath(e,n),o=t<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return t<=0&&Math.abs(t)>1&&(t*=-1),Z(i,o,t)}},{key:"within",value:function(e,t,n){return n>=Math.min(e,t)&&n<=Math.max(e,t)}},{key:"closest",value:function(e,t,n){return Math.abs(n-e)<Math.abs(n-t)?e:t}},{key:"findClosestPointOnPath",value:function(e,t){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)n.y=this.y1,n.x=this.within(this.x1,this.x2,e)?e:this.closest(this.x1,this.x2,e);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,t)?t:this.closest(this.y1,this.y2,t);else{var i=this.y1-this.m*this.x1,o=(t-this.m2*e-i)/(this.m-this.m2),r=this.m*o+i;n.x=this.within(this.x1,this.x2,o)?o:this.closest(this.x1,this.x2,o),n.y=this.within(this.y1,this.y2,r)?r:this.closest(this.y1,this.y2,r)}var s=q({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=q({x:e,y:t},n),n.l=s/length,n}},{key:"_pointLiesBetween",value:function(e,t,n){return n>t?t<=e&&e<=n:t>=e&&e>=n}},{key:"lineIntersection",value:function(e,t,n,i){var o=Math.abs(U({x:e,y:t},{x:n,y:i})),r=Math.abs(this.m),s=r===1/0?this.x1:this.y1-r*this.x1,a=[],l=o===1/0?e:t-o*e;if(o!==r)if(o===1/0&&0===r)this._pointLiesBetween(e,this.x1,this.x2)&&this._pointLiesBetween(this.y1,t,i)&&a.push({x:e,y:this.y1});else if(0===o&&r===1/0)this._pointLiesBetween(t,this.y1,this.y2)&&this._pointLiesBetween(this.x1,e,n)&&a.push({x:this.x1,y:t});else{var c,u;o===1/0?(c=e,this._pointLiesBetween(c,this.x1,this.x2)&&(u=r*e+s,this._pointLiesBetween(u,t,i)&&a.push({x:c,y:u}))):0===o?(u=t,this._pointLiesBetween(u,this.y1,this.y2)&&(c=(t-s)/r,this._pointLiesBetween(c,e,n)&&a.push({x:c,y:u}))):(u=r*(c=(l-s)/(r-o))+s,this._pointLiesBetween(c,this.x1,this.x2)&&this._pointLiesBetween(u,this.y1,this.y2)&&a.push({x:c,y:u}))}return a}},{key:"boxIntersection",value:function(e,t,n,i){var o=[];return o.push.apply(o,this.lineIntersection(e,t,e+n,t)),o.push.apply(o,this.lineIntersection(e+n,t,e+n,t+i)),o.push.apply(o,this.lineIntersection(e+n,t+i,e,t+i)),o.push.apply(o,this.lineIntersection(e,t+i,e,t)),o}}]),n}(K);le(je,"segmentType","Straight");var Ie=function(e){ce(n,e);var t=fe(n);function n(){var e;re(this,n);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return le(de(e=t.call.apply(t,[this].concat(o))),"type",n.type),e}return ae(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){this._addSegment(je,{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),this._addSegment(je,{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),this._addSegment(je,{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty}),this.geometry={source:t.sourcePos,target:t.targetPos}}},{key:"transformGeometry",value:function(e,t,n){return{source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}}]),n}(Te);le(Ie,"type","Straight");var Oe={},Ge=function(e,t,n){var i=Oe[t];if(i)return new i(e,n);throw{message:"jsPlumb: unknown connector type '"+t+"'"}},Le=function(e,t){Oe[e]=t};function Fe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"."+e})).join(",")}function Be(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"["+e+"]"})).join(",")}var Re="source",He="target",Ne="block",Xe="none",Ye="absolute",Ve="fixed",ze="data-jtk-group",Ue="data-jtk-managed",qe="data-jtk-not-draggable",We="tabindex",Je="data-jtk-scope-",Ze="checkCondition",Qe="jtk-connector",$e="jtk-endpoint",Ke="jtk-group-collapsed",et="jtk-group-expanded",tt="jtk-overlay",nt="internal.connection",it="connection:move",ot="internal.endpoint:unregistered",rt="internal.connection:detached",st="group:member:added",at="maxConnections",lt="zoom",ct="isDetachAllowed",ut="beforeDetach",ht=Be(Ue);function dt(e){var t=null;return(t=o(e)?{type:e,options:{}}:e).options.id=t.options.id||C(),t}var pt=function(e){ce(n,e);var t=fe(n);function n(e,i,o){var r;for(var s in re(this,n),(r=t.call(this)).instance=e,r.component=i,le(de(r),"id",void 0),le(de(r),"type",void 0),le(de(r),"cssClass",void 0),le(de(r),"visible",!0),le(de(r),"location",void 0),le(de(r),"events",void 0),le(de(r),"attributes",void 0),o=o||{},r.id=o.id||C(),r.cssClass=o.cssClass||"",r.location=o.location||.5,r.events=o.events||{},r.attributes=o.attributes||{},r.events)r.bind(s,r.events[s]);return r}return ae(n,[{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"setVisible",value:function(e){this.visible=e,this.instance.setOverlayVisible(this,e)}},{key:"isVisible",value:function(){return this.visible}}]),n}(X),ft={},vt=function(e,t,n,i){var o=ft[t];if(o)return new o(e,n,i);throw{message:"jsPlumb: unknown overlay type '"+t+"'"}},yt=function(e,t){ft[e]=t},gt=function(e){ce(n,e);var t=fe(n);function n(e,i,o){var r;return re(this,n),(r=t.call(this,e,i,o)).instance=e,r.component=i,le(de(r),"label",void 0),le(de(r),"labelText",void 0),le(de(r),"type",n.type),le(de(r),"cachedDimensions",void 0),o=o||{label:""},r.setLabel(o.label),r}return ae(n,[{key:"getLabel",value:function(){return a(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(e){this.label=e,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(e){null!=e.label&&this.setLabel(e.label)}}]),n}(pt);function mt(e){return e.type===gt.type}function _t(e){return null==e?null:e.split(" ")}function xt(e,t,n){for(var i in t)e[i]=n}le(gt,"type","Label"),yt("Label",gt);var bt="__default",kt="__label",Et="remove";function Ct(e,n){if(e.getDefaultType){var i=e.getTypeDescriptor(),o={},r=e.getDefaultType(),s=t({},r);xt(o,r,bt);for(var a=0,l=e._types.length;a<l;a++){var u=e._types[a];if(u!==bt){var d=e.instance.getType(u,i);if(null!=d){var p=new Set(["connector","anchor","anchors"]);if("override"===d.mergeStrategy)for(var f in d)p.add(f);s=c(s,d,["cssClass"],y(p)),xt(o,d,u)}}}n&&(s=h(s,n,"_")),e.applyType(s,o)}}function St(e,t){var n=e._types[t],i=e.instance.getType(n,e.getTypeDescriptor());null!=i&&i.cssClass&&e.removeClass(i.cssClass)}function Pt(e){if(e.paintStyle&&e.hoverPaintStyle){var n={};t(n,e.paintStyle),t(n,e.hoverPaintStyle),e.hoverPaintStyle=n}}var wt,At,Dt,Mt,Tt=function(e){ce(i,e);var n=fe(i);function i(e,t){var o;if(re(this,i),(o=n.call(this)).instance=e,le(de(o),"defaultLabelLocation",.5),le(de(o),"overlays",{}),le(de(o),"overlayPositions",{}),le(de(o),"overlayPlacements",{}),le(de(o),"clone",void 0),le(de(o),"deleted",void 0),le(de(o),"segment",void 0),le(de(o),"x",void 0),le(de(o),"y",void 0),le(de(o),"w",void 0),le(de(o),"h",void 0),le(de(o),"id",void 0),le(de(o),"visible",!0),le(de(o),"typeId",void 0),le(de(o),"params",{}),le(de(o),"paintStyle",void 0),le(de(o),"hoverPaintStyle",void 0),le(de(o),"paintStyleInUse",void 0),le(de(o),"_hover",!1),le(de(o),"lastPaintedAt",void 0),le(de(o),"data",void 0),le(de(o),"_defaultType",void 0),le(de(o),"events",void 0),le(de(o),"parameters",void 0),le(de(o),"_types",void 0),le(de(o),"_typeCache",void 0),le(de(o),"cssClass",void 0),le(de(o),"hoverClass",void 0),le(de(o),"beforeDetach",void 0),le(de(o),"beforeDrop",void 0),t=t||{},o.cssClass=t.cssClass||"",o.hoverClass=t.hoverClass||e.defaults.hoverClass,o.beforeDetach=t.beforeDetach,o.beforeDrop=t.beforeDrop,o._types=[],o._typeCache={},o.parameters=l(t.parameters||{}),o.id=t.id||o.getIdPrefix()+(new Date).getTime(),o._defaultType={parameters:o.parameters,scope:t.scope||o.instance.defaultScope,overlays:{}},t.events)for(var r in t.events)o.bind(r,t.events[r]);o.clone=function(){var n=Object.create(o.constructor.prototype);return o.constructor.apply(n,[e,t]),n},o.overlays={},o.overlayPositions={};var s=t.overlays||[],a={},c=o.getDefaultOverlayKey();if(c){var u=o.instance.defaults[c];u&&s.push.apply(s,ge(u));for(var h=0;h<s.length;h++){var d=dt(s[h]);a[d.options.id]=d}}return o._defaultType.overlays=a,t.label&&(o.getDefaultType().overlays.__label={type:gt.type,options:{label:t.label,location:t.labelLocation||o.defaultLabelLocation,id:kt}}),o}return ae(i,[{key:"isDetachAllowed",value:function(e){var t=!0;if(this.beforeDetach)try{t=this.beforeDetach(e)}catch(e){A("jsPlumb: beforeDetach callback failed",e)}return t}},{key:"isDropAllowed",value:function(e,t,n,i,o){var r,s={sourceId:e,targetId:t,scope:n,connection:i,dropEndpoint:o};if(this.beforeDrop)try{r=this.beforeDrop(s)}catch(e){A("jsPlumb: beforeDrop callback failed",e)}else r=this.instance.checkCondition("beforeDrop",s);return r}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(e){for(var t in e)this._defaultType[t]=e[t]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(e,t,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][e]=t}},{key:"getCachedTypeItem",value:function(e,t){return this._typeCache[t]?this._typeCache[t][e]:null}},{key:"setType",value:function(e,t){this.clearTypes(),this._types=_t(e)||[],Ct(this,t)}},{key:"getType",value:function(){return this._types}},{key:"reapplyTypes",value:function(e){Ct(this,e)}},{key:"hasType",value:function(e){return-1!==this._types.indexOf(e)}},{key:"addType",value:function(e,t){var n=_t(e),i=!1;if(null!=n){for(var o=0,r=n.length;o<r;o++)this.hasType(n[o])||(this._types.push(n[o]),i=!0);i&&Ct(this,t)}}},{key:"removeType",value:function(e,t){var n,i,o=this,r=_t(e),s=!1;if(null!=r){for(var a=0,l=r.length;a<l;a++)n=r[a],i=void 0,s=-1!==(i=o._types.indexOf(n))&&(St(o,i),o._types.splice(i,1),!0)||s;s&&Ct(this,t)}}},{key:"clearTypes",value:function(e,t){for(var n=this._types.length,i=0;i<n;i++)St(this,0),this._types.splice(0,1);Ct(this,e)}},{key:"toggleType",value:function(e,t){var n=_t(e);if(null!=n){for(var i=0,o=n.length;i<o;i++){var r=this._types.indexOf(n[i]);-1!==r?(St(this,r),this._types.splice(r,1)):this._types.push(n[i])}Ct(this,t)}}},{key:"applyType",value:function(e,t){if(this.setPaintStyle(e.paintStyle),this.setHoverPaintStyle(e.hoverPaintStyle),this.mergeParameters(e.parameters),this.paintStyleInUse=this.getPaintStyle(),e.overlays){var n,i={};for(n in e.overlays){var o=this.overlays[e.overlays[n].options.id];if(o)o.updateFrom(e.overlays[n].options),i[e.overlays[n].options.id]=!0,this.instance.reattachOverlay(o,this);else{var r=this.getCachedTypeItem("overlay",e.overlays[n].options.id);null!=r?(this.instance.reattachOverlay(r,this),r.setVisible(!0),r.updateFrom(e.overlays[n].options),this.overlays[r.id]=r):r=this.addOverlay(e.overlays[n]),i[r.id]=!0}}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(e){this.paintStyle=e,this.paintStyleInUse=this.paintStyle,Pt(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(e){this.hoverPaintStyle=e,Pt(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(e){null!=e&&t(this.parameters,e)}},{key:"setVisible",value:function(e){this.visible=e,e?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(e,t){this.overlayPositions[e.id]=t}},{key:"getAbsoluteOverlayPosition",value:function(e){return this.overlayPositions?this.overlayPositions[e.id]:null}},{key:"_clazzManip",value:function(e,t){for(var n in this.overlays)"add"===e?this.instance.addOverlayClass(this.overlays[n],t):e===Et&&this.instance.removeOverlayClass(this.overlays[n],t)}},{key:"addClass",value:function(e,t){var n=(this.cssClass||"").split(" ");n.push(e),this.cssClass=n.join(" "),this._clazzManip("add",e)}},{key:"removeClass",value:function(e,t){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter((function(t){return t!==e})).join(" "),this._clazzManip(Et,e)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(e){this.data=e||{}}},{key:"mergeData",value:function(e){this.data=t(this.data,e)}},{key:"addOverlay",value:function(e){var n=function(e,n){var i=null;if(o(n))i=vt(e.instance,n,e,{});else if(null!=n.type&&null!=n.options){var r=n,s=t({},r.options);i=vt(e.instance,r.type,e,s)}else i=n;return i.id=i.id||C(),e.cacheTypeItem("overlay",i,i.id),e.overlays[i.id]=i,i}(this,e);if(this.getData&&n.type===gt.type&&!o(e)){var i=this.getData(),r=e.options;if(i){var s=i[r.labelLocationAttribute||"labelLocation"];s&&(n.location=s)}}return n}},{key:"getOverlay",value:function(e){return this.overlays[e]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i in t=t||[],this.overlays)0!==t.length&&-1===t.indexOf(i)||this.overlays[i].setVisible(!1)}},{key:"showOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!0)}},{key:"showOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i in t=t||[],this.overlays)0!==t.length&&-1===t.indexOf(i)||this.overlays[i].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(e,t){var n=this.overlays[e];n&&(n.setVisible(!1),t||this.instance.destroyOverlay(n),delete this.overlays[e],this.overlayPositions&&delete this.overlayPositions[e],this.overlayPlacements&&delete this.overlayPlacements[e])}},{key:"removeOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,o=t.length;i<o;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function(){var e=this.getLabelOverlay();return null!=e?e.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(kt)}},{key:"setLabel",value:function(e){var n,i,r,s=this.getLabelOverlay();if(s)if(o(e)||a(e))s.setLabel(e);else{var l=e;l.label&&s.setLabel(l.label),l.location&&(s.location=l.location)}else{var c=o(e)||a(e)?{label:e}:e;n=this,r=t({cssClass:(i=c).cssClass,id:kt,component:n},i),s=new gt(n.instance,n,r),this.overlays.__label=s}}}]),i}(X);!function(e){e.top="top",e.left="left",e.right="right",e.bottom="bottom"}(Mt||(Mt={}));var jt=Mt.top,It=Mt.left,Ot=Mt.right,Gt=Mt.bottom,Lt=[It,Ot],Ft=[jt,Gt],Bt=function(){function e(t,n){re(this,e),this.instance=t,this.element=n,le(this,"isFloating",!0),le(this,"isContinuous",void 0),le(this,"isDynamic",void 0),le(this,"locations",[]),le(this,"currentLocation",0),le(this,"locked",!1),le(this,"cssClass",""),le(this,"timestamp",null),le(this,"type","Floating"),le(this,"id",C()),le(this,"orientation",[0,0]),le(this,"size",void 0),this.size=t.getSize(n),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return ae(e,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(e){this.orientation=this.instance.router.getEndpointOrientation(e),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),e}(),Rt=(le(wt={},jt,Gt),le(wt,Ot,It),le(wt,It,Ot),le(wt,Gt,jt),wt),Ht=(le(At={},jt,Ot),le(At,Ot,Gt),le(At,It,jt),le(At,Gt,It),At),Nt=(le(Dt={},jt,It),le(Dt,Ot,jt),le(Dt,It,Gt),le(Dt,Gt,Ot),Dt);function Xt(e){return 0===e.faces.length?jt:e.faces[0]}function Yt(e,t){return-1!==e.faces.indexOf(t)}function Vt(e,t){return null==e.lockedAxis?null==e.lockedFace?!0===Yt(e,t):e.lockedFace===t:-1!==e.lockedAxis.indexOf(t)}function zt(e,t){if(Yt(e,t))return t;if(Yt(e,Rt[t]))return Rt[t];var n=function(e,t){return(e.clockwise?Ht:Nt)[t]}(e,t);if(Yt(e,n))return n;var i=function(e,t){return(e.clockwise?Nt:Ht)[t]}(e,t);return Yt(e,i)?i:t}var Ut={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},qt={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},Wt={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},Jt={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},Zt={Top:[Ut],Bottom:[qt],Left:[Wt],Right:[Jt],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[Ut,Wt,qt,Jt]},Qt={Continuous:{faces:[jt,It,Gt,Ot]},ContinuousTop:{faces:[jt]},ContinuousRight:{faces:[Ot]},ContinuousBottom:{faces:[Gt]},ContinuousLeft:{faces:[It]},ContinuousLeftRight:{faces:[It,Ot]},ContinuousTopBottom:{faces:[jt,Gt]}};function $t(e,n){if(n=n||{},e===N.Perimeter)return function(e){var n=(e=e||{}).anchorCount||60,i=e.shape;if(!i)throw new Error("no shape supplied to Perimeter Anchor type");if(!an.has(i))throw new Error("Shape ["+i+"] is unknown by Perimeter Anchor type");var o=an.get(i)(n);e.rotation&&(o=function(e,t){for(var n=[],i=t/180*Math.PI,o=0;o<e.length;o++){var r=e[o].x-.5,s=e[o].y-.5;n.push({x:r*Math.cos(i)-s*Math.sin(i)+.5,y:r*Math.sin(i)+s*Math.cos(i)+.5,ox:e[o].ox,oy:e[o].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(o,e.rotation));return t(Kt(N.Perimeter,o,e),{shape:i})}(n);var i=Zt[e];if(null!=i)return Kt(e,w(i,(function(e){return t({iox:e.ox,ioy:e.oy},e)})),n);if(null!=(i=Qt[e]))return function(e,t,n){var i={type:e,locations:[],currentLocation:0,locked:!1,id:C(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||t,lockedFace:null,lockedAxis:null,clockwise:!(!1===n.clockwise),__currentFace:null};return Object.defineProperty(i,en,{get:function(){return this.__currentFace},set:function(e){this.__currentFace=zt(this,e)}}),i}(e,i.faces,n);throw{message:"jsPlumb: unknown anchor type '"+e+"'"}}function Kt(e,t,n){return{type:e,locations:t,currentLocation:0,locked:!1,id:C(),isFloating:!1,isContinuous:!1,isDynamic:t.length>1,timestamp:null,cssClass:n.cssClass||""}}var en="currentFace";function tn(e){return e.length<7&&e.every(i)||7===e.length&&e.slice(0,5).every(i)&&o(e[6])}function nn(e){if(o(e))return $t(e,null);if(Array.isArray(e)){if(tn(e)){var n=e;return Kt(null,[{x:n[0],y:n[1],ox:n[2],oy:n[3],offx:null==n[4]?0:n[4],offy:null==n[5]?0:n[5],iox:n[2],ioy:n[3],cls:n[6]||""}],{cssClass:n[6]||""})}return Kt("Dynamic",w(e,(function(e){if(o(e)){var n=Zt[e];return null!=n?t({iox:n[0].ox,ioy:n[0].oy,cls:""},n[0]):null}if(tn(e))return{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:null==e[4]?0:e[4],offy:null==e[5]?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}})).filter((function(e){return null!=e})),{})}var i=e;return $t(i.type,i.options)}function on(e){for(var t=.5,n=2*Math.PI/e,i=[],o=0,r=0;r<e;r++){var s=t+t*Math.sin(o),a=t+t*Math.cos(o);i.push({x:s,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),o+=n}return i}function rn(e,t){for(var n=[],i=0;i<e.length;i++)n.push([e[i][0],e[i][1],e[i][2],e[i][3],1/e.length,e[i][4],e[i][5]]);return function(e,t){for(var n=t/e.length,i=[],o=function(e,o,r,s,a,l,c){for(var u=(r-e)/(n=t*a),h=(s-o)/n,d=0;d<n;d++)i.push({x:e+u*d,y:o+h*d,ox:null==l?0:l,oy:null==c?0:c,offx:0,offy:0,iox:0,ioy:0,cls:""})},r=0;r<e.length;r++)o.apply(null,e[r]);return i}(n,t)}function sn(e){return rn([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],e)}var an=new Map;an.set(H.Circle,on),an.set(H.Ellipse,on),an.set(H.Rectangle,sn),an.set(H.Square,sn),an.set(H.Diamond,(function(e){return rn([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],e)})),an.set(H.Triangle,(function(e){return rn([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],e)}));var ln="anchors",cn="connector";function un(e,t,n,i,o,r,s){var a;if(t)e.endpoints[n]=t,t.addConnection(e);else{var l=s||e.endpointSpec||e.endpointsSpec[n]||e.instance.defaults.endpoints[n]||e.instance.defaults.endpoint,c=e.endpointStyles[n]||e.endpointStyle||e.instance.defaults.endpointStyles[n]||e.instance.defaults.endpointStyle;null==c.fill&&null!=e.paintStyle&&(c.fill=e.paintStyle.stroke),null==c.outlineStroke&&null!=e.paintStyle&&(c.outlineStroke=e.paintStyle.outlineStroke),null==c.outlineWidth&&null!=e.paintStyle&&(c.outlineWidth=e.paintStyle.outlineWidth);var u=e.endpointHoverStyles[n]||e.endpointHoverStyle||e.endpointHoverStyle||e.instance.defaults.endpointHoverStyles[n]||e.instance.defaults.endpointHoverStyle;null!=e.hoverPaintStyle&&(null==u&&(u={}),null==u.fill&&(u.fill=e.hoverPaintStyle.stroke));var h=e.uuids?e.uuids[n]:null;i=null!=i?i:null!=e.instance.defaults.anchors?e.instance.defaults.anchors[n]:e.instance.defaults.anchor,a=e.instance._internal_newEndpoint({paintStyle:c,hoverPaintStyle:u,endpoint:l,connections:[e],uuid:h,element:o,scope:e.scope,anchor:i,reattachConnections:e.reattach||e.instance.defaults.reattachConnections,connectionsDetachable:e.detachable||e.instance.defaults.connectionsDetachable}),null==t&&(a.deleteOnEmpty=!0),e.endpoints[n]=a}return a}var hn=function(e){ce(i,e);var n=fe(i);function i(e,o){var r;re(this,i),(r=n.call(this,e,o)).instance=e,le(de(r),"connector",void 0),le(de(r),"defaultLabelLocation",.5),le(de(r),"scope",void 0),le(de(r),"typeId","_jsplumb_connection"),le(de(r),"previousConnection",void 0),le(de(r),"sourceId",void 0),le(de(r),"targetId",void 0),le(de(r),"source",void 0),le(de(r),"target",void 0),le(de(r),"detachable",!0),le(de(r),"reattach",!1),le(de(r),"uuids",void 0),le(de(r),"cost",1),le(de(r),"directed",void 0),le(de(r),"endpoints",[null,null]),le(de(r),"endpointStyles",void 0),le(de(r),"endpointSpec",void 0),le(de(r),"endpointsSpec",void 0),le(de(r),"endpointStyle",{}),le(de(r),"endpointHoverStyle",{}),le(de(r),"endpointHoverStyles",void 0),le(de(r),"suspendedEndpoint",void 0),le(de(r),"suspendedIndex",void 0),le(de(r),"suspendedElement",void 0),le(de(r),"suspendedElementId",void 0),le(de(r),"suspendedElementType",void 0),le(de(r),"_forceReattach",void 0),le(de(r),"_forceDetach",void 0),le(de(r),"proxies",[]),le(de(r),"pending",!1),r.id=o.id,r.previousConnection=o.previousConnection,r.source=o.source,r.target=o.target,o.sourceEndpoint?(r.source=o.sourceEndpoint.element,r.sourceId=o.sourceEndpoint.elementId):r.sourceId=e.getId(r.source),o.targetEndpoint?(r.target=o.targetEndpoint.element,r.targetId=o.targetEndpoint.elementId):r.targetId=e.getId(r.target),r.scope=o.scope;var a=o.anchors?o.anchors[0]:o.anchor,l=o.anchors?o.anchors[1]:o.anchor;e.manage(r.source),e.manage(r.target),r.visible=!0,r.params={cssClass:o.cssClass,hoverClass:o.hoverClass,"pointer-events":o["pointer-events"],overlays:o.overlays},r.lastPaintedAt=null,o.type&&(o.endpoints=o.endpoints||r.instance._deriveEndpointAndAnchorSpec(o.type).endpoints),r.endpointSpec=o.endpoint,r.endpointsSpec=o.endpoints||[null,null],r.endpointStyle=o.endpointStyle,r.endpointHoverStyle=o.endpointHoverStyle,r.endpointStyles=o.endpointStyles||[null,null],r.endpointHoverStyles=o.endpointHoverStyles||[null,null],r.paintStyle=o.paintStyle,r.hoverPaintStyle=o.hoverPaintStyle,r.uuids=o.uuids,r.makeEndpoint(!0,r.source,r.sourceId,a,o.sourceEndpoint),r.makeEndpoint(!1,r.target,r.targetId,l,o.targetEndpoint),r.scope||(r.scope=r.endpoints[0].scope),null!=o.deleteEndpointsOnEmpty&&(r.endpoints[0].deleteOnEmpty=o.deleteEndpointsOnEmpty,r.endpoints[1].deleteOnEmpty=o.deleteEndpointsOnEmpty);var c=r.instance.defaults.connectionsDetachable;!1===o.detachable&&(c=!1),!1===r.endpoints[0].connectionsDetachable&&(c=!1),!1===r.endpoints[1].connectionsDetachable&&(c=!1),r.endpointsSpec=o.endpoints||[null,null],r.endpointSpec=o.endpoint||null;var u=o.reattach||r.endpoints[0].reattachConnections||r.endpoints[1].reattachConnections||r.instance.defaults.reattachConnections;if(r.appendToDefaultType({detachable:c,reattach:u,paintStyle:r.endpoints[0].connectorStyle||r.endpoints[1].connectorStyle||o.paintStyle||r.instance.defaults.paintStyle,hoverPaintStyle:r.endpoints[0].connectorHoverStyle||r.endpoints[1].connectorHoverStyle||o.hoverPaintStyle||r.instance.defaults.hoverPaintStyle}),!r.instance._suspendDrawing){var h=r.instance._suspendedAt||C();r.instance._paintEndpoint(r.endpoints[0],{timestamp:h}),r.instance._paintEndpoint(r.endpoints[1],{timestamp:h})}r.cost=o.cost||r.endpoints[0].connectionCost,r.directed=o.directed,null==o.directed&&(r.directed=r.endpoints[0].connectionsDirected);var d=t({},r.endpoints[1].parameters);t(d,r.endpoints[0].parameters),t(d,r.parameters),r.parameters=d,r.paintStyleInUse=r.getPaintStyle()||{},r.setConnector(r.endpoints[0].connector||r.endpoints[1].connector||o.connector||r.instance.defaults.connector,!0);var p=null!=o.data&&s(o.data)?o.data:{};r.setData(p);var f=[te,r.endpoints[0].edgeType,r.endpoints[1].edgeType,o.type].join(" ");return/[^\s]/.test(f)&&r.addType(f,o.data),r}return ae(i,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return"connectionOverlays"}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(e,t,n,i,o){return n=n||this.instance.getId(t),un(this,o,e?0:1,i,t)}},{key:"getTypeDescriptor",value:function(){return i.type}},{key:"isDetachable",value:function(e){return!1!==this.detachable&&(null!=e?!0===e.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function(e){this.detachable=!0===e}},{key:"isReattach",value:function(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function(e){this.reattach=!0===e}},{key:"applyType",value:function(e,t){var n=null;null!=e.connector&&(null==(n=this.getCachedTypeItem(cn,t.connector))&&(n=this.prepareConnector(e.connector,t.connector),this.cacheTypeItem(cn,n,t.connector)),this.setPreparedConnector(n)),ve(ue(i.prototype),"applyType",this).call(this,e,t),null!=e.detachable&&this.setDetachable(e.detachable),null!=e.reattach&&this.setReattach(e.reattach),e.scope&&(this.scope=e.scope);var o=null;e.anchor?null==(o=this.getCachedTypeItem(ln,t.anchor))&&(o=[nn(e.anchor),nn(e.anchor)],this.cacheTypeItem(ln,o,t.anchor)):e.anchors&&null==(o=this.getCachedTypeItem(ln,t.anchors))&&(o=[nn(e.anchors[0]),nn(e.anchors[1])],this.cacheTypeItem(ln,o,t.anchors)),null!=o&&(this.instance.router.setConnectionAnchors(this,o),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,e)}},{key:"addClass",value:function(e,t){ve(ue(i.prototype),"addClass",this).call(this,e),t&&(this.endpoints[0].addClass(e),this.endpoints[1].addClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(e)),this.connector&&this.instance.addConnectorClass(this.connector,e)}},{key:"removeClass",value:function(e,t){ve(ue(i.prototype),"removeClass",this).call(this,e),t&&(this.endpoints[0].removeClass(e),this.endpoints[1].removeClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(e)),this.connector&&this.instance.removeConnectorClass(this.connector,e)}},{key:"setVisible",value:function(e){ve(ue(i.prototype),"setVisible",this).call(this,e),this.connector&&this.instance.setConnectorVisible(this.connector,e),this.instance._paintConnection(this)}},{key:"destroy",value:function(){ve(ue(i.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(e,t){var n,i={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};if(o(e))n=this.instance._makeConnector(this,e,i);else{var r=e;n=this.instance._makeConnector(this,r.type,c(r.options,i))}return null!=t&&(n.typeId=t),n}},{key:"setPreparedConnector",value:function(e,t,n,i){if(this.connector!==e){var o,r="";if(null!=this.connector&&(o=this.connector,r=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=e,i&&this.cacheTypeItem(cn,e,i),this.addClass(r),null!=o){var s=this.getOverlays();for(var a in s)this.instance.reattachOverlay(s[a],this)}t||this.instance._paintConnection(this)}}},{key:"setConnector",value:function(e,t,n,i){var o=this.prepareConnector(e,i);this.setPreparedConnector(o,t,n,i)}},{key:"replaceEndpoint",value:function(e,t){var n=this.endpoints[e],i=(n.elementId,this.instance.getEndpoints(n.element)),o=i.indexOf(n),r=un(this,null,e,null,n.element,0,t);this.endpoints[e]=r,i.splice(o,1,r),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire("endpoint:replaced",{previous:n,current:r})}}]),i}(Tt);le(hn,"type","connection");var dn=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],pn=function(e){ce(i,e);var n=fe(i);function i(e,t){var o;re(this,i),(o=n.call(this,e,t)).instance=e,le(de(o),"connections",[]),le(de(o),"endpoint",void 0),le(de(o),"element",void 0),le(de(o),"elementId",void 0),le(de(o),"dragAllowedWhenFull",!0),le(de(o),"timestamp",void 0),le(de(o),"portId",void 0),le(de(o),"maxConnections",void 0),le(de(o),"proxiedBy",void 0),le(de(o),"connectorClass",void 0),le(de(o),"connectorHoverClass",void 0),le(de(o),"finalEndpoint",void 0),le(de(o),"enabled",!0),le(de(o),"isSource",void 0),le(de(o),"isTarget",void 0),le(de(o),"isTemporarySource",void 0),le(de(o),"connectionCost",1),le(de(o),"connectionsDirected",void 0),le(de(o),"connectionsDetachable",void 0),le(de(o),"reattachConnections",void 0),le(de(o),"currentAnchorClass",void 0),le(de(o),"referenceEndpoint",void 0),le(de(o),"edgeType",void 0),le(de(o),"connector",void 0),le(de(o),"connectorOverlays",void 0),le(de(o),"connectorStyle",void 0),le(de(o),"connectorHoverStyle",void 0),le(de(o),"deleteOnEmpty",void 0),le(de(o),"uuid",void 0),le(de(o),"scope",void 0),le(de(o),"_anchor",void 0),le(de(o),"defaultLabelLocation",[.5,.5]),o.appendToDefaultType({edgeType:t.edgeType,maxConnections:null==t.maxConnections?o.instance.defaults.maxConnections:t.maxConnections,paintStyle:t.paintStyle||o.instance.defaults.endpointStyle,hoverPaintStyle:t.hoverPaintStyle||o.instance.defaults.endpointHoverStyle,connectorStyle:t.connectorStyle,connectorHoverStyle:t.connectorHoverStyle,connectorClass:t.connectorClass,connectorHoverClass:t.connectorHoverClass,connectorOverlays:t.connectorOverlays,connector:t.connector}),o.enabled=!(!1===t.enabled),o.visible=!0,o.element=t.element,o.uuid=t.uuid,o.portId=t.portId,o.elementId=t.elementId,o.connectionCost=null==t.connectionCost?1:t.connectionCost,o.connectionsDirected=t.connectionsDirected,o.currentAnchorClass="",o.events={},o.connectorOverlays=t.connectorOverlays,o.connectorStyle=t.connectorStyle,o.connectorHoverStyle=t.connectorHoverStyle,o.connector=t.connector,o.edgeType=t.edgeType,o.connectorClass=t.connectorClass,o.connectorHoverClass=t.connectorHoverClass,o.deleteOnEmpty=!0===t.deleteOnEmpty,o.isSource=t.source||!1,o.isTemporarySource=t.isTemporarySource||!1,o.isTarget=t.target||!1,o.connections=t.connections||[],o.scope=t.scope||e.defaultScope,o.timestamp=null,o.reattachConnections=t.reattachConnections||e.defaults.reattachConnections,o.connectionsDetachable=e.defaults.connectionsDetachable,!1===t.connectionsDetachable&&(o.connectionsDetachable=!1),o.dragAllowedWhenFull=!1!==t.dragAllowedWhenFull,t.onMaxConnections&&o.bind(at,t.onMaxConnections);var r=t.endpoint||t.existingEndpoint||e.defaults.endpoint;if(o.setEndpoint(r),null!=t.preparedAnchor)o.setPreparedAnchor(t.preparedAnchor);else{var s=t.anchor?t.anchor:t.anchors?t.anchors:e.defaults.anchor||N.Top;o.setAnchor(s)}var a=[te,t.type||""].join(" ");return o.addType(a,t.data),o}return ae(i,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var e=this._anchor&&this._anchor.cssClass;if(null!=e&&e.length>0){var t=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=e;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");t!==n&&(this.removeClass(t),this.addClass(n),this.instance.removeClass(this.element,t),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(e){return this.instance.router.setAnchor(this,e),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(e){this.fire("anchor:changed",{endpoint:this,anchor:e}),this._updateAnchorClass()}},{key:"setAnchor",value:function(e){var t=this.instance.router.prepareAnchor(e);return this.setPreparedAnchor(t),this}},{key:"addConnection",value:function(e){var t=this.isFull(),n=0===this.connections.length;this.connections.push(e),n&&this.addClass(this.instance.endpointConnectedClass),this.isFull()?t||this.addClass(this.instance.endpointFullClass):t&&this.removeClass(this.instance.endpointFullClass)}},{key:"detachFromConnection",value:function(e,t,n){(t=null==t?this.connections.indexOf(e):t)>=0&&(this.connections.splice(t,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(e){for(var t=this.connections.length,n=0;n<t;n++)this.instance.deleteConnection(this.connections[0],e)}},{key:"detachFrom",value:function(e){for(var t=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==e&&this.connections[n].endpoints[0]!==e||t.push(this.connections[n]);for(var i=0,o=t.length;i<o;i++)this.instance.deleteConnection(t[0]);return this}},{key:"setVisible",value:function(e,t,n){if(ve(ue(i.prototype),"setVisible",this).call(this,e),this.endpoint.setVisible(e),e?this.showOverlays():this.hideOverlays(),!t)for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(e),!n){var r=this===this.connections[o].endpoints[0]?1:0;1===this.connections[o].endpoints[r].connections.length&&this.connections[o].endpoints[r].setVisible(e,!0,!0)}}},{key:"applyType",value:function(e,n){ve(ue(i.prototype),"applyType",this).call(this,e,n),this.setPaintStyle(e.endpointStyle||e.paintStyle),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle),this.connectorStyle=e.connectorStyle,this.connectorHoverStyle=e.connectorHoverStyle,this.connector=e.connector,this.connectorOverlays=e.connectorOverlays,this.edgeType=e.edgeType,null!=e.maxConnections&&(this.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),t(e,dn),this.instance.applyEndpointType(this,e)}},{key:"destroy",value:function(){ve(ue(i.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(e){var t=!1;if(e)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===e||this.connections[n].endpoints[0]===e){t=!0;break}return t}},{key:"setDragAllowedWhenFull",value:function(e){this.dragAllowedWhenFull=e}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(e,n){var i,r={cssClass:this.cssClass,endpoint:this};if(T(e,Ce)){var s=e;i=Ee.clone(s)}else if(o(e))i=Ee.get(this,e,r);else{var a=e;t(r,a.options||{}),i=Ee.get(this,a.type,r)}return i.typeId=n,i}},{key:"setEndpoint",value:function(e){var t=this.prepareEndpoint(e);this.setPreparedEndpoint(t)}},{key:"setPreparedEndpoint",value:function(e){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=e}},{key:"addClass",value:function(e,t){ve(ue(i.prototype),"addClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.addClass(e)}},{key:"removeClass",value:function(e,t){ve(ue(i.prototype),"removeClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.removeClass(e)}}]),i}(Tt),fn=function e(t,n){re(this,e),this.instance=t,this.el=n,le(this,"group",void 0)},vn=function(e){ce(n,e);var t=fe(n);function n(e,i,o){var r;re(this,n),(r=t.call(this,e,i)).instance=e,le(de(r),"children",[]),le(de(r),"collapsed",!1),le(de(r),"droppable",void 0),le(de(r),"enabled",void 0),le(de(r),"orphan",void 0),le(de(r),"constrain",void 0),le(de(r),"proxied",void 0),le(de(r),"ghost",void 0),le(de(r),"revert",void 0),le(de(r),"prune",void 0),le(de(r),"dropOverride",void 0),le(de(r),"anchor",void 0),le(de(r),"endpoint",void 0),le(de(r),"connections",{source:[],target:[],internal:[]}),le(de(r),"manager",void 0),le(de(r),"id",void 0),le(de(r),"elId",void 0);var s=r.el;return s._isJsPlumbGroup=!0,s._jsPlumbGroup=de(r),r.elId=e.getId(i),r.orphan=!0===o.orphan,r.revert=!0!==r.orphan&&!1!==o.revert,r.droppable=!1!==o.droppable,r.ghost=!0===o.ghost,r.enabled=!1!==o.enabled,r.prune=!0!==r.orphan&&!0===o.prune,r.constrain=r.ghost||!0===o.constrain,r.proxied=!1!==o.proxied,r.id=o.id||C(),r.dropOverride=!0===o.dropOverride,r.anchor=o.anchor,r.endpoint=o.endpoint,r.anchor=o.anchor,e.setAttribute(i,ze,""),r}return ae(n,[{key:"overrideDrop",value:function(e,t){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(e,t){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(e,t){return this.endpoint||{type:Se.type,options:{radius:10}}}},{key:"add",value:function(e,t){var n=this.instance.getGroupContentArea(this),i=e;if(null!=i._jsPlumbParentGroup){if(i._jsPlumbParentGroup===this)return;i._jsPlumbParentGroup.remove(e,!0,t,!1)}i._jsPlumbParentGroup=this,this.children.push(new fn(this.instance,e)),this.instance._appendElement(i,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(e){return null==e?null:f(this.children,(function(t){return t.el===e}))}},{key:"remove",value:function(e,t,n,i,o){var r=this.resolveNode(e);null!=r&&this._doRemove(r,t,n,i,o)}},{key:"_doRemove",value:function(e,t,n,i,o){var r=e.el;if(delete r._jsPlumbParentGroup,g(this.children,(function(t){return t===e})),t)try{this.instance.getGroupContentArea(this).removeChild(r)}catch(e){A("Could not remove element from Group "+e)}if(!n){var s={group:this,el:r};o&&(s.targetGroup=o),this.instance.fire("group:member:removed",s)}i||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(e,t){for(var n=0,i=this.children.length;n<i;n++){var o=this.children[0];this._doRemove(o,e,t,!0),this.instance.unmanage(o.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var e={},t=0;t<this.children.length;t++){var n=this.manager.orphan(this.children[t].el,!1);e[n.id]=n.pos}return this.children.length=0,e}},{key:"addGroup",value:function(e){if(this.instance.allowNestedGroups&&e!==this){if(this.instance.groupManager.isAncestor(this,e))return!1;null!=e.group&&e.group.removeGroup(e);var t=this.instance.getId(e.el);this.instance.getManagedElements()[t].group=this.elId;var n=this.instance.getOffsetRelativeToRoot(e.el),i=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));e.el._jsPlumbParentGroup=this,this.children.push(e),this.instance._appendElement(e.el,this.instance.getGroupContentArea(this)),e.group=this;var o={x:n.x-i.x,y:n.y-i.y};return this.instance.setPosition(e.el,o),this.instance.fire("group:nested:added",{parent:this,child:e}),!0}return!1}},{key:"removeGroup",value:function(e){if(e.group===this){var t=e.el,n=this.instance.getGroupContentArea(this);n===t.parentNode&&n.removeChild(e.el);var i=this.instance.getId(e.el),o=this.instance.getManagedElements()[i];o&&delete o.group,this.children=this.children.filter((function(t){return t.id!==e.id})),delete e.group,delete t._jsPlumbParentGroup,this.instance.fire("group:nested:removed",{parent:this,child:e})}}},{key:"getGroups",value:function(){return this.children.filter((function(e){return e.constructor===n}))}},{key:"getNodes",value:function(){return this.children.filter((function(e){return e.constructor===fn}))}},{key:"collapseParent",get:function(){var e=null;if(null==this.group)return null;for(var t=this.group;null!=t;)t.collapsed&&(e=t),t=t.group;return e}}]),n}(fn),yn=function(){function e(t){var n=this;re(this,e),this.instance=t,le(this,"groupMap",{}),le(this,"_connectionSourceMap",{}),le(this,"_connectionTargetMap",{}),t.bind(nt,(function(e){var t=n.getGroupFor(e.source),i=n.getGroupFor(e.target);null!=t&&null!=i&&t===i?(n._connectionSourceMap[e.connection.id]=t,n._connectionTargetMap[e.connection.id]=t,b(t.connections.internal,e.connection)):(null!=t&&(e.target._jsPlumbGroup===t?b(t.connections.internal,e.connection):b(t.connections.source,e.connection),n._connectionSourceMap[e.connection.id]=t),null!=i&&(e.source._jsPlumbGroup===i?b(i.connections.internal,e.connection):b(i.connections.target,e.connection),n._connectionTargetMap[e.connection.id]=i))})),t.bind(rt,(function(e){n._cleanupDetachedConnection(e.connection)})),t.bind(it,(function(e){var t=e.originalEndpoint.element,i=n.getGroupFor(t),o=e.connection.endpoints[e.index].element,r=n.getGroupFor(o),s=0===e.index?n._connectionSourceMap:n._connectionTargetMap,a=0===e.index?n._connectionTargetMap:n._connectionSourceMap;null!=r?(s[e.connection.id]=r,e.connection.source===e.connection.target&&(a[e.connection.id]=r)):(delete s[e.connection.id],e.connection.source===e.connection.target&&delete a[e.connection.id]),null!=i&&n._updateConnectionsForGroup(i),null!=r&&n._updateConnectionsForGroup(r)}))}return ae(e,[{key:"_cleanupDetachedConnection",value:function(e){e.proxies.length=0;var t,n=this._connectionSourceMap[e.id];null!=n&&(t=function(t){return t.id===e.id},g(n.connections.source,t),g(n.connections.target,t),g(n.connections.internal,t),delete this._connectionSourceMap[e.id]),null!=(n=this._connectionTargetMap[e.id])&&(t=function(t){return t.id===e.id},g(n.connections.source,t),g(n.connections.target,t),g(n.connections.internal,t),delete this._connectionTargetMap[e.id])}},{key:"addGroup",value:function(e){var t=e.el;if(null!=this.groupMap[e.id])throw new Error("cannot create Group ["+e.id+"]; a Group with that ID exists");if(null!=t._isJsPlumbGroup)throw new Error("cannot create Group ["+e.id+"]; the given element is already a Group");var n=new vn(this.instance,e.el,e);return this.groupMap[n.id]=n,e.collapsed&&this.collapseGroup(n),this.instance.manage(n.el),this.instance.addClass(n.el,et),n.manager=this,this._updateConnectionsForGroup(n),this.instance.fire("group:added",{group:n}),n}},{key:"getGroup",value:function(e){var t=e;if(o(e)&&null==(t=this.groupMap[e]))throw new Error("No such group ["+e+"]");return t}},{key:"getGroupFor",value:function(e){for(var t=e,n=this.instance.getContainer(),i=!1,o=null;!i;)null==t||t===n?i=!0:t._jsPlumbParentGroup?(o=t._jsPlumbParentGroup,i=!0):t=t.parentNode;return o}},{key:"getGroups",value:function(){var e=[];for(var t in this.groupMap)e.push(this.groupMap[t]);return e}},{key:"removeGroup",value:function(e,t,n,i){var o=this,r=this.getGroup(e);this.expandGroup(r,!0);var s={};return d(r.children,(function(e){var t=o.instance.getManagedElements()[o.instance.getId(e.el)];t&&delete t.group})),t?(d(r.getGroups(),(function(e){return o.removeGroup(e,t,n)})),r.removeAll(n,i)):(r.group&&d(r.children,(function(e){return r.group.add(e.el)})),s=r.orphanAll()),r.group&&r.group.removeGroup(r),this.instance.unmanage(r.el,!0),delete this.groupMap[r.id],this.instance.fire("group:removed",{group:r}),s}},{key:"removeAllGroups",value:function(e,t,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],e,t,n)}},{key:"forEach",value:function(e){for(var t in this.groupMap)e(this.groupMap[t])}},{key:"orphan",value:function(e,t){var n=e;if(n._jsPlumbParentGroup){var i=n._jsPlumbParentGroup,o=this.instance.getOffset(n),r=this.instance.getId(n),s=this.instance.getOffset(e);return n.parentNode.removeChild(n),!0!==t&&i.group?(s.x+=o.x,s.y+=o.y,this.instance.getGroupContentArea(i.group).appendChild(e)):this.instance._appendElement(e,this.instance.getContainer()),this.instance.setPosition(e,s),delete n._jsPlumbParentGroup,{id:r,pos:s}}}},{key:"_updateConnectionsForGroup",value:function(e){var t=this;e.connections.source.length=0,e.connections.target.length=0,e.connections.internal.length=0;var n=e.children.slice().map((function(e){return e.el})),i=[];if(d(n,(function(e){Array.prototype.push.apply(i,t.instance.getSelector(e,ht))})),Array.prototype.push.apply(n,i),n.length>0){var o,r,s=this.instance.getConnections({source:n,scope:oe},!0),a=this.instance.getConnections({target:n,scope:oe},!0),l={},c=function(n){for(var i=0;i<n.length;i++)l[n[i].id]||(l[n[i].id]=!0,o=t.getGroupFor(n[i].source),r=t.getGroupFor(n[i].target),n[i].source===e.el&&r===e||n[i].target===e.el&&o===e?e.connections.internal.push(n[i]):o===e?(r!==e?e.connections.source.push(n[i]):e.connections.internal.push(n[i]),t._connectionSourceMap[n[i].id]=e):r===e&&(e.connections.target.push(n[i]),t._connectionTargetMap[n[i].id]=e))};c(s),c(a)}}},{key:"_collapseConnection",value:function(e,t,n){var i=e.endpoints[0===t?1:0].element;if(i._jsPlumbParentGroup&&!i._jsPlumbParentGroup.proxied&&i._jsPlumbParentGroup.collapsed)return!1;var o=e.endpoints[0].element._jsPlumbParentGroup,r=null!=o?o.collapseParent||o:null,s=e.endpoints[1].element._jsPlumbParentGroup,a=null!=s?s.collapseParent||s:null;if(null==r||null==a||r.id!==a.id){var l=n.el;return this.instance.getId(l),this.instance.proxyConnection(e,t,l,(function(e,t){return n.getEndpoint(e,t)}),(function(e,t){return n.getAnchor(e,t)})),!0}return!1}},{key:"_expandConnection",value:function(e,t,n){this.instance.unproxyConnection(e,t)}},{key:"isElementDescendant",value:function(e,t){for(var n=this.instance.getContainer();;){if(null==e||e===n)return!1;if(e===t)return!0;e=e.parentNode}}},{key:"collapseGroup",value:function(e){var t=this,n=this.getGroup(e);if(null!=n&&!n.collapsed){var i=n.el;if(null==n.collapseParent){if(this.instance.setGroupVisible(n,!1),n.collapsed=!0,this.instance.removeClass(i,et),this.instance.addClass(i,Ke),n.proxied){var o=new Set,r=function(e,i){for(var r=0;r<e.length;r++){var s=e[r];!0===t._collapseConnection(s,i,n)&&o.add(s.id)}};r(n.connections.source,0),r(n.connections.target,1),d(n.getGroups(),(function(e){t.cascadeCollapse(n,e,o)}))}this.instance.revalidate(i),this.repaintGroup(n),this.instance.fire("group:collapse",{group:n})}else n.collapsed=!0,this.instance.removeClass(i,et),this.instance.addClass(i,Ke)}}},{key:"cascadeCollapse",value:function(e,t,n){var i=this;if(e.proxied){var o=function(t,o){for(var r=0;r<t.length;r++){var s=t[r];n.has(s.id)||!0===i._collapseConnection(s,o,e)&&n.add(s.id)}};o(t.connections.source,0),o(t.connections.target,1)}d(t.getGroups(),(function(t){i.cascadeCollapse(e,t,n)}))}},{key:"expandGroup",value:function(e,t){var n=this,i=this.getGroup(e);if(null!=i){var o=i.el;if(null==i.collapseParent){if(this.instance.setGroupVisible(i,!0),i.collapsed=!1,this.instance.addClass(o,et),this.instance.removeClass(o,Ke),i.proxied){var r=function(e,t){for(var o=0;o<e.length;o++){var r=e[o];n._expandConnection(r,t,i)}};r(i.connections.source,0),r(i.connections.target,1);d(i.getGroups(),(function e(t,i){if(i||t.collapsed){var o=function(e,i){for(var o=0;o<e.length;o++){var r=e[o];n._collapseConnection(r,i,t.collapseParent||t)}};o(t.connections.source,0),o(t.connections.target,1),d(t.connections.internal,(function(e){return e.setVisible(!1)})),d(t.getGroups(),(function(t){return e(t,!0)}))}else n.expandGroup(t,!0)}))}this.instance.revalidate(o),this.repaintGroup(i),t||this.instance.fire("group:expand",{group:i})}else i.collapsed=!1,this.instance.addClass(o,et),this.instance.removeClass(o,Ke)}}},{key:"toggleGroup",value:function(e){null!=(e=this.getGroup(e))&&(e.collapsed?this.expandGroup(e):this.collapseGroup(e))}},{key:"repaintGroup",value:function(e){for(var t=this.getGroup(e).children,n=0;n<t.length;n++)this.instance.revalidate(t[n].el)}},{key:"addToGroup",value:function(e,t){var n=this,i=this.getGroup(e);if(i){for(var o=i.el,r=function(e){var r=e,s=null!=r._isJsPlumbGroup,a=r._jsPlumbGroup,l=r._jsPlumbParentGroup;if(l!==i){var c=n.instance.manage(e),u=n.instance.getOffset(e),h=i.collapsed?n.instance.getOffsetRelativeToRoot(o):n.instance.getOffset(n.instance.getGroupContentArea(i));c.group=i.elId,null!=l&&(l.remove(e,!1,t,!1,i),n._updateConnectionsForGroup(l)),s?i.addGroup(a):i.add(e,t);var d=function(e,t){var o=0===t?1:0;e.each((function(e){e.setVisible(!1),e.endpoints[o].element._jsPlumbGroup===i?(e.endpoints[o].setVisible(!1),n._expandConnection(e,o,i)):(e.endpoints[t].setVisible(!1),n._collapseConnection(e,t,i))}))};i.collapsed&&(d(n.instance.select({source:e}),0),d(n.instance.select({target:e}),1)),n.instance.getId(e);var p={x:u.x-h.x,y:u.y-h.y};if(n.instance.setPosition(e,p),n._updateConnectionsForGroup(i),n.instance.revalidate(e),!t){var f={group:i,el:e,pos:p};l&&(f.sourceGroup=l),n.instance.fire(st,f)}}},s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];d(a,r)}}},{key:"removeFromGroup",value:function(e,t){var n=this,i=this.getGroup(e);if(i){for(var o=function(e){if(i.collapsed){var o=function(t,o){for(var r=0;r<t.length;r++){var s=t[r];if(s.proxies)for(var a=0;a<s.proxies.length;a++)if(null!=s.proxies[a]){var l=s.proxies[a].originalEp.element;(l===e||n.isElementDescendant(l,e))&&n._expandConnection(s,o,i)}}};o(i.connections.source.slice(),0),o(i.connections.target.slice(),1)}i.remove(e,null,t);var r=n.instance.getManagedElements()[n.instance.getId(e)];r&&delete r.group},r=arguments.length,s=new Array(r>2?r-2:0),a=2;a<r;a++)s[a-2]=arguments[a];d(s,o)}}},{key:"getAncestors",value:function(e){for(var t=[],n=e.group;null!=n;)t.push(n),n=n.group;return t}},{key:"isAncestor",value:function(e,t){return null!=e&&null!=t&&-1!==this.getAncestors(e).indexOf(t)}},{key:"getDescendants",value:function(e){var t=[];return function e(n){var i=n.getGroups();t.push.apply(t,ge(i)),d(i,e)}(e),t}},{key:"isDescendant",value:function(e,t){return null!=e&&null!=t&&-1!==this.getDescendants(t).indexOf(e)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),e}(),gn=function(){function e(t,n){re(this,e),this.instance=t,this.entries=n}return ae(e,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(e){return d(this.entries,(function(t){return e(t)})),this}},{key:"get",value:function(e){return this.entries[e]}},{key:"addClass",value:function(e,t){return this.each((function(n){return n.addClass(e,t)})),this}},{key:"removeClass",value:function(e,t){return this.each((function(n){return n.removeClass(e,t)})),this}},{key:"removeAllOverlays",value:function(){return this.each((function(e){return e.removeAllOverlays()})),this}},{key:"setLabel",value:function(e){return this.each((function(t){return t.setLabel(e)})),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(e){var t=[];return this.each((function(n){return t.push(e(n))})),t}},{key:"addOverlay",value:function(e){return this.each((function(t){return t.addOverlay(e)})),this}},{key:"removeOverlay",value:function(e){return this.each((function(t){return t.removeOverlay(e)})),this}},{key:"removeOverlays",value:function(){return this.each((function(e){return e.removeOverlays()})),this}},{key:"showOverlay",value:function(e){return this.each((function(t){return t.showOverlay(e)})),this}},{key:"hideOverlay",value:function(e){return this.each((function(t){return t.hideOverlay(e)})),this}},{key:"setPaintStyle",value:function(e){return this.each((function(t){return t.setPaintStyle(e)})),this}},{key:"setHoverPaintStyle",value:function(e){return this.each((function(t){return t.setHoverPaintStyle(e)})),this}},{key:"setSuspendEvents",value:function(e){return this.each((function(t){return t.setSuspendEvents(e)})),this}},{key:"setParameter",value:function(e,t){return this.each((function(n){return n.parameters[e]=t})),this}},{key:"setParameters",value:function(e){return this.each((function(t){return t.parameters=e})),this}},{key:"setVisible",value:function(e){return this.each((function(t){return t.setVisible(e)})),this}},{key:"addType",value:function(e){return this.each((function(t){return t.addType(e)})),this}},{key:"toggleType",value:function(e){return this.each((function(t){return t.toggleType(e)})),this}},{key:"removeType",value:function(e){return this.each((function(t){return t.removeType(e)})),this}},{key:"bind",value:function(e,t){return this.each((function(n){return n.bind(e,t)})),this}},{key:"unbind",value:function(e,t){return this.each((function(n){return n.unbind(e,t)})),this}},{key:"setHover",value:function(e){var t=this;return this.each((function(n){return t.instance.setHover(n,e)})),this}}]),e}(),mn=function(e){ce(n,e);var t=fe(n);function n(){return re(this,n),t.apply(this,arguments)}return ae(n,[{key:"setEnabled",value:function(e){return this.each((function(t){return t.enabled=e})),this}},{key:"setAnchor",value:function(e){return this.each((function(t){return t.setAnchor(e)})),this}},{key:"deleteEveryConnection",value:function(){return this.each((function(e){return e.deleteEveryConnection()})),this}},{key:"deleteAll",value:function(){var e=this;return this.each((function(t){return e.instance.deleteEndpoint(t)})),this.clear(),this}}]),n}(gn),_n=function(e){ce(n,e);var t=fe(n);function n(){return re(this,n),t.apply(this,arguments)}return ae(n,[{key:"setDetachable",value:function(e){return this.each((function(t){return t.setDetachable(e)})),this}},{key:"setReattach",value:function(e){return this.each((function(t){return t.setReattach(e)})),this}},{key:"setConnector",value:function(e){return this.each((function(t){return t.setConnector(e)})),this}},{key:"deleteAll",value:function(){var e=this;this.each((function(t){return e.instance.deleteConnection(t)})),this.clear()}},{key:"repaint",value:function(){var e=this;return this.each((function(t){return e.instance._paintConnection(t)})),this}}]),n}(gn),xn=function e(){re(this,e),le(this,"affectedElements",new Set)};function bn(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var kn=function(e,t){var n=0;return t[1]>e[1]?n=-1:t[1]<e[1]&&(n=1),n},En=function(e,t){return-1*kn(e,t)};function Cn(e,t,n,i){!function(e,t,n,i){if(0===t.length)t.push(e);else{for(var o=i?-1:1,r=0,s=t.length,a=Math.floor((r+s)/2);s>r;)n(e,t[a])*o<0?s=a:r=a+1,a=Math.floor((r+s)/2);t.splice(a,0,e)}}([e,t],n,kn,i)}function Sn(e,t){var n=p(t,(function(t){return t[0]===e}));n>-1&&t.splice(n,1)}var Pn,wn=function(e){ce(n,e);var t=fe(n);function n(e){var i;return re(this,n),(i=t.call(this)).instance=e,le(de(i),"_currentTransaction",null),le(de(i),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),le(de(i),"_elementMap",new Map),le(de(i),"_transformedElementMap",new Map),le(de(i),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),i}return ae(n,[{key:"_updateBounds",value:function(e,t,n){null!=t&&(Sn(e,this._sortedElements.xmin),Sn(e,this._sortedElements.xmax),Sn(e,this._sortedElements.ymin),Sn(e,this._sortedElements.ymax),Cn(e,t.t.x,this._sortedElements.xmin,!1),Cn(e,t.t.x+t.t.w,this._sortedElements.xmax,!0),Cn(e,t.t.y,this._sortedElements.ymin,!1),Cn(e,t.t.y+t.t.h,this._sortedElements.ymax,!0),!0!==n&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var e=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach((function(t,n){e._sortedElements.xmin.push([n,t.t.x]),e._sortedElements.xmax.push([n,t.t.x+t.t.w]),e._sortedElements.ymin.push([n,t.t.y]),e._sortedElements.ymax.push([n,t.t.y+t.t.h])})),this._sortedElements.xmin.sort(kn),this._sortedElements.ymin.sort(kn),this._sortedElements.xmax.sort(En),this._sortedElements.ymax.sort(En),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(e,t,n){var i,o,r,s,a,l,c,u,h,d,p,f,v,y,g,m,_,x,b;t.t=(i=t.x,o=t.y,r=t.w,s=t.h,a=t.r,l=i+r/2,c=o+s/2,u=Math.cos(a/360*Math.PI*2),h=Math.sin(a/360*Math.PI*2),d=function(e,t){return{x:l+Math.round((e-l)*u-(t-c)*h),y:c+Math.round((t-c)*u-(e-l)*h)}},p=d(i,o),f=d(i+r,o),v=d(i+r,o+s),y=d(i,o+s),g=d(i+r/2,o+s/2),m=Math.min(p.x,f.x,v.x,y.x),_=Math.max(p.x,f.x,v.x,y.x),x=Math.min(p.y,f.y,v.y,y.y),b=Math.max(p.y,f.y,v.y,y.y),{x:m,y:x,w:_-m,h:b-x,c:g,r:a,x2:_,y2:b,cr:u,sr:h}),this._transformedElementMap.set(e,t.t),!0!==n&&this._updateBounds(e,t,n)}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new xn}},{key:"endTransaction",value:function(){var e=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach((function(t){var n=e.getPosition(t);e._finaliseUpdate(t,n,!0)})),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(e){var t=this;d(e,(function(e){return t.updateElement(e.id,e.x,e.y,e.width,e.height,e.rotation)}))}},{key:"updateElement",value:function(e,t,n,i,o,r,s){var a=M(this._elementMap,e,bn);return a.dirty=null==t&&null==a.x||null==n&&null==a.y||null==i&&null==a.w||null==o&&null==a.h,null!=t&&(a.x=t),null!=n&&(a.y=n),null!=i&&(a.w=i),null!=o&&(a.h=o),null!=r&&(a.r=r||0),a.c.x=a.x+a.w/2,a.c.y=a.y+a.h/2,a.x2=a.x+a.w,a.y2=a.y+a.h,null==this._currentTransaction?this._finaliseUpdate(e,a,s):this._currentTransaction.affectedElements.add(e),a}},{key:"refreshElement",value:function(e,t){var n=this.instance.getManagedElements(),i=n[e]?n[e].el:null;if(null!=i){var o=this.getSize(i),r=this.getOffset(i);return this.updateElement(e,r.x,r.y,o.w,o.h,null,t)}return null}},{key:"getSize",value:function(e){return this.instance.getSize(e)}},{key:"getOffset",value:function(e){return this.instance.getOffset(e)}},{key:"registerElement",value:function(e,t){return this.updateElement(e,0,0,0,0,0,t)}},{key:"addElement",value:function(e,t,n,i,o,r){return this.updateElement(e,t,n,i,o,r)}},{key:"rotateElement",value:function(e,t){var n=M(this._elementMap,e,bn);return n.r=t||0,this._finaliseUpdate(e,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,null,null,t,n,null)}},{key:"setPosition",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,t,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(e){Sn(e,this._sortedElements.xmin),Sn(e,this._sortedElements.xmax),Sn(e,this._sortedElements.ymin),Sn(e,this._sortedElements.ymax),this._elementMap.delete(e),this._transformedElementMap.delete(e),this._recalculateBounds()}},{key:"getPosition",value:function(e){return this._elementMap.get(e)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]),n}(X),An=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];re(this,e),this.selector=t,this.def=n,this.exclude=i,le(this,"id",void 0),this.id=C()}return ae(e,[{key:"setEnabled",value:function(e){this.def.enabled=e}},{key:"isEnabled",value:function(){return!1!==this.def.enabled}}]),e}(),Dn=function(e){ce(n,e);var t=fe(n);function n(e,i,o){var r;return re(this,n),(r=t.call(this,e,i,o)).def=i,le(de(r),"redrop",void 0),r.redrop=i.def.redrop||"strict",r}return n}(An),Mn=function(e){ce(n,e);var t=fe(n);function n(e,i,o){var r;return re(this,n),(r=t.call(this,e,i,o)).def=i,r}return n}(An);function Tn(e,t){return t.theta-e.theta}function jn(e,t){return(e.theta<0?-Math.PI-e.theta:Math.PI-e.theta)-(t.theta<0?-Math.PI-t.theta:Math.PI-t.theta)}var In=(le(Pn={},jt,jn),le(Pn,Ot,Tn),le(Pn,Gt,Tn),le(Pn,It,jn),Pn);function On(e){return!0===e.isContinuous}function Gn(e){return!0===e.isContinuous}function Ln(e){return e.locations.length>1}function Fn(e){return[e.currentLocation,e.locations[e.currentLocation]]}var Bn=function(){function e(t){var n=this;re(this,e),this.instance=t,le(this,"anchorLists",new Map),le(this,"anchorLocations",new Map),t.bind(rt,(function(e){e.sourceEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(e.sourceEndpoint),e.targetEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(e.targetEndpoint)})),t.bind(ot,(function(e){n._removeEndpointFromAnchorLists(e)}))}return ae(e,[{key:"getAnchorOrientation",value:function(e){var t=this.anchorLocations.get(e.id);return t?[t.ox,t.oy]:[0,0]}},{key:"_distance",value:function(e,t,n,i,o,r,s){var a=i.x+e.x*o.w,l=i.y+e.y*o.h,c=i.x+o.w/2,u=i.y+o.h/2;if(null!=r&&r.length>0){var h=this.instance._applyRotations([a,l,0,0],r);a=h.x,l=h.y}return Math.sqrt(Math.pow(t-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(c-a,2)+Math.pow(u-l,2))}},{key:"_anchorSelector",value:function(e,t,n,i,o,r,s){for(var a=n.x+i.w/2,l=n.y+i.h/2,c=-1,u=1/0,h=0;h<s.length;h++){var d=this._distance(s[h],a,l,e,t,o,r);d<u&&(c=h+0,u=d)}return[c,s[c]]}},{key:"_floatingAnchorCompute",value:function(e,t){var n=t.xy,i={curX:n.x+e.size.w/2,curY:n.y+e.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(e,i)}},{key:"_setComputedPosition",value:function(e,t,n){return this.anchorLocations.set(e.id,t),e.computedPosition=t,n&&(e.timestamp=n),t}},{key:"_computeSingleLocation",value:function(e,n,i,o){var r,s={curX:n.x+e.x*i.w+e.offx,curY:n.y+e.y*i.h+e.offy,x:e.x,y:e.y,ox:0,oy:0},a=o.rotation;if(null!=a&&a.length>0){var l=[e.iox,e.ioy],c={x:s.curX,y:s.curY,cr:0,sr:0};d(a,(function(e){c=S(c,e.c,e.r);var t=[Math.round(l[0]*c.cr-l[1]*c.sr),Math.round(l[1]*c.cr+l[0]*c.sr)];l=t.slice()})),e.ox=l[0],e.oy=l[1],r={curX:c.x,curY:c.y,x:e.x,y:e.y,ox:l[0],oy:l[1]}}else e.ox=e.iox,e.oy=e.ioy,r=t({ox:e.iox,oy:e.ioy},s);return r}},{key:"_singleAnchorCompute",value:function(e,t){var n=t.xy,i=t.wh,o=t.timestamp,r=this.anchorLocations.get(e.id);if(null!=r&&o&&o===e.timestamp)return r;var s=ye(Fn(e),2);s[0];var a=s[1];return r=this._computeSingleLocation(a,n,i,t),this._setComputedPosition(e,r,o)}},{key:"_defaultAnchorCompute",value:function(e,t){var n;if(1===e.locations.length)return this._singleAnchorCompute(e,t);var i=t.xy,o=t.wh,r=t.txy,s=t.twh,a=ye(Fn(e),2),l=a[0],c=a[1];if(e.locked||null==r||null==s)n=this._computeSingleLocation(c,i,o,t);else{var u=ye(this._anchorSelector(i,o,r,s,t.rotation,t.tRotation,e.locations),2),h=u[0],d=u[1];e.currentLocation=h,h!==l&&(e.cssClass=d.cls||e.cssClass,t.element._anchorLocationChanged(e)),n=this._computeSingleLocation(d,i,o,t)}return this._setComputedPosition(e,n,t.timestamp)}},{key:"_placeAnchors",value:function(e,t){var n=this,i=this.instance.viewport.getPosition(e),o=function(t,o,r,s,a,l){if(r.length>0)for(var c=r.sort(In[t]),u=function(e,t,n,i,o){for(var r=n?e.w:e.h,s=n?e.h:e.w,a=[],l=r/(t.length+1),c=0;c<t.length;c++){var u=(c+1)*l,h=i*s;o&&(u=r-u);var d=n?u:h,p=e.x+d,f=d/e.w,v=n?h:u,y=e.y+v,g=v/e.h;if(0!==e.r&&null!=e.r){var m=S({x:p,y},e.c,e.r);p=m.x,y=m.y}a.push({x:p,y,xLoc:f,yLoc:g,c:t[c].c})}return a}(i,c,s,a,t===Ot||t===jt),h=0;h<u.length;h++){var d=u[h].c,p=d.endpoints[0].elementId===e?d.endpoints[0]:d.endpoints[1];n._setComputedPosition(p._anchor,{curX:u[h].x,curY:u[h].y,x:u[h].xLoc,y:u[h].yLoc,ox:l[0],oy:l[1]})}};o(Gt,0,t.bottom,!0,1,[0,1]),o(jt,0,t.top,!0,0,[0,-1]),o(It,0,t.left,!1,0,[-1,0]),o(Ot,0,t.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(e,t,n,i,o,r,s,a,l,c,u){var h,d=i.endpoints[s],f=d.id,v=[1,0][s],y={theta:t,order:n,c:i,b:o,elId:r,epId:f},g=e[l],m=d._continuousAnchorEdge?e[d._continuousAnchorEdge]:null;if(m){var _=p(m,(function(e){return e.epId===f}));if(-1!==_){m.splice(_,1);for(var x=0;x<m.length;x++)!0!==(h=m[x].c).placeholder&&c.add(h),u.add(m[x].c.endpoints[s]),u.add(m[x].c.endpoints[v])}}for(var b=0;b<g.length;b++)!0!==(h=g[b].c).placeholder&&c.add(h),u.add(g[b].c.endpoints[s]),u.add(g[b].c.endpoints[v]);var k=a?0:g.length;g.splice(k,0,y),d._continuousAnchorEdge=l}},{key:"_removeEndpointFromAnchorLists",value:function(e){var t=this.anchorLists.get(e.elementId),n=0;!function(e,t){if(e){var i=function(e){return e.epId===t};g(e.top,i),g(e.left,i),g(e.bottom,i),g(e.right,i),n+=e.top.length,n+=e.left.length,n+=e.bottom.length,n+=e.right.length}}(t,e.id),0===n&&this.anchorLists.delete(e.elementId),this.anchorLocations.delete(e._anchor.id)}},{key:"computeAnchorLocation",value:function(e,t){var n;return n=On(e)?this.anchorLocations.get(e.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:Gn(e)?this._floatingAnchorCompute(e,t):this._defaultAnchorCompute(e,t),e.timestamp=t.timestamp,n}},{key:"computePath",value:function(e,t){var n=this.instance.viewport.getPosition(e.sourceId),i=this.instance.viewport.getPosition(e.targetId),o=e.endpoints[0],r=e.endpoints[1],s=this.getEndpointLocation(o,{xy:n,wh:n,element:o,timestamp:t,rotation:this.instance._getRotations(e.sourceId)}),a=this.getEndpointLocation(r,{xy:i,wh:i,element:r,timestamp:t,rotation:this.instance._getRotations(e.targetId)});e.connector.resetBounds(),e.connector.compute({sourcePos:s,targetPos:a,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1],strokeWidth:e.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function(e,t){t=t||{};var n=e._anchor,i=this.anchorLocations.get(n.id);return(null==i||null!=t.timestamp&&n.timestamp!==t.timestamp)&&(i=this.computeAnchorLocation(n,t),this._setComputedPosition(n,i,t.timestamp)),i}},{key:"getEndpointOrientation",value:function(e){return e._anchor?this.getAnchorOrientation(e._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(e,t){var n=this.anchorLocations.get(e.id);null!=n&&(n.ox=t[0],n.oy=t[1])}},{key:"isDynamicAnchor",value:function(e){return!!e._anchor&&(!On(e._anchor)&&e._anchor.locations.length>1)}},{key:"isFloating",value:function(e){return!!e._anchor&&Gn(e._anchor)}},{key:"prepareAnchor",value:function(e){return nn(e)}},{key:"redraw",value:function(e,t,n){var i=this,o=new Set,r=new Set,s=new Set;if(!this.instance._suspendDrawing){var a=this.instance.endpointsByElement[e]||[];t=t||C();for(var l,c,u={},h=0;h<a.length;h++)if(c=a[h],r.add(c),l=c._anchor,0===c.connections.length)On(l)&&(this.anchorLists.has(e)||this.anchorLists.set(e,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(e),-Math.PI/2,0,{endpoints:[c,c],placeholder:!0},!1,e,0,!1,Xt(l),o,r),s.add(e));else for(var d=0;d<c.connections.length;d++){var p=c.connections[d],f=p.sourceId,v=p.targetId,y=On(p.endpoints[0]._anchor),g=On(p.endpoints[1]._anchor);if(y||g){var m=[f,(p.endpoints[0]._anchor.faces||[]).join("-"),v,(p.endpoints[1]._anchor.faces||[]).join("-")].join("-"),_=u[m],x=p.sourceId===e?1:0;y&&!this.anchorLists.has(f)&&this.anchorLists.set(f,{top:[],right:[],bottom:[],left:[]}),g&&!this.anchorLists.has(v)&&this.anchorLists.set(v,{top:[],right:[],bottom:[],left:[]});var b=this.instance.viewport.getPosition(v),k=this.instance.viewport.getPosition(f);if(v===f&&(y||g))this._updateAnchorList(this.anchorLists.get(f),-Math.PI/2,0,p,!1,v,0,!1,jt,o,r),this._updateAnchorList(this.anchorLists.get(v),-Math.PI/2,0,p,!1,f,1,!1,jt,o,r);else{var E=this.instance._getRotations(f),S=this.instance._getRotations(v);_||(_=this._calculateOrientation(f,v,k,b,p.endpoints[0]._anchor,p.endpoints[1]._anchor,E,S),u[m]=_),y&&this._updateAnchorList(this.anchorLists.get(f),_.theta,0,p,!1,v,0,!1,_.a[0],o,r),g&&this._updateAnchorList(this.anchorLists.get(v),_.theta2,-1,p,!0,f,1,!0,_.a[1],o,r)}y&&s.add(f),g&&s.add(v),o.add(p),(y&&0===x||g&&1===x)&&r.add(p.endpoints[x])}else{var P=c.connections[d].endpoints[p.sourceId===e?1:0];if(Ln(P._anchor)){this.instance._paintEndpoint(P,{elementWithPrecedence:e,timestamp:t}),o.add(c.connections[d]);for(var w=0;w<P.connections.length;w++)P.connections[w]!==c.connections[d]&&o.add(P.connections[w])}else o.add(c.connections[d])}}s.forEach((function(e){i._placeAnchors(e,i.anchorLists.get(e))})),r.forEach((function(e){var n=i.instance.viewport.getPosition(e.elementId);i.instance._paintEndpoint(e,{timestamp:t,offset:n})})),o.forEach((function(e){i.instance._paintConnection(e,{timestamp:t})}))}return{c:o,e:r}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(e,t){null!=t&&(e._anchor=t)}},{key:"setConnectionAnchors",value:function(e,t){e.endpoints[0]._anchor=t[0],e.endpoints[1]._anchor=t[1]}},{key:"_calculateOrientation",value:function(e,t,n,i,o,r,s,a){var l=this;if(e===t)return{orientation:"identity",a:[jt,jt]};var c=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),u=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),h=[],d={};!function(e,t){for(var n=0;n<e.length;n++){var i;if(d[e[n]]=(le(i={},It,{x:t[n][0].x,y:t[n][0].c.y}),le(i,Ot,{x:t[n][0].x+t[n][0].w,y:t[n][0].c.y}),le(i,jt,{x:t[n][0].c.x,y:t[n][0].y}),le(i,Gt,{x:t[n][0].c.x,y:t[n][0].y+t[n][0].h}),i),null!=t[n][1]&&t[n][1].length>0)for(var o in d[e[n]])d[e[n]][o]=l.instance._applyRotationsXY(d[e[n]][o],t[n][1])}}([Re,He],[[n,s],[i,a]]);for(var p=[jt,It,Ot,Gt],f=0;f<p.length;f++)for(var v=0;v<p.length;v++)h.push({source:p[f],target:p[v],dist:q(d.source[p[f]],d.target[p[v]])});h.sort((function(e,t){if(e.dist<t.dist)return-1;if(t.dist<e.dist)return 1;var n,i=(le(n={},It,0),le(n,jt,1),le(n,Ot,2),le(n,Gt,3),n),o=i[e.source],r=i[t.source],s=i[e.target],a=i[t.target];return o<r?-1:r<o?1:s<a?-1:a<s?1:0}));for(var y=h[0].source,g=h[0].target,m=0;m<h.length&&(y=On(o)&&o.locked?o.currentFace:!o.isContinuous||Vt(o,h[m].source)?h[m].source:null,g=r.isContinuous&&r.locked?r.currentFace:!r.isContinuous||Vt(r,h[m].target)?h[m].target:null,null==y||null==g);m++);return o.isContinuous&&this.setCurrentFace(o,y),r.isContinuous&&this.setCurrentFace(r,g),{a:[y,g],theta:c,theta2:u}}},{key:"setCurrentFace",value:function(e,t,n){e.currentFace=t,n&&null!=e.lockedFace&&(e.lockedFace=e.currentFace)}},{key:"lock",value:function(e){e.locked=!0,On(e)&&(e.lockedFace=e.currentFace)}},{key:"unlock",value:function(e){e.locked=!1,On(e)&&(e.lockedFace=null)}},{key:"selectAnchorLocation",value:function(e,t){var n=p(e.locations,(function(e){return e.x===t.x&&e.y===t.y}));return-1!==n&&(e.currentLocation=n,!0)}},{key:"lockCurrentAxis",value:function(e){null!=e.currentFace&&(e.lockedAxis=e.currentFace===It||e.currentFace===Ot?Lt:Ft)}},{key:"unlockCurrentAxis",value:function(e){e.lockedAxis=null}},{key:"anchorsEqual",value:function(e,t){if(!e||!t)return!1;var n=e.locations[e.currentLocation],i=t.locations[t.currentLocation];return n.x===i.x&&n.y===i.y&&n.offx===i.offx&&n.offy===i.offy&&n.ox===i.ox&&n.oy===i.oy}}]),e}();function Rn(e,t,n){var i=[],r=function(t){return o(t)?t:e.getId(t)};if(t)if("string"==typeof t){if("*"===t)return t;i.push(t)}else{var s;if(n)i=t;else if(null!=t.length)(s=i).push.apply(s,ge(ge(t).map(r)));else i.push(r(t))}return i}function Hn(e,t,n){null!=t&&(t.connections.push(e),1===t.connections.length&&e.instance.addClass(e.source,e.instance.connectedClass)),null!=n&&(null!=t&&e.sourceId===e.targetId||(n.connections.push(e),1===n.connections.length&&e.instance.addClass(e.target,e.instance.connectedClass)))}function Nn(e,t,n){if(null!=t){var i=t.connections.length;g(t.connections,(function(t){return e.id===t.id})),i>0&&0===t.connections.length&&e.instance.removeClass(e.source,e.instance.connectedClass)}if(null!=n){var o=n.connections.length;null!=t&&e.sourceId===e.targetId||g(n.connections,(function(t){return e.id===t.id})),o>0&&0===n.connections.length&&e.instance.removeClass(e.target,e.instance.connectedClass)}}var Xn=function(n){ce(r,n);var i=fe(r);function r(e,n){var o;return re(this,r),(o=i.call(this))._instanceIndex=e,le(de(o),"defaults",void 0),le(de(o),"_initialDefaults",{}),le(de(o),"isConnectionBeingDragged",!1),le(de(o),"currentlyDragging",!1),le(de(o),"hoverSuspended",!1),le(de(o),"_suspendDrawing",!1),le(de(o),"_suspendedAt",null),le(de(o),"connectorClass",Qe),le(de(o),"connectorOutlineClass","jtk-connector-outline"),le(de(o),"connectedClass","jtk-connected"),le(de(o),"endpointClass",$e),le(de(o),"endpointConnectedClass","jtk-endpoint-connected"),le(de(o),"endpointFullClass","jtk-endpoint-full"),le(de(o),"endpointDropAllowedClass","jtk-endpoint-drop-allowed"),le(de(o),"endpointDropForbiddenClass","jtk-endpoint-drop-forbidden"),le(de(o),"endpointAnchorClassPrefix","jtk-endpoint-anchor"),le(de(o),"overlayClass",tt),le(de(o),"connections",[]),le(de(o),"endpointsByElement",{}),le(de(o),"endpointsByUUID",new Map),le(de(o),"sourceSelectors",[]),le(de(o),"targetSelectors",[]),le(de(o),"allowNestedGroups",void 0),le(de(o),"_curIdStamp",1),le(de(o),"viewport",new wn(de(o))),le(de(o),"router",void 0),le(de(o),"groupManager",void 0),le(de(o),"_connectionTypes",new Map),le(de(o),"_endpointTypes",new Map),le(de(o),"_container",void 0),le(de(o),"_managedElements",{}),le(de(o),"DEFAULT_SCOPE",void 0),le(de(o),"_zoom",1),o.defaults={anchor:N.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:Ie.type,container:null,endpoint:Se.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},n&&t(o.defaults,n),t(o._initialDefaults,o.defaults),o.DEFAULT_SCOPE=o.defaults.scope,o.allowNestedGroups=!1!==o._initialDefaults.allowNestedGroups,o.router=new Bn(de(o)),o.groupManager=new yn(de(o)),o.setContainer(o._initialDefaults.container),o}return ae(r,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(e){return null!=e&&null!=e[0]&&null!=e[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(e,t){return this._zoom=e,this.fire(lt,this._zoom),t&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(e,t){var n=this.getListener(e),i=!0;if(n&&n.length>0){var o=Array.prototype.slice.call(arguments,1);try{for(var r=0,s=n.length;r<s;r++)i=i&&n[r].apply(n[r],o)}catch(t){A("cannot check condition ["+e+"]"+t)}}return i}},{key:"getId",value:function(e,t){if(null==e)return null;var n=this.getAttribute(e,Ue);return n&&"undefined"!==n||(2===arguments.length&&void 0!==arguments[1]?n=t:(1===arguments.length||3===arguments.length&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(e,Ue,n)),n}},{key:"getConnections",value:function(t,n){t?t.constructor===String&&(t={scope:t}):t={};for(var i=Rn(this,t.scope||this.defaultScope,!0),o=Rn(this,t.source),r=Rn(this,t.target),s=!n&&i.length>1?{}:[],a=function(e,t){if(!n&&i.length>1){var o=s[e];null==o&&(o=s[e]=[]),o.push(t)}else s.push(t)},l=0,c=this.connections.length;l<c;l++){var u=this.connections[l],h=u.proxies&&u.proxies[0]?u.proxies[0].originalEp.elementId:u.sourceId,d=u.proxies&&u.proxies[1]?u.proxies[1].originalEp.elementId:u.targetId;e(i,u.scope)&&e(o,h)&&e(r,d)&&a(u.scope,u)}return s}},{key:"select",value:function(e){return(e=e||{}).scope=e.scope||"*",new _n(this,e.connections||this.getConnections(e,!0))}},{key:"selectEndpoints",value:function(t){(t=t||{}).scope=t.scope||oe;var n=!t.element&&!t.source&&!t.target,i=n?oe:Rn(this,t.element),o=n?oe:Rn(this,t.source),r=n?oe:Rn(this,t.target),s=Rn(this,t.scope,!0),a=[];for(var l in this.endpointsByElement){var c=e(i,l,!0),u=e(o,l,!0),h="*"!==o,d=e(r,l,!0),p="*"!==r;if(c||u||d)e:for(var f=0,v=this.endpointsByElement[l].length;f<v;f++){var y=this.endpointsByElement[l][f];if(e(s,y.scope,!0)){var g=h&&o.length>0&&!y.isSource,m=p&&r.length>0&&!y.isTarget;if(g||m)continue e;a.push(y)}}}return new mn(this,a)}},{key:"setContainer",value:function(e){this._container=e,this.fire("container:change",this._container)}},{key:"_set",value:function(e,t,n){var i,o,r=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],s=e[r.elId],a=e.endpoints[n],l={index:n,originalEndpoint:a,originalSourceId:0===n?s:e.sourceId,newSourceId:e.sourceId,originalTargetId:1===n?s:e.targetId,newTargetId:e.targetId,connection:e,newEndpoint:a};return t instanceof pn?(i=t).addConnection(e):i=(o=this.getId(t))===e[r.elId]?null:e.makeEndpoint(0===n,t,o),null!=i&&(l.newEndpoint=i,a.detachFromConnection(e),e.endpoints[n]=i,e[r.el]=i.element,e[r.elId]=i.elementId,l[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(l),this._paintConnection(e)),l}},{key:"setSource",value:function(e,t){Nn(e,this._managedElements[e.sourceId]);var n=this._set(e,t,0);Hn(e,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(e,t){Nn(e,this._managedElements[e.targetId]);var n=this._set(e,t,1);Hn(e,this._managedElements[n.newTargetId])}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(e,t){var n=this._suspendDrawing;return this._suspendDrawing=e,e?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),t&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(e,t){var n=!0===this._suspendDrawing;n||this.setSuspendDrawing(!0),e(),n||this.setSuspendDrawing(!1,!t)}},{key:"each",value:function(e,t){if(null!=e){if(null!=e.length)for(var n=0;n<e.length;n++)t(e[n]);else t(e);return this}}},{key:"updateOffset",value:function(e){var t=e.elId;return e.recalc?this.viewport.refreshElement(t):this.viewport.getPosition(t)}},{key:"deleteConnection",value:function(e,t){if(null!=e&&!0!==e.deleted&&((t=t||{}).force||u(!0,!1,[[e.endpoints[0],ct,[e]],[e.endpoints[1],ct,[e]],[e,ct,[e]],[this,Ze,[ut,e]]]))){Nn(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.fireDetachEvent(e,!e.pending&&!1!==t.fireEvent,t.originalEvent);var n=e.endpoints[0],i=e.endpoints[1];return n!==t.endpointToIgnore&&n.detachFromConnection(e,null,!0),i!==t.endpointToIgnore&&i.detachFromConnection(e,null,!0),g(this.connections,(function(t){return e.id===t.id})),e.destroy(),n!==t.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==t.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0}return!1}},{key:"deleteEveryConnection",value:function(e){var t=this;e=e||{};var n=this.connections.length,i=0;return this.batch((function(){for(var o=0;o<n;o++)i+=t.deleteConnection(t.connections[0],e)?1:0})),i}},{key:"deleteConnectionsForElement",value:function(e,t){var n=this.getId(e),i=this._managedElements[n];if(i)for(var o=i.connections.length,r=0;r<o;r++)this.deleteConnection(i.connections[0],t);return this}},{key:"fireDetachEvent",value:function(e,t,n){var i=null!=e.id?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&this.fire("connection:detach",i,n),this.fire(rt,i,n)}},{key:"fireMoveEvent",value:function(e,t){this.fire(it,e,t)}},{key:"manageAll",value:function(e,t){for(var n=o(e)?this.getSelector(this.getContainer(),e):e,i=0;i<n.length;i++)this.manage(n[i],null,t)}},{key:"manage",value:function(e,t,n){null==this.getAttribute(e,Ue)&&(t=t||this.getAttribute(e,"id")||C(),this.setAttribute(e,Ue,t));var i=this.getId(e);if(this._managedElements[i])n&&(this._managedElements[i].viewportElement=this.updateOffset({elId:i,timestamp:null,recalc:!0}));else{var o={el:e,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[i]=o,this._suspendDrawing?o.viewportElement=this.viewport.registerElement(i,!0):o.viewportElement=this.updateOffset({elId:i,recalc:!0}),this.fire("element:manage",{el:e})}return this._managedElements[i]}},{key:"getManagedData",value:function(e,t,n){if(this._managedElements[e]){var i=this._managedElements[e].data[t];return null!=i?i[n]:null}}},{key:"setManagedData",value:function(e,t,n,i){this._managedElements[e]&&(this._managedElements[e].data[t]=this._managedElements[e].data[t]||{},this._managedElements[e].data[t][n]=i)}},{key:"getManagedElement",value:function(e){return this._managedElements[e]?this._managedElements[e].el:null}},{key:"unmanage",value:function(e,t){var n=this;this.removeAllEndpoints(e,!0);var i=function(e){var i=n.getId(e);n.removeAttribute(e,Ue),delete n._managedElements[i],n.viewport.remove(i),n.fire("element:unmanage",{el:e}),e&&t&&n._removeElement(e)};this._getAssociatedElements(e).map(i),i(e)}},{key:"rotate",value:function(e,t,n){var i=this.getId(e);return this._managedElements[i]&&(this._managedElements[i].rotation=t,this.viewport.rotateElement(i,t),!0!==n)?this.revalidate(e):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(e){var t=this._managedElements[e];return null!=t&&t.rotation||0}},{key:"_getRotations",value:function(e){var t=this,n=[],i=this._managedElements[e];return null!=i&&(n.push({r:i.viewportElement.r||0,c:i.viewportElement.c}),function e(i){if(null!=i.group){var o=t._managedElements[i.group];null!=o&&(n.push({r:o.viewportElement.r,c:o.viewportElement.c}),e(o))}}(i)),n}},{key:"_applyRotations",value:function(e,t){var n=e.slice(),i={x:n[0],y:n[1],cr:0,sr:0};return d(t,(function(e){i=S(i,e.c,e.r)})),i}},{key:"_applyRotationsXY",value:function(e,t){return d(t,(function(t){e=S(e,t.c,t.r)})),e}},{key:"_internal_newEndpoint",value:function(e){var n=t({},e),i=this.manage(n.element);n.elementId=this.getId(n.element),n.id="ep_"+this._idstamp();var o=new pn(this,n);return function(e,t){null!=e&&e.endpoints.push(t)}(i,o),e.uuid&&this.endpointsByUUID.set(e.uuid,o),x(this.endpointsByElement,o.elementId,o),this._suspendDrawing||this._paintEndpoint(o,{timestamp:this._suspendedAt}),o}},{key:"_deriveEndpointAndAnchorSpec",value:function(e,t){for(var n=((t?"":"default ")+e).split(/[\s]/),i=null,o=null,r=null,s=null,a=0;a<n.length;a++){var l=this.getConnectionType(n[a]);l&&(l.endpoints&&(i=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(s=l.anchors),l.anchor&&(r=l.anchor))}return{endpoints:i||[o,o],anchors:s||[r,r]}}},{key:"revalidate",value:function(e,t){var n=this.getId(e);return this.updateOffset({elId:n,recalc:!0,timestamp:t}),this.repaint(e)}},{key:"repaintEverything",value:function(){var e,t=C();for(e in this._managedElements)this.viewport.refreshElement(e,!0);for(e in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[e].el,t,!0);return this}},{key:"setElementPosition",value:function(e,t,n){var i=this.getId(e);return this.viewport.setPosition(i,t,n),this.repaint(e)}},{key:"repaint",value:function(e,t,n){var i={c:new Set,e:new Set},o=function(e){e.c.forEach((function(e){return i.c.add(e)})),e.e.forEach((function(e){return i.e.add(e)}))};if(!this._suspendDrawing){var r=this.getId(e);if(null!=e){var s=this._getAssociatedElements(e);if(null==t&&(t=C()),!n)for(var a=0;a<s.length;a++)this.updateOffset({elId:this.getId(s[a]),recalc:!0,timestamp:t});if(o(this.router.redraw(r,t,null)),s.length>0)for(var l=0;l<s.length;l++)o(this.router.redraw(this.getId(s[l]),t,null))}}return i}},{key:"unregisterEndpoint",value:function(e){var t=e.getUuid();t&&this.endpointsByUUID.delete(t),function(e,t){null!=e&&g(e.endpoints,(function(e){return e===t}))}(this._managedElements[e.elementId],e);var n=this.endpointsByElement[e.elementId];null!=n&&(n.length>1?this.endpointsByElement[e.elementId]=n.filter((function(t){return t!==e})):delete this.endpointsByElement[e.elementId]),this.fire(ot,e)}},{key:"_maybePruneEndpoint",value:function(e){return!(!e.deleteOnEmpty||0!==e.connections.length)&&(this.deleteEndpoint(e),!0)}},{key:"deleteEndpoint",value:function(e){var t=this,n="string"==typeof e?this.endpointsByUUID.get(e):e;if(n){var i=n.proxiedBy,o=n.connections.slice();d(o,(function(e){n.detachFromConnection(e,null,!0)})),this.unregisterEndpoint(n),n.destroy(),d(o,(function(e){t.deleteConnection(e,{force:!0,endpointToIgnore:n})})),null!=i&&this.deleteEndpoint(i)}return this}},{key:"addEndpoint",value:function(e,n,i){var o=t({},i=i||{});t(o,n||{});var r=t({element:e},o);return this._internal_newEndpoint(r)}},{key:"addEndpoints",value:function(e,t,n){for(var i=[],o=0,r=t.length;o<r;o++)i.push(this.addEndpoint(e,t[o],n));return i}},{key:"reset",value:function(){var e=this;this.silently((function(){e.endpointsByElement={},e._managedElements={},e.endpointsByUUID.clear(),e.viewport.reset(),e.router.reset(),e.groupManager.reset(),e.connections.length=0}))}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(e){return this.endpointsByElement[this.getId(e)]||[]}},{key:"getEndpoint",value:function(e){return this.endpointsByUUID.get(e)}},{key:"setEndpointUuid",value:function(e,t){e.uuid&&this.endpointsByUUID.delete(e.uuid),e.uuid=t,this.endpointsByUUID.set(t,e)}},{key:"connect",value:function(e,t){try{var n=this._prepareConnectionParams(e,t),i=this._newConnection(n);return this._finaliseConnection(i,n),i}catch(e){return void A(e)}}},{key:"_prepareConnectionParams",value:function(e,n){var i=t({},e);n&&t(i,n);var o=i;if(o.source&&o.source.endpoint&&(o.sourceEndpoint=o.source),o.target&&o.target.endpoint&&(o.targetEndpoint=o.target),e.uuids&&(o.sourceEndpoint=this.getEndpoint(e.uuids[0]),o.targetEndpoint=this.getEndpoint(e.uuids[1])),null!=o.sourceEndpoint){if(o.sourceEndpoint.isFull())throw"Cannot establish connection: source endpoint is full";if(o.type||(o.type=o.sourceEndpoint.edgeType),o.sourceEndpoint.connectorOverlays){o.overlays=o.overlays||[];for(var r=0,s=o.sourceEndpoint.connectorOverlays.length;r<s;r++)o.overlays.push(o.sourceEndpoint.connectorOverlays[r])}o.sourceEndpoint.scope&&(o.scope=o.sourceEndpoint.scope)}else if(null==o.source)throw"Cannot establish connection: source does not exist";if(null!=o.targetEndpoint){if(o.targetEndpoint.isFull())throw"Cannot establish connection: target endpoint is full"}else if(null==o.target)throw"Cannot establish connection: target does not exist";if(o.sourceEndpoint&&o.targetEndpoint&&!function(e,t){for(var n=e.scope.split(/\s/),i=t.scope.split(/\s/),o=0;o<n.length;o++)for(var r=0;r<i.length;r++)if(i[r]===n[o])return!0;return!1}(o.sourceEndpoint,o.targetEndpoint))throw"Cannot establish connection: scopes do not match";return o}},{key:"_newConnection",value:function(e){e.id="con_"+this._idstamp();var t=new hn(this,e);return Hn(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this._paintConnection(t),t}},{key:"_finaliseConnection",value:function(e,t,n){t=t||{},e.suspendedEndpoint||this.connections.push(e),e.pending=null,e.endpoints[0].isTemporarySource=!1,this.repaint(e.source);var i={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};this.fire(nt,i,n),t.doNotFireConnectionEvent||!1===t.fireEvent||this.fire("connection",i,n)}},{key:"removeAllEndpoints",value:function(e,t){var n=this,i=function(e){var t,i,o=n.getId(e),r=n.endpointsByElement[o];if(r)for(t=0,i=r.length;t<i;t++)n.deleteEndpoint(r[t]);delete n.endpointsByElement[o]};return t&&this._getAssociatedElements(e).map(i),i(e),this}},{key:"_createSourceDefinition",value:function(e,n){var i=t({},n);t(i,e),i.edgeType=i.edgeType||te;var o=this._deriveEndpointAndAnchorSpec(i.edgeType);i.endpoint=i.endpoint||o.endpoints[0],i.anchor=i.anchor||o.anchors[0];var r=i.maxConnections||-1;return{def:t({},i),uniqueEndpoint:i.uniqueEndpoint,maxConnections:r,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createSourceDefinition(t),o=new Dn(e,i,n);return this.sourceSelectors.push(o),o}},{key:"removeSourceSelector",value:function(e){g(this.sourceSelectors,(function(t){return t===e}))}},{key:"removeTargetSelector",value:function(e){g(this.targetSelectors,(function(t){return t===e}))}},{key:"addTargetSelector",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createTargetDefinition(t),o=new Mn(e,i,n);return this.targetSelectors.push(o),o}},{key:"_createTargetDefinition",value:function(e,n){var i=t({},n);t(i,e),i.edgeType=i.edgeType||te;var o=i.maxConnections||-1;return{def:t({},i),uniqueEndpoint:i.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null}}},{key:"show",value:function(e,t){return this._setVisible(e,Ne,t)}},{key:"hide",value:function(e,t){return this._setVisible(e,Xe,t)}},{key:"_setVisible",value:function(e,t,n){var i=t===Ne,o=null;n&&(o=function(e){e.setVisible(i,!0,!0)});var r=this.getId(e);return this._operation(e,(function(e){if(i&&n){var t=e.sourceId===r?1:0;e.endpoints[t].isVisible()&&e.setVisible(!0)}else e.setVisible(i)}),o),this}},{key:"toggleVisible",value:function(e,t){var n=null;t&&(n=function(e){var t=e.isVisible();e.setVisible(!t)}),this._operation(e,(function(e){var t=e.isVisible();e.setVisible(!t)}),n)}},{key:"_operation",value:function(e,t,n){var i=this.getId(e),o=this.endpointsByElement[i];if(o&&o.length)for(var r=0,s=o.length;r<s;r++){for(var a=0,l=o[r].connections.length;a<l;a++){if(t(o[r].connections[a]))return}n&&n(o[r])}}},{key:"registerConnectionType",value:function(e,n){if(this._connectionTypes.set(e,t({},n)),n.overlays){for(var i={},o=0;o<n.overlays.length;o++){var r=dt(n.overlays[o]);i[r.options.id]=r}this._connectionTypes.get(e).overlays=i}}},{key:"registerConnectionTypes",value:function(e){for(var t in e)this.registerConnectionType(t,e[t])}},{key:"registerEndpointType",value:function(e,n){if(this._endpointTypes.set(e,t({},n)),n.overlays){for(var i={},o=0;o<n.overlays.length;o++){var r=dt(n.overlays[o]);i[r.options.id]=r}this._endpointTypes.get(e).overlays=i}}},{key:"registerEndpointTypes",value:function(e){for(var t in e)this.registerEndpointType(t,e[t])}},{key:"getType",value:function(e,t){return"connection"===t?this.getConnectionType(e):this.getEndpointType(e)}},{key:"getConnectionType",value:function(e){return this._connectionTypes.get(e)}},{key:"getEndpointType",value:function(e){return this._endpointTypes.get(e)}},{key:"importDefaults",value:function(e){for(var t in e)this.defaults[t]=e[t];return e.container&&this.setContainer(e.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=t({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(e,t,n,i,o){var r,s=null!=e.proxies[t],a=s?e.proxies[t].originalEp.elementId:e.endpoints[t].elementId,l=s?e.proxies[t].originalEp:e.endpoints[t],c=this.getId(n);e.proxies[t]?e.proxies[t].ep.elementId===c?r=e.proxies[t].ep:(e.proxies[t].ep.detachFromConnection(e,t),r=this._internal_newEndpoint({element:n,endpoint:i(e,t),anchor:o(e,t),parameters:{isProxyEndpoint:!0}})):r=this._internal_newEndpoint({element:n,endpoint:i(e,t),anchor:o(e,t),parameters:{isProxyEndpoint:!0}}),r.deleteOnEmpty=!0,e.proxies[t]={ep:r,originalEp:l},this.sourceOrTargetChanged(a,c,e,n,t),l.detachFromConnection(e,null,!0),r.connections=[e],e.endpoints[t]=r,l.proxiedBy=r,l.setVisible(!1),e.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(e,t){if(null!=e.proxies&&null!=e.proxies[t]){var n=e.proxies[t].originalEp.element,i=e.proxies[t].originalEp.elementId,o=e.proxies[t].ep.elementId;e.endpoints[t]=e.proxies[t].originalEp,delete e.proxies[t].originalEp.proxiedBy,this.sourceOrTargetChanged(o,i,e,n,t),e.proxies[t].ep.detachFromConnection(e,null),e.proxies[t].originalEp.addConnection(e),e.isVisible()&&e.proxies[t].originalEp.setVisible(!0),e.proxies[t]=null,-1===p(e.proxies,(function(e){return null!=e}))&&(e.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(e,t,n,i,o){e!==t&&(0===o?(n.sourceId=t,n.source=i):1===o&&(n.targetId=t,n.target=i),Nn(n,this._managedElements[e]),Hn(n,this._managedElements[t]))}},{key:"getGroup",value:function(e){return this.groupManager.getGroup(e)}},{key:"getGroupFor",value:function(e){return this.groupManager.getGroupFor(e)}},{key:"addGroup",value:function(e){return this.groupManager.addGroup(e)}},{key:"addToGroup",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(t=this.groupManager).addToGroup.apply(t,[e,!1].concat(i))}},{key:"collapseGroup",value:function(e){this.groupManager.collapseGroup(e)}},{key:"expandGroup",value:function(e){this.groupManager.expandGroup(e)}},{key:"toggleGroup",value:function(e){this.groupManager.toggleGroup(e)}},{key:"removeGroup",value:function(e,t,n,i){return this.groupManager.removeGroup(e,t,n,i)}},{key:"removeAllGroups",value:function(e,t){this.groupManager.removeAllGroups(e,t,!1)}},{key:"removeFromGroup",value:function(e,t,n){this.groupManager.removeFromGroup(e,n,t),this._appendElement(t,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(t)})}},{key:"_paintEndpoint",value:function(e,t){var n=(t=t||{}).timestamp,i=!(!1===t.recalc);if(!n||e.timestamp!==n){var o=this.viewport.getPosition(e.elementId),r=t.offset?{x:t.offset.x,y:t.offset.y}:{x:o.x,y:o.y};if(null!=r){var s=t.anchorLoc;if(null==s){var a={xy:r,wh:o,element:e,timestamp:n};if(i&&this.router.isDynamicAnchor(e)&&e.connections.length>0){var l=function(e){var n=0;if(null!=t.elementWithPrecedence)for(var i=0;i<e.connections.length;i++)if(e.connections[i].sourceId===t.elementWithPrecedence||e.connections[i].targetId===t.elementWithPrecedence){n=i;break}return e.connections[n]}(e),c=l.endpoints[0]===e?1:0,u=0===c?l.sourceId:l.targetId,h=this.viewport.getPosition(u);a.index=0===c?1:0,a.connection=l,a.txy=h,a.twh=h,a.tElement=l.endpoints[c],a.tRotation=this._getRotations(u)}else e.connections.length>0&&(a.connection=e.connections[0]);a.rotation=this._getRotations(e.elementId),s=this.router.computeAnchorLocation(e._anchor,a)}for(var d in e.endpoint.compute(s,this.router.getEndpointOrientation(e),e.paintStyleInUse),this.renderEndpoint(e,e.paintStyleInUse),e.timestamp=n,e.overlays)if(e.overlays.hasOwnProperty(d)){var p=e.overlays[d];p.isVisible()&&(e.overlayPlacements[d]=this.drawOverlay(p,e.endpoint,e.paintStyleInUse,e.getAbsoluteOverlayPosition(p)),this._paintOverlay(p,e.overlayPlacements[d],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(e,t){if(!this._suspendDrawing&&!1!==e.visible){var n=(t=t||{}).timestamp;if(null!=n&&n===e.lastPaintedAt)return;if(null==n||n!==e.lastPaintedAt){this.router.computePath(e,n);var i={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var o in e.overlays)if(e.overlays.hasOwnProperty(o)){var r=e.overlays[o];r.isVisible()&&(e.overlayPlacements[o]=this.drawOverlay(r,e.connector,e.paintStyleInUse,e.getAbsoluteOverlayPosition(r)),i.xmin=Math.min(i.xmin,e.overlayPlacements[o].xmin),i.xmax=Math.max(i.xmax,e.overlayPlacements[o].xmax),i.ymin=Math.min(i.ymin,e.overlayPlacements[o].ymin),i.ymax=Math.max(i.ymax,e.overlayPlacements[o].ymax))}var s=parseFloat(""+e.paintStyleInUse.strokeWidth||"1")/2,a=parseFloat(""+e.paintStyleInUse.strokeWidth||"0"),l={xmin:Math.min(e.connector.bounds.xmin-(s+a),i.xmin),ymin:Math.min(e.connector.bounds.ymin-(s+a),i.ymin),xmax:Math.max(e.connector.bounds.xmax+(s+a),i.xmax),ymax:Math.max(e.connector.bounds.ymax+(s+a),i.ymax)};for(var c in this.paintConnector(e.connector,e.paintStyleInUse,l),e.overlays)if(e.overlays.hasOwnProperty(c)){var u=e.overlays[c];u.isVisible()&&this._paintOverlay(u,e.overlayPlacements[c],l)}}e.lastPaintedAt=n}}},{key:"_refreshEndpoint",value:function(e){e.connections.length>0?this.addEndpointClass(e,this.endpointConnectedClass):this.removeEndpointClass(e,this.endpointConnectedClass),e.isFull()?this.addEndpointClass(e,this.endpointFullClass):this.removeEndpointClass(e,this.endpointFullClass)}},{key:"_makeConnector",value:function(e,t,n){return Ge(e,t,n)}},{key:"addOverlay",value:function(e,t,n){if(e.addOverlay(t),!n){var i=e instanceof pn?e.element:e.source;this.revalidate(i)}}},{key:"getPathData",value:function(e){for(var t="",n=0;n<e.segments.length;n++)t+=e.segments[n].getPath(0===n),t+=" ";return t}}]),r}(X);function Yn(e){var t=Math.floor(e),n=Math.ceil(e);return e-t<1e-10?t:n-e<1e-10?n:e}var Vn=function(e){ce(n,e);var t=fe(n);function n(e){var i;re(this,n),le(de(i=t.call(this,e)),"type",n.segmentType),le(de(i),"cx",void 0),le(de(i),"cy",void 0),le(de(i),"radius",void 0),le(de(i),"anticlockwise",void 0),le(de(i),"startAngle",void 0),le(de(i),"endAngle",void 0),le(de(i),"sweep",void 0),le(de(i),"length",void 0),le(de(i),"circumference",void 0),le(de(i),"frac",void 0),i.cx=e.cx,i.cy=e.cy,i.radius=e.r,i.anticlockwise=e.ac,e.startAngle&&e.endAngle?(i.startAngle=e.startAngle,i.endAngle=e.endAngle,i.x1=i.cx+i.radius*Math.cos(i.startAngle),i.y1=i.cy+i.radius*Math.sin(i.startAngle),i.x2=i.cx+i.radius*Math.cos(i.endAngle),i.y2=i.cy+i.radius*Math.sin(i.endAngle)):(i.startAngle=i._calcAngle(i.x1,i.y1),i.endAngle=i._calcAngle(i.x2,i.y2)),i.endAngle<0&&(i.endAngle+=z),i.startAngle<0&&(i.startAngle+=z);var o=i.endAngle<i.startAngle?i.endAngle+z:i.endAngle;return i.sweep=Math.abs(o-i.startAngle),i.anticlockwise&&(i.sweep=z-i.sweep),i.circumference=2*Math.PI*i.radius,i.frac=i.sweep/z,i.length=i.circumference*i.frac,i.extents={xmin:i.cx-i.radius,xmax:i.cx+i.radius,ymin:i.cy-i.radius,ymax:i.cy+i.radius},i}return ae(n,[{key:"_calcAngle",value:function(e,t){return n={x:this.cx,y:this.cy},o=U(n,i={x:e,y:t}),r=Math.atan(o),4!=(s=W(n,i))&&3!=s||(r+=Math.PI),r<0&&(r+=2*Math.PI),r;var n,i,o,r,s}},{key:"_calcAngleForLocation",value:function(e,t){if(e.anticlockwise){var n=e.startAngle<e.endAngle?e.startAngle+z:e.startAngle;return n-Math.abs(n-e.endAngle)*t}var i=e.endAngle<e.startAngle?e.endAngle+z:e.endAngle,o=Math.abs(i-e.startAngle);return e.startAngle+o*t}},{key:"getPath",value:function(e){var t=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(e?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+t+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(e,t){if(0===e)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===e)return{x:this.x2,y:this.y2,theta:this.endAngle};t&&(e/=length);var n=this._calcAngleForLocation(this,e),i=this.cx+this.radius*Math.cos(n),o=this.cy+this.radius*Math.sin(n);return{x:Yn(i),y:Yn(o),theta:n}}},{key:"gradientAtPoint",value:function(e,t){var n=this.pointOnPath(e,t),i=-1/U({x:this.cx,y:this.cy},n);return this.anticlockwise||i!==1/0&&i!==-1/0||(i*=-1),i}},{key:"pointAlongPathFrom",value:function(e,t,n){var i=this.pointOnPath(e,n),o=t/this.circumference*2*Math.PI,r=this.anticlockwise?-1:1,s=i.theta+r*o;return{x:this.cx+this.radius*Math.cos(s),y:this.cy+this.radius*Math.sin(s)}}}]),n}(K);le(Vn,"segmentType","Arc");var zn=function(e){ce(n,e);var t=fe(n);function n(e,i,o){var r;return re(this,n),(r=t.call(this,e,i,o)).instance=e,r.component=i,le(de(r),"width",void 0),le(de(r),"length",void 0),le(de(r),"foldback",void 0),le(de(r),"direction",void 0),le(de(r),"location",.5),le(de(r),"paintStyle",void 0),le(de(r),"type",n.type),le(de(r),"cachedDimensions",void 0),o=o||{},r.width=o.width||20,r.length=o.length||20,r.direction=(o.direction||1)<0?-1:1,r.foldback=o.foldback||.623,r.paintStyle=o.paintStyle||{strokeWidth:1},r.location=null==o.location?r.location:Array.isArray(o.location)?o.location[0]:o.location,r}return ae(n,[{key:"draw",value:function(e,t,n){if(e instanceof Te){var i,o,r,s=e;if(this.location>1||this.location<0){var a=this.location<0?1:0;o=Z(i=s.pointAlongPathFrom(a,this.location,!1),s.pointAlongPathFrom(a,this.location-this.direction*this.length/2,!1),this.length)}else if(1===this.location){if(o=Z(i=s.pointOnPath(this.location),s.pointAlongPathFrom(this.location,-this.length),this.length),-1===this.direction){var l=o;o=i,i=l}}else if(0===this.location){if(i=Z(o=s.pointOnPath(this.location),s.pointAlongPathFrom(this.location,this.length),this.length),-1===this.direction){var c=o;o=i,i=c}}else o=Z(i=s.pointAlongPathFrom(this.location,this.direction*this.length/2),s.pointOnPath(this.location),this.length);var u={hxy:i,tail:r=function(e,t,n){var i=U(e,t),o=Math.atan(-1/i),r=n/2*Math.sin(o),s=n/2*Math.cos(o);return[{x:t.x+s,y:t.y+r},{x:t.x-s,y:t.y-r}]}(i,o,this.width),cxy:Z(i,o,this.foldback*this.length)},h=this.paintStyle.stroke||t.stroke,d=this.paintStyle.fill||t.stroke;return{component:e,d:u,"stroke-width":this.paintStyle.strokeWidth||t.strokeWidth,stroke:h,fill:d,xmin:Math.min(i.x,r[0].x,r[1].x),xmax:Math.max(i.x,r[0].x,r[1].x),ymin:Math.min(i.y,r[0].y,r[1].y),ymax:Math.max(i.y,r[0].y,r[1].y)}}}},{key:"updateFrom",value:function(e){}}]),n}(pt);function Un(e){return e.type===zn.type}le(zn,"type","Arrow"),yt(zn.type,zn);var qn=function(e){ce(n,e);var t=fe(n);function n(e,i,o){var r;return re(this,n),(r=t.call(this,e,i,o)).instance=e,le(de(r),"type",n.type),r.foldback=1,r}return n}(zn);function Wn(e){return e.type===qn.type}le(qn,"type","PlainArrow"),yt("PlainArrow",qn);var Jn=function(e){ce(n,e);var t=fe(n);function n(e,i,o){var r;return re(this,n),(r=t.call(this,e,i,o)).instance=e,le(de(r),"type",n.type),r.length=r.length/2,r.foldback=2,r}return n}(zn);function Zn(e){return e.type===Jn.type}le(Jn,"type","Diamond"),yt(Jn.type,Jn);var Qn=function(e){ce(n,e);var t=fe(n);function n(e,i,o){var r;return re(this,n),(r=t.call(this,e,i,o)).instance=e,r.component=i,le(de(r),"create",void 0),le(de(r),"type",n.type),r.create=o.create,r}return ae(n,[{key:"updateFrom",value:function(e){}}]),n}(pt);function $n(e){return e.type===Qn.type}function Kn(e){return Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kn(e)}function ei(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ti(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ni(e,t,n){return t&&ti(e.prototype,t),n&&ti(e,n),e}function ii(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oi(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&si(e,t)}function ri(e){return ri=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ri(e)}function si(e,t){return si=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},si(e,t)}function ai(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function li(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?ai(e):t}function ci(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ri(e);if(t){var o=ri(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return li(this,n)}}function ui(e,t,n){return ui="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ri(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},ui(e,t,n||e)}function hi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,o,r=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);s=!0);}catch(e){a=!0,o=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return di(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return di(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function di(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function pi(e,t,n){for(var i=(n=n||e.parentNode).querySelectorAll(t),o=0;o<i.length;o++)if(i[o]===e)return!0;return!1}function fi(e,t){e.stopPropagation?e.stopPropagation():e.returnValue=!1,!t&&e.preventDefault&&e.preventDefault()}function vi(e,t,n,i){if(i&&pi(e,t,n))return e;for(e=e.parentNode;null!=e&&e!==n;){if(pi(e,t))return e;e=e.parentNode}}function yi(e){return e.srcElement||e.target}function gi(e){return null!=e.className?void 0===e.className.baseVal?e.className:e.className.baseVal:""}function mi(e,t,n){var i=null==t?[]:Array.isArray(t)?t:t.split(/\s+/),o=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),r=gi(e).split(/\s+/),s=function(e,t){for(var n=0;n<t.length;n++)if(e)-1===r.indexOf(t[n])&&r.push(t[n]);else{var i=r.indexOf(t[n]);-1!==i&&r.splice(i,1)}};s(!0,i),s(!1,o),function(e,t,n){t=P(t),void 0!==e.className.baseVal?e.className.baseVal=t:e.className=t;try{var i=e.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var o=0;o<n.length;o++)n[o]&&i.add(n[o])}}catch(e){A("JSPLUMB: cannot set class list",e)}}(e,r.join(" "),r)}function _i(e){return!o(e)&&!Array.isArray(e)&&null!=e.length&&null==e.documentElement&&null==e.nodeType}function xi(e,t){var n=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?d(P(t).split(/\s+/),(function(t){e.classList.add(t)})):mi(e,t))};_i(e)?d(e,(function(e){return n(e,t)})):n(e,t)}function bi(e,t){var n=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?P(t).split(/\s+/).forEach((function(t){e.classList.remove(t)})):mi(e,null,t))};_i(e)?d(e,(function(e){return n(e,t)})):n(e,t)}function ki(e,t,n,i){return Ei(null,e,t,n,i)}function Ei(e,t,n,i,o){var r,s=null==e?document.createElement(t):document.createElementNS(e,t);for(r in n=n||{})s.style[r]=n[r];for(r in i&&(s.className=i),o=o||{})s.setAttribute(r,""+o[r]);return s}function Ci(e){var t=e.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,r=window.pageXOffset||i.scrollLeft||n.scrollLeft,s=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=t.top+o-s,c=t.left+r-a;return{x:Math.round(c),y:Math.round(l)}}le(Qn,"type","Custom"),yt(Qn.type,Qn),Ee.registerHandler(Pe),Ee.registerHandler(Me),Ee.registerHandler(Ae),Le(Ie.type,Ie);var Si={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},Pi="stroke-dasharray",wi="svg",Ai="path",Di="http://www.w3.org/2000/svg";function Mi(e,t){for(var n in t)e.setAttribute(n,""+t[n])}function Ti(e,t){return(t=t||{}).version="1.1",t.xmlns=Di,Ei(Di,e,null,null,t)}function ji(e){return"position:absolute;left:"+e[0]+"px;top:"+e[1]+"px"}function Ii(e,t,n){if(t.setAttribute("fill",n.fill?n.fill:Xe),t.setAttribute("stroke",n.stroke?n.stroke:Xe),n.strokeWidth&&t.setAttribute("stroke-width",n.strokeWidth),n.dashstyle&&n.strokeWidth&&!n[Pi]){var i=-1===n.dashstyle.indexOf(",")?" ":",",o=n.dashstyle.split(i),r="";d(o,(function(e){r+=Math.floor(e*n.strokeWidth)+i})),t.setAttribute(Pi,r)}else n[Pi]&&t.setAttribute(Pi,n[Pi]);for(var s in Si)n[s]&&t.setAttribute(Si[s],n[s])}function Oi(e,t,n){e.childNodes.length>n?e.insertBefore(t,e.childNodes[n]):e.appendChild(t)}function Gi(e,t,n,i,o){e.style.width=i+"px",e.style.height=o+"px",e.style.left=t+"px",e.style.top=n+"px",e.height=o,e.width=i}function Li(e,t,n){var i=[e,t];return n&&i.push(n),i.join(":")}var Fi="data-jtk-container",Bi="data-jtk-enabled",Ri="data-jtk-scope",Hi="endpoint",Ni="element",Xi="connection",Yi="div",Vi="click",zi="contextmenu",Ui="dblclick",qi="dbltap",Wi="mousedown",Ji="mouseenter",Zi="mouseexit",Qi="mousemove",$i="mouseup",Ki="mouseout",eo="mouseover",to="tap",no="revert",io="connection:drag",oo=Li(Ni,Vi),ro=Li(Ni,Ui),so=Li(Ni,qi),ao=Li(Ni,Ki),lo=Li(Ni,eo),co=Li(Ni,Qi),uo=Li(Ni,$i),ho=Li(Ni,Wi),po=Li(Ni,zi),fo=Li(Ni,to),vo=Li(Hi,Vi),yo=Li(Hi,Ui),go=(Li(Hi,qi),Li(Hi,Ki)),mo=Li(Hi,eo),_o=Li(Hi,$i),xo=Li(Hi,Wi),bo=(Li(Hi,to),Li(Xi,Vi)),ko=Li(Xi,Ui),Eo=Li(Xi,qi),Co=Li(Xi,Ki),So=Li(Xi,eo),Po=Li(Xi,$i),wo=Li(Xi,Wi),Ao=Li(Xi,zi),Do=Li(Xi,to),Mo="position",To=Fe(Qe),jo=Fe($e),Io=Be(ze),Oo=Be("data-jtk-group-content"),Go=Fe(tt);function Lo(e,t,n,i,o,r,s){return function(){var e=[];return e.push.apply(e,arguments),e.item=function(e){return this[e]},e}(function(e,t,n,i,o,r,s){return new Touch({target:e,identifier:C(),pageX:t,pageY:n,screenX:i,screenY:o,clientX:r||i,clientY:s||o})}(e,t,n,i,o,r,s))}function Fo(e,t,n){for(var i=(n=n||e.parentNode).querySelectorAll(t),o=0;o<i.length;o++)if(i[o]===e)return!0;return!1}function Bo(e){return e.srcElement||e.target}function Ro(e,t,n,i){if(i){if(void 0!==e.path&&e.path.indexOf)return{path:e.path,end:e.path.indexOf(n)};var o={path:[],end:-1};return function e(t){o.path.push(t),t===n?o.end=o.path.length-1:null!=t.parentNode&&e(t.parentNode)}(t),o}return{path:[t],end:1}}var Ho=1;function No(){return"ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function Xo(){return"onmousedown"in document.documentElement}var Yo={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};function Vo(e,t){if(null==e)return{x:0,y:0};var n=function(e,t){return e.item?e.item(t):e[t]}(Uo(e),0);return{x:n[t+"X"],y:n[t+"Y"]}}function zo(e){return Vo(e,"page")}function Uo(e){return e.touches&&e.touches.length>0?e.touches:e.changedTouches&&e.changedTouches.length>0?e.changedTouches:e.targetTouches&&e.targetTouches.length>0?e.targetTouches:[e]}function qo(e,t,n,i,o){if(Zo(e,t,n),i.__tauid=n.__tauid,e.addEventListener)e.addEventListener(t,n,!1,o);else if(e.attachEvent){var r=t+n.__tauid;e["e"+r]=n,e[r]=function(){e["e"+r]&&e["e"+r](window.event)},e.attachEvent("on"+t,e[r])}}function Wo(e,t,n){var i=this;null!=n&&Jo(e,(function(o){if(function(e,t,n){if(e.__ta&&e.__ta[t]&&delete e.__ta[t][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)Wo(e,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(o,t,n),null!=n.__tauid)if(o.removeEventListener)o.removeEventListener(t,n,!1),No()&&Yo[t]&&o.removeEventListener(Yo[t],n,!1);else if(i.detachEvent){var r=t+n.__tauid;o[r]&&o.detachEvent("on"+t,o[r]),o[r]=null,o["e"+r]=null}n.__taTouchProxy&&Wo(e,n.__taTouchProxy[1],n.__taTouchProxy[0])}))}function Jo(e,t){if(null!=e)for(var n="string"==typeof e?document.querySelectorAll(e):null!=e.length?e:[e],i=0;i<n.length;i++)t(n[i])}function Zo(e,t,n){var i=Ho++;return e.__ta=e.__ta||{},e.__ta[t]=e.__ta[t]||{},e.__ta[t][i]=n,n.__tauid=i,i}var Qo=/:not\(([^)]+)\)/;function $o(e,t,n,i){if(null==e)return n;var o=e.split(","),r=[],s=[];d(o,(function(e){var t=e.match(Qo);null!=t?s.push(t[1]):r.push(e)})),s.length>0&&0===r.length&&r.push(oe);var a=function i(o){i.__tauid=n.__tauid;var a=Bo(o),l=!1,c=a,u=Ro(o,a,t,null!=e);if(-1!=u.end)for(var h=0;!l&&h<u.end;h++){c=u.path[h];for(var d=0;d<s.length;d++)if(Fo(c,s[d],t))return;for(var p=0;!l&&p<r.length;p++)if(Fo(c,r[p],t)){n.apply(c,[o,c]),l=!0;break}}};return function(e,t,n){e.__taExtra=e.__taExtra||[],e.__taExtra.push([t,n])}(n,i,a),a}var Ko=function(e,t,n,i,o){if(No()&&Yo[t]){var r=$o(i,e,n,Yo[t]);qo(e,Yo[t],r,n,o)}"focus"===t&&null==e.getAttribute(We)&&e.setAttribute(We,"1"),qo(e,t,$o(i,e,n,t),n,o)},er={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}};function tr(e,t,n,i){for(var o in n.__tamee[e])n.__tamee[e].hasOwnProperty(o)&&n.__tamee[e][o].apply(i,[t])}var nr=function(){function e(){ei(this,e)}return ni(e,null,[{key:"generate",value:function(e,t){return function(n,i,o,r){if(i==zi&&Xo())Ko(n,i,o,r);else{if(null==n.__taTapHandler){var s=n.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},a=function(i){for(var o=Bo(i),a=Ro(i,o,n,null!=r),l=!1,h=0;h<a.end;h++){if(l)return;o=a.path[h];for(var d=0;d<s.downSelectors.length;d++)if(null==s.downSelectors[d]||Fo(o,s.downSelectors[d],n)){s.down=!0,setTimeout(c,e),setTimeout(u,t),l=!0;break}}},l=function(e){if(s.down){var t,i,o=Bo(e);s.taps++;var r=function(e){return Uo(e).length}(e);for(var a in er)if(er.hasOwnProperty(a)){var l=er[a];if(l.touches===r&&(1===l.taps||l.taps===s.taps))for(var c=0;c<s[a].length;c++){i=Ro(e,o,n,null!=s[a][c][1]);for(var u=0;u<i.end;u++)if(t=i.path[u],null==s[a][c][1]||Fo(t,s[a][c][1],n)){s[a][c][0].apply(t,[e,t]);break}}}}},c=function(){s.down=!1},u=function(){s.taps=0};n.__taTapHandler.downHandler=a,n.__taTapHandler.upHandler=l,Ko(n,Wi,a),Ko(n,$i,l)}n.__taTapHandler.downSelectors.push(r),n.__taTapHandler[i].push([o,r]),o.__taUnstore=function(){null!=n.__taTapHandler&&(g(n.__taTapHandler.downSelectors,(function(e){return e===r})),function(e,t){var n,i=0;for(i=0,n=e.length;i<n&&e[i][0]!==t;i++);i<e.length&&e.splice(i,1)}(n.__taTapHandler[i],o),0===n.__taTapHandler.downSelectors.length&&(Wo(n,Wi,n.__taTapHandler.downHandler),Wo(n,$i,n.__taTapHandler.upHandler),delete n.__taTapHandler))}}}}}]),e}(),ir=function(){function e(){ei(this,e)}return ni(e,null,[{key:"generate",value:function(){var e=[];return function(t,n,i,o){if(!t.__tamee){t.__tamee={over:!1,mouseenter:[],mouseexit:[]};var r=function(n){var i=Bo(n);(null==o&&i==t&&!t.__tamee.over||Fo(i,o,t)&&(null==i.__tamee||!i.__tamee.over))&&(tr(Ji,n,t,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,e.push(i))},s=function(n){for(var i=Bo(n),o=0;o<e.length;o++)i!=e[o]||Fo(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,e.splice(o,1),tr(Zi,n,t,i))};qo(t,eo,$o(o,t,r,eo),r),qo(t,Ki,$o(o,t,s,Ki),s)}i.__taUnstore=function(){delete t.__tamee[n][i.__tauid]},Zo(t,n,i),t.__tamee[n][i.__tauid]=i}}}]),e}(),or=function(){function e(t){ei(this,e),ii(this,"clickThreshold",void 0),ii(this,"dblClickThreshold",void 0),ii(this,"tapHandler",void 0),ii(this,"mouseEnterExitHandler",void 0),t=t||{},this.clickThreshold=t.clickThreshold||250,this.dblClickThreshold=t.dblClickThreshold||450,this.mouseEnterExitHandler=ir.generate(),this.tapHandler=nr.generate(this.clickThreshold,this.dblClickThreshold)}return ni(e,[{key:"_doBind",value:function(e,t,n,i,o){if(null!=n){var r=e;t===to||t===qi||t===zi?this.tapHandler(r,t,n,i,o):t===Ji||t==Zi?this.mouseEnterExitHandler(r,t,n,i,o):Ko(r,t,n,i,o)}}},{key:"on",value:function(e,t,n,i,o){var r=null==i?null:n,s=null==i?n:i;return this._doBind(e,t,s,r,o),this}},{key:"off",value:function(e,t,n){return Wo(e,t,n),this}},{key:"trigger",value:function(e,t,n,i,o){var r=Xo()&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),s=No()&&!Xo()&&Yo[t]?Yo[t]:t,a=!(No()&&!Xo()&&Yo[t]),l=zo(n),c=Vo(n,"screen"),u=function(e){return Vo(e,"client")}(n);return Jo(e,(function(e){var h;n=n||{screenX:c.x,screenY:c.y,clientX:u.x,clientY:u.y};var d,p={TouchEvent:function(t){var n=Lo(e,l.x,l.y,c.x,c.y,u.x,u.y);(t.initTouchEvent||t.initEvent)(s,!0,!0,window,null,c.x,c.y,u.x,u.y,!1,!1,!1,!1,n,n,n,1,0)},MouseEvents:function(t){t.initMouseEvent(s,!0,!0,window,null==o?1:o,c.x,c.y,u.x,u.y,!1,!1,!1,!1,1,e)}},f=!a&&!r&&No()&&Yo[t]?"TouchEvent":"MouseEvents";h=document.createEvent(f),p[f](h),d=h,i&&(d.payload=i),e.dispatchEvent(h)})),this}}]),e}();function rr(e,t,n){if(pi(t,n,e))return t;for(var i=t.parentNode;null!=i&&i!==e;){if(pi(i,n,e))return i;i=i.parentNode}}function sr(e){return{x:e.offsetLeft,y:e.offsetTop}}function ar(e){return{w:e.offsetWidth,h:e.offsetHeight}}function lr(e,t){e.style.left=t.x+"px",e.style.top=t.y+"px"}function cr(e,t,n){var i=t.parentNode,o=e.getSize(i),r=e.getSize(t),s=n.x,a=s+r.w,l=n.y,c=l+r.h;return a>0&&s<o.w&&c>0&&l<o.h}var ur,hr="start",dr="beforeStart",pr="drag",fr="stop",vr="katavorio-draggable",yr=function(){return!0},gr=function(){return!1},mr="katavorio-delegated-draggable",_r="katavorio-drag-no-select",xr="katavorio-ghost-proxy",br="katavorio-clone-drag",kr=[fr,hr,pr,"drop","over","out",dr],Er=function(){},Cr=function(e,t){if(null!=e){e=o(e)||null!=e.tagName||null==e.length?[e]:e;for(var n=0;n<e.length;n++)t.apply(e[n],[e[n]])}},Sr=function(){function e(t,n){ei(this,e),this.el=t,this.k=n,ii(this,"_class",void 0),ii(this,"uuid",C()),ii(this,"enabled",!0),ii(this,"scopes",[])}return ni(e,[{key:"setEnabled",value:function(e){this.enabled=e}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(e){var t={};for(var n in Cr(this.scopes,(function(e){t[e]=!0})),Cr(e?e.split(/\s+/):[],(function(e){t[e]=!0})),this.scopes.length=0,t)this.scopes.push(n)}},{key:"removeScope",value:function(e){var t={};for(var n in Cr(this.scopes,(function(e){t[e]=!0})),Cr(e?e.split(/\s+/):[],(function(e){delete t[e]})),this.scopes.length=0,t)this.scopes.push(n)}},{key:"toggleScope",value:function(e){var t={};for(var n in Cr(this.scopes,(function(e){t[e]=!0})),Cr(e?e.split(/\s+/):[],(function(e){t[e]?delete t[e]:t[e]=!0})),this.scopes.length=0,t)this.scopes.push(n)}}]),e}();!function(e){e.notNegative="notNegative",e.parent="parent",e.parentEnclosed="parentEnclosed"}(ur||(ur={}));var Pr=function(e){oi(n,e);var t=ci(n);function n(e,i,o){var r;if(ei(this,n),ii(ai(r=t.call(this,e,o)),"_class",void 0),ii(ai(r),"rightButtonCanDrag",void 0),ii(ai(r),"consumeStartEvent",void 0),ii(ai(r),"clone",void 0),ii(ai(r),"scroll",void 0),ii(ai(r),"trackScroll",void 0),ii(ai(r),"_downAt",void 0),ii(ai(r),"_posAtDown",void 0),ii(ai(r),"_pagePosAtDown",void 0),ii(ai(r),"_pageDelta",{x:0,y:0}),ii(ai(r),"_moving",void 0),ii(ai(r),"_lastPosition",void 0),ii(ai(r),"_lastScrollValues",{x:0,y:0}),ii(ai(r),"_initialScroll",{x:0,y:0}),ii(ai(r),"_size",void 0),ii(ai(r),"_currentParentPosition",void 0),ii(ai(r),"_ghostParentPosition",void 0),ii(ai(r),"_dragEl",void 0),ii(ai(r),"_multipleDrop",void 0),ii(ai(r),"_ghostProxyOffsets",void 0),ii(ai(r),"_ghostDx",void 0),ii(ai(r),"_ghostDy",void 0),ii(ai(r),"_isConstrained",!1),ii(ai(r),"_ghostProxyParent",void 0),ii(ai(r),"_useGhostProxy",void 0),ii(ai(r),"_ghostProxyFunction",void 0),ii(ai(r),"_activeSelectorParams",void 0),ii(ai(r),"_availableSelectors",[]),ii(ai(r),"_canDrag",void 0),ii(ai(r),"_consumeFilteredEvents",void 0),ii(ai(r),"_parent",void 0),ii(ai(r),"_ignoreZoom",void 0),ii(ai(r),"_filters",{}),ii(ai(r),"_constrainRect",void 0),ii(ai(r),"_elementToDrag",void 0),ii(ai(r),"downListener",void 0),ii(ai(r),"moveListener",void 0),ii(ai(r),"upListener",void 0),ii(ai(r),"scrollTracker",void 0),ii(ai(r),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),r._class=r.k.css.draggable,xi(r.el,r._class),r.downListener=r._downListener.bind(ai(r)),r.upListener=r._upListener.bind(ai(r)),r.moveListener=r._moveListener.bind(ai(r)),r.rightButtonCanDrag=!0===i.rightButtonCanDrag,r.consumeStartEvent=!1!==i.consumeStartEvent,r._dragEl=r.el,r.clone=!0===i.clone,r.scroll=!0===i.scroll,r.trackScroll=!1!==i.trackScroll,r._multipleDrop=!1!==i.multipleDrop,r._canDrag=i.canDrag||yr,r._consumeFilteredEvents=i.consumeFilteredEvents,r._parent=i.parent,r._ignoreZoom=!0===i.ignoreZoom,r._ghostProxyParent=i.ghostProxyParent,r.trackScroll&&(r.scrollTracker=r._trackScroll.bind(ai(r)),document.addEventListener("scroll",r.scrollTracker)),!0===i.ghostProxy?r._useGhostProxy=yr:i.ghostProxy&&"function"==typeof i.ghostProxy?r._useGhostProxy=i.ghostProxy:r._useGhostProxy=function(e,t){return!(!r._activeSelectorParams||!r._activeSelectorParams.useGhostProxy)&&r._activeSelectorParams.useGhostProxy(e,t)},i.makeGhostProxy?r._ghostProxyFunction=i.makeGhostProxy:r._ghostProxyFunction=function(e){return r._activeSelectorParams&&r._activeSelectorParams.makeGhostProxy?r._activeSelectorParams.makeGhostProxy(e):e.cloneNode(!0)},i.selector){var s=r.el.getAttribute(vr);null==s&&(s=""+(new Date).getTime(),r.el.setAttribute("katavorio-draggable",s)),r._availableSelectors.push(i)}return r.k.eventManager.on(r.el,Wi,r.downListener),r}return ni(n,[{key:"_trackScroll",value:function(e){if(this._moving){var t={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=t.x-this._lastScrollValues.x,i=t.y-this._lastScrollValues.y,o={x:n+this._lastPosition.x,y:i+this._lastPosition.y},r=o.x-this._downAt.x,s=o.y-this._downAt.y,a=this._ignoreZoom?1:this.k.getZoom();this._dragEl&&this._dragEl.parentNode&&(r+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,s+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),r/=a,s/=a,this.moveBy(r,s,e),this._lastPosition=o,this._lastScrollValues=t}}},{key:"on",value:function(e,t){this.listeners[e]&&this.listeners[e].push(t)}},{key:"off",value:function(e,t){if(this.listeners[e]){for(var n=[],i=0;i<this.listeners[e].length;i++)this.listeners[e][i]!==t&&n.push(this.listeners[e][i]);this.listeners[e]=n}}},{key:"_upListener",value:function(e){this._downAt&&(this._downAt=null,this.k.eventManager.off(document,Qi,this.moveListener),this.k.eventManager.off(document,$i,this.upListener),bi(document.body,_r),this.unmark(e),this.stop(e),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,sr(this._dragEl))&&(lr(this._dragEl,this._posAtDown),this._dispatch(no,this._dragEl)))}},{key:"_downListener",value:function(e){if(!e.defaultPrevented&&((this.rightButtonCanDrag||3!==e.which&&2!==e.button)&&this.isEnabled()&&this._canDrag())){var t=this._testFilter(e)&&function(e,t,n){return!pi(e.srcElement||e.target,n.getInputFilterSelector(),t)}(e,this.el,this.k);if(t){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var n=e.target||e.srcElement,i=function(e,t,n){for(var i=null,o=t.getAttribute("katavorio-draggable"),r=null!=o?"[katavorio-draggable='"+o+"'] ":"",s=0;s<e.length;s++)if(null!=(i=rr(t,n,r+e[s].selector))){if(e[s].filter){var a=pi(n,e[s].filter,i);if(!0===e[s].filterExclude&&!a||a)return null}return[e[s],i]}return null}(this._availableSelectors,this.el,n);if(null!=i&&(this._activeSelectorParams=i[0],this._elementToDrag=i[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var o=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag):null;if(null!=o&&(this._elementToDrag=o),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),xi(this._dragEl,br),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var r=sr(this.el);this._dragEl.style.left=r.x+"px",this._dragEl.style.top=r.y+"px",this._parent.appendChild(this._dragEl)}else{var s=Ci(this._elementToDrag);this._dragEl.style.left=s.x+"px",this._dragEl.style.top=s.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&fi(e),this._downAt=zo(e),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=sr(this._dragEl),this._pagePosAtDown=Ci(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=ar(this._dragEl),this.k.eventManager.on(document,Qi,this.moveListener),this.k.eventManager.on(document,$i,this.upListener),xi(document.body,_r),this._dispatch(dr,{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size})}else this._consumeFilteredEvents&&fi(e)}}},{key:"_moveListener",value:function(e){if(this._downAt){if(!this._moving){var t=this._dispatch(hr,{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size});if(!1!==t){if(!this._downAt)return;this.mark(t),this._moving=!0}else this.abort()}if(this._downAt){var n=zo(e),i=n.x-this._downAt.x,o=n.y-this._downAt.y,r=this._ignoreZoom?1:this.k.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,o+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),i/=r,o/=r,this.moveBy(i,o,e)}}}},{key:"mark",value:function(e){var t;this._posAtDown=sr(this._dragEl),this._pagePosAtDown=Ci(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=ar(this._dragEl),xi(this._dragEl,this.k.css.drag),this._constrainRect={w:(t=this._dragEl).parentNode.offsetWidth+t.parentNode.scrollLeft,h:t.parentNode.offsetHeight+t.parentNode.scrollTop},this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(e){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,bi(this._dragEl,this.k.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(e,t,n){var i=this.toGrid({x:this._posAtDown.x+e,y:this._posAtDown.y+t}),o=this._doConstrain(i,this._dragEl,this._constrainRect,this._size);if(this._useGhostProxy(this.el,this._dragEl))if(i.x!==o.x||i.y!==o.y){if(!this._isConstrained){var r=this._ghostProxyFunction(this._elementToDrag);xi(r,xr),this._ghostProxyParent?(this._ghostProxyParent.appendChild(r),this._currentParentPosition=Ci(this._elementToDrag.parentNode),this._ghostParentPosition=Ci(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(r),this._dragEl=r,this._isConstrained=!0}o=i}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);lr(this._dragEl,{x:o.x+this._ghostDx,y:o.y+this._ghostDy}),this._dispatch(pr,{el:this.el,pos:o,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(e){return e?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(e,t){if(t||this._moving){var n=[],i=sr(this._dragEl);n.push([this._dragEl,i,this,this._size]),this._dispatch(fr,{el:this._dragEl,pos:this._ghostProxyOffsets||i,finalPos:i,e,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(e,t){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[e])n=this._activeSelectorParams[e](t);else if(this.listeners[e])for(var i=0;i<this.listeners[e].length;i++)try{var o=this.listeners[e][i](t);null!=o&&(n=o)}catch(e){}return n}},{key:"resolveGrid",value:function(){var e={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(e.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(e.thresholdX=this._activeSelectorParams.snapThreshold,e.thresholdY=this._activeSelectorParams.snapThreshold)),e}},{key:"toGrid",value:function(e){var t=this.resolveGrid(),n=t.grid,i=t.thresholdX,o=t.thresholdY;return null==n?e:function(e,t,n,i){n=null==n?null==t.thresholdX?t.w/2:t.thresholdX:n,i=null==i?null==t.thresholdY?t.h/2:t.thresholdY:i;var o=Math.floor(e.x/t.w),r=t.w*o,s=r+t.w,a=Math.abs(e.x-r)<=n?r:Math.abs(s-e.x)<=n?s:e.x,l=Math.floor(e.y/t.h),c=t.h*l,u=c+t.h;return{x:a,y:Math.abs(e.y-c)<=i?c:Math.abs(u-e.y)<=i?u:e.y}}(e,n,n?n.w/2:i,n?n.h/2:o)}},{key:"setUseGhostProxy",value:function(e){this._useGhostProxy=e?yr:gr}},{key:"_doConstrain",value:function(e,t,n,i){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(e,t,n,i):e}},{key:"_testFilter",value:function(e){for(var t in this._filters){var n=this._filters[t],i=n[0](e);if(n[1]&&(i=!i),!i)return!1}return!0}},{key:"addFilter",value:function(e,t){var n,i=this;if(e){var r="function"==typeof(n=e)?(n._katavorioId=C(),n._katavorioId):n;this._filters[r]=[function(t){var n,r=t.srcElement||t.target;return o(e)?n=pi(r,e,i.el):"function"==typeof e&&(n=e(t,i.el)),n},!1!==t]}}},{key:"removeFilter",value:function(e){var t="function"==typeof e?e._katavorioId:e;delete this._filters[t]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(e,t){e.selector&&(t?this._availableSelectors.unshift(e):this._availableSelectors.push(e))}},{key:"destroy",value:function(){this.k.eventManager.off(this.el,Wi,this.downListener),this.k.eventManager.off(document,Qi,this.moveListener),this.k.eventManager.off(document,$i,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,null!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]),n}(Sr),wr=["input","textarea","select","button","option"].join(","),Ar=function(){function e(n){ei(this,e),ii(this,"eventManager",void 0),ii(this,"zoom",1),ii(this,"css",{}),ii(this,"inputFilterSelector",void 0),n=n||{},this.inputFilterSelector=n.inputFilterSelector||wr,this.eventManager=new or,this.zoom=n.zoom||1;var i=n.css||{};t(this.css,i)}return ni(e,[{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(e){this.zoom=e}},{key:"_prepareParams",value:function(e){e=e||{};var t,n={events:{}};for(t in e)n[t]=e[t];for(t=0;t<kr.length;t++)n.events[kr[t]]=e[kr[t]]||Er;return n}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(e){return this.inputFilterSelector=e,this}},{key:"draggable",value:function(e,t){if(null==e._katavorioDrag){var n=this._prepareParams(t),i=new Pr(e,n,this);return xi(e,mr),e._katavorioDrag=i,i}return e._katavorioDrag}},{key:"destroyDraggable",value:function(e){e._katavorioDrag&&(e._katavorioDrag.destroy(),delete e._katavorioDrag)}}]),e}(),Dr="jtk-drag-selected",Mr=function(){function e(t){ei(this,e),this.instance=t,ii(this,"_dragSelection",[]),ii(this,"_dragSizes",new Map),ii(this,"_dragElements",new Map),ii(this,"_dragElementStartPositions",new Map),ii(this,"_dragElementPositions",new Map),ii(this,"__activeSet",void 0)}return ni(e,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(e){var t=this;this.__activeSet=[],d(this._dragSelection,(function(n){e(n)&&t.__activeSet.push(n)}))}},{key:"clear",value:function(){var e=this;this.reset(),d(this._dragSelection,(function(t){return e.instance.removeClass(t.jel,Dr)})),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var e=this;d(this._activeSet,(function(t){var n={x:parseInt(""+t.jel.offsetLeft,10),y:parseInt(""+t.jel.offsetTop,10)};e._dragElementStartPositions.set(t.id,n),e._dragElementPositions.set(t.id,n),e._dragSizes.set(t.id,e.instance.getSize(t.jel))}))}},{key:"updatePositions",value:function(e,t,n){var i=this,o=e.x-t.x,r=e.y-t.y;d(this._activeSet,(function(e){var t=i._dragElementStartPositions.get(e.id);if(t){var s=t.x+o,a=t.y+r,l=i._dragSizes.get(e.id),c={x:s,y:a,w:l.w,h:l.h};if(e.jel._jsPlumbParentGroup&&e.jel._jsPlumbParentGroup.constrain){var u={w:e.jel.parentNode.offsetWidth+e.jel.parentNode.scrollLeft,h:e.jel.parentNode.offsetHeight+e.jel.parentNode.scrollTop};c.x=Math.max(c.x,0),c.y=Math.max(c.y,0),c.x=Math.min(c.x,u.w-l.w),c.y=Math.min(c.y,u.h-l.h)}i._dragElementPositions.set(e.id,{x:s,y:a}),e.jel.style.left=c.x+"px",e.jel.style.top=c.y+"px",n(e.jel,e.id,l,c)}}))}},{key:"each",value:function(e){var t=this;d(this._activeSet,(function(n){var i=t._dragSizes.get(n.id),o=t._dragElementPositions.get(n.id),r=t._dragElementStartPositions.get(n.id);e(n.jel,n.id,o,i,r)}))}},{key:"add",value:function(e,t){var n=e;t=t||this.instance.getId(n),-1===p(this._dragSelection,(function(e){return e.id===t}))&&(this.instance.addClass(e,Dr),this._dragSelection.push({id:t,jel:n}))}},{key:"remove",value:function(e){var t=this,n=e;this._dragSelection=this._dragSelection.filter((function(e){var i=e.jel!==n;return i||t.instance.removeClass(e.jel,Dr),i}))}},{key:"toggle",value:function(e){var t=e;-1!==p(this._dragSelection,(function(e){return e.jel===t}))?this.remove(t):this.add(e)}}]),e}(),Tr="jtk-drag-active",jr="jtk-drag-hover",Ir=function(){function e(t,n,i){var o=this;ei(this,e),this.instance=t,this.dragSelection=n,ii(this,"collicat",void 0),ii(this,"drag",void 0),ii(this,"_draggables",{}),ii(this,"_dlist",[]),ii(this,"_elementsWithEndpoints",{}),ii(this,"_draggablesForElements",{}),ii(this,"handlers",[]),ii(this,"_trackScroll",void 0),ii(this,"_filtersToAdd",[]),this.collicat=new Ar({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:"jtk-delegated-draggable",draggable:"jtk-draggable",drag:"jtk-drag",selected:Dr,active:Tr,hover:jr,ghostProxy:"jtk-ghost-proxy"}}),this.instance.bind(lt,(function(e){o.collicat.setZoom(e)})),i=i||{},this._trackScroll=!1!==i.trackScroll}return ni(e,[{key:"addHandler",value:function(e,n){var i=this,o=t({selector:e.selector},n||{});o.start=D(o.start,(function(t){return e.onStart(t)}),!1),o.drag=D(o.drag,(function(t){return e.onDrag(t)})),o.stop=D(o.stop,(function(t){return e.onStop(t)}));var r=(e.onBeforeStart||function(e){}).bind(e);if(o.beforeStart=D(o.beforeStart,(function(e){return r(e)})),o.dragInit=function(t){return e.onDragInit(t)},o.dragAbort=function(t){return e.onDragAbort(t)},e.useGhostProxy&&(o.useGhostProxy=e.useGhostProxy,o.makeGhostProxy=e.makeGhostProxy),null==o.constrainFunction&&null!=o.containment)switch(o.containment){case ur.notNegative:o.constrainFunction=function(e,t,n,i){return{x:Math.max(0,Math.min(e.x)),y:Math.max(0,Math.min(e.y))}};break;case ur.parent:var s=o.containmentPadding||5;o.constrainFunction=function(e,t,n,i){return{x:e.x<0?0:e.x>n.w-s?n.w-s:e.x,y:e.y<0?0:e.y>n.h-s?n.h-s:e.y}};break;case ur.parentEnclosed:o.constrainFunction=function(e,t,n,i){return{x:e.x<0?0:e.x+i.w>n.w?n.w-i.w:e.x,y:e.y<0?0:e.y+i.h>n.h?n.h-i.h:e.y}}}null==this.drag?(o.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),o),d(this._filtersToAdd,(function(e){return i.drag.addFilter(e[0],e[1])})),this.drag.on(no,(function(e){i.instance.revalidate(e)}))):this.drag.addSelector(o),this.handlers.push({handler:e,options:o}),e.init(this.drag)}},{key:"addSelector",value:function(e,t){this.drag&&this.drag.addSelector(e,t)}},{key:"addFilter",value:function(e,t){null==this.drag?this._filtersToAdd.push([e,!0===t]):this.drag.addFilter(e,t)}},{key:"removeFilter",value:function(e){null!=this.drag&&this.drag.removeFilter(e)}},{key:"setFilters",value:function(e){var t=this;d(e,(function(e){t.drag.addFilter(e[0],e[1])}))}},{key:"reset",value:function(){var e=[];if(d(this.handlers,(function(e){e.handler.reset()})),this.handlers.length=0,null!=this.drag){var t=this.drag._filters;for(var n in t)e.push([n,t[n][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,e}},{key:"setOption",value:function(e,n){var i=f(this.handlers,(function(t){return t.handler===e}));null!=i&&t(i.options,n||{})}}]),e}();function Or(e,t){return o(t)?{id:t,active:!0}:{id:e.getId(t),active:t.active}}var Gr=function(){function e(t,n){ei(this,e),this.instance=t,this._dragSelection=n,ii(this,"selector","> "+ht+":not("+Fe(tt)+")"),ii(this,"_dragOffset",null),ii(this,"_groupLocations",[]),ii(this,"_intersectingGroups",[]),ii(this,"_currentDragParentGroup",null),ii(this,"_dragGroupByElementIdMap",{}),ii(this,"_dragGroupMap",{}),ii(this,"_currentDragGroup",null),ii(this,"_currentDragGroupOffsets",new Map),ii(this,"_currentDragGroupSizes",new Map),ii(this,"_dragPayload",null),ii(this,"drag",void 0),ii(this,"originalPosition",void 0)}return ni(e,[{key:"onDragInit",value:function(e){return null}},{key:"onDragAbort",value:function(e){return null}},{key:"getDropGroup",value:function(){var e=null;if(this._intersectingGroups.length>0){var t=this._intersectingGroups[0].groupLoc.group,n=this._intersectingGroups[0].intersectingElement,i=n._jsPlumbParentGroup;i!==t&&(null!=i&&i.overrideDrop(n,t)||(e=this._intersectingGroups[0]))}return e}},{key:"onStop",value:function(e){var t=this,n=e.drag.getDragElement(),i=this.getDropGroup(),o=[];if(o.push({el:n,id:this.instance.getId(n),pos:e.finalPos,originalGroup:n._jsPlumbParentGroup,redrawResult:null,originalPos:e.originalPos,reverted:!1,dropGroup:null!=i?i.groupLoc.group:null}),this._dragSelection.each((function(t,n,r,s,a){if(t!==e.el){var l={x:r.x,y:r.y},c=l.x,u=l.y;if(t._jsPlumbParentGroup&&t._jsPlumbParentGroup.constrain){var h={w:t.parentNode.offsetWidth+t.parentNode.scrollLeft,h:t.parentNode.offsetHeight+t.parentNode.scrollTop};c=Math.max(c,0),u=Math.max(u,0),c=Math.min(c,h.w-s.w),u=Math.min(u,h.h-s.h),l.x=c,l.y=u}o.push({el:t,id:n,pos:l,originalPos:a,originalGroup:t._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null!=i?i.groupLoc.group:null})}})),d(o,(function(e){var n=null!=e.originalGroup,o=n&&cr(t.instance,e.el,e.pos),r={x:0,y:0};if(n&&!o){if(null==i){var s=t._pruneOrOrphan(e,!0,!0);null!=s.pos?e.pos=s.pos.pos:!s.pruned&&e.originalGroup.revert&&(e.pos=e.originalPos,e.reverted=!0)}}else n&&o&&(r=t.instance.viewport.getPosition(e.originalGroup.elId));null==i||o?e.dropGroup=null:t.instance.groupManager.addToGroup(i.groupLoc.group,!1,e.el),e.reverted&&t.instance.setPosition(e.el,e.pos),e.redrawResult=t.instance.setElementPosition(e.el,e.pos.x+r.x,e.pos.y+r.y),t.instance.removeClass(e.el,"jtk-dragged"),t.instance.select({source:e.el}).removeClass(t.instance.elementDraggingClass+" "+t.instance.sourceElementDraggingClass,!0),t.instance.select({target:e.el}).removeClass(t.instance.elementDraggingClass+" "+t.instance.targetElementDraggingClass,!0)})),null!=o[0].originalGroup){var r=n._jsPlumbParentGroup;if(r!==o[0].originalGroup){var s=e.drag.getDragElement(!0);if(o[0].originalGroup.ghost){var a=this.instance.getOffset(this.instance.getGroupContentArea(r)),l=this.instance.getOffset(this.instance.getGroupContentArea(o[0].originalGroup)),c={x:l.x+e.pos.x-a.x,y:l.y+e.pos.y-a.y};s.style.left=c.x+"px",s.style.top=c.y+"px",this.instance.revalidate(s)}}}this.instance.fire("drag:stop",{elements:o,e:e.e,el:n,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var e=this;d(this._groupLocations,(function(t){e.instance.removeClass(t.el,Tr),e.instance.removeClass(t.el,jr)})),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(e){this.drag=e}},{key:"onDrag",value:function(e){var t=this,n=e.drag.getDragElement(),i=e.pos,o=this.instance.getSize(n),r={x:i.x,y:i.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(r.x+=this._dragOffset.x,r.y+=this._dragOffset.y);var s=function(n,i,o){if(o){var r=new Set;d(t._groupLocations,(function(n){!r.has(n.group.id)&&J(i,n.r)?(n.group!==t._currentDragParentGroup&&t.instance.addClass(n.el,jr),t._intersectingGroups.push({groupLoc:n,intersectingElement:e.drag.getDragElement(!0),d:0}),d(t.instance.groupManager.getAncestors(n.group),(function(e){return r.add(e.id)}))):t.instance.removeClass(n.el,jr)}))}t.instance.setElementPosition(n,i.x,i.y),t.instance.fire("drag:move",{el:n,e:e.e,pos:{x:i.x,y:i.y},originalPosition:t.originalPosition,payload:t._dragPayload})},a={x:r.x,y:r.y,w:o.w,h:o.h};s(n,a,!0),this._dragSelection.updatePositions(i,this.originalPosition,(function(e,t,n,i){s(e,i,!1)})),this._currentDragGroupOffsets.forEach((function(e,n){var i=t._currentDragGroupSizes.get(n),o={x:a.x+e[0].x,y:a.y+e[0].y,w:i.w,h:i.h};e[1].style.left=o.x+"px",e[1].style.top=o.y+"px",s(e[1],o,!1)}))}},{key:"onStart",value:function(e){var t=this,n=e.drag.getDragElement(),i=this.instance.getOffset(n);this.originalPosition={x:e.pos.x,y:e.pos.y},n._jsPlumbParentGroup&&(this._dragOffset=this.instance.getOffset(n.offsetParent),this._currentDragParentGroup=n._jsPlumbParentGroup);var o=!0,r=n.getAttribute(qe);if((!1===this.instance.elementsDraggable||null!=r&&r!==ie)&&(o=!1),o){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var s=e.drag.getDragElement(!0),a=s.querySelectorAll(ht),l=function(e){for(var t=[],n=e._jsPlumbParentGroup;null!=n;)t.push(n.el),n=n.group;return t}(s),c=[];Array.prototype.push.apply(c,a),Array.prototype.push.apply(c,l),this._dragSelection.filterActiveSet((function(e){return-1===c.indexOf(e.jel)})),this._dragSelection.initialisePositions();var u=function(n){if(!n._isJsPlumbGroup||t.instance.allowNestedGroups){var i=!n._jsPlumbParentGroup,o=i||!0!==n._jsPlumbParentGroup.dropOverride,r=!i&&(n._jsPlumbParentGroup.ghost||!0!==n._jsPlumbParentGroup.constrain);(i||o&&r)&&(d(t.instance.groupManager.getGroups(),(function(e){var i=n._jsPlumbGroup;if(!1!==e.droppable&&!1!==e.enabled&&n._jsPlumbGroup!==e&&!t.instance.groupManager.isDescendant(e,i)){var o=e.el,r=t.instance.getSize(o),s=t.instance.getOffset(o),a={el:o,r:{x:s.x,y:s.y,w:r.w,h:r.h},group:e};t._groupLocations.push(a),e!==t._currentDragParentGroup&&t.instance.addClass(o,Tr)}})),t._groupLocations.sort((function(e,n){return t.instance.groupManager.isDescendant(e.group,n.group)?-1:t.instance.groupManager.isAncestor(n.group,e.group)?1:0})))}return t.instance.select({source:n}).addClass(t.instance.elementDraggingClass+" "+t.instance.sourceElementDraggingClass,!0),t.instance.select({target:n}).addClass(t.instance.elementDraggingClass+" "+t.instance.targetElementDraggingClass,!0),t.instance.fire("drag:start",{el:n,e:e.e,originalPosition:t.originalPosition,pos:t.originalPosition})},h=this.instance.getId(n);this._currentDragGroup=this._dragGroupByElementIdMap[h],this._currentDragGroup&&!function(e,t){var n=v(e.members,(function(e){return e.el===t}));return null!==n&&!0===n.active}(this._currentDragGroup,n)&&(this._currentDragGroup=null);var p=u(n);if(!1===p)return this._cleanup(),!1;this._dragPayload=p,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach((function(e){var n=t.instance.getOffset(e.el);t._currentDragGroupOffsets.set(e.elId,[{x:n.x-i.x,y:n.y-i.y},e.el]),t._currentDragGroupSizes.set(e.elId,t.instance.getSize(e.el)),u(e.el)})))}return o}},{key:"addToDragGroup",value:function(e){var t=this,n=Or(this.instance,e),i=this._dragGroupMap[n.id];null==i&&(i={id:n.id,members:new Set},this._dragGroupMap[n.id]=i);for(var o=arguments.length,r=new Array(o>1?o-1:0),s=1;s<o;s++)r[s-1]=arguments[s];this.removeFromDragGroup.apply(this,r),d(r,(function(e){var o=t.instance.getId(e);i.members.add({elId:o,el:e,active:n.active}),t._dragGroupByElementIdMap[o]=i}))}},{key:"removeFromDragGroup",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];d(n,(function(t){var n=e.instance.getId(t),i=e._dragGroupByElementIdMap[n];if(null!=i){var o=new Set;i.members.forEach((function(e){e.el!==t&&o.add(e)})),i.members=o,delete e._dragGroupByElementIdMap[n]}}))}},{key:"setDragGroupState",value:function(e){for(var t=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var r=i.map((function(e){return t.instance.getId(e)}));d(r,(function(n){var i=t._dragGroupByElementIdMap[n];if(null!=i){var o=v(i.members,(function(e){return e.elId===n}));null!=o&&(o.active=e)}}))}},{key:"_pruneOrOrphan",value:function(e,t,n){var i=e.el,o={pruned:!1,pos:null};if(n||!cr(this.instance,i,e.pos)){var r=i._jsPlumbParentGroup;r.prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):r.remove(e.el,!0),o.pruned=!0):r.orphan&&(o.pos=this.instance.groupManager.orphan(e.el,t),i._isJsPlumbGroup?r.removeGroup(i._jsPlumbGroup):r.remove(e.el))}return o}}]),e}();function Lr(e,t,n,i,o){var r=function(e,t){return new Bt(e,t)}(o,i),s={paintStyle:e.getPaintStyle(),preparedAnchor:r,element:i,scope:e.scope};null!=t&&(T(t,Ce)?s.existingEndpoint=t:s.endpoint=t);var a=o._internal_newEndpoint(s);return o._paintEndpoint(a,{}),a}function Fr(e,t,n,i,o){for(var r=e.target||e.srcElement,s=!1,a=i.getSelector(t,n),l=0;l<a.length;l++)if(a[l]===r){s=!0;break}return o?!s:s}var Br=Fe(Tr,jr),Rr="sourceSelectorEndpoint",Hr=function(){function e(t){ei(this,e),this.instance=t,ii(this,"jpc",void 0),ii(this,"existingJpc",void 0),ii(this,"_originalAnchorSpec",void 0),ii(this,"ep",void 0),ii(this,"endpointRepresentation",void 0),ii(this,"canvasElement",void 0),ii(this,"_activeDefinition",void 0),ii(this,"placeholderInfo",{id:null,element:null}),ii(this,"floatingIndex",void 0),ii(this,"floatingId",void 0),ii(this,"floatingElement",void 0),ii(this,"floatingEndpoint",void 0),ii(this,"floatingAnchor",void 0),ii(this,"_stopped",void 0),ii(this,"inPlaceCopy",void 0),ii(this,"endpointDropTargets",[]),ii(this,"currentDropTarget",null),ii(this,"payload",void 0),ii(this,"floatingConnections",{}),ii(this,"_forceReattach",void 0),ii(this,"_forceDetach",void 0),ii(this,"mousedownHandler",void 0),ii(this,"mouseupHandler",void 0),ii(this,"selector",Fe($e));var n=t.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),t.on(n,Wi,ht,this.mousedownHandler),t.on(n,$i,[ht,Fe($e)].join(","),this.mouseupHandler)}return ni(e,[{key:"_resolveDragParent",value:function(e,t){var n=this.instance.getContainer(),i=vi(t,ht,n,!0);if(null!=e.parentSelector){var o=vi(t,e.parentSelector,n,!0);return null!=o&&(i=vi(o.parentNode,ht,n,!1)),o||i}return i}},{key:"_mousedownHandler",value:function(e){var n,i;if(3!==e.which&&2!==e.button){var o=e.target||e.srcElement;if((null==(i=this._getSourceDefinition(e))||null!=(n=this._resolveDragParent(i.def.def,o))&&n.getAttribute(Bi)!==ie)&&i){var r,s=e.currentTarget;if(o.getAttribute(Bi)!==ie){if(fi(e),this._activeDefinition=i,null!=(r=i.def.def).canAcceptNewConnection&&!r.canAcceptNewConnection(n,e))return!1;var a=Jr(e,n,this.instance.currentZoom),l={element:n};if(t(l,r),l.isTemporarySource=!0,r.scope)l.scope=r.scope;else{var u=o.getAttribute(Ri);null!=u&&(l.scope=u)}if(null!=(l=c(l,r.parameterExtractor?r.parameterExtractor(n,o,e):{})).maxConnections&&l.maxConnections>=0)if(this.instance.select({source:n}).length>=l.maxConnections)return fi(e),r.onMaxConnections&&r.onMaxConnections({element:n,maxConnections:l.maxConnections},e),e.stopImmediatePropagation&&e.stopImmediatePropagation(),!1;if(r.anchorPositionFinder){var h=r.anchorPositionFinder(n,a,r,e);null!=h&&(l.anchor=h)}this._originalAnchorSpec=l.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var d=this.instance.router.prepareAnchor(this._originalAnchorSpec),p=[a.x,a.y,0,0];if(d.locations.length>0)p[2]=d.locations[0].ox,p[3]=d.locations[0].oy;else if(d.isContinuous){var f=a.x<.5?a.x:1-a.x,v=a.y<.5?a.y:1-a.y;p[2]=f<v?a.x<.5?-1:1:0,p[3]=v<f?a.y<.5?-1:1:0}l.anchor=p,l.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(l);var y={};if(r.extract){for(var g in r.extract){var m=o.getAttribute(g);m&&(y[r.extract[g]]=m)}this.ep.mergeParameters(y)}if(l.uniqueEndpoint){var _=this.ep.elementId,x=this.instance.getManagedData(_,Rr,i.id);null==x?(this.instance.setManagedData(_,Rr,i.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=x}s._jsPlumbOrphanedEndpoints=s._jsPlumbOrphanedEndpoints||[],s._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,Wi,e,y)}}}}},{key:"_mouseupHandler",value:function(e){var t=e.currentTarget||e.srcElement;t._jsPlumbOrphanedEndpoints&&(!function(e,t){e=null==e.length||"string"==typeof e?[e]:e;for(var n=0;n<e.length;n++)t(e[n])}(t._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),t._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(e){var t=this.instance.getOffset(e),n=this.instance.getSize(e);return this._makeDraggablePlaceholder(t,n),this.placeholderInfo.element.jtk=e.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(e){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(e,t){this.placeholderInfo=this.placeholderInfo||{};var n=ki(Yi,{position:"absolute"});this.instance._appendElement(n,this.instance.getContainer());var i=this.instance.getId(n);return this.instance.setPosition(n,e),n.style.width=t.w+"px",n.style.height=t.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n,n}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var e=this.instance.getContainer();this.instance.off(e,$i,this.mouseupHandler),this.instance.off(e,Wi,this.mousedownHandler)}},{key:"init",value:function(e){}},{key:"startNewConnectionDrag",value:function(e,t){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:e,data:t}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(io,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var e=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(io,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[e].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,e),this.jpc.suspendedEndpoint=this.jpc.endpoints[e],this.jpc.suspendedElement=this.jpc.endpoints[e].element,this.jpc.suspendedElementId=this.jpc.endpoints[e].elementId,this.jpc.suspendedElementType=0===e?Re:He,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[e]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=e}},{key:"_shouldStartDrag",value:function(){var e=!0;this.ep.enabled||(e=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(e=!1),!this.ep.isSource||!this.ep.isFull()||null!=this.jpc&&this.ep.dragAllowedWhenFull||(e=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?e=!1:this.jpc=null);var n={},i=this.instance.checkCondition(null==this.jpc?"beforeDrag":"beforeStartDetach",{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===i?e=!1:"object"===Kn(i)?t(n=i,this.payload||{}):n=this.payload||{},[e,n]}},{key:"_createFloatingEndpoint",value:function(e){var t=this.ep.endpoint;null!=this.ep.edgeType&&(t=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]);this.floatingEndpoint=Lr(this.ep,t,0,this.placeholderInfo.element,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(e,t,n){var i,o,r,s=this,a=this.jpc&&this.jpc.endpoints[0]===this.ep;if(d(this.instance.getContainer().querySelectorAll([".",$e,"[",Je,this.ep.scope,"]"].join("")),(function(t){if((null!=s.jpc||t!==e)&&t!==s.floatingElement&&!t.jtk.endpoint.isFull()&&(a&&t.jtk.endpoint.isSource||!a&&t.jtk.endpoint.isTarget)){var n=s.instance.getOffset(t),o=s.instance.getSize(t);i={x:n.x,y:n.y,w:o.w,h:o.h},s.endpointDropTargets.push({el:t,targetEl:t,r:i,endpoint:t.jtk.endpoint,def:null}),s.instance.addClass(t,Tr)}})),a){var l=f(this.instance.sourceSelectors,(function(e){return e.isEnabled()&&(null==e.def.def.scope||e.def.def.scope===s.ep.scope)}));if(null!=l)d(this.instance.getContainer().querySelectorAll("any"===l.redrop?ht:l.selector),(function(e){if(e.getAttribute(Bi)!==ie){var t=e.getAttribute(Ri);if(null!=t&&t!==s.ep.scope)return;var n={r:null,el:e};n.targetEl=vi(e,ht,s.instance.getContainer(),!0);var i=s.instance.getOffset(n.el),o=s.instance.getSize(n.el);n.r={x:i.x,y:i.y,w:o.w,h:o.h},null!=l.def.def.rank&&(n.rank=l.def.def.rank),n.def=l,s.endpointDropTargets.push(n),s.instance.addClass(n.targetEl,Tr)}}))}else{var c=(o=this.instance.targetSelectors,r=function(e,t){var n=[];if(e)for(var i=0;i<e.length;i++)t(e[i])&&n.push(i);return n}(o,(function(e){return e.isEnabled()})),r.map((function(e){return o[e]})));c.forEach((function(e){d(s.instance.getContainer().querySelectorAll(e.selector),(function(t){if(t.getAttribute(Bi)!==ie){var i=t.getAttribute(Ri);if(null!=i&&i!==s.ep.scope)return;var o={r:null,el:t};if(null!=e.def.def.parentSelector&&(o.targetEl=vi(t,e.def.def.parentSelector,s.instance.getContainer(),!0)),null==o.targetEl&&(o.targetEl=vi(t,ht,s.instance.getContainer(),!0)),(!1===e.def.def.allowLoopback||s._activeDefinition&&!1===s._activeDefinition.def.def.allowLoopback)&&o.targetEl===s.ep.element)return;if(null!=e.def.def.canAcceptNewConnection&&!e.def.def.canAcceptNewConnection(o.targetEl,n))return;var r=e.def.def.maxConnections;if(null!=r&&-1!==r&&s.instance.select({target:o.targetEl}).length>=r)return;var a=s.instance.getOffset(t),l=s.instance.getSize(t);o.r={x:a.x,y:a.y,w:l.w,h:l.h},o.def=e.def,null!=e.def.def.rank&&(o.rank=e.def.def.rank),s.endpointDropTargets.push(o),s.instance.addClass(o.targetEl,Tr)}}))}))}this.endpointDropTargets.sort((function(e,t){if(e.targetEl._isJsPlumbGroup&&!t.targetEl._isJsPlumbGroup)return 1;if(!e.targetEl._isJsPlumbGroup&&t.targetEl._isJsPlumbGroup)return-1;if(e.targetEl._isJsPlumbGroup&&t.targetEl._isJsPlumbGroup){if(s.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup))return-1;if(s.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup))return 1}else{if(null==e.rank||null==t.rank)return 0;if(e.rank>t.rank)return-1;if(e.rank<t.rank)return 1}}))}},{key:"onStart",value:function(e){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var t=e.drag.getDragElement();this.ep=t.jtk.endpoint;var n=e.e.srcElement||e.e.target;if(!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var i=hi(this._shouldStartDrag(),2),o=i[0],r=i[1];if(!1===o)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,n,e.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,r):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc,this.floatingEndpoint),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(e){this.payload=e.e.payload||{}}},{key:"onDrag",value:function(e){if(this._stopped)return!0;if(this.placeholderInfo.element){var t=this.instance.getSize(this.floatingElement);this.instance.setElementPosition(this.placeholderInfo.element,e.pos.x,e.pos.y);for(var n,i,o={x:e.pos.x,y:e.pos.y,w:t.w,h:t.h},r=0;r<this.endpointDropTargets.length;r++)if(J(o,this.endpointDropTargets[r].r)){n=this.endpointDropTargets[r];break}if(n!==this.currentDropTarget&&null!=this.currentDropTarget&&(i=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,jr),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=n)if(this.instance.addClass(n.el,jr),i=this._getFloatingAnchorIndex(),null!=n.endpoint)if(n.endpoint.isSource&&0===i||n.endpoint.isTarget&&0!==i||this.jpc.suspendedEndpoint&&n.endpoint.referenceEndpoint&&n.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id)this.instance.checkCondition("checkDropAllowed",{sourceEndpoint:this.jpc.endpoints[i],targetEndpoint:n.endpoint.endpoint,connection:this.jpc})?(n.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(n.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(n.endpoint),this.instance._paintConnection(this.jpc);else n=null;this.currentDropTarget=n}}},{key:"_maybeCleanup",value:function(e){e._mtNew&&0===e.connections.length?this.instance.deleteEndpoint(e):delete e._mtNew}},{key:"_reattachOrDiscard",value:function(e){var t=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return t&&this._shouldReattach(e)?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,e),!1)}},{key:"onStop",value:function(e){var t=this,n=e.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join(" ")}(jr,Tr);if(d(this.instance.getContainer().querySelectorAll(Br),(function(e){t.instance.removeClass(e,i)})),this.jpc&&null!=this.jpc.endpoints){var o,r=null!=this.jpc.suspendedEndpoint,s=this._getFloatingAnchorIndex(),a=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget)if(null==(o=this._getDropEndpoint(e,this.jpc)))this._reattachOrDiscard(e.e);else if(a&&a.id===o.id)this._doForceReattach(s);else if(o.enabled)if(o.isFull())o.fire(at,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},n),this._reattachOrDiscard(e.e);else{0===s?(this.jpc.source=o.element,this.jpc.sourceId=o.elementId):(this.jpc.target=o.element,this.jpc.targetId=o.elementId);var l=!0;r&&this.jpc.suspendedEndpoint.id!==o.id&&(this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[s].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(l=!1)),(l=l&&o.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,o))?this._drop(o,s,n,l):this._reattachOrDiscard(e.e)}else this._reattachOrDiscard(e.e);else this._reattachOrDiscard(e.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=o&&this._maybeCleanup(o)}}},{key:"_getSourceDefinition",value:function(e){for(var t,n=0;n<this.instance.sourceSelectors.length;n++){if((t=this.instance.sourceSelectors[n]).isEnabled())if(!1!==Fr(e,this.instance.getContainer(),t.selector,this.instance,t.exclude))return t}}},{key:"_getDropEndpoint",value:function(e,n){var i;if(null==this.currentDropTarget.endpoint){var o=this.currentDropTarget.def,r=e.e.target||e.e.srcElement;if(null==o)return null;var s=this.currentDropTarget.targetEl,a=Jr(e.e,s,this.instance.currentZoom),l=this.instance._deriveEndpointAndAnchorSpec(n.getType().join(" "),!0),u=l.endpoints?t(e,{endpoint:o.def.endpoint||l.endpoints[1]}):e,h=this.instance.validAnchorsSpec(l.anchors)?l.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,d=o.def.anchor,p=o.def.anchorPositionFinder?o.def.anchorPositionFinder(s,a,o.def,e.e):null,f=null!=p?p:null!=d?d:null!=h&&null!=h[1]?h[1]:null;if(null!=f&&(u=t(u,{anchor:f})),null!=o.def.portId&&(u.portId=o.def.portId),(u=c(u,o.def.parameterExtractor?o.def.parameterExtractor(this.currentDropTarget.el,r,e.e):{})).element=s,(i=this.instance._internal_newEndpoint(u))._mtNew=!0,i.deleteOnEmpty=!0,o.def.parameters&&i.mergeParameters(o.def.parameters),o.def.extract){var v={};for(var y in o.def.extract){var g=this.currentDropTarget.el.getAttribute(y);g&&(v[o.def.extract[y]]=g)}i.mergeParameters(v)}}else i=this.currentDropTarget.endpoint;return i&&(i.removeClass(this.instance.endpointDropAllowedClass),i.removeClass(this.instance.endpointDropForbiddenClass)),i}},{key:"_doForceReattach",value:function(e){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[e]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,e),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(e){return this.jpc.isReattach()||this.jpc._forceReattach||!u(!0,!1,[[this.jpc.endpoints[0],ct,[this.jpc]],[this.jpc.endpoints[1],ct,[this.jpc]],[this.jpc,ct,[this.jpc]],[this.instance,Ze,[ut,this.jpc]]])}},{key:"_discard",value:function(e,t){this.jpc.pending?this.instance.fire("connection:abort",this.jpc,t):(0===e?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[e]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:t,force:!0})}},{key:"_drop",value:function(e,t,n,i){if(this.jpc.endpoints[t].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[t]=e,e.addConnection(this.jpc),this.jpc.suspendedEndpoint){var o=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:t,originalSourceId:0===t?o:this.jpc.sourceId,newSourceId:0===t?e.elementId:this.jpc.sourceId,originalTargetId:1===t?o:this.jpc.targetId,newTargetId:1===t?e.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:e},n)}(1===t?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint)&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc));s(i)&&this.jpc.mergeData(i),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(e,t,n){this.floatingConnections[e.id]=t,x(this.instance.endpointsByElement,e.id,n)}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),e}(),Nr=function(e){oi(n,e);var t=ci(n);function n(e,i){var o;return ei(this,n),(o=t.call(this,e,i)).instance=e,o.dragSelection=i,ii(ai(o),"selector",[">",Io,ht].join(" ")),ii(ai(o),"doRevalidate",void 0),o.doRevalidate=o._revalidate.bind(ai(o)),o}return ni(n,[{key:"reset",value:function(){this.drag.off(no,this.doRevalidate)}},{key:"_revalidate",value:function(e){this.instance.revalidate(e)}},{key:"init",value:function(e){this.drag=e,e.on(no,this.doRevalidate)}},{key:"useGhostProxy",value:function(e,t){var n=t._jsPlumbParentGroup;return null!=n&&!0===n.ghost}},{key:"makeGhostProxy",value:function(e){var t=e,n=t.cloneNode(!0);return n._jsPlumbParentGroup=t._jsPlumbParentGroup,n}}]),n}(Gr),Xr=function(){function e(t,n){ei(this,e),this.instance=t,this.overlay=n,ii(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=n}return ni(e,null,[{key:"getElement",value:function(e,t,n){if(null==e.canvas){if(n&&t){e.canvas=n(t);var i=e.instance.overlayClass+" "+(e.cssClass?e.cssClass:"");e.instance.addClass(e.canvas,i)}else e.canvas=ki(Yi,{},e.instance.overlayClass+" "+(e.cssClass?e.cssClass:""));for(var o in e.instance.setAttribute(e.canvas,"jtk-overlay-id",e.id),e.attributes)e.instance.setAttribute(e.canvas,o,e.attributes[o]);e.canvas.style.position=Ye,e.instance._appendElement(e.canvas,e.instance.getContainer()),e.instance.getId(e.canvas);var r="translate(-50%, -50%)";e.canvas.style.webkitTransform=r,e.canvas.style.mozTransform=r,e.canvas.style.msTransform=r,e.canvas.style.oTransform=r,e.canvas.style.transform=r,e.isVisible()||(e.canvas.style.display=Xe),e.canvas.jtk={overlay:e}}return e.canvas}},{key:"destroy",value:function(e){e.canvas&&e.canvas.parentNode&&e.canvas.parentNode.removeChild(e.canvas),delete e.canvas,delete e.cachedDimensions}},{key:"_getDimensions",value:function(e,t){return(null==e.cachedDimensions||t)&&(e.cachedDimensions={w:1,h:1}),e.cachedDimensions}}]),e}(),Yr=function(e){oi(i,e);var n=ci(i);function i(){var e;ei(this,i);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return ii(ai(e=n.call.apply(n,[this].concat(o))),"path",void 0),e}return ni(i,null,[{key:"ensurePath",value:function(e){if(null==e.path){var n=t({"jtk-overlay-id":e.id},e.attributes);e.path=Ti(Ai,n);var i=null;if(e.component instanceof hn){var o=e.component.connector;i=null!=o?o.canvas:null}else if(e.component instanceof pn){var r=e.component.endpoint;i=null!=r?r.svg:r}null!=i&&Oi(i,e.path,1);var s=e.instance.overlayClass+" "+(e.cssClass?e.cssClass:"");e.instance.addClass(e.path,s),e.path.jtk={overlay:e}}return e.path}},{key:"paint",value:function(e,t,n,i){this.ensurePath(e);var o=[0,0];i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin);var r={d:t,stroke:n.stroke?n.stroke:null,fill:n.fill?n.fill:null,transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"};Mi(e.path,r)}},{key:"destroy",value:function(e,t){var n=e;null!=n.path&&null!=n.path.parentNode&&n.path.parentNode.removeChild(n.path),null!=n.bgPath&&null!=n.bgPath.parentNode&&n.bgPath.parentNode.removeChild(n.bgPath),delete n.path,delete n.bgPath}}]),i}(pt),Vr=function(){function e(){ei(this,e)}return ni(e,null,[{key:"paint",value:function(e,t,n,i){if(null!=n){var o,r=[e.x,e.y],s=[e.w,e.h];null!=i&&(i.xmin<0&&(r[0]+=i.xmin),i.ymin<0&&(r[1]+=i.ymin),s[0]=i.xmax+(i.xmin<0?-i.xmin:0),s[1]=i.ymax+(i.ymin<0?-i.ymin:0)),isFinite(s[0])&&isFinite(s[1])&&(t?(Gi(e.canvas,r[0],r[1],s[0],s[1]),r[0]=0,r[1]=0,o=ji([0,0]),Mi(e.svg,{style:o,width:""+(s[0]||0),height:""+(s[1]||0)})):(o=ji([r[0],r[1]]),Mi(e.canvas,{style:o,width:""+(s[0]||0),height:""+(s[1]||0)})))}}}]),e}();function zr(e,n,i,o){!function(e,t){if(null!=t.canvas)return t.canvas;var n=Ti(wi,{style:"",width:"0",height:"0","pointer-events":Xe,position:Ye});t.canvas=n,e._appendElement(t.canvas,e.getContainer()),null!=t.cssClass&&e.addClass(n,t.cssClass),e.addClass(n,e.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=t}(e,n),Vr.paint(n,!1,i,o);var r=[0,0];if(o.xmin<0&&(r[0]=-o.xmin),o.ymin<0&&(r[1]=-o.ymin),n.segments.length>0){var s={d:e.getPathData(n),transform:"translate("+r[0]+","+r[1]+")","pointer-events":"visibleStroke"},a=null;if(i.outlineStroke){var l=i.outlineWidth||1,c=i.strokeWidth+2*l;(a=t({},i)).stroke=i.outlineStroke,a.strokeWidth=c,null==n.bgPath?(n.bgPath=Ti(Ai,s),e.addClass(n.bgPath,e.connectorOutlineClass),Oi(n.canvas,n.bgPath,0)):Mi(n.bgPath,s),Ii(n.canvas,n.bgPath,a)}var u=n;null==u.path?(u.path=Ti(Ai,s),Oi(u.canvas,u.path,i.outlineStroke?1:0)):(u.path.parentNode!==u.canvas&&Oi(u.canvas,u.path,i.outlineStroke?1:0),Mi(n.path,s)),Ii(n.canvas,n.path,i)}}var Ur=function(){function e(){ei(this,e)}return ni(e,null,[{key:"getEndpointElement",value:function(e){if(null!=e.canvas)return e.canvas;var t=Ti(wi,{style:"",width:"0",height:"0","pointer-events":Xe,position:Ye});e.svg=t;var n=ki(Yi,{position:Ye});e.canvas=n;var i=e.classes.join(" ");e.instance.addClass(n,i);for(var o=e.endpoint.scope.split(/\s/),r=0;r<o.length;r++)e.instance.setAttribute(n,Je+o[r],ne);return e.instance._suspendDrawing||Gi(n,0,0,1,1),e.instance._appendElement(n,e.instance.getContainer()),n.appendChild(t),null!=e.cssClass&&e.instance.addClass(n,e.cssClass),e.instance.addClass(n,e.instance.endpointClass),n.jtk=n.jtk||{},n.jtk.endpoint=e.endpoint,n.style.display=!1!==e.endpoint.visible?Ne:Xe,n}},{key:"paint",value:function(e,n,i){if(!0!==e.endpoint.deleted){this.getEndpointElement(e),Vr.paint(e,!0,i);var o=t({},i);o.outlineStroke&&(o.stroke=o.outlineStroke),null==e.node?(e.node=n.makeNode(e,o),e.svg.appendChild(e.node)):null!=n.updateNode&&n.updateNode(e,e.node),Ii(e.canvas,e.node,o)}}}]),e}(),qr={};function Wr(e,t){qr[e]=t}function Jr(e,t,n){var i=t,o=Kn(t.getBoundingClientRect)!==ee?t.getBoundingClientRect():{left:0,top:0,width:0,height:0},r=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||r.scrollTop,l=window.pageXOffset||s.scrollLeft||r.scrollLeft,c=s.clientTop||r.clientTop||0,u=s.clientLeft||r.clientLeft||0,h=o.top+a-c+0*n,d=o.left+l-u+0*n,p=zo(e),f=o.width||i.offsetWidth*n,v=o.height||i.offsetHeight*n;return{x:(p.x-d)/f,y:(p.y-h)/v}}function Zr(e){return Un(e)||Zn(e)||Wn(e)}function Qr(e,t){e.canvas&&(e.canvas.style.display=t?"block":"none")}function $r(e){e.canvas&&e.canvas.parentNode.removeChild(e.canvas),delete e.canvas,delete e.svg}function Kr(e){return e.canvas}function es(e){return Xr.getElement(e)}function ts(e){return Xr.getElement(e,e.component,(function(t){var n=e.create(t);return e.instance.addClass(n,e.instance.overlayClass),n}))}function ns(e,t,n,i){var o=e.x,r=e.y;return t._jsPlumbParentGroup&&t._jsPlumbParentGroup.constrain&&(o=Math.max(e.x,0),r=Math.max(e.y,0),o=Math.min(o,n.w-i.w),r=Math.min(r,n.h-i.h)),{x:o,y:r}}var is=function(e){oi(n,e);var t=ci(n);function n(e,i){var o;ei(this,n),(o=t.call(this,e,i))._instanceIndex=e,ii(ai(o),"dragSelection",void 0),ii(ai(o),"dragManager",void 0),ii(ai(o),"_connectorClick",void 0),ii(ai(o),"_connectorDblClick",void 0),ii(ai(o),"_connectorTap",void 0),ii(ai(o),"_connectorDblTap",void 0),ii(ai(o),"_endpointClick",void 0),ii(ai(o),"_endpointDblClick",void 0),ii(ai(o),"_overlayClick",void 0),ii(ai(o),"_overlayDblClick",void 0),ii(ai(o),"_overlayTap",void 0),ii(ai(o),"_overlayDblTap",void 0),ii(ai(o),"_connectorMouseover",void 0),ii(ai(o),"_connectorMouseout",void 0),ii(ai(o),"_endpointMouseover",void 0),ii(ai(o),"_endpointMouseout",void 0),ii(ai(o),"_connectorContextmenu",void 0),ii(ai(o),"_connectorMousedown",void 0),ii(ai(o),"_connectorMouseup",void 0),ii(ai(o),"_endpointMousedown",void 0),ii(ai(o),"_endpointMouseup",void 0),ii(ai(o),"_overlayMouseover",void 0),ii(ai(o),"_overlayMouseout",void 0),ii(ai(o),"_elementClick",void 0),ii(ai(o),"_elementTap",void 0),ii(ai(o),"_elementDblTap",void 0),ii(ai(o),"_elementMouseenter",void 0),ii(ai(o),"_elementMouseexit",void 0),ii(ai(o),"_elementMousemove",void 0),ii(ai(o),"_elementMouseup",void 0),ii(ai(o),"_elementMousedown",void 0),ii(ai(o),"_elementContextmenu",void 0),ii(ai(o),"eventManager",void 0),ii(ai(o),"draggingClass","jtk-dragging"),ii(ai(o),"elementDraggingClass","jtk-element-dragging"),ii(ai(o),"hoverClass","jtk-hover"),ii(ai(o),"sourceElementDraggingClass","jtk-source-element-dragging"),ii(ai(o),"targetElementDraggingClass","jtk-target-element-dragging"),ii(ai(o),"hoverSourceClass","jtk-source-hover"),ii(ai(o),"hoverTargetClass","jtk-target-hover"),ii(ai(o),"dragSelectClass","jtk-drag-select"),ii(ai(o),"managedElementsSelector",void 0),ii(ai(o),"elementsDraggable",void 0),ii(ai(o),"elementDragHandler",void 0),ii(ai(o),"groupDragOptions",void 0),ii(ai(o),"elementDragOptions",void 0),ii(ai(o),"svg",{node:function(e,t){return Ti(e,t)},attr:function(e,t){return Mi(e,t)},pos:function(e){return ji(e)}}),o.elementsDraggable=i&&!1!==i.elementsDraggable,o.managedElementsSelector=i&&i.managedElementsSelector||ht,o.eventManager=new or,o.dragSelection=new Mr(ai(o)),o.dragManager=new Ir(ai(o),o.dragSelection),o.dragManager.addHandler(new Hr(ai(o))),o.groupDragOptions={constrainFunction:ns},o.dragManager.addHandler(new Nr(ai(o),o.dragSelection),o.groupDragOptions),o.elementDragHandler=new Gr(ai(o),o.dragSelection),o.elementDragOptions=i&&i.dragOptions||{},o.dragManager.addHandler(o.elementDragHandler,o.elementDragOptions),i&&i.dragOptions&&i.dragOptions.filter&&o.dragManager.addFilter(i.dragOptions.filter);var r=function(e,t){if(!t.defaultPrevented&&null==t._jsPlumbOverlay){var n=vi(yi(t),To,this.getContainer(),!0);this.fire(e,n.jtk.connector.connection,t)}};o._connectorClick=r.bind(ai(o),bo),o._connectorDblClick=r.bind(ai(o),ko),o._connectorTap=r.bind(ai(o),Do),o._connectorDblTap=r.bind(ai(o),Eo);var s=function(e,t){var n=yi(t).parentNode;if(n.jtk&&n.jtk.connector){var i=n.jtk.connector,o=i.connection;this.setConnectorHover(i,e),e?(this.addClass(o.source,this.hoverSourceClass),this.addClass(o.target,this.hoverTargetClass)):(this.removeClass(o.source,this.hoverSourceClass),this.removeClass(o.target,this.hoverTargetClass)),this.fire(e?So:Co,n.jtk.connector.connection,t)}};o._connectorMouseover=s.bind(ai(o),!0),o._connectorMouseout=s.bind(ai(o),!1);var a=function(e,t){var n=yi(t).parentNode;n.jtk&&n.jtk.connector&&this.fire(e?Po:wo,n.jtk.connector.connection,t)};o._connectorMouseup=a.bind(ai(o),!0),o._connectorMousedown=a.bind(ai(o),!1),o._connectorContextmenu=function(e){var t=yi(e).parentNode;t.jtk&&t.jtk.connector&&this.fire(Ao,t.jtk.connector.connection,e)}.bind(ai(o));var l=function(e,t,n){t.defaultPrevented||null!=t._jsPlumbOverlay||this.fire(e,n.jtk.endpoint,t)};o._endpointClick=l.bind(ai(o),vo),o._endpointDblClick=l.bind(ai(o),yo);var c=function(e,t){var n=yi(t);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,e),this.fire(e?mo:go,n.jtk.endpoint,t))};o._endpointMouseover=c.bind(ai(o),!0),o._endpointMouseout=c.bind(ai(o),!1);var u=function(e,t){var n=yi(t);n.jtk&&n.jtk.endpoint&&this.fire(e?_o:xo,n.jtk.endpoint,t)};o._endpointMouseup=u.bind(ai(o),!0),o._endpointMousedown=u.bind(ai(o),!1);var h=function(e,t){var n=vi(yi(t),Go,this.getContainer(),!0).jtk.overlay;n&&this.fireOverlayMethod(n,e,t)}.bind(ai(o));o._overlayClick=h.bind(ai(o),Vi),o._overlayDblClick=h.bind(ai(o),Ui),o._overlayTap=h.bind(ai(o),to),o._overlayDblTap=h.bind(ai(o),qi);var d=function(e,t){var n=vi(yi(t),Go,this.getContainer(),!0).jtk.overlay;n&&this.setOverlayHover(n,e)};o._overlayMouseover=d.bind(ai(o),!0),o._overlayMouseout=d.bind(ai(o),!1);o._elementClick=function(e,t,n){t.defaultPrevented||this.fire(1===t.detail?oo:ro,n,t)}.bind(ai(o),oo);o._elementTap=function(e,t,n){t.defaultPrevented||this.fire(fo,n,t)}.bind(ai(o),fo);o._elementDblTap=function(e,t,n){t.defaultPrevented||this.fire(so,n,t)}.bind(ai(o),so);var p=function(e,t){this.fire(e?lo:ao,yi(t),t)};return o._elementMouseenter=p.bind(ai(o),!0),o._elementMouseexit=p.bind(ai(o),!1),o._elementMousemove=function(e){this.fire(co,yi(e),e)}.bind(ai(o)),o._elementMouseup=function(e){this.fire(uo,yi(e),e)}.bind(ai(o)),o._elementMousedown=function(e){this.fire(ho,yi(e),e)}.bind(ai(o)),o._elementContextmenu=function(e){this.fire(po,yi(e),e)}.bind(ai(o)),o._attachEventDelegates(),o}return ni(n,[{key:"fireOverlayMethod",value:function(e,t,n){var i=Li(e.component instanceof hn?Xi:Hi,t);n._jsPlumbOverlay=e,e.fire(t,{e:n,overlay:e}),this.fire(i,e.component,n)}},{key:"addDragFilter",value:function(e,t){this.dragManager.addFilter(e,t)}},{key:"removeDragFilter",value:function(e){this.dragManager.removeFilter(e)}},{key:"setDragGrid",value:function(e){this.dragManager.setOption(this.elementDragHandler,{grid:e})}},{key:"_removeElement",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"_appendElement",value:function(e,t){t&&t.appendChild(e)}},{key:"_getAssociatedElements",value:function(e){var t=[];if(3!==e.nodeType&&8!==e.nodeType){var n=e.querySelectorAll(ht);Array.prototype.push.apply(t,n)}return t.filter((function(e){return 3!==e.nodeType&&8!==e.nodeType}))}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getClass",value:function(e){return function(e){return gi(e)}(e)}},{key:"addClass",value:function(e,t){xi(e,t)}},{key:"hasClass",value:function(e,t){return function(e,t){return e.classList?e.classList.contains(t):-1!==gi(e).indexOf(t)}(e,t)}},{key:"removeClass",value:function(e,t){bi(e,t)}},{key:"toggleClass",value:function(e,t){!function(e,t){var n=this,i=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?e.classList.toggle(t):n.hasClass(e,t)?n.removeClass(e,t):n.addClass(e,t))};_i(e)?d(e,(function(e){return i(e,t)})):i(e,t)}(e,t)}},{key:"setAttribute",value:function(e,t,n){e.setAttribute(t,n)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}},{key:"removeAttribute",value:function(e,t){e.removeAttribute&&e.removeAttribute(t)}},{key:"on",value:function(e,t,n,i){var o=this,r=function(e){null==i?o.eventManager.on(e,t,n):o.eventManager.on(e,t,n,i)};return _i(e)?d(e,(function(e){return r(e)})):r(e),this}},{key:"off",value:function(e,t,n){var i=this;return _i(e)?d(e,(function(e){return i.eventManager.off(e,t,n)})):this.eventManager.off(e,t,n),this}},{key:"trigger",value:function(e,t,n,i,o){this.eventManager.trigger(e,t,n,i,o)}},{key:"getOffsetRelativeToRoot",value:function(e){return Ci(e)}},{key:"getOffset",value:function(e){for(var t,n=e,i=this.getContainer(),o={x:n.offsetLeft,y:n.offsetTop},r=e!==i&&n.offsetParent!==i?n.offsetParent:null;null!=r;)o.x+=r.offsetLeft,o.y+=r.offsetTop,null!=(t=r)&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(o.x-=t.scrollLeft,o.y-=t.scrollTop),r=r.offsetParent===i?null:r.offsetParent;if(null!=i&&(i.scrollTop>0||i.scrollLeft>0)){var s=null!=n.offsetParent?this.getStyle(n.offsetParent,Mo):"static",a=this.getStyle(n,Mo);a!==Ye&&a!==Ve&&s!==Ye&&s!==Ve&&(o.x-=i.scrollLeft,o.y-=i.scrollTop)}return o}},{key:"getSize",value:function(e){return function(e){return{w:e.offsetWidth,h:e.offsetHeight}}(e)}},{key:"getStyle",value:function(e,t){return Kn(window.getComputedStyle)!==ee?getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]}},{key:"getGroupContentArea",value:function(e){var t=this.getSelector(e.el,Oo);return t&&t.length>0?t[0]:e.el}},{key:"getSelector",value:function(e,t){var n=null;if(1===arguments.length){if(!o(e)){var i=document.createDocumentFragment();return i.appendChild(e),m(i.childNodes)}n=m(document.querySelectorAll(e))}else n=m(e.querySelectorAll(t));return n}},{key:"setPosition",value:function(e,t){var n=e;n.style.left=t.x+"px",n.style.top=t.y+"px"}},{key:"setDraggable",value:function(e,t){t?this.removeAttribute(e,qe):this.setAttribute(e,qe,ne)}},{key:"isDraggable",value:function(e){var t=this.getAttribute(e,qe);return null==t||t===ie}},{key:"toggleDraggable",value:function(e){var t=this.isDraggable(e);return this.setDraggable(e,!t),!t}},{key:"_attachEventDelegates",value:function(){var e=this.getContainer();this.eventManager.on(e,Vi,Go,this._overlayClick),this.eventManager.on(e,Ui,Go,this._overlayDblClick),this.eventManager.on(e,to,Go,this._overlayTap),this.eventManager.on(e,qi,Go,this._overlayDblTap),this.eventManager.on(e,Vi,To,this._connectorClick),this.eventManager.on(e,Ui,To,this._connectorDblClick),this.eventManager.on(e,to,To,this._connectorTap),this.eventManager.on(e,qi,To,this._connectorDblTap),this.eventManager.on(e,Vi,jo,this._endpointClick),this.eventManager.on(e,Ui,jo,this._endpointDblClick),this.eventManager.on(e,Vi,this.managedElementsSelector,this._elementClick),this.eventManager.on(e,to,this.managedElementsSelector,this._elementTap),this.eventManager.on(e,qi,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(e,eo,To,this._connectorMouseover),this.eventManager.on(e,Ki,To,this._connectorMouseout),this.eventManager.on(e,zi,To,this._connectorContextmenu),this.eventManager.on(e,$i,To,this._connectorMouseup),this.eventManager.on(e,Wi,To,this._connectorMousedown),this.eventManager.on(e,eo,jo,this._endpointMouseover),this.eventManager.on(e,Ki,jo,this._endpointMouseout),this.eventManager.on(e,$i,jo,this._endpointMouseup),this.eventManager.on(e,Wi,jo,this._endpointMousedown),this.eventManager.on(e,eo,Go,this._overlayMouseover),this.eventManager.on(e,Ki,Go,this._overlayMouseout),this.eventManager.on(e,eo,ht,this._elementMouseenter),this.eventManager.on(e,Ki,ht,this._elementMouseexit),this.eventManager.on(e,Qi,ht,this._elementMousemove),this.eventManager.on(e,$i,ht,this._elementMouseup),this.eventManager.on(e,Wi,ht,this._elementMousedown),this.eventManager.on(e,zi,ht,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var e=this.getContainer();e&&(this.eventManager.off(e,Vi,this._connectorClick),this.eventManager.off(e,Ui,this._connectorDblClick),this.eventManager.off(e,to,this._connectorTap),this.eventManager.off(e,qi,this._connectorDblTap),this.eventManager.off(e,Vi,this._endpointClick),this.eventManager.off(e,Ui,this._endpointDblClick),this.eventManager.off(e,Vi,this._overlayClick),this.eventManager.off(e,Ui,this._overlayDblClick),this.eventManager.off(e,to,this._overlayTap),this.eventManager.off(e,qi,this._overlayDblTap),this.eventManager.off(e,Vi,this._elementClick),this.eventManager.off(e,to,this._elementTap),this.eventManager.off(e,qi,this._elementDblTap),this.eventManager.off(e,eo,this._connectorMouseover),this.eventManager.off(e,Ki,this._connectorMouseout),this.eventManager.off(e,zi,this._connectorContextmenu),this.eventManager.off(e,$i,this._connectorMouseup),this.eventManager.off(e,Wi,this._connectorMousedown),this.eventManager.off(e,eo,this._endpointMouseover),this.eventManager.off(e,Ki,this._endpointMouseout),this.eventManager.off(e,$i,this._endpointMouseup),this.eventManager.off(e,Wi,this._endpointMousedown),this.eventManager.off(e,eo,this._overlayMouseover),this.eventManager.off(e,Ki,this._overlayMouseout),this.eventManager.off(e,Ji,this._elementMouseenter),this.eventManager.off(e,Zi,this._elementMouseexit),this.eventManager.off(e,Qi,this._elementMousemove),this.eventManager.off(e,$i,this._elementMouseup),this.eventManager.off(e,Wi,this._elementMousedown),this.eventManager.off(e,zi,this._elementContextmenu))}},{key:"setContainer",value:function(e){var t,i=this;if(e===document||e===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(t=this.dragManager.reset()),this.setAttribute(e,Fi,C().replace("-",""));var o=this.getContainer();null!=o&&(o.removeAttribute(Fi),d(m(o.childNodes).filter((function(e){return null!=e&&(i.hasClass(e,Qe)||i.hasClass(e,$e)||i.hasClass(e,tt)||e.getAttribute&&null!=e.getAttribute(Ue))})),(function(t){e.appendChild(t)})));ui(ri(n.prototype),"setContainer",this).call(this,e),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new Hr(this)),this.dragManager.addHandler(new Nr(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new Gr(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=t&&this.dragManager.setFilters(t))}},{key:"reset",value:function(){ui(ri(n.prototype),"reset",this).call(this),d(this.getContainer().querySelectorAll([ht,jo,To,Go].join(",")),(function(e){return e.parentNode&&e.parentNode.removeChild(e)}))}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),ui(ri(n.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(e,t){this.removeFromDragSelection(e),ui(ri(n.prototype),"unmanage",this).call(this,e,t)}},{key:"addToDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];d(n,(function(t){return e.dragSelection.add(t)}))}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];d(n,(function(t){return e.dragSelection.remove(t)}))}},{key:"toggleDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];d(n,(function(t){return e.dragSelection.toggle(t)}))}},{key:"addToDragGroup",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this.elementDragHandler).addToDragGroup.apply(t,[e].concat(i))}},{key:"removeFromDragGroup",value:function(){var e;(e=this.elementDragHandler).removeFromDragGroup.apply(e,arguments)}},{key:"setDragGroupState",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this.elementDragHandler).setDragGroupState.apply(t,[e].concat(i))}},{key:"consume",value:function(e,t){fi(e,t)}},{key:"rotate",value:function(e,t,i){var o=this.getId(e);return this._managedElements[o]?(this._managedElements[o].el.style.transform="rotate("+t+"deg)",this._managedElements[o].el.style.transformOrigin="center center",ui(ri(n.prototype),"rotate",this).call(this,e,t,i)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(e,t){if(mt(e))e.instance.addClass(es(e),t);else if(Zr(e))e.instance.addClass(Yr.ensurePath(e),t);else{if(!$n(e))throw"Could not add class to overlay of type ["+e.type+"]";e.instance.addClass(ts(e),t)}}},{key:"removeOverlayClass",value:function(e,t){if(mt(e))e.instance.removeClass(es(e),t);else if(Zr(e))e.instance.removeClass(Yr.ensurePath(e),t);else{if(!$n(e))throw"Could not remove class from overlay of type ["+e.type+"]";e.instance.removeClass(ts(e),t)}}},{key:"_paintOverlay",value:function(e,t,n){if(mt(e)){es(e);var i=e.component.getXY();e.canvas.style.left=i.x+t.d.minx+"px",e.canvas.style.top=i.y+t.d.miny+"px"}else if(Zr(e)){var o=isNaN(t.d.cxy.x)||isNaN(t.d.cxy.y)?"M 0 0":"M"+t.d.hxy.x+","+t.d.hxy.y+" L"+t.d.tail[0].x+","+t.d.tail[0].y+" L"+t.d.cxy.x+","+t.d.cxy.y+" L"+t.d.tail[1].x+","+t.d.tail[1].y+" L"+t.d.hxy.x+","+t.d.hxy.y;Yr.paint(e,o,t,n)}else{if(!$n(e))throw"Could not paint overlay of type ["+e.type+"]";ts(e);var r=e.component.getXY();e.canvas.style.left=r.x+t.d.minx+"px",e.canvas.style.top=r.y+t.d.miny+"px"}}},{key:"setOverlayVisible",value:function(e,t){var n=t?"block":"none";function i(e){null!=e&&(e.style.display=n)}mt(e)?i(es(e)):$n(e)?i(ts(e)):Zr(e)&&i(e.path)}},{key:"reattachOverlay",value:function(e,t){mt(e)?e.instance._appendElement(es(e),this.getContainer()):$n(e)?e.instance._appendElement(ts(e),this.getContainer()):Zr(e)&&this._appendElement(Yr.ensurePath(e),t.connector.canvas)}},{key:"setOverlayHover",value:function(e,t){var n;mt(e)?n=es(e):$n(e)?n=ts(e):Zr(e)&&(n=Yr.ensurePath(e)),null!=n&&(null!=this.hoverClass&&(t?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(e.component,t))}},{key:"destroyOverlay",value:function(e){if(mt(e)){var t=es(e);t.parentNode.removeChild(t),delete e.canvas,delete e.cachedDimensions}else if(Un(e)||Zn(e)||Wn(e))Yr.destroy(e);else if($n(e)){var n=ts(e);n.parentNode.removeChild(n),delete e.canvas,delete e.cachedDimensions}}},{key:"drawOverlay",value:function(e,t,n,i){if(mt(e)||$n(e)){var r=Xr._getDimensions(e);if(null!=r&&null!=r.w&&null!=r.h){var s={x:0,y:0};if(i)s={x:i.x,y:i.y};else if(t instanceof Ce){var a=Array.isArray(e.location)?e.location:[e.location,e.location];s={x:a[0]*t.w,y:a[1]*t.h}}else{var l=e.location,c=!1;(o(e.location)||e.location<0||e.location>1)&&(l=parseInt(""+e.location,10),c=!0),s=t.pointOnPath(l,c)}var u=s.x-r.w/2,h=s.y-r.h/2;return{component:e,d:{minx:u,miny:h,td:r,cxy:s},xmin:u,xmax:u+r.w,ymin:h,ymax:h+r.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(Un(e)||Zn(e)||Wn(e))return e.draw(t,n,i);throw"Could not draw overlay of type ["+e.type+"]"}},{key:"updateLabel",value:function(e){if(a(e.label)){var t=e.label(this);es(e).innerText=null!=t?t:""}else null==e.labelText&&(e.labelText=e.label,null!=e.labelText?es(e).innerText=e.labelText:es(e).innerText="")}},{key:"setHover",value:function(e,t){e._hover=t,e instanceof pn&&null!=e.endpoint?this.setEndpointHover(e,t,-1):e instanceof hn&&null!=e.connector&&this.setConnectorHover(e.connector,t)}},{key:"paintConnector",value:function(e,t,n){zr(this,e,t,n)}},{key:"setConnectorHover",value:function(e,t,n){if(!1===t||!this.currentlyDragging&&!this.isHoverSuspended()){var i=e.canvas;null!=i&&(null!=e.hoverClass&&(t?this.addClass(i,e.hoverClass):this.removeClass(i,e.hoverClass)),t?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null!=e.connection.hoverPaintStyle&&(e.connection.paintStyleInUse=t?e.connection.hoverPaintStyle:e.connection.paintStyle,this._suspendDrawing||this._paintConnection(e.connection)),e.connection.endpoints[0]!==n&&this.setEndpointHover(e.connection.endpoints[0],t,0,!0),e.connection.endpoints[1]!==n&&this.setEndpointHover(e.connection.endpoints[1],t,1,!0)}}},{key:"destroyConnector",value:function(e){null!=e.connector&&$r(e.connector)}},{key:"addConnectorClass",value:function(e,t){e.canvas&&this.addClass(e.canvas,t)}},{key:"removeConnectorClass",value:function(e,t){e.canvas&&this.removeClass(e.canvas,t)}},{key:"getConnectorClass",value:function(e){return e.canvas?e.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(e,t){Qr(e,t)}},{key:"applyConnectorType",value:function(e,t){if(e.canvas&&t.cssClass){var n=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(e.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(e,t){var n=Kr(e.endpoint);null!=n&&this.addClass(n,t)}},{key:"applyEndpointType",value:function(e,t){if(t.cssClass){var n=Kr(e.endpoint);if(n){var i=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(n,i.join(" "))}}}},{key:"destroyEndpoint",value:function(e){var t=this.endpointAnchorClassPrefix+(e.currentAnchorClass?"-"+e.currentAnchorClass:"");this.removeClass(e.element,t),$r(e.endpoint)}},{key:"renderEndpoint",value:function(e,t){var n=qr[e.endpoint.type];null!=n?Ur.paint(e.endpoint,n,t):A("jsPlumb: no endpoint renderer found for type ["+e.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(e,t){var n=Kr(e.endpoint);null!=n&&this.removeClass(n,t)}},{key:"getEndpointClass",value:function(e){var t=Kr(e.endpoint);return null!=t?t.className:""}},{key:"setEndpointHover",value:function(e,t,n,i){if(null!=e&&(!1===t||!this.currentlyDragging&&!this.isHoverSuspended())){var o=Kr(e.endpoint);if(null!=o&&(null!=e.hoverClass&&(t?this.addClass(o,e.hoverClass):this.removeClass(o,e.hoverClass)),0===n||1===n)){var r=0===n?this.hoverSourceClass:this.hoverTargetClass;t?this.addClass(o,r):this.removeClass(o,r)}if(null!=e.hoverPaintStyle&&(e.paintStyleInUse=t?e.hoverPaintStyle:e.paintStyle,this._suspendDrawing||this.renderEndpoint(e,e.paintStyleInUse)),!i)for(var s=0;s<e.connections.length;s++)this.setConnectorHover(e.connections[s].connector,t,e)}}},{key:"setEndpointVisible",value:function(e,t){Qr(e.endpoint,t)}},{key:"setGroupVisible",value:function(e,t){for(var n=e.el.querySelectorAll(ht),i=0;i<n.length;i++)t?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function(e,t){return null!=e&&!0!==e.deleted&&(!0!==e.endpoints[0].deleted&&this.setEndpointHover(e.endpoints[0],!1,0,!0),!0!==e.endpoints[1].deleted&&this.setEndpointHover(e.endpoints[1],!1,1,!0),ui(ri(n.prototype),"deleteConnection",this).call(this,e,t))}},{key:"addSourceSelector",value:function(e,t,i){return this.addDragFilter(e),ui(ri(n.prototype),"addSourceSelector",this).call(this,e,t,i)}},{key:"removeSourceSelector",value:function(e){this.removeDragFilter(e.selector),ui(ri(n.prototype),"removeSourceSelector",this).call(this,e)}}]),n}(Xn),os={width:10,height:0,fill:"transparent",stroke:"transparent"};Wr(Se.type,{makeNode:function(e,t){return Ti("circle",{cx:e.w/2,cy:e.h/2,r:e.radius})},updateNode:function(e,t){Mi(t,{cx:""+e.w/2,cy:""+e.h/2,r:""+e.radius})}}),Wr(we.type,{makeNode:function(e,t){return Ti("rect",os)},updateNode:function(e,t){Mi(t,os)}}),Wr(De.type,{makeNode:function(e,t){return Ti("rect",{width:e.w,height:e.h})},updateNode:function(e,t){Mi(t,{width:e.w,height:e.h})}});var rs=0;function ss(e){return new is(function(){var e=rs+1;return rs++,e}(),e)}function as(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ls(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cs(e){return cs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},cs(e)}function us(e,t){return us=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},us(e,t)}function hs(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ds(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?hs(e):t}function ps(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=cs(e);if(t){var o=cs(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return ds(this,n)}}function fs(e){return e<0?-1:0===e?0:1}function vs(e){return[fs(e[2]-e[0]),fs(e[3]-e[1])]}function ys(e){return Math.sqrt(Math.pow(e[0]-e[2],2)+Math.pow(e[1]-e[3],2))}function gs(e){var t=[];return t.push.apply(t,e),t}var ms=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&us(e,t)}(r,e);var t,n,i,o=ps(r);function r(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(n=o.call(this,e,t)).connection=e,ls(hs(n),"type",r.type),ls(hs(n),"internalSegments",[]),ls(hs(n),"midpoint",void 0),ls(hs(n),"alwaysRespectStubs",void 0),ls(hs(n),"cornerRadius",void 0),ls(hs(n),"lastx",void 0),ls(hs(n),"lasty",void 0),ls(hs(n),"lastOrientation",void 0),ls(hs(n),"loopbackRadius",void 0),ls(hs(n),"isLoopbackCurrently",void 0),n.midpoint=null==t.midpoint||isNaN(t.midpoint)?.5:t.midpoint,n.cornerRadius=null!=t.cornerRadius?t.cornerRadius:0,n.alwaysRespectStubs=!0===t.alwaysRespectStubs,n.lastx=null,n.lasty=null,n.lastOrientation=null,n.loopbackRadius=t.loopbackRadius||25,n.isLoopbackCurrently=!1,n}return t=r,n=[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(e,t,n){if(this.lastx!==e||this.lasty!==t){var i=null==this.lastx?n.sx:this.lastx,o=null==this.lasty?n.sy:this.lasty,r=i===e?"v":"h";this.lastx=e,this.lasty=t,this.internalSegments.push([i,o,e,t,r])}}},{key:"writeSegments",value:function(e){for(var t,n,i,o=null,r=0;r<this.internalSegments.length-1;r++){if(o=o||gs(this.internalSegments[r]),t=gs(this.internalSegments[r+1]),n=vs(o),i=vs(t),this.cornerRadius>0&&o[4]!==t[4]){var s=Math.min(ys(o),ys(t)),a=Math.min(this.cornerRadius,s/2);o[2]-=n[0]*a,o[3]-=n[1]*a,t[0]+=i[0]*a,t[1]+=i[1]*a;var l=n[1]===i[0]&&1===i[0]||n[1]===i[0]&&0===i[0]&&n[0]!==i[1]||n[1]===i[0]&&-1===i[0],c=(t[1]>o[3]?1:-1)==(t[0]>o[2]?1:-1),u=c&&l||!c&&!l?t[0]:o[2],h=c&&l||!c&&!l?o[3]:t[1];this._addSegment(je,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]}),this._addSegment(Vn,{r:a,x1:o[2],y1:o[3],x2:t[0],y2:t[1],cx:u,cy:h,ac:l})}else this._addSegment(je,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]});o=t}null!=t&&this._addSegment(je,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]})}},{key:"_compute",value:function(e,t){var n=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var i=function(t){return[e.startStubX,e.startStubY,e.endStubX,e.endStubY]},o={perpendicular:i,orthogonal:i,opposite:function(t){var i=e,o="x"===t?0:1,r={x:function(){return 1===i.so[o]&&(i.startStubX>i.endStubX&&i.tx>i.startStubX||i.sx>i.endStubX&&i.tx>i.sx)||-1===i.so[o]&&(i.startStubX<i.endStubX&&i.tx<i.startStubX||i.sx<i.endStubX&&i.tx<i.sx)},y:function(){return 1===i.so[o]&&(i.startStubY>i.endStubY&&i.ty>i.startStubY||i.sy>i.endStubY&&i.ty>i.sy)||-1===i.so[o]&&(i.startStubY<i.endStubY&&i.ty<i.startStubY||i.sy<i.endStubY&&i.ty<i.sy)}};return!n.alwaysRespectStubs&&r[t]()?{x:[(e.sx+e.tx)/2,e.startStubY,(e.sx+e.tx)/2,e.endStubY],y:[e.startStubX,(e.sy+e.ty)/2,e.endStubX,(e.sy+e.ty)/2]}[t]:[e.startStubX,e.startStubY,e.endStubX,e.endStubY]}},r=o[e.anchorOrientation](e.sourceAxis),s="x"===e.sourceAxis?0:1,a="x"===e.sourceAxis?1:0,l=r[s],c=r[a],u=r[s+2],h=r[a+2];this.addASegment(r[0],r[1],e);var d=e.startStubX+(e.endStubX-e.startStubX)*this.midpoint,p=e.startStubY+(e.endStubY-e.startStubY)*this.midpoint,f={x:[0,1],y:[1,0]},v={perpendicular:function(t,n,i,o,r){var s=e,a={x:[[s.startStubX,s.endStubX],null,[s.endStubX,s.startStubX]],y:[[s.startStubY,s.endStubY],null,[s.endStubY,s.startStubY]]},l={x:[[d,s.startStubY],[d,s.endStubY]],y:[[s.startStubX,p],[s.endStubX,p]]},c={x:[[s.endStubX,s.startStubY]],y:[[s.startStubX,s.endStubY]]},u={x:[[s.startStubX,s.endStubY],[s.endStubX,s.endStubY]],y:[[s.endStubX,s.startStubY],[s.endStubX,s.endStubY]]},h={x:[[s.startStubX,p],[s.endStubX,p],[s.endStubX,s.endStubY]],y:[[d,s.startStubY],[d,s.endStubY],[s.endStubX,s.endStubY]]},v={x:[s.startStubY,s.endStubY],y:[s.startStubX,s.endStubX]},y=f[t][0],g=f[t][1],m=s.so[y]+1,_=s.to[g]+1,x=-1===s.to[g]&&v[t][1]<v[t][0]||1===s.to[g]&&v[t][1]>v[t][0],b=a[t][m][0],k=a[t][m][1],E={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[t][m][_];return s.segment===E[3]||s.segment===E[2]&&x?l[t]:s.segment===E[2]&&k<b?c[t]:s.segment===E[2]&&k>=b||s.segment===E[1]&&!x?h[t]:s.segment===E[0]||s.segment===E[1]&&x?u[t]:void 0},orthogonal:function(t,n,i,o,r){var s=e,a={x:-1===s.so[0]?Math.min(n,o):Math.max(n,o),y:-1===s.so[1]?Math.min(n,o):Math.max(n,o)}[t];return{x:[[a,i],[a,r],[o,r]],y:[[i,a],[r,a],[r,o]]}[t]},opposite:function(i,o,r,a,l){var c=e,u={x:"y",y:"x"}[i],h={x:"h",y:"w"}[i],f=c["is"+i.toUpperCase()+"GreaterThanStubTimes2"];if(t.sourceEndpoint.elementId===t.targetEndpoint.elementId){var v=r+(1-t.sourceEndpoint._anchor.computedPosition[u])*t.sourceInfo[h]+n.maxStub;return{x:[[o,v],[a,v]],y:[[v,o],[v,a]]}[i]}return!f||1===c.so[s]&&o>a||-1===c.so[s]&&o<a?{x:[[o,p],[a,p]],y:[[d,o],[d,a]]}[i]:1===c.so[s]&&o<a||-1===c.so[s]&&o>a?{x:[[d,c.sy],[d,c.ty]],y:[[c.sx,p],[c.tx,p]]}[i]:void 0}},y=v[e.anchorOrientation](e.sourceAxis,l,c,u,h);if(y)for(var g=0;g<y.length;g++)this.addASegment(y[g][0],y[g][1],e);this.addASegment(r[2],r[3],e),this.addASegment(e.tx,e.ty,e),this.writeSegments(e)}},{key:"transformGeometry",value:function(e,t,n){return e}}],n&&as(t.prototype,n),i&&as(t,i),r}(Te);function _s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return xs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xs(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}function xs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function bs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ls(ms,"type","Flowchart"),Le(ms.type,ms);var ks=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"addTextRedactor",value:function(e,t,n){e.innerHTML+='<label for="formControlTextarea" class="form-label">'+t+'</label><textarea class="form-control" id="formControlTextarea" rows="3"> '+n+"</textarea>"}},{key:"addAnswerForOpenQuestion",value:function(e,t){e.innerHTML+='<div class=\'col-8\'><input type="text" class="form-control" id="answerText" value='+t.text+'></div><div class="col-3"><div class="input-group"><span class="input-group-text"> Очки </span><input type="text" class="form-control" id="answerPoints" value='+t.points+'></div></div><div class="col-1"><button class="btn btn-danger">-</button></div>'}},{key:"addMovementForMovementBlock",value:function(e,t){e.innerHTML+='<div class=\'col-8\'><div class=\'input-group\'><span class="input-group-text"> Координаты </span><input type="text" class="form-control" id="moveCoords" value='+t.movements[0].place.coords+'></div></div><div class=\'col-8\'><div class=\'input-group\'><span class="input-group-text"> Радиус(м) </span><input type="text" class="form-control" id="moveRadius"  value='+t.movements[0].place.radius+'></div></div><div class="col-8"><div class=\'input-group\'><span class="input-group-text"> Очки </span><input type="text" class="form-control" id="movePoints"  value='+t.answer_options[0].points+"></div></div>"}},{key:"createStartRedactor",value:function(e,t){this.addTextRedactor(e,"Приветственное сообщение:",t.text),document.getElementById("update").onclick=function(){t.text=document.getElementById("formControlTextarea").value,document.getElementById(t.question_id).getElementsByClassName("card-text")[0].textContent=t.text}}},{key:"createFinishRedactor",value:function(e,t){this.addTextRedactor(e,"Прощальное сообщение:",t.text),document.getElementById("update").onclick=function(){t.text=document.getElementById("formControlTextarea").value,document.getElementById(t.question_id).getElementsByClassName("card-text")[0].textContent=t.text}}},{key:"createOpenQuestionRedactor",value:function(e,t){this.addTextRedactor(e,"Вопрос",t.text),e.innerHTML+='<hr><label for="formControlTextarea" class="form-label">Ответы:</label>';var n,i=_s(t.answer_options);try{for(i.s();!(n=i.n()).done;){var o=n.value;this.addAnswerForOpenQuestion(e,o)}}catch(e){i.e(e)}finally{i.f()}e.innerHTML+="<div class='col-auto'><button type='button' class='btn btn-primary'>Добавить ответ</button></div>",document.getElementById("update").onclick=function(){t.text=document.getElementById("formControlTextarea").value,document.getElementById(t.question_id).getElementsByClassName("card-text")[0].textContent=t.text;var e,n=_s(t.answer_options);try{for(n.s();!(e=n.n()).done;){var i=e.value,o=i.answer_option_id;i.text=document.getElementById("answerText").value,i.points=document.getElementById("answerPoints").value,document.getElementById("answer"+o).innerText=document.getElementById("answerText").value}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createMovementRedactor",value:function(t,n){var i;e.addTextRedactor(t,"Перемещение",n.text),t.innerHTML+='<div class="z-depth-1-half map-container" style="height: 500px" id="map"></div>';var o=document.getElementById("map");console.log(o),ymaps.ready((function(){i=new ymaps.Map("map",{center:[57.5262,38.3061],zoom:11},{balloonMaxWidth:200,searchControlProvider:"yandex#search"}),console.log(i),i.events.add("click",(function(e){if(i.balloon.isOpen())i.balloon.close();else{var t=e.get("coords");i.balloon.open(t,{contentHeader:"Новое место квеста",contentBody:"<p></p><p>Координаты точки: "+[t[0].toPrecision(6),t[1].toPrecision(6)].join(", ")+"</p>",contentFooter:"<sup>Вы можете выбрать новую точку</sup>"}),n.movements[0].place.coords="("+t[0].toString()+","+t[1].toString()+")",console.log(n.movements[0].place.coords),document.getElementById("moveCoords").value=n.movements[0].place.coords}})),i.events.add("balloonopen",(function(e){i.hint.close()}))})),console.log(i),e.addMovementForMovementBlock(t,n),document.getElementById("update").onclick=function(){n.text=document.getElementById("formControlTextarea").value,document.getElementById(n.question_id).getElementsByClassName("card-text")[0].textContent=n.text,n.movements[0].place.coords=document.getElementById("moveCoords").value,n.movements[0].place.radius=document.getElementById("moveRadius").value,n.answer_options[0].points=document.getElementById("movePoints").value}}},{key:"showRedactor",value:function(t){var n=new bootstrap.Modal(document.getElementById("redactor")),i=document.getElementById("redactorForm");switch(i.innerHTML="",t.type){case"start":e.createStartRedactor(i,t);break;case"end":e.createFinishRedactor(i,t);break;case"open":case"choice":e.createOpenQuestionRedactor(i,t);break;case"movement":e.createMovementRedactor(i,t)}n.show()}}],(n=null)&&bs(t.prototype,n),i&&bs(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Es(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Cs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Cs(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}function Cs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ss(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ps=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"renderBlockBase",value:function(e,t,n,i){var o=document.createElement("div");o.id=e.question_id,o.className="position-absolute border-2 card",o.style.width=t,o.style.top=i[0],o.style.left=i[1];var r=document.createElement("div");return r.className="card-body",r.innerHTML='<h5 class="card-title text-center">'+n+'</h5><hr><p class="card-text text-center text-truncate">'+e.text+"</p>",o.append(r),o.ondblclick=function(){ks.showRedactor(e)},document.getElementById("container").append(o),o}},{key:"addDeleteButton",value:function(e,t,n,i){var o=document.createElement("button");o.id="btn"+t.id,o.className="btn-close btn-danger",o.style.position="absolute",o.style.top="0",o.style.right="0",o.onclick=function(){if(void 0!==i){var o,r=Es(i);try{for(r.s();!(o=r.n()).done;){var s=o.value;n.deleteConnectionsForElement(s),n.selectEndpoints({element:s}).deleteAll(),delete n.getManagedElements()[s.id]}}catch(e){r.e(e)}finally{r.f()}}n.deleteConnectionsForElement(t),n.selectEndpoints({element:t}).deleteAll(),delete n.getManagedElements()[t.id],t.parentElement.removeChild(t);var a=e.data.questions;a.splice(a.indexOf(a.find((function(e){return e.question_id==t.id}))),1)},t.append(o)}},{key:"renderStart",value:function(e,t,n,i){var o=this.renderBlockBase(e,"10rem","Начало",i);return t.manage(o,o.id),t.addEndpoint(o,n),o}},{key:"renderFinish",value:function(e,t,n,i){var o=this.renderBlockBase(e,"10rem","Конец",i);return t.manage(o,o.id),t.addEndpoint(o,n),o}},{key:"renderOpenQuestion",value:function(t,n,i,o,r,s){var a=e.renderBlockBase(n,"15rem","Открытый вопрос",s),l=document.createElement("ul");l.className="list-group list-group-flush",a.append(l);var c,u=Es(n.answer_options);try{for(u.s();!(c=u.n()).done;){var h=c.value,d=document.createElement("li");d.innerHTML=h.text,d.className="list-group-item",d.id="answer"+h.answer_option_id,l.append(d),i.addEndpoint(d,{anchor:["Right","Left"]},o)}}catch(e){u.e(e)}finally{u.f()}return e.addDeleteButton(t,a,i,l.childNodes),i.addEndpoint(a,{anchor:"Top"},r),a}},{key:"renderMovement",value:function(t,n,i,o,r,s){var a=e.renderBlockBase(n,"15rem","Перемещение",s);return e.addDeleteButton(t,a,i),i.addEndpoint(a,{anchor:"Top"},r),i.addEndpoint(a,{anchor:"Bottom"},o),a}},{key:"render",value:function(t,n,i,o){var r,s=[0,0],a=Es(t.data.questions);try{for(a.s();!(r=a.n()).done;){var l=r.value;switch(l.type){case"start":e.renderStart(l,n,i,s);break;case"end":e.renderFinish(l,n,o,s);break;case"open":case"choice":e.renderOpenQuestion(t,l,n,i,o,s);break;case"movement":e.renderMovement(t,l,n,i,o,s)}}}catch(e){a.e(e)}finally{a.f()}var c,u=Es(t.data.questions);try{for(u.s();!(c=u.n()).done;){var h=c.value;if("start"===h.type)n.connect({source:n.selectEndpoints({element:document.getElementById(h.question_id)}).get(0),target:n.selectEndpoints({element:document.getElementById(h.answer_options[0].next_question_id)}).get(0)});else if("movement"===h.type)n.connect({source:n.selectEndpoints({element:document.getElementById(h.question_id)}).get(1),target:n.selectEndpoints({element:document.getElementById(h.answer_options[0].next_question_id)}).get(0)});else if("end"!==h.type){var d,p=Es(h.answer_options);try{for(p.s();!(d=p.n()).done;){var f=d.value;n.connect({source:n.selectEndpoints({element:document.getElementById("answer"+f.answer_option_id)}).get(0),target:n.selectEndpoints({element:document.getElementById(f.next_question_id)}).get(0)})}}catch(e){p.e(e)}finally{p.f()}}}}catch(e){u.e(e)}finally{u.f()}}}],(n=null)&&Ss(t.prototype,n),i&&Ss(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ws(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var As=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t}var t,n,i;return t=e,n=[{key:"showQuest",value:function(){var e=ss({container:document.getElementById("container")});Ps.render(this,e,{endpoint:{type:"Dot",options:{radius:5}},connector:{type:"Flowchart",options:{cornerRadius:2}},source:!0},{endpoint:{type:"Rectangle"},maxConnections:-1,source:!1,target:!0,connectionsDetachable:!0,anchor:[.5,0,0,-1]})}}],i=[{key:"makeLoadRequest",value:function(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?t(i.responseText):n(i.status))},i.open("GET",e,!0),i.send()}))}},{key:"loadQuest",value:function(t){var n=this,i="/api/db/quest/"+t.toString();return new Promise((function(t,o){t(n.makeLoadRequest(i).then((function(t){return console.log("success"),new e(JSON.parse(t))})))}))}}],n&&ws(t.prototype,n),i&&ws(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();n(909);var Ds=ss({container:document.getElementById("container")}),Ms={endpoint:{type:"Dot",options:{radius:5}},connector:{type:"Flowchart",options:{cornerRadius:2}},source:!0},Ts={endpoint:{type:"Rectangle"},maxConnections:-1,source:!1,target:!0,connectionsDetachable:!0,anchor:[.5,0,0,-1]};As.loadQuest(1).then((function(e){var t=e;return Ps.render(t,Ds,Ms,Ts),t}))})()})();