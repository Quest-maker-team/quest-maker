(()=>{"use strict";function t(t,e,n){return"*"===t||(t.length>0?-1!==t.indexOf(e):!n)}function e(t,e,n){var i,o=t=t||{},s=e=e||{};if(n)for(i=0;i<n.length;i++)o[n[i]]=s[n[i]];else for(i in s)o[i]=s[i];return t}function n(t){return"[object Number]"===Object.prototype.toString.call(t)}function i(t){return"string"==typeof t}function o(t){return"boolean"==typeof t}function s(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function r(t){return"[object Function]"===Object.prototype.toString.call(t)}function a(t){if(i(t))return""+t;if(o(t))return!!t;if(u=t,"[object Date]"===Object.prototype.toString.call(u))return new Date(t.getTime());if(r(t))return t;if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(a(t[n]));return e}if(s(t)){var l={};for(var c in t)l[c]=a(t[c]);return l}return t;var u}function l(t,e,l,c){var u,h,d={},p={};for(l=l||[],c=c||[],h=0;h<l.length;h++)d[l[h]]=!0;for(h=0;h<c.length;h++)p[c[h]]=!0;var f=a(t);for(h in e)if(null==f[h]||p[h])f[h]=e[h];else if(d[h])(u=[]).push.apply(u,Array.isArray(f[h])?f[h]:[f[h]]),u.push(e[h]),f[h]=u;else if(i(e[h])||o(e[h])||r(e[h])||n(e[h]))f[h]=e[h];else if(Array.isArray(e[h]))u=[],Array.isArray(f[h])&&u.push.apply(u,f[h]),u.push.apply(u,e[h]),f[h]=u;else if(s(e[h]))for(var v in s(f[h])||(f[h]={}),e[h])f[h][v]=e[h][v];return f}function c(t,e,n){for(var i=0;i<n.length;i++){var o=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(o===e)return o}return t}function u(t,e,n,o){return function t(a){if(null!=a){if(i(a))return function(t){var n=t.match(/(\${.*?})/g);if(null!=n)for(var i=0;i<n.length;i++){var o=e[n[i].substring(2,n[i].length-1)]||"";null!=o&&(t=t.replace(n[i],o))}return t}(a);if(!r(a)||o||null!=n&&0!==(a.name||"").indexOf(n)){if(Array.isArray(a)){for(var l=[],c=0;c<a.length;c++)l.push(t(a[c]));return l}if(s(a)){var u={};for(var h in a)u[h]=t(a[h]);return u}return a}return a(e)}}(t)}function h(t,e){if(!t)return null;for(var n=0;n<t.length;n++)e(t[n])}function d(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1}function p(t,e){var n=d(t,e);return-1===n?null:t[n]}function f(t,e){var n=null;return t.forEach((function(t){e(t)&&(n=t)})),n}function v(t){var e=[];return t.forEach((function(t){e.push(t)})),e}function y(t,e){var n=d(t,e);return n>-1&&t.splice(n,1),-1!==n}function g(t){if(null!=Array.fromArray)return Array.from(t);var e=[];return Array.prototype.push.apply(e,t),e}function m(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),-1!==n}function _(t,e,n,i){var o=t[e];return null==o&&(o=[],t[e]=o),o[i?"unshift":"push"](n),o}function x(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)}for(var k=[],b=0;b<256;b++)k[b]=(b<16?"0":"")+b.toString(16);function C(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return k[255&t]+k[t>>8&255]+k[t>>16&255]+k[t>>24&255]+"-"+k[255&e]+k[e>>8&255]+"-"+k[e>>16&15|64]+k[e>>24&255]+"-"+k[63&n|128]+k[n>>8&255]+"-"+k[n>>16&255]+k[n>>24&255]+k[255&i]+k[i>>8&255]+k[i>>16&255]+k[i>>24&255]}function E(t,e,n){var i=t.x-e.x,o=t.y-e.y,s=Math.cos(n/360*Math.PI*2),r=Math.sin(n/360*Math.PI*2);return{x:i*s-o*r+e.x,y:o*s+i*r+e.y,cr:s,sr:r}}function S(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,i=e.length;n.test(e.charAt(--i)););return e.slice(0,i+1)}function P(t,e){for(var n=[],i=0;i<t.length;i++)n.push(e(t[i]));return n}function w(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if("undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(t){}}function A(t,e,n){return function(){var i=null;try{null!=e&&(i=e.apply(this,arguments))}catch(t){w("jsPlumb function failed : "+t)}if(null!=t&&(null==n||i!==n))try{i=t.apply(this,arguments)}catch(t){w("wrapped function failed : "+t)}return i}}function D(t,e,n){return t.has(e)||t.set(e,n()),t.get(e)}function M(t,e){for(var n=t.__proto__;null!=n;){if(n instanceof e)return!0;n=n.__proto__}return!1}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function I(t,e,n){return e&&T(t.prototype,e),n&&T(t,n),t}function O(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},G(t)}function L(t,e){return L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},L(t,e)}function F(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function H(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=G(t);if(e){var o=G(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return F(this,n)}}var R,N,B=function(){function t(){j(this,t),O(this,"_listeners",{}),O(this,"eventsSuspended",!1),O(this,"tick",!1),O(this,"eventsToDieOn",{ready:!0}),O(this,"queue",[])}return I(t,[{key:"fire",value:function(t,e,n){var i=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var o=this._listeners[t].length,s=0,r=!1;if(!this.shouldFireEvent||this.shouldFireEvent(t,e,n))for(;!r&&s<o&&!1!==i;){if(this.eventsToDieOn[t])this._listeners[t][s].apply(this,[e,n]);else try{i=this._listeners[t][s].apply(this,[e,n])}catch(e){w("jsPlumb: fire failed for event "+t+" : "+(e.message||e))}s++,null!=this._listeners&&null!=this._listeners[t]||(r=!0)}}this.tick=!1,this._drain()}return i}},{key:"_drain",value:function(){var t=this.queue.pop();t&&this.fire.apply(this,t)}},{key:"unbind",value:function(t,e){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb){var n;for(var i in t.__jsPlumb)n=t.__jsPlumb[i],m(this._listeners[n]||[],t)}}else 2===arguments.length&&m(this._listeners[t]||[],e);return this}},{key:"getListener",value:function(t){return this._listeners[t]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(t){this.eventsSuspended=t}},{key:"bind",value:function(t,e,n){var i=this,o=function(t){_(i._listeners,t,e,n),e.__jsPlumb=e.__jsPlumb||{},e.__jsPlumb[C()]=t};if("string"==typeof t)o(t);else if(null!=t.length)for(var s=0;s<t.length;s++)o(t[s]);return this}},{key:"silently",value:function(t){this.setSuspendEvents(!0);try{t()}catch(t){w("Cannot execute silent function "+t)}this.setSuspendEvents(!1)}}]),t}(),q=(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L(t,e)}(n,t);var e=H(n);function n(){return j(this,n),e.apply(this,arguments)}I(n,[{key:"shouldFireEvent",value:function(t,e,n){return!0}}])}(B),[null,[1,-1],[1,1],[-1,1],[-1,-1]]),X=[null,[-1,-1],[-1,1],[1,1],[1,-1]],Y=2*Math.PI;function V(t,e){return e.x===t.x?e.y>t.y?1/0:-1/0:e.y===t.y?e.x>t.x?0:-0:(e.y-t.y)/(e.x-t.x)}function z(t,e){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function U(t,e){return e.x>t.x||e.x==t.x?e.y>t.y?2:1:e.y>t.y?3:4}function W(t,e){var n=t.x,i=t.x+t.w,o=t.y,s=t.y+t.h,r=e.x,a=e.x+e.w,l=e.y,c=e.y+e.h;return n<=r&&r<=i&&o<=l&&l<=s||n<=a&&a<=i&&o<=l&&l<=s||n<=r&&r<=i&&o<=c&&c<=s||n<=a&&r<=i&&o<=c&&c<=s||r<=n&&n<=a&&l<=o&&o<=c||r<=i&&i<=a&&l<=o&&o<=c||r<=n&&n<=a&&l<=s&&s<=c||r<=i&&n<=a&&l<=s&&s<=c}function J(t,e,n){var i=V(t,e),o=U(t,e),s=n>0?q[o]:X[o],r=Math.atan(i),a=Math.abs(n*Math.sin(r))*s[1],l=Math.abs(n*Math.cos(r))*s[0];return{x:t.x+l,y:t.y+a}}function Z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function K(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t.Circle="Circle",t.Ellipse="Ellipse",t.Triangle="Triangle",t.Diamond="Diamond",t.Rectangle="Rectangle",t.Square="Square"}(R||(R={})),function(t){t.Assign="Assign",t.AutoDefault="AutoDefault",t.Bottom="Bottom",t.BottomLeft="BottomLeft",t.BottomRight="BottomRight",t.Center="Center",t.Continuous="Continuous",t.ContinuousBottom="ContinuousBottom",t.ContinuousLeft="ContinuousLeft",t.ContinuousRight="ContinuousRight",t.ContinuousTop="ContinuousTop",t.ContinuousLeftRight="ContinuousLeftRight",t.ContinuousTopBottom="ContinuousTopBottom",t.Left="Left",t.Perimeter="Perimeter",t.Right="Right",t.Top="Top",t.TopLeft="TopLeft",t.TopRight="TopRight"}(N||(N={}));var $=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=e,K(this,"x1",void 0),K(this,"x2",void 0),K(this,"y1",void 0),K(this,"y2",void 0),K(this,"extents",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),K(this,"type",void 0),this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2}var e,n,i;return e=t,(n=[{key:"findClosestPointOnPath",value:function(t,e){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return[]}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}},{key:"boundingBoxIntersection",value:function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}}])&&Z(e.prototype,n),i&&Z(e,i),t}(),Q="undefined",tt="default",et="true",nt="false",it="*";function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function rt(t,e,n){return e&&st(t.prototype,e),n&&st(t,n),t}function at(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function lt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ut(t,e)}function ct(t){return ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ct(t)}function ut(t,e){return ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ut(t,e)}function ht(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?ht(t):e}function pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=ct(t);if(e){var o=ct(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return dt(this,n)}}function ft(t,e,n){return ft="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ct(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}},ft(t,e,n||t)}function vt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,o,s=[],r=!0,a=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(s.push(i.value),!e||s.length!==e);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==n.return||n.return()}finally{if(a)throw o}}return s}(t,e)||gt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yt(t){return function(t){if(Array.isArray(t))return mt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||gt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gt(t,e){if(t){if("string"==typeof t)return mt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mt(t,e):void 0}}function mt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var _t={},xt={},kt={},bt={get:function(t,e,n){var i=_t[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown endpoint type '"+e+"'"}},clone:function(t){var e=kt[t.type];return bt.get(t.endpoint,t.type,e.getParams(t))},compute:function(t,e,n,i){var o=xt[t.type];if(null!=o)return o(t,e,n,i);w("jsPlumb: cannot find endpoint calculator for endpoint of type ",t.type)},registerHandler:function(t){kt[t.type]=t,_t[t.type]=t.cls,xt[t.type]=t.compute}},Ct=function(){function t(e,n){ot(this,t),this.endpoint=e,at(this,"typeId",void 0),at(this,"x",void 0),at(this,"y",void 0),at(this,"w",void 0),at(this,"h",void 0),at(this,"computedValue",void 0),at(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),at(this,"classes",[]),at(this,"instance",void 0),at(this,"type",void 0),n=n||{},this.instance=e.instance,e.cssClass&&this.classes.push(e.cssClass),n.cssClass&&this.classes.push(n.cssClass)}return rt(t,[{key:"addClass",value:function(t){this.classes.push(t),this.instance.addEndpointClass(this.endpoint,t)}},{key:"removeClass",value:function(t){this.classes=this.classes.filter((function(e){return e!==t})),this.instance.removeEndpointClass(this.endpoint,t)}},{key:"compute",value:function(t,e,n){this.computedValue=bt.compute(this,t,e,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(t){this.instance.setEndpointVisible(this.endpoint,t)}}]),t}(),Et=function(t){lt(n,t);var e=pt(n);function n(t,i){var o;return ot(this,n),at(ht(o=e.call(this,t,i)),"radius",void 0),at(ht(o),"defaultOffset",void 0),at(ht(o),"defaultInnerRadius",void 0),at(ht(o),"type",n.type),i=i||{},o.radius=i.radius||5,o.defaultOffset=.5*o.radius,o.defaultInnerRadius=o.radius/3,o}return n}(Ct);at(Et,"type","Dot");var St={type:Et.type,cls:Et,compute:function(t,e,n,i){var o=e.curX-t.radius,s=e.curY-t.radius,r=2*t.radius,a=2*t.radius;if(i&&i.stroke){var l=i.strokeWidth||1;o-=l,s-=l,r+=2*l,a+=2*l}return t.x=o,t.y=s,t.w=r,t.h=a,[o,s,r,a,t.radius]},getParams:function(t){return{radius:t.radius}}},Pt=function(t){lt(n,t);var e=pt(n);function n(t,i){var o;return ot(this,n),at(ht(o=e.call(this,t,i)),"type",n.type),o}return n}(Ct);at(Pt,"type","Blank");var wt={type:Pt.type,cls:Pt,compute:function(t,e,n,i){return t.x=e.curX,t.y=e.curY,t.w=10,t.h=0,[e.curX,e.curY,10,0]},getParams:function(t){return{}}},At=function(t){lt(n,t);var e=pt(n);function n(t,i){var o;return ot(this,n),at(ht(o=e.call(this,t,i)),"width",void 0),at(ht(o),"height",void 0),at(ht(o),"type",n.type),i=i||{},o.width=i.width||10,o.height=i.height||10,o}return rt(n,null,[{key:"_getParams",value:function(t){return{width:t.width,height:t.height}}}]),n}(Ct);at(At,"type","Rectangle");var Dt={type:At.type,cls:At,compute:function(t,e,n,i){var o=i.width||t.width,s=i.height||t.height,r=e.curX-o/2,a=e.curY-s/2;return t.x=r,t.y=a,t.w=o,t.h=s,[r,a,o,s]},getParams:function(t){return{width:t.width,height:t.height}}},Mt=function(){function t(e,n){ot(this,t),this.connection=e,at(this,"type",void 0),at(this,"edited",!1),at(this,"stub",void 0),at(this,"sourceStub",void 0),at(this,"targetStub",void 0),at(this,"maxStub",void 0),at(this,"typeId",void 0),at(this,"gap",void 0),at(this,"sourceGap",void 0),at(this,"targetGap",void 0),at(this,"segments",[]),at(this,"totalLength",0),at(this,"segmentProportions",[]),at(this,"segmentProportionalLengths",[]),at(this,"paintInfo",null),at(this,"strokeWidth",void 0),at(this,"x",void 0),at(this,"y",void 0),at(this,"w",void 0),at(this,"h",void 0),at(this,"segment",void 0),at(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),at(this,"cssClass",void 0),at(this,"hoverClass",void 0),at(this,"geometry",void 0),this.stub=n.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=n.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=n.cssClass||"",this.hoverClass=n.hoverClass||""}return rt(t,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(t,e){this.geometry=t,this.edited=null!=t&&!e}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(t){return this.geometry=t,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(t,e,n){return{x:t.x,y:t.y,ox:t.ox,oy:t.oy,curX:t.curX+e,curY:t.curY+n}}},{key:"resetBounds",value:function(){this.bounds={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}},{key:"findSegmentForPoint",value:function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var o=this.segments[i].findClosestPointOnPath(t,e);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=this.segments[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+o.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function(t,e,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].lineIntersection(t,e,n,i));return o}},{key:"boxIntersection",value:function(t,e,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].boxIntersection(t,e,n,i));return o}},{key:"boundingBoxIntersection",value:function(t){for(var e=[],n=0;n<this.segments.length;n++)e.push.apply(e,this.segments[n].boundingBoxIntersection(t));return e}},{key:"_updateSegmentProportions",value:function(){for(var t=0,e=0;e<this.segments.length;e++){var n=this.segments[e].getLength();this.segmentProportionalLengths[e]=n/this.totalLength,this.segmentProportions[e]=[t,t+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(t,e){var n,i,o;if(e&&(t=t>0?t/this.totalLength:(this.totalLength+t)/this.totalLength),1===t)n=this.segments.length-1,o=1;else if(0===t)o=0,n=0;else if(t>=.5){for(n=0,o=0,i=this.segmentProportions.length-1;i>-1;i--)if(this.segmentProportions[i][1]>=t&&this.segmentProportions[i][0]<=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(n=this.segmentProportions.length-1,o=1,i=0;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:o,index:n}}},{key:"_addSegment",value:function(t,e){if(e.x1!==e.x2||e.y1!==e.y2){var n=new t(e);this.segments.push(n),this.totalLength+=n.getLength(),this.updateBounds(n)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(t){this.strokeWidth=t.strokeWidth;var e=t.sourcePos.curX,n=t.targetPos.curX,i=t.sourcePos.curY,o=t.targetPos.curY,s=U({x:e,y:i},{x:n,y:o}),r=n<e,a=o<i,l=[t.sourcePos.ox,t.sourcePos.oy],c=[t.targetPos.ox,t.targetPos.oy],u=r?n:e,h=a?o:i,d=Math.abs(n-e),p=Math.abs(o-i),f=0===l[0]&&0===l[1],v=0===c[0]&&0===c[1];if(f||v){var y=d>p?0:1,g=[1,0][y],m=0===y?e:i,_=0===y?n:o;f&&(l[y]=m>_?-1:1,l[g]=0),v&&(c[y]=m>_?1:-1,c[g]=0)}var x=r?d+this.sourceGap*l[0]:this.sourceGap*l[0],k=a?p+this.sourceGap*l[1]:this.sourceGap*l[1],b=r?this.targetGap*c[0]:d+this.targetGap*c[0],C=a?this.targetGap*c[1]:p+this.targetGap*c[1],E=l[0]*c[0]+l[1]*c[1],S={sx:x,sy:k,tx:b,ty:C,xSpan:Math.abs(b-x),ySpan:Math.abs(C-k),mx:(x+b)/2,my:(k+C)/2,so:l,to:c,x:u,y:h,w:d,h:p,segment:s,startStubX:x+l[0]*this.sourceStub,startStubY:k+l[1]*this.sourceStub,endStubX:b+c[0]*this.targetStub,endStubY:C+c[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(x-b)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(k-C)>this.sourceStub+this.targetStub,opposite:-1===E,perpendicular:0===E,orthogonal:1===E,sourceAxis:0===l[0]?"y":"x",points:[u,h,d,p,x,k,b,C],stubs:[this.sourceStub,this.targetStub]};return S.anchorOrientation=S.opposite?"opposite":S.orthogonal?"orthogonal":"perpendicular",S}},{key:"updateBounds",value:function(t){var e=t.extents;this.bounds.xmin=Math.min(this.bounds.xmin,e.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,e.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,e.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,e.ymax)}},{key:"dumpSegmentsToConsole",value:function(){w("SEGMENTS:");for(var t=0;t<this.segments.length;t++)w(this.segments[t].type,""+this.segments[t].getLength(),""+this.segmentProportions[t])}},{key:"pointOnPath",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this._findSegmentForLocation(t,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,e,!1)||{x:0,y:0}}},{key:"compute",value:function(t){this.paintInfo=this._prepareCompute(t),this._clearSegments(),this._compute(this.paintInfo,t),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(t,e){}}]),t}(),jt=function(t){lt(n,t);var e=pt(n);function n(t){var i;return ot(this,n),at(ht(i=e.call(this,t)),"length",void 0),at(ht(i),"m",void 0),at(ht(i),"m2",void 0),at(ht(i),"type",n.segmentType),i._setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),i}return rt(n,[{key:"getPath",value:function(t){return(t?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=V({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(t){this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this._recalc()}},{key:"pointOnPath",value:function(t,e){if(0!==t||e){if(1!==t||e){var n=e?t>0?t:this.length+t:t*this.length;return J({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}return{x:this.x2,y:this.y2}}return{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(t,e){return this.m}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=e<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return e<=0&&Math.abs(e)>1&&(e*=-1),J(i,o,e)}},{key:"within",value:function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)}},{key:"closest",value:function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e}},{key:"findClosestPointOnPath",value:function(t,e){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)n.y=this.y1,n.x=this.within(this.x1,this.x2,t)?t:this.closest(this.x1,this.x2,t);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,e)?e:this.closest(this.y1,this.y2,e);else{var i=this.y1-this.m*this.x1,o=(e-this.m2*t-i)/(this.m-this.m2),s=this.m*o+i;n.x=this.within(this.x1,this.x2,o)?o:this.closest(this.x1,this.x2,o),n.y=this.within(this.y1,this.y2,s)?s:this.closest(this.y1,this.y2,s)}var r=z({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=z({x:t,y:e},n),n.l=r/length,n}},{key:"_pointLiesBetween",value:function(t,e,n){return n>e?e<=t&&t<=n:e>=t&&t>=n}},{key:"lineIntersection",value:function(t,e,n,i){var o=Math.abs(V({x:t,y:e},{x:n,y:i})),s=Math.abs(this.m),r=s===1/0?this.x1:this.y1-s*this.x1,a=[],l=o===1/0?t:e-o*t;if(o!==s)if(o===1/0&&0===s)this._pointLiesBetween(t,this.x1,this.x2)&&this._pointLiesBetween(this.y1,e,i)&&a.push({x:t,y:this.y1});else if(0===o&&s===1/0)this._pointLiesBetween(e,this.y1,this.y2)&&this._pointLiesBetween(this.x1,t,n)&&a.push({x:this.x1,y:e});else{var c,u;o===1/0?(c=t,this._pointLiesBetween(c,this.x1,this.x2)&&(u=s*t+r,this._pointLiesBetween(u,e,i)&&a.push({x:c,y:u}))):0===o?(u=e,this._pointLiesBetween(u,this.y1,this.y2)&&(c=(e-r)/s,this._pointLiesBetween(c,t,n)&&a.push({x:c,y:u}))):(u=s*(c=(l-r)/(s-o))+r,this._pointLiesBetween(c,this.x1,this.x2)&&this._pointLiesBetween(u,this.y1,this.y2)&&a.push({x:c,y:u}))}return a}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}}]),n}($);at(jt,"segmentType","Straight");var Tt=function(t){lt(n,t);var e=pt(n);function n(){var t;ot(this,n);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return at(ht(t=e.call.apply(e,[this].concat(o))),"type",n.type),t}return rt(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){this._addSegment(jt,{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),this._addSegment(jt,{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),this._addSegment(jt,{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty}),this.geometry={source:e.sourcePos,target:e.targetPos}}},{key:"transformGeometry",value:function(t,e,n){return{source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}}]),n}(Mt);at(Tt,"type","Straight");var It={},Ot=function(t,e,n){var i=It[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown connector type '"+e+"'"}},Gt=function(t,e){It[t]=e};function Lt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){return"."+t})).join(",")}function Ft(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){return"["+t+"]"})).join(",")}var Ht="source",Rt="target",Nt="block",Bt="none",qt="absolute",Xt="fixed",Yt="data-jtk-group",Vt="data-jtk-managed",zt="data-jtk-not-draggable",Ut="tabindex",Wt="data-jtk-scope-",Jt="checkCondition",Zt="jtk-connector",Kt="jtk-endpoint",$t="jtk-group-collapsed",Qt="jtk-group-expanded",te="jtk-overlay",ee="internal.connection",ne="connection:move",ie="internal.endpoint:unregistered",oe="internal.connection:detached",se="group:member:added",re="maxConnections",ae="zoom",le="isDetachAllowed",ce="beforeDetach",ue=Ft(Vt);function he(t){var e=null;return(e=i(t)?{type:t,options:{}}:t).options.id=e.options.id||C(),e}var de=function(t){lt(n,t);var e=pt(n);function n(t,i,o){var s;for(var r in ot(this,n),(s=e.call(this)).instance=t,s.component=i,at(ht(s),"id",void 0),at(ht(s),"type",void 0),at(ht(s),"cssClass",void 0),at(ht(s),"visible",!0),at(ht(s),"location",void 0),at(ht(s),"events",void 0),at(ht(s),"attributes",void 0),o=o||{},s.id=o.id||C(),s.cssClass=o.cssClass||"",s.location=o.location||.5,s.events=o.events||{},s.attributes=o.attributes||{},s.events)s.bind(r,s.events[r]);return s}return rt(n,[{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"setVisible",value:function(t){this.visible=t,this.instance.setOverlayVisible(this,t)}},{key:"isVisible",value:function(){return this.visible}}]),n}(B),pe={},fe=function(t,e,n,i){var o=pe[e];if(o)return new o(t,n,i);throw{message:"jsPlumb: unknown overlay type '"+e+"'"}},ve=function(t,e){pe[t]=e},ye=function(t){lt(n,t);var e=pt(n);function n(t,i,o){var s;return ot(this,n),(s=e.call(this,t,i,o)).instance=t,s.component=i,at(ht(s),"label",void 0),at(ht(s),"labelText",void 0),at(ht(s),"type",n.type),at(ht(s),"cachedDimensions",void 0),o=o||{label:""},s.setLabel(o.label),s}return rt(n,[{key:"getLabel",value:function(){return r(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(t){this.label=t,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(t){null!=t.label&&this.setLabel(t.label)}}]),n}(de);function ge(t){return t.type===ye.type}function me(t){return null==t?null:t.split(" ")}function _e(t,e,n){for(var i in e)t[i]=n}at(ye,"type","Label"),ve("Label",ye);var xe="__default",ke="__label",be="remove";function Ce(t,n){if(t.getDefaultType){var i=t.getTypeDescriptor(),o={},s=t.getDefaultType(),r=e({},s);_e(o,s,xe);for(var a=0,c=t._types.length;a<c;a++){var h=t._types[a];if(h!==xe){var d=t.instance.getType(h,i);if(null!=d){var p=new Set(["connector","anchor","anchors"]);if("override"===d.mergeStrategy)for(var f in d)p.add(f);r=l(r,d,["cssClass"],v(p)),_e(o,d,h)}}}n&&(r=u(r,n,"_")),t.applyType(r,o)}}function Ee(t,e){var n=t._types[e],i=t.instance.getType(n,t.getTypeDescriptor());null!=i&&i.cssClass&&t.removeClass(i.cssClass)}function Se(t){if(t.paintStyle&&t.hoverPaintStyle){var n={};e(n,t.paintStyle),e(n,t.hoverPaintStyle),t.hoverPaintStyle=n}}var Pe,we,Ae,De,Me=function(t){lt(o,t);var n=pt(o);function o(t,e){var i;if(ot(this,o),(i=n.call(this)).instance=t,at(ht(i),"defaultLabelLocation",.5),at(ht(i),"overlays",{}),at(ht(i),"overlayPositions",{}),at(ht(i),"overlayPlacements",{}),at(ht(i),"clone",void 0),at(ht(i),"deleted",void 0),at(ht(i),"segment",void 0),at(ht(i),"x",void 0),at(ht(i),"y",void 0),at(ht(i),"w",void 0),at(ht(i),"h",void 0),at(ht(i),"id",void 0),at(ht(i),"visible",!0),at(ht(i),"typeId",void 0),at(ht(i),"params",{}),at(ht(i),"paintStyle",void 0),at(ht(i),"hoverPaintStyle",void 0),at(ht(i),"paintStyleInUse",void 0),at(ht(i),"_hover",!1),at(ht(i),"lastPaintedAt",void 0),at(ht(i),"data",void 0),at(ht(i),"_defaultType",void 0),at(ht(i),"events",void 0),at(ht(i),"parameters",void 0),at(ht(i),"_types",void 0),at(ht(i),"_typeCache",void 0),at(ht(i),"cssClass",void 0),at(ht(i),"hoverClass",void 0),at(ht(i),"beforeDetach",void 0),at(ht(i),"beforeDrop",void 0),e=e||{},i.cssClass=e.cssClass||"",i.hoverClass=e.hoverClass||t.defaults.hoverClass,i.beforeDetach=e.beforeDetach,i.beforeDrop=e.beforeDrop,i._types=[],i._typeCache={},i.parameters=a(e.parameters||{}),i.id=e.id||i.getIdPrefix()+(new Date).getTime(),i._defaultType={parameters:i.parameters,scope:e.scope||i.instance.defaultScope,overlays:{}},e.events)for(var s in e.events)i.bind(s,e.events[s]);i.clone=function(){var n=Object.create(i.constructor.prototype);return i.constructor.apply(n,[t,e]),n},i.overlays={},i.overlayPositions={};var r=e.overlays||[],l={},c=i.getDefaultOverlayKey();if(c){var u=i.instance.defaults[c];u&&r.push.apply(r,yt(u));for(var h=0;h<r.length;h++){var d=he(r[h]);l[d.options.id]=d}}return i._defaultType.overlays=l,e.label&&(i.getDefaultType().overlays.__label={type:ye.type,options:{label:e.label,location:e.labelLocation||i.defaultLabelLocation,id:ke}}),i}return rt(o,[{key:"isDetachAllowed",value:function(t){var e=!0;if(this.beforeDetach)try{e=this.beforeDetach(t)}catch(t){w("jsPlumb: beforeDetach callback failed",t)}return e}},{key:"isDropAllowed",value:function(t,e,n,i,o){var s,r={sourceId:t,targetId:e,scope:n,connection:i,dropEndpoint:o};if(this.beforeDrop)try{s=this.beforeDrop(r)}catch(t){w("jsPlumb: beforeDrop callback failed",t)}else s=this.instance.checkCondition("beforeDrop",r);return s}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(t){for(var e in t)this._defaultType[e]=t[e]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(t,e,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][t]=e}},{key:"getCachedTypeItem",value:function(t,e){return this._typeCache[e]?this._typeCache[e][t]:null}},{key:"setType",value:function(t,e){this.clearTypes(),this._types=me(t)||[],Ce(this,e)}},{key:"getType",value:function(){return this._types}},{key:"reapplyTypes",value:function(t){Ce(this,t)}},{key:"hasType",value:function(t){return-1!==this._types.indexOf(t)}},{key:"addType",value:function(t,e){var n=me(t),i=!1;if(null!=n){for(var o=0,s=n.length;o<s;o++)this.hasType(n[o])||(this._types.push(n[o]),i=!0);i&&Ce(this,e)}}},{key:"removeType",value:function(t,e){var n,i,o=this,s=me(t),r=!1;if(null!=s){for(var a=0,l=s.length;a<l;a++)n=s[a],i=void 0,r=-1!==(i=o._types.indexOf(n))&&(Ee(o,i),o._types.splice(i,1),!0)||r;r&&Ce(this,e)}}},{key:"clearTypes",value:function(t,e){for(var n=this._types.length,i=0;i<n;i++)Ee(this,0),this._types.splice(0,1);Ce(this,t)}},{key:"toggleType",value:function(t,e){var n=me(t);if(null!=n){for(var i=0,o=n.length;i<o;i++){var s=this._types.indexOf(n[i]);-1!==s?(Ee(this,s),this._types.splice(s,1)):this._types.push(n[i])}Ce(this,e)}}},{key:"applyType",value:function(t,e){if(this.setPaintStyle(t.paintStyle),this.setHoverPaintStyle(t.hoverPaintStyle),this.mergeParameters(t.parameters),this.paintStyleInUse=this.getPaintStyle(),t.overlays){var n,i={};for(n in t.overlays){var o=this.overlays[t.overlays[n].options.id];if(o)o.updateFrom(t.overlays[n].options),i[t.overlays[n].options.id]=!0,this.instance.reattachOverlay(o,this);else{var s=this.getCachedTypeItem("overlay",t.overlays[n].options.id);null!=s?(this.instance.reattachOverlay(s,this),s.setVisible(!0),s.updateFrom(t.overlays[n].options),this.overlays[s.id]=s):s=this.addOverlay(t.overlays[n]),i[s.id]=!0}}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(t){this.paintStyle=t,this.paintStyleInUse=this.paintStyle,Se(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(t){this.hoverPaintStyle=t,Se(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(t){null!=t&&e(this.parameters,t)}},{key:"setVisible",value:function(t){this.visible=t,t?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(t,e){this.overlayPositions[t.id]=e}},{key:"getAbsoluteOverlayPosition",value:function(t){return this.overlayPositions?this.overlayPositions[t.id]:null}},{key:"_clazzManip",value:function(t,e){for(var n in this.overlays)"add"===t?this.instance.addOverlayClass(this.overlays[n],e):t===be&&this.instance.removeOverlayClass(this.overlays[n],e)}},{key:"addClass",value:function(t,e){var n=(this.cssClass||"").split(" ");n.push(t),this.cssClass=n.join(" "),this._clazzManip("add",t)}},{key:"removeClass",value:function(t,e){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter((function(e){return e!==t})).join(" "),this._clazzManip(be,t)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(t){this.data=t||{}}},{key:"mergeData",value:function(t){this.data=e(this.data,t)}},{key:"addOverlay",value:function(t){var n=function(t,n){var o=null;if(i(n))o=fe(t.instance,n,t,{});else if(null!=n.type&&null!=n.options){var s=n,r=e({},s.options);o=fe(t.instance,s.type,t,r)}else o=n;return o.id=o.id||C(),t.cacheTypeItem("overlay",o,o.id),t.overlays[o.id]=o,o}(this,t);if(this.getData&&n.type===ye.type&&!i(t)){var o=this.getData(),s=t.options;if(o){var r=o[s.labelLocationAttribute||"labelLocation"];r&&(n.location=r)}}return n}},{key:"getOverlay",value:function(t){return this.overlays[t]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i in e=e||[],this.overlays)0!==e.length&&-1===e.indexOf(i)||this.overlays[i].setVisible(!1)}},{key:"showOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!0)}},{key:"showOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i in e=e||[],this.overlays)0!==e.length&&-1===e.indexOf(i)||this.overlays[i].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(t,e){var n=this.overlays[t];n&&(n.setVisible(!1),e||this.instance.destroyOverlay(n),delete this.overlays[t],this.overlayPositions&&delete this.overlayPositions[t],this.overlayPlacements&&delete this.overlayPlacements[t])}},{key:"removeOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,o=e.length;i<o;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function(){var t=this.getLabelOverlay();return null!=t?t.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(ke)}},{key:"setLabel",value:function(t){var n,o,s,a=this.getLabelOverlay();if(a)if(i(t)||r(t))a.setLabel(t);else{var l=t;l.label&&a.setLabel(l.label),l.location&&(a.location=l.location)}else{var c=i(t)||r(t)?{label:t}:t;n=this,s=e({cssClass:(o=c).cssClass,id:ke,component:n},o),a=new ye(n.instance,n,s),this.overlays.__label=a}}}]),o}(B);!function(t){t.top="top",t.left="left",t.right="right",t.bottom="bottom"}(De||(De={}));var je=De.top,Te=De.left,Ie=De.right,Oe=De.bottom,Ge=[Te,Ie],Le=[je,Oe],Fe=function(){function t(e,n){ot(this,t),this.instance=e,this.element=n,at(this,"isFloating",!0),at(this,"isContinuous",void 0),at(this,"isDynamic",void 0),at(this,"locations",[]),at(this,"currentLocation",0),at(this,"locked",!1),at(this,"cssClass",""),at(this,"timestamp",null),at(this,"type","Floating"),at(this,"id",C()),at(this,"orientation",[0,0]),at(this,"size",void 0),this.size=e.getSize(n),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return rt(t,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(t){this.orientation=this.instance.router.getEndpointOrientation(t),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),t}(),He=(at(Pe={},je,Oe),at(Pe,Ie,Te),at(Pe,Te,Ie),at(Pe,Oe,je),Pe),Re=(at(we={},je,Ie),at(we,Ie,Oe),at(we,Te,je),at(we,Oe,Te),we),Ne=(at(Ae={},je,Te),at(Ae,Ie,je),at(Ae,Te,Oe),at(Ae,Oe,Ie),Ae);function Be(t){return 0===t.faces.length?je:t.faces[0]}function qe(t,e){return-1!==t.faces.indexOf(e)}function Xe(t,e){return null==t.lockedAxis?null==t.lockedFace?!0===qe(t,e):t.lockedFace===e:-1!==t.lockedAxis.indexOf(e)}function Ye(t,e){if(qe(t,e))return e;if(qe(t,He[e]))return He[e];var n=function(t,e){return(t.clockwise?Re:Ne)[e]}(t,e);if(qe(t,n))return n;var i=function(t,e){return(t.clockwise?Ne:Re)[e]}(t,e);return qe(t,i)?i:e}var Ve={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},ze={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},Ue={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},We={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},Je={Top:[Ve],Bottom:[ze],Left:[Ue],Right:[We],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[Ve,Ue,ze,We]},Ze={Continuous:{faces:[je,Te,Oe,Ie]},ContinuousTop:{faces:[je]},ContinuousRight:{faces:[Ie]},ContinuousBottom:{faces:[Oe]},ContinuousLeft:{faces:[Te]},ContinuousLeftRight:{faces:[Te,Ie]},ContinuousTopBottom:{faces:[je,Oe]}};function Ke(t,n){if(n=n||{},t===N.Perimeter)return function(t){var n=(t=t||{}).anchorCount||60,i=t.shape;if(!i)throw new Error("no shape supplied to Perimeter Anchor type");if(!rn.has(i))throw new Error("Shape ["+i+"] is unknown by Perimeter Anchor type");var o=rn.get(i)(n);t.rotation&&(o=function(t,e){for(var n=[],i=e/180*Math.PI,o=0;o<t.length;o++){var s=t[o].x-.5,r=t[o].y-.5;n.push({x:s*Math.cos(i)-r*Math.sin(i)+.5,y:s*Math.sin(i)+r*Math.cos(i)+.5,ox:t[o].ox,oy:t[o].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(o,t.rotation));return e($e(N.Perimeter,o,t),{shape:i})}(n);var i=Je[t];if(null!=i)return $e(t,P(i,(function(t){return e({iox:t.ox,ioy:t.oy},t)})),n);if(null!=(i=Ze[t]))return function(t,e,n){var i={type:t,locations:[],currentLocation:0,locked:!1,id:C(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||e,lockedFace:null,lockedAxis:null,clockwise:!(!1===n.clockwise),__currentFace:null};return Object.defineProperty(i,Qe,{get:function(){return this.__currentFace},set:function(t){this.__currentFace=Ye(this,t)}}),i}(t,i.faces,n);throw{message:"jsPlumb: unknown anchor type '"+t+"'"}}function $e(t,e,n){return{type:t,locations:e,currentLocation:0,locked:!1,id:C(),isFloating:!1,isContinuous:!1,isDynamic:e.length>1,timestamp:null,cssClass:n.cssClass||""}}var Qe="currentFace";function tn(t){return t.length<7&&t.every(n)||7===t.length&&t.slice(0,5).every(n)&&i(t[6])}function en(t){if(i(t))return Ke(t,null);if(Array.isArray(t)){if(tn(t)){var n=t;return $e(null,[{x:n[0],y:n[1],ox:n[2],oy:n[3],offx:null==n[4]?0:n[4],offy:null==n[5]?0:n[5],iox:n[2],ioy:n[3],cls:n[6]||""}],{cssClass:n[6]||""})}return $e("Dynamic",P(t,(function(t){if(i(t)){var n=Je[t];return null!=n?e({iox:n[0].ox,ioy:n[0].oy,cls:""},n[0]):null}if(tn(t))return{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}})).filter((function(t){return null!=t})),{})}var o=t;return Ke(o.type,o.options)}function nn(t){for(var e=.5,n=2*Math.PI/t,i=[],o=0,s=0;s<t;s++){var r=e+e*Math.sin(o),a=e+e*Math.cos(o);i.push({x:r,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),o+=n}return i}function on(t,e){for(var n=[],i=0;i<t.length;i++)n.push([t[i][0],t[i][1],t[i][2],t[i][3],1/t.length,t[i][4],t[i][5]]);return function(t,e){for(var n=e/t.length,i=[],o=function(t,o,s,r,a,l,c){for(var u=(s-t)/(n=e*a),h=(r-o)/n,d=0;d<n;d++)i.push({x:t+u*d,y:o+h*d,ox:null==l?0:l,oy:null==c?0:c,offx:0,offy:0,iox:0,ioy:0,cls:""})},s=0;s<t.length;s++)o.apply(null,t[s]);return i}(n,e)}function sn(t){return on([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],t)}var rn=new Map;rn.set(R.Circle,nn),rn.set(R.Ellipse,nn),rn.set(R.Rectangle,sn),rn.set(R.Square,sn),rn.set(R.Diamond,(function(t){return on([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],t)})),rn.set(R.Triangle,(function(t){return on([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],t)}));var an="anchors",ln="connector";function cn(t,e,n,i,o,s,r){var a;if(e)t.endpoints[n]=e,e.addConnection(t);else{var l=r||t.endpointSpec||t.endpointsSpec[n]||t.instance.defaults.endpoints[n]||t.instance.defaults.endpoint,c=t.endpointStyles[n]||t.endpointStyle||t.instance.defaults.endpointStyles[n]||t.instance.defaults.endpointStyle;null==c.fill&&null!=t.paintStyle&&(c.fill=t.paintStyle.stroke),null==c.outlineStroke&&null!=t.paintStyle&&(c.outlineStroke=t.paintStyle.outlineStroke),null==c.outlineWidth&&null!=t.paintStyle&&(c.outlineWidth=t.paintStyle.outlineWidth);var u=t.endpointHoverStyles[n]||t.endpointHoverStyle||t.endpointHoverStyle||t.instance.defaults.endpointHoverStyles[n]||t.instance.defaults.endpointHoverStyle;null!=t.hoverPaintStyle&&(null==u&&(u={}),null==u.fill&&(u.fill=t.hoverPaintStyle.stroke));var h=t.uuids?t.uuids[n]:null;i=null!=i?i:null!=t.instance.defaults.anchors?t.instance.defaults.anchors[n]:t.instance.defaults.anchor,a=t.instance._internal_newEndpoint({paintStyle:c,hoverPaintStyle:u,endpoint:l,connections:[t],uuid:h,element:o,scope:t.scope,anchor:i,reattachConnections:t.reattach||t.instance.defaults.reattachConnections,connectionsDetachable:t.detachable||t.instance.defaults.connectionsDetachable}),null==e&&(a.deleteOnEmpty=!0),t.endpoints[n]=a}return a}var un=function(t){lt(o,t);var n=pt(o);function o(t,i){var r;ot(this,o),(r=n.call(this,t,i)).instance=t,at(ht(r),"connector",void 0),at(ht(r),"defaultLabelLocation",.5),at(ht(r),"scope",void 0),at(ht(r),"typeId","_jsplumb_connection"),at(ht(r),"previousConnection",void 0),at(ht(r),"sourceId",void 0),at(ht(r),"targetId",void 0),at(ht(r),"source",void 0),at(ht(r),"target",void 0),at(ht(r),"detachable",!0),at(ht(r),"reattach",!1),at(ht(r),"uuids",void 0),at(ht(r),"cost",1),at(ht(r),"directed",void 0),at(ht(r),"endpoints",[null,null]),at(ht(r),"endpointStyles",void 0),at(ht(r),"endpointSpec",void 0),at(ht(r),"endpointsSpec",void 0),at(ht(r),"endpointStyle",{}),at(ht(r),"endpointHoverStyle",{}),at(ht(r),"endpointHoverStyles",void 0),at(ht(r),"suspendedEndpoint",void 0),at(ht(r),"suspendedIndex",void 0),at(ht(r),"suspendedElement",void 0),at(ht(r),"suspendedElementId",void 0),at(ht(r),"suspendedElementType",void 0),at(ht(r),"_forceReattach",void 0),at(ht(r),"_forceDetach",void 0),at(ht(r),"proxies",[]),at(ht(r),"pending",!1),r.id=i.id,r.previousConnection=i.previousConnection,r.source=i.source,r.target=i.target,i.sourceEndpoint?(r.source=i.sourceEndpoint.element,r.sourceId=i.sourceEndpoint.elementId):r.sourceId=t.getId(r.source),i.targetEndpoint?(r.target=i.targetEndpoint.element,r.targetId=i.targetEndpoint.elementId):r.targetId=t.getId(r.target),r.scope=i.scope;var a=i.anchors?i.anchors[0]:i.anchor,l=i.anchors?i.anchors[1]:i.anchor;t.manage(r.source),t.manage(r.target),r.visible=!0,r.params={cssClass:i.cssClass,hoverClass:i.hoverClass,"pointer-events":i["pointer-events"],overlays:i.overlays},r.lastPaintedAt=null,i.type&&(i.endpoints=i.endpoints||r.instance._deriveEndpointAndAnchorSpec(i.type).endpoints),r.endpointSpec=i.endpoint,r.endpointsSpec=i.endpoints||[null,null],r.endpointStyle=i.endpointStyle,r.endpointHoverStyle=i.endpointHoverStyle,r.endpointStyles=i.endpointStyles||[null,null],r.endpointHoverStyles=i.endpointHoverStyles||[null,null],r.paintStyle=i.paintStyle,r.hoverPaintStyle=i.hoverPaintStyle,r.uuids=i.uuids,r.makeEndpoint(!0,r.source,r.sourceId,a,i.sourceEndpoint),r.makeEndpoint(!1,r.target,r.targetId,l,i.targetEndpoint),r.scope||(r.scope=r.endpoints[0].scope),null!=i.deleteEndpointsOnEmpty&&(r.endpoints[0].deleteOnEmpty=i.deleteEndpointsOnEmpty,r.endpoints[1].deleteOnEmpty=i.deleteEndpointsOnEmpty);var c=r.instance.defaults.connectionsDetachable;!1===i.detachable&&(c=!1),!1===r.endpoints[0].connectionsDetachable&&(c=!1),!1===r.endpoints[1].connectionsDetachable&&(c=!1),r.endpointsSpec=i.endpoints||[null,null],r.endpointSpec=i.endpoint||null;var u=i.reattach||r.endpoints[0].reattachConnections||r.endpoints[1].reattachConnections||r.instance.defaults.reattachConnections;if(r.appendToDefaultType({detachable:c,reattach:u,paintStyle:r.endpoints[0].connectorStyle||r.endpoints[1].connectorStyle||i.paintStyle||r.instance.defaults.paintStyle,hoverPaintStyle:r.endpoints[0].connectorHoverStyle||r.endpoints[1].connectorHoverStyle||i.hoverPaintStyle||r.instance.defaults.hoverPaintStyle}),!r.instance._suspendDrawing){var h=r.instance._suspendedAt||C();r.instance._paintEndpoint(r.endpoints[0],{timestamp:h}),r.instance._paintEndpoint(r.endpoints[1],{timestamp:h})}r.cost=i.cost||r.endpoints[0].connectionCost,r.directed=i.directed,null==i.directed&&(r.directed=r.endpoints[0].connectionsDirected);var d=e({},r.endpoints[1].parameters);e(d,r.endpoints[0].parameters),e(d,r.parameters),r.parameters=d,r.paintStyleInUse=r.getPaintStyle()||{},r.setConnector(r.endpoints[0].connector||r.endpoints[1].connector||i.connector||r.instance.defaults.connector,!0);var p=null!=i.data&&s(i.data)?i.data:{};r.setData(p);var f=[tt,r.endpoints[0].edgeType,r.endpoints[1].edgeType,i.type].join(" ");return/[^\s]/.test(f)&&r.addType(f,i.data),r}return rt(o,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return"connectionOverlays"}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(t,e,n,i,o){return n=n||this.instance.getId(e),cn(this,o,t?0:1,i,e)}},{key:"getTypeDescriptor",value:function(){return o.type}},{key:"isDetachable",value:function(t){return!1!==this.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function(t){this.detachable=!0===t}},{key:"isReattach",value:function(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function(t){this.reattach=!0===t}},{key:"applyType",value:function(t,e){var n=null;null!=t.connector&&(null==(n=this.getCachedTypeItem(ln,e.connector))&&(n=this.prepareConnector(t.connector,e.connector),this.cacheTypeItem(ln,n,e.connector)),this.setPreparedConnector(n)),ft(ct(o.prototype),"applyType",this).call(this,t,e),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope);var i=null;t.anchor?null==(i=this.getCachedTypeItem(an,e.anchor))&&(i=[en(t.anchor),en(t.anchor)],this.cacheTypeItem(an,i,e.anchor)):t.anchors&&null==(i=this.getCachedTypeItem(an,e.anchors))&&(i=[en(t.anchors[0]),en(t.anchors[1])],this.cacheTypeItem(an,i,e.anchors)),null!=i&&(this.instance.router.setConnectionAnchors(this,i),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,t)}},{key:"addClass",value:function(t,e){ft(ct(o.prototype),"addClass",this).call(this,t),e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.instance.addConnectorClass(this.connector,t)}},{key:"removeClass",value:function(t,e){ft(ct(o.prototype),"removeClass",this).call(this,t),e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.instance.removeConnectorClass(this.connector,t)}},{key:"setVisible",value:function(t){ft(ct(o.prototype),"setVisible",this).call(this,t),this.connector&&this.instance.setConnectorVisible(this.connector,t),this.instance._paintConnection(this)}},{key:"destroy",value:function(){ft(ct(o.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(t,e){var n,o={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};if(i(t))n=this.instance._makeConnector(this,t,o);else{var s=t;n=this.instance._makeConnector(this,s.type,l(s.options,o))}return null!=e&&(n.typeId=e),n}},{key:"setPreparedConnector",value:function(t,e,n,i){if(this.connector!==t){var o,s="";if(null!=this.connector&&(o=this.connector,s=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=t,i&&this.cacheTypeItem(ln,t,i),this.addClass(s),null!=o){var r=this.getOverlays();for(var a in r)this.instance.reattachOverlay(r[a],this)}e||this.instance._paintConnection(this)}}},{key:"setConnector",value:function(t,e,n,i){var o=this.prepareConnector(t,i);this.setPreparedConnector(o,e,n,i)}},{key:"replaceEndpoint",value:function(t,e){var n=this.endpoints[t],i=(n.elementId,this.instance.getEndpoints(n.element)),o=i.indexOf(n),s=cn(this,null,t,null,n.element,0,e);this.endpoints[t]=s,i.splice(o,1,s),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire("endpoint:replaced",{previous:n,current:s})}}]),o}(Me);at(un,"type","connection");var hn=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],dn=function(t){lt(o,t);var n=pt(o);function o(t,e){var i;ot(this,o),(i=n.call(this,t,e)).instance=t,at(ht(i),"connections",[]),at(ht(i),"endpoint",void 0),at(ht(i),"element",void 0),at(ht(i),"elementId",void 0),at(ht(i),"dragAllowedWhenFull",!0),at(ht(i),"timestamp",void 0),at(ht(i),"portId",void 0),at(ht(i),"maxConnections",void 0),at(ht(i),"proxiedBy",void 0),at(ht(i),"connectorClass",void 0),at(ht(i),"connectorHoverClass",void 0),at(ht(i),"finalEndpoint",void 0),at(ht(i),"enabled",!0),at(ht(i),"isSource",void 0),at(ht(i),"isTarget",void 0),at(ht(i),"isTemporarySource",void 0),at(ht(i),"connectionCost",1),at(ht(i),"connectionsDirected",void 0),at(ht(i),"connectionsDetachable",void 0),at(ht(i),"reattachConnections",void 0),at(ht(i),"currentAnchorClass",void 0),at(ht(i),"referenceEndpoint",void 0),at(ht(i),"edgeType",void 0),at(ht(i),"connector",void 0),at(ht(i),"connectorOverlays",void 0),at(ht(i),"connectorStyle",void 0),at(ht(i),"connectorHoverStyle",void 0),at(ht(i),"deleteOnEmpty",void 0),at(ht(i),"uuid",void 0),at(ht(i),"scope",void 0),at(ht(i),"_anchor",void 0),at(ht(i),"defaultLabelLocation",[.5,.5]),i.appendToDefaultType({edgeType:e.edgeType,maxConnections:null==e.maxConnections?i.instance.defaults.maxConnections:e.maxConnections,paintStyle:e.paintStyle||i.instance.defaults.endpointStyle,hoverPaintStyle:e.hoverPaintStyle||i.instance.defaults.endpointHoverStyle,connectorStyle:e.connectorStyle,connectorHoverStyle:e.connectorHoverStyle,connectorClass:e.connectorClass,connectorHoverClass:e.connectorHoverClass,connectorOverlays:e.connectorOverlays,connector:e.connector}),i.enabled=!(!1===e.enabled),i.visible=!0,i.element=e.element,i.uuid=e.uuid,i.portId=e.portId,i.elementId=e.elementId,i.connectionCost=null==e.connectionCost?1:e.connectionCost,i.connectionsDirected=e.connectionsDirected,i.currentAnchorClass="",i.events={},i.connectorOverlays=e.connectorOverlays,i.connectorStyle=e.connectorStyle,i.connectorHoverStyle=e.connectorHoverStyle,i.connector=e.connector,i.edgeType=e.edgeType,i.connectorClass=e.connectorClass,i.connectorHoverClass=e.connectorHoverClass,i.deleteOnEmpty=!0===e.deleteOnEmpty,i.isSource=e.source||!1,i.isTemporarySource=e.isTemporarySource||!1,i.isTarget=e.target||!1,i.connections=e.connections||[],i.scope=e.scope||t.defaultScope,i.timestamp=null,i.reattachConnections=e.reattachConnections||t.defaults.reattachConnections,i.connectionsDetachable=t.defaults.connectionsDetachable,!1===e.connectionsDetachable&&(i.connectionsDetachable=!1),i.dragAllowedWhenFull=!1!==e.dragAllowedWhenFull,e.onMaxConnections&&i.bind(re,e.onMaxConnections);var s=e.endpoint||e.existingEndpoint||t.defaults.endpoint;if(i.setEndpoint(s),null!=e.preparedAnchor)i.setPreparedAnchor(e.preparedAnchor);else{var r=e.anchor?e.anchor:e.anchors?e.anchors:t.defaults.anchor||N.Top;i.setAnchor(r)}var a=[tt,e.type||""].join(" ");return i.addType(a,e.data),i}return rt(o,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var t=this._anchor&&this._anchor.cssClass;if(null!=t&&t.length>0){var e=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=t;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");e!==n&&(this.removeClass(e),this.addClass(n),this.instance.removeClass(this.element,e),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(t){return this.instance.router.setAnchor(this,t),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(t){this.fire("anchor:changed",{endpoint:this,anchor:t}),this._updateAnchorClass()}},{key:"setAnchor",value:function(t){var e=this.instance.router.prepareAnchor(t);return this.setPreparedAnchor(e),this}},{key:"addConnection",value:function(t){var e=this.isFull(),n=0===this.connections.length;this.connections.push(t),n&&this.addClass(this.instance.endpointConnectedClass),this.isFull()?e||this.addClass(this.instance.endpointFullClass):e&&this.removeClass(this.instance.endpointFullClass)}},{key:"detachFromConnection",value:function(t,e,n){(e=null==e?this.connections.indexOf(t):e)>=0&&(this.connections.splice(e,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(t){for(var e=this.connections.length,n=0;n<e;n++)this.instance.deleteConnection(this.connections[0],t)}},{key:"detachFrom",value:function(t){for(var e=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==t&&this.connections[n].endpoints[0]!==t||e.push(this.connections[n]);for(var i=0,o=e.length;i<o;i++)this.instance.deleteConnection(e[0]);return this}},{key:"setVisible",value:function(t,e,n){if(ft(ct(o.prototype),"setVisible",this).call(this,t),this.endpoint.setVisible(t),t?this.showOverlays():this.hideOverlays(),!e)for(var i=0;i<this.connections.length;i++)if(this.connections[i].setVisible(t),!n){var s=this===this.connections[i].endpoints[0]?1:0;1===this.connections[i].endpoints[s].connections.length&&this.connections[i].endpoints[s].setVisible(t,!0,!0)}}},{key:"applyType",value:function(t,n){ft(ct(o.prototype),"applyType",this).call(this,t,n),this.setPaintStyle(t.endpointStyle||t.paintStyle),this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle),this.connectorStyle=t.connectorStyle,this.connectorHoverStyle=t.connectorHoverStyle,this.connector=t.connector,this.connectorOverlays=t.connectorOverlays,this.edgeType=t.edgeType,null!=t.maxConnections&&(this.maxConnections=t.maxConnections),t.scope&&(this.scope=t.scope),e(t,hn),this.instance.applyEndpointType(this,t)}},{key:"destroy",value:function(){ft(ct(o.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(t){var e=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=!0;break}return e}},{key:"setDragAllowedWhenFull",value:function(t){this.dragAllowedWhenFull=t}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(t,n){var o,s={cssClass:this.cssClass,endpoint:this};if(M(t,Ct)){var r=t;o=bt.clone(r)}else if(i(t))o=bt.get(this,t,s);else{var a=t;e(s,a.options||{}),o=bt.get(this,a.type,s)}return o.typeId=n,o}},{key:"setEndpoint",value:function(t){var e=this.prepareEndpoint(t);this.setPreparedEndpoint(e)}},{key:"setPreparedEndpoint",value:function(t){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=t}},{key:"addClass",value:function(t,e){ft(ct(o.prototype),"addClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.addClass(t)}},{key:"removeClass",value:function(t,e){ft(ct(o.prototype),"removeClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.removeClass(t)}}]),o}(Me),pn=function t(e,n){ot(this,t),this.instance=e,this.el=n,at(this,"group",void 0)},fn=function(t){lt(n,t);var e=pt(n);function n(t,i,o){var s;ot(this,n),(s=e.call(this,t,i)).instance=t,at(ht(s),"children",[]),at(ht(s),"collapsed",!1),at(ht(s),"droppable",void 0),at(ht(s),"enabled",void 0),at(ht(s),"orphan",void 0),at(ht(s),"constrain",void 0),at(ht(s),"proxied",void 0),at(ht(s),"ghost",void 0),at(ht(s),"revert",void 0),at(ht(s),"prune",void 0),at(ht(s),"dropOverride",void 0),at(ht(s),"anchor",void 0),at(ht(s),"endpoint",void 0),at(ht(s),"connections",{source:[],target:[],internal:[]}),at(ht(s),"manager",void 0),at(ht(s),"id",void 0),at(ht(s),"elId",void 0);var r=s.el;return r._isJsPlumbGroup=!0,r._jsPlumbGroup=ht(s),s.elId=t.getId(i),s.orphan=!0===o.orphan,s.revert=!0!==s.orphan&&!1!==o.revert,s.droppable=!1!==o.droppable,s.ghost=!0===o.ghost,s.enabled=!1!==o.enabled,s.prune=!0!==s.orphan&&!0===o.prune,s.constrain=s.ghost||!0===o.constrain,s.proxied=!1!==o.proxied,s.id=o.id||C(),s.dropOverride=!0===o.dropOverride,s.anchor=o.anchor,s.endpoint=o.endpoint,s.anchor=o.anchor,t.setAttribute(i,Yt,""),s}return rt(n,[{key:"overrideDrop",value:function(t,e){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(t,e){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(t,e){return this.endpoint||{type:Et.type,options:{radius:10}}}},{key:"add",value:function(t,e){var n=this.instance.getGroupContentArea(this),i=t;if(null!=i._jsPlumbParentGroup){if(i._jsPlumbParentGroup===this)return;i._jsPlumbParentGroup.remove(t,!0,e,!1)}i._jsPlumbParentGroup=this,this.children.push(new pn(this.instance,t)),this.instance._appendElement(i,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(t){return null==t?null:p(this.children,(function(e){return e.el===t}))}},{key:"remove",value:function(t,e,n,i,o){var s=this.resolveNode(t);null!=s&&this._doRemove(s,e,n,i,o)}},{key:"_doRemove",value:function(t,e,n,i,o){var s=t.el;if(delete s._jsPlumbParentGroup,y(this.children,(function(e){return e===t})),e)try{this.instance.getGroupContentArea(this).removeChild(s)}catch(t){w("Could not remove element from Group "+t)}if(!n){var r={group:this,el:s};o&&(r.targetGroup=o),this.instance.fire("group:member:removed",r)}i||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(t,e){for(var n=0,i=this.children.length;n<i;n++){var o=this.children[0];this._doRemove(o,t,e,!0),this.instance.unmanage(o.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var t={},e=0;e<this.children.length;e++){var n=this.manager.orphan(this.children[e].el,!1);t[n.id]=n.pos}return this.children.length=0,t}},{key:"addGroup",value:function(t){if(this.instance.allowNestedGroups&&t!==this){if(this.instance.groupManager.isAncestor(this,t))return!1;null!=t.group&&t.group.removeGroup(t);var e=this.instance.getId(t.el);this.instance.getManagedElements()[e].group=this.elId;var n=this.instance.getOffsetRelativeToRoot(t.el),i=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));t.el._jsPlumbParentGroup=this,this.children.push(t),this.instance._appendElement(t.el,this.instance.getGroupContentArea(this)),t.group=this;var o={x:n.x-i.x,y:n.y-i.y};return this.instance.setPosition(t.el,o),this.instance.fire("group:nested:added",{parent:this,child:t}),!0}return!1}},{key:"removeGroup",value:function(t){if(t.group===this){var e=t.el,n=this.instance.getGroupContentArea(this);n===e.parentNode&&n.removeChild(t.el);var i=this.instance.getId(t.el),o=this.instance.getManagedElements()[i];o&&delete o.group,this.children=this.children.filter((function(e){return e.id!==t.id})),delete t.group,delete e._jsPlumbParentGroup,this.instance.fire("group:nested:removed",{parent:this,child:t})}}},{key:"getGroups",value:function(){return this.children.filter((function(t){return t.constructor===n}))}},{key:"getNodes",value:function(){return this.children.filter((function(t){return t.constructor===pn}))}},{key:"collapseParent",get:function(){var t=null;if(null==this.group)return null;for(var e=this.group;null!=e;)e.collapsed&&(t=e),e=e.group;return t}}]),n}(pn),vn=function(){function t(e){var n=this;ot(this,t),this.instance=e,at(this,"groupMap",{}),at(this,"_connectionSourceMap",{}),at(this,"_connectionTargetMap",{}),e.bind(ee,(function(t){var e=n.getGroupFor(t.source),i=n.getGroupFor(t.target);null!=e&&null!=i&&e===i?(n._connectionSourceMap[t.connection.id]=e,n._connectionTargetMap[t.connection.id]=e,x(e.connections.internal,t.connection)):(null!=e&&(t.target._jsPlumbGroup===e?x(e.connections.internal,t.connection):x(e.connections.source,t.connection),n._connectionSourceMap[t.connection.id]=e),null!=i&&(t.source._jsPlumbGroup===i?x(i.connections.internal,t.connection):x(i.connections.target,t.connection),n._connectionTargetMap[t.connection.id]=i))})),e.bind(oe,(function(t){n._cleanupDetachedConnection(t.connection)})),e.bind(ne,(function(t){var e=t.originalEndpoint.element,i=n.getGroupFor(e),o=t.connection.endpoints[t.index].element,s=n.getGroupFor(o),r=0===t.index?n._connectionSourceMap:n._connectionTargetMap,a=0===t.index?n._connectionTargetMap:n._connectionSourceMap;null!=s?(r[t.connection.id]=s,t.connection.source===t.connection.target&&(a[t.connection.id]=s)):(delete r[t.connection.id],t.connection.source===t.connection.target&&delete a[t.connection.id]),null!=i&&n._updateConnectionsForGroup(i),null!=s&&n._updateConnectionsForGroup(s)}))}return rt(t,[{key:"_cleanupDetachedConnection",value:function(t){t.proxies.length=0;var e,n=this._connectionSourceMap[t.id];null!=n&&(e=function(e){return e.id===t.id},y(n.connections.source,e),y(n.connections.target,e),y(n.connections.internal,e),delete this._connectionSourceMap[t.id]),null!=(n=this._connectionTargetMap[t.id])&&(e=function(e){return e.id===t.id},y(n.connections.source,e),y(n.connections.target,e),y(n.connections.internal,e),delete this._connectionTargetMap[t.id])}},{key:"addGroup",value:function(t){var e=t.el;if(null!=this.groupMap[t.id])throw new Error("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=e._isJsPlumbGroup)throw new Error("cannot create Group ["+t.id+"]; the given element is already a Group");var n=new fn(this.instance,t.el,t);return this.groupMap[n.id]=n,t.collapsed&&this.collapseGroup(n),this.instance.manage(n.el),this.instance.addClass(n.el,Qt),n.manager=this,this._updateConnectionsForGroup(n),this.instance.fire("group:added",{group:n}),n}},{key:"getGroup",value:function(t){var e=t;if(i(t)&&null==(e=this.groupMap[t]))throw new Error("No such group ["+t+"]");return e}},{key:"getGroupFor",value:function(t){for(var e=t,n=this.instance.getContainer(),i=!1,o=null;!i;)null==e||e===n?i=!0:e._jsPlumbParentGroup?(o=e._jsPlumbParentGroup,i=!0):e=e.parentNode;return o}},{key:"getGroups",value:function(){var t=[];for(var e in this.groupMap)t.push(this.groupMap[e]);return t}},{key:"removeGroup",value:function(t,e,n,i){var o=this,s=this.getGroup(t);this.expandGroup(s,!0);var r={};return h(s.children,(function(t){var e=o.instance.getManagedElements()[o.instance.getId(t.el)];e&&delete e.group})),e?(h(s.getGroups(),(function(t){return o.removeGroup(t,e,n)})),s.removeAll(n,i)):(s.group&&h(s.children,(function(t){return s.group.add(t.el)})),r=s.orphanAll()),s.group&&s.group.removeGroup(s),this.instance.unmanage(s.el,!0),delete this.groupMap[s.id],this.instance.fire("group:removed",{group:s}),r}},{key:"removeAllGroups",value:function(t,e,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],t,e,n)}},{key:"forEach",value:function(t){for(var e in this.groupMap)t(this.groupMap[e])}},{key:"orphan",value:function(t,e){var n=t;if(n._jsPlumbParentGroup){var i=n._jsPlumbParentGroup,o=this.instance.getOffset(n),s=this.instance.getId(n),r=this.instance.getOffset(t);return n.parentNode.removeChild(n),!0!==e&&i.group?(r.x+=o.x,r.y+=o.y,this.instance.getGroupContentArea(i.group).appendChild(t)):this.instance._appendElement(t,this.instance.getContainer()),this.instance.setPosition(t,r),delete n._jsPlumbParentGroup,{id:s,pos:r}}}},{key:"_updateConnectionsForGroup",value:function(t){var e=this;t.connections.source.length=0,t.connections.target.length=0,t.connections.internal.length=0;var n=t.children.slice().map((function(t){return t.el})),i=[];if(h(n,(function(t){Array.prototype.push.apply(i,e.instance.getSelector(t,ue))})),Array.prototype.push.apply(n,i),n.length>0){var o,s,r=this.instance.getConnections({source:n,scope:it},!0),a=this.instance.getConnections({target:n,scope:it},!0),l={},c=function(n){for(var i=0;i<n.length;i++)l[n[i].id]||(l[n[i].id]=!0,o=e.getGroupFor(n[i].source),s=e.getGroupFor(n[i].target),n[i].source===t.el&&s===t||n[i].target===t.el&&o===t?t.connections.internal.push(n[i]):o===t?(s!==t?t.connections.source.push(n[i]):t.connections.internal.push(n[i]),e._connectionSourceMap[n[i].id]=t):s===t&&(t.connections.target.push(n[i]),e._connectionTargetMap[n[i].id]=t))};c(r),c(a)}}},{key:"_collapseConnection",value:function(t,e,n){var i=t.endpoints[0===e?1:0].element;if(i._jsPlumbParentGroup&&!i._jsPlumbParentGroup.proxied&&i._jsPlumbParentGroup.collapsed)return!1;var o=t.endpoints[0].element._jsPlumbParentGroup,s=null!=o?o.collapseParent||o:null,r=t.endpoints[1].element._jsPlumbParentGroup,a=null!=r?r.collapseParent||r:null;if(null==s||null==a||s.id!==a.id){var l=n.el;return this.instance.getId(l),this.instance.proxyConnection(t,e,l,(function(t,e){return n.getEndpoint(t,e)}),(function(t,e){return n.getAnchor(t,e)})),!0}return!1}},{key:"_expandConnection",value:function(t,e,n){this.instance.unproxyConnection(t,e)}},{key:"isElementDescendant",value:function(t,e){for(var n=this.instance.getContainer();;){if(null==t||t===n)return!1;if(t===e)return!0;t=t.parentNode}}},{key:"collapseGroup",value:function(t){var e=this,n=this.getGroup(t);if(null!=n&&!n.collapsed){var i=n.el;if(null==n.collapseParent){if(this.instance.setGroupVisible(n,!1),n.collapsed=!0,this.instance.removeClass(i,Qt),this.instance.addClass(i,$t),n.proxied){var o=new Set,s=function(t,i){for(var s=0;s<t.length;s++){var r=t[s];!0===e._collapseConnection(r,i,n)&&o.add(r.id)}};s(n.connections.source,0),s(n.connections.target,1),h(n.getGroups(),(function(t){e.cascadeCollapse(n,t,o)}))}this.instance.revalidate(i),this.repaintGroup(n),this.instance.fire("group:collapse",{group:n})}else n.collapsed=!0,this.instance.removeClass(i,Qt),this.instance.addClass(i,$t)}}},{key:"cascadeCollapse",value:function(t,e,n){var i=this;if(t.proxied){var o=function(e,o){for(var s=0;s<e.length;s++){var r=e[s];n.has(r.id)||!0===i._collapseConnection(r,o,t)&&n.add(r.id)}};o(e.connections.source,0),o(e.connections.target,1)}h(e.getGroups(),(function(e){i.cascadeCollapse(t,e,n)}))}},{key:"expandGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(null!=i){var o=i.el;if(null==i.collapseParent){if(this.instance.setGroupVisible(i,!0),i.collapsed=!1,this.instance.addClass(o,Qt),this.instance.removeClass(o,$t),i.proxied){var s=function(t,e){for(var o=0;o<t.length;o++){var s=t[o];n._expandConnection(s,e,i)}};s(i.connections.source,0),s(i.connections.target,1);h(i.getGroups(),(function t(e,i){if(i||e.collapsed){var o=function(t,i){for(var o=0;o<t.length;o++){var s=t[o];n._collapseConnection(s,i,e.collapseParent||e)}};o(e.connections.source,0),o(e.connections.target,1),h(e.connections.internal,(function(t){return t.setVisible(!1)})),h(e.getGroups(),(function(e){return t(e,!0)}))}else n.expandGroup(e,!0)}))}this.instance.revalidate(o),this.repaintGroup(i),e||this.instance.fire("group:expand",{group:i})}else i.collapsed=!1,this.instance.addClass(o,Qt),this.instance.removeClass(o,$t)}}},{key:"toggleGroup",value:function(t){null!=(t=this.getGroup(t))&&(t.collapsed?this.expandGroup(t):this.collapseGroup(t))}},{key:"repaintGroup",value:function(t){for(var e=this.getGroup(t).children,n=0;n<e.length;n++)this.instance.revalidate(e[n].el)}},{key:"addToGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=i.el,s=function(t){var s=t,r=null!=s._isJsPlumbGroup,a=s._jsPlumbGroup,l=s._jsPlumbParentGroup;if(l!==i){var c=n.instance.manage(t),u=n.instance.getOffset(t),h=i.collapsed?n.instance.getOffsetRelativeToRoot(o):n.instance.getOffset(n.instance.getGroupContentArea(i));c.group=i.elId,null!=l&&(l.remove(t,!1,e,!1,i),n._updateConnectionsForGroup(l)),r?i.addGroup(a):i.add(t,e);var d=function(t,e){var o=0===e?1:0;t.each((function(t){t.setVisible(!1),t.endpoints[o].element._jsPlumbGroup===i?(t.endpoints[o].setVisible(!1),n._expandConnection(t,o,i)):(t.endpoints[e].setVisible(!1),n._collapseConnection(t,e,i))}))};i.collapsed&&(d(n.instance.select({source:t}),0),d(n.instance.select({target:t}),1)),n.instance.getId(t);var p={x:u.x-h.x,y:u.y-h.y};if(n.instance.setPosition(t,p),n._updateConnectionsForGroup(i),n.instance.revalidate(t),!e){var f={group:i,el:t,pos:p};l&&(f.sourceGroup=l),n.instance.fire(se,f)}}},r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];h(a,s)}}},{key:"removeFromGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=function(t){if(i.collapsed){var o=function(e,o){for(var s=0;s<e.length;s++){var r=e[s];if(r.proxies)for(var a=0;a<r.proxies.length;a++)if(null!=r.proxies[a]){var l=r.proxies[a].originalEp.element;(l===t||n.isElementDescendant(l,t))&&n._expandConnection(r,o,i)}}};o(i.connections.source.slice(),0),o(i.connections.target.slice(),1)}i.remove(t,null,e);var s=n.instance.getManagedElements()[n.instance.getId(t)];s&&delete s.group},s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];h(r,o)}}},{key:"getAncestors",value:function(t){for(var e=[],n=t.group;null!=n;)e.push(n),n=n.group;return e}},{key:"isAncestor",value:function(t,e){return null!=t&&null!=e&&-1!==this.getAncestors(t).indexOf(e)}},{key:"getDescendants",value:function(t){var e=[];return function t(n){var i=n.getGroups();e.push.apply(e,yt(i)),h(i,t)}(t),e}},{key:"isDescendant",value:function(t,e){return null!=t&&null!=e&&-1!==this.getDescendants(e).indexOf(t)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),t}(),yn=function(){function t(e,n){ot(this,t),this.instance=e,this.entries=n}return rt(t,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(t){return h(this.entries,(function(e){return t(e)})),this}},{key:"get",value:function(t){return this.entries[t]}},{key:"addClass",value:function(t,e){return this.each((function(n){return n.addClass(t,e)})),this}},{key:"removeClass",value:function(t,e){return this.each((function(n){return n.removeClass(t,e)})),this}},{key:"removeAllOverlays",value:function(){return this.each((function(t){return t.removeAllOverlays()})),this}},{key:"setLabel",value:function(t){return this.each((function(e){return e.setLabel(t)})),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(t){var e=[];return this.each((function(n){return e.push(t(n))})),e}},{key:"addOverlay",value:function(t){return this.each((function(e){return e.addOverlay(t)})),this}},{key:"removeOverlay",value:function(t){return this.each((function(e){return e.removeOverlay(t)})),this}},{key:"removeOverlays",value:function(){return this.each((function(t){return t.removeOverlays()})),this}},{key:"showOverlay",value:function(t){return this.each((function(e){return e.showOverlay(t)})),this}},{key:"hideOverlay",value:function(t){return this.each((function(e){return e.hideOverlay(t)})),this}},{key:"setPaintStyle",value:function(t){return this.each((function(e){return e.setPaintStyle(t)})),this}},{key:"setHoverPaintStyle",value:function(t){return this.each((function(e){return e.setHoverPaintStyle(t)})),this}},{key:"setSuspendEvents",value:function(t){return this.each((function(e){return e.setSuspendEvents(t)})),this}},{key:"setParameter",value:function(t,e){return this.each((function(n){return n.parameters[t]=e})),this}},{key:"setParameters",value:function(t){return this.each((function(e){return e.parameters=t})),this}},{key:"setVisible",value:function(t){return this.each((function(e){return e.setVisible(t)})),this}},{key:"addType",value:function(t){return this.each((function(e){return e.addType(t)})),this}},{key:"toggleType",value:function(t){return this.each((function(e){return e.toggleType(t)})),this}},{key:"removeType",value:function(t){return this.each((function(e){return e.removeType(t)})),this}},{key:"bind",value:function(t,e){return this.each((function(n){return n.bind(t,e)})),this}},{key:"unbind",value:function(t,e){return this.each((function(n){return n.unbind(t,e)})),this}},{key:"setHover",value:function(t){var e=this;return this.each((function(n){return e.instance.setHover(n,t)})),this}}]),t}(),gn=function(t){lt(n,t);var e=pt(n);function n(){return ot(this,n),e.apply(this,arguments)}return rt(n,[{key:"setEnabled",value:function(t){return this.each((function(e){return e.enabled=t})),this}},{key:"setAnchor",value:function(t){return this.each((function(e){return e.setAnchor(t)})),this}},{key:"deleteEveryConnection",value:function(){return this.each((function(t){return t.deleteEveryConnection()})),this}},{key:"deleteAll",value:function(){var t=this;return this.each((function(e){return t.instance.deleteEndpoint(e)})),this.clear(),this}}]),n}(yn),mn=function(t){lt(n,t);var e=pt(n);function n(){return ot(this,n),e.apply(this,arguments)}return rt(n,[{key:"setDetachable",value:function(t){return this.each((function(e){return e.setDetachable(t)})),this}},{key:"setReattach",value:function(t){return this.each((function(e){return e.setReattach(t)})),this}},{key:"setConnector",value:function(t){return this.each((function(e){return e.setConnector(t)})),this}},{key:"deleteAll",value:function(){var t=this;this.each((function(e){return t.instance.deleteConnection(e)})),this.clear()}},{key:"repaint",value:function(){var t=this;return this.each((function(e){return t.instance._paintConnection(e)})),this}}]),n}(yn),_n=function t(){ot(this,t),at(this,"affectedElements",new Set)};function xn(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var kn=function(t,e){var n=0;return e[1]>t[1]?n=-1:e[1]<t[1]&&(n=1),n},bn=function(t,e){return-1*kn(t,e)};function Cn(t,e,n,i){!function(t,e,n,i){if(0===e.length)e.push(t);else{for(var o=i?-1:1,s=0,r=e.length,a=Math.floor((s+r)/2);r>s;)n(t,e[a])*o<0?r=a:s=a+1,a=Math.floor((s+r)/2);e.splice(a,0,t)}}([t,e],n,kn,i)}function En(t,e){var n=d(e,(function(e){return e[0]===t}));n>-1&&e.splice(n,1)}var Sn,Pn=function(t){lt(n,t);var e=pt(n);function n(t){var i;return ot(this,n),(i=e.call(this)).instance=t,at(ht(i),"_currentTransaction",null),at(ht(i),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),at(ht(i),"_elementMap",new Map),at(ht(i),"_transformedElementMap",new Map),at(ht(i),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),i}return rt(n,[{key:"_updateBounds",value:function(t,e,n){null!=e&&(En(t,this._sortedElements.xmin),En(t,this._sortedElements.xmax),En(t,this._sortedElements.ymin),En(t,this._sortedElements.ymax),Cn(t,e.t.x,this._sortedElements.xmin,!1),Cn(t,e.t.x+e.t.w,this._sortedElements.xmax,!0),Cn(t,e.t.y,this._sortedElements.ymin,!1),Cn(t,e.t.y+e.t.h,this._sortedElements.ymax,!0),!0!==n&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var t=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach((function(e,n){t._sortedElements.xmin.push([n,e.t.x]),t._sortedElements.xmax.push([n,e.t.x+e.t.w]),t._sortedElements.ymin.push([n,e.t.y]),t._sortedElements.ymax.push([n,e.t.y+e.t.h])})),this._sortedElements.xmin.sort(kn),this._sortedElements.ymin.sort(kn),this._sortedElements.xmax.sort(bn),this._sortedElements.ymax.sort(bn),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(t,e,n){var i,o,s,r,a,l,c,u,h,d,p,f,v,y,g,m,_,x,k;e.t=(i=e.x,o=e.y,s=e.w,r=e.h,a=e.r,l=i+s/2,c=o+r/2,u=Math.cos(a/360*Math.PI*2),h=Math.sin(a/360*Math.PI*2),d=function(t,e){return{x:l+Math.round((t-l)*u-(e-c)*h),y:c+Math.round((e-c)*u-(t-l)*h)}},p=d(i,o),f=d(i+s,o),v=d(i+s,o+r),y=d(i,o+r),g=d(i+s/2,o+r/2),m=Math.min(p.x,f.x,v.x,y.x),_=Math.max(p.x,f.x,v.x,y.x),x=Math.min(p.y,f.y,v.y,y.y),k=Math.max(p.y,f.y,v.y,y.y),{x:m,y:x,w:_-m,h:k-x,c:g,r:a,x2:_,y2:k,cr:u,sr:h}),this._transformedElementMap.set(t,e.t),!0!==n&&this._updateBounds(t,e,n)}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new _n}},{key:"endTransaction",value:function(){var t=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach((function(e){var n=t.getPosition(e);t._finaliseUpdate(e,n,!0)})),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(t){var e=this;h(t,(function(t){return e.updateElement(t.id,t.x,t.y,t.width,t.height,t.rotation)}))}},{key:"updateElement",value:function(t,e,n,i,o,s,r){var a=D(this._elementMap,t,xn);return a.dirty=null==e&&null==a.x||null==n&&null==a.y||null==i&&null==a.w||null==o&&null==a.h,null!=e&&(a.x=e),null!=n&&(a.y=n),null!=i&&(a.w=i),null!=o&&(a.h=o),null!=s&&(a.r=s||0),a.c.x=a.x+a.w/2,a.c.y=a.y+a.h/2,a.x2=a.x+a.w,a.y2=a.y+a.h,null==this._currentTransaction?this._finaliseUpdate(t,a,r):this._currentTransaction.affectedElements.add(t),a}},{key:"refreshElement",value:function(t,e){var n=this.instance.getManagedElements(),i=n[t]?n[t].el:null;if(null!=i){var o=this.getSize(i),s=this.getOffset(i);return this.updateElement(t,s.x,s.y,o.w,o.h,null,e)}return null}},{key:"getSize",value:function(t){return this.instance.getSize(t)}},{key:"getOffset",value:function(t){return this.instance.getOffset(t)}},{key:"registerElement",value:function(t,e){return this.updateElement(t,0,0,0,0,0,e)}},{key:"addElement",value:function(t,e,n,i,o,s){return this.updateElement(t,e,n,i,o,s)}},{key:"rotateElement",value:function(t,e){var n=D(this._elementMap,t,xn);return n.r=e||0,this._finaliseUpdate(t,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,null,null,e,n,null)}},{key:"setPosition",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,e,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(t){En(t,this._sortedElements.xmin),En(t,this._sortedElements.xmax),En(t,this._sortedElements.ymin),En(t,this._sortedElements.ymax),this._elementMap.delete(t),this._transformedElementMap.delete(t),this._recalculateBounds()}},{key:"getPosition",value:function(t){return this._elementMap.get(t)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]),n}(B),wn=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];ot(this,t),this.selector=e,this.def=n,this.exclude=i,at(this,"id",void 0),this.id=C()}return rt(t,[{key:"setEnabled",value:function(t){this.def.enabled=t}},{key:"isEnabled",value:function(){return!1!==this.def.enabled}}]),t}(),An=function(t){lt(n,t);var e=pt(n);function n(t,i,o){var s;return ot(this,n),(s=e.call(this,t,i,o)).def=i,at(ht(s),"redrop",void 0),s.redrop=i.def.redrop||"strict",s}return n}(wn),Dn=function(t){lt(n,t);var e=pt(n);function n(t,i,o){var s;return ot(this,n),(s=e.call(this,t,i,o)).def=i,s}return n}(wn);function Mn(t,e){return e.theta-t.theta}function jn(t,e){return(t.theta<0?-Math.PI-t.theta:Math.PI-t.theta)-(e.theta<0?-Math.PI-e.theta:Math.PI-e.theta)}var Tn=(at(Sn={},je,jn),at(Sn,Ie,Mn),at(Sn,Oe,Mn),at(Sn,Te,jn),Sn);function In(t){return!0===t.isContinuous}function On(t){return!0===t.isContinuous}function Gn(t){return t.locations.length>1}function Ln(t){return[t.currentLocation,t.locations[t.currentLocation]]}var Fn=function(){function t(e){var n=this;ot(this,t),this.instance=e,at(this,"anchorLists",new Map),at(this,"anchorLocations",new Map),e.bind(oe,(function(t){t.sourceEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(t.sourceEndpoint),t.targetEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(t.targetEndpoint)})),e.bind(ie,(function(t){n._removeEndpointFromAnchorLists(t)}))}return rt(t,[{key:"getAnchorOrientation",value:function(t){var e=this.anchorLocations.get(t.id);return e?[e.ox,e.oy]:[0,0]}},{key:"_distance",value:function(t,e,n,i,o,s,r){var a=i.x+t.x*o.w,l=i.y+t.y*o.h,c=i.x+o.w/2,u=i.y+o.h/2;if(null!=s&&s.length>0){var h=this.instance._applyRotations([a,l,0,0],s);a=h.x,l=h.y}return Math.sqrt(Math.pow(e-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(c-a,2)+Math.pow(u-l,2))}},{key:"_anchorSelector",value:function(t,e,n,i,o,s,r){for(var a=n.x+i.w/2,l=n.y+i.h/2,c=-1,u=1/0,h=0;h<r.length;h++){var d=this._distance(r[h],a,l,t,e,o,s);d<u&&(c=h+0,u=d)}return[c,r[c]]}},{key:"_floatingAnchorCompute",value:function(t,e){var n=e.xy,i={curX:n.x+t.size.w/2,curY:n.y+t.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(t,i)}},{key:"_setComputedPosition",value:function(t,e,n){return this.anchorLocations.set(t.id,e),t.computedPosition=e,n&&(t.timestamp=n),e}},{key:"_computeSingleLocation",value:function(t,n,i,o){var s,r={curX:n.x+t.x*i.w+t.offx,curY:n.y+t.y*i.h+t.offy,x:t.x,y:t.y,ox:0,oy:0},a=o.rotation;if(null!=a&&a.length>0){var l=[t.iox,t.ioy],c={x:r.curX,y:r.curY,cr:0,sr:0};h(a,(function(t){c=E(c,t.c,t.r);var e=[Math.round(l[0]*c.cr-l[1]*c.sr),Math.round(l[1]*c.cr+l[0]*c.sr)];l=e.slice()})),t.ox=l[0],t.oy=l[1],s={curX:c.x,curY:c.y,x:t.x,y:t.y,ox:l[0],oy:l[1]}}else t.ox=t.iox,t.oy=t.ioy,s=e({ox:t.iox,oy:t.ioy},r);return s}},{key:"_singleAnchorCompute",value:function(t,e){var n=e.xy,i=e.wh,o=e.timestamp,s=this.anchorLocations.get(t.id);if(null!=s&&o&&o===t.timestamp)return s;var r=vt(Ln(t),2);r[0];var a=r[1];return s=this._computeSingleLocation(a,n,i,e),this._setComputedPosition(t,s,o)}},{key:"_defaultAnchorCompute",value:function(t,e){var n;if(1===t.locations.length)return this._singleAnchorCompute(t,e);var i=e.xy,o=e.wh,s=e.txy,r=e.twh,a=vt(Ln(t),2),l=a[0],c=a[1];if(t.locked||null==s||null==r)n=this._computeSingleLocation(c,i,o,e);else{var u=vt(this._anchorSelector(i,o,s,r,e.rotation,e.tRotation,t.locations),2),h=u[0],d=u[1];t.currentLocation=h,h!==l&&(t.cssClass=d.cls||t.cssClass,e.element._anchorLocationChanged(t)),n=this._computeSingleLocation(d,i,o,e)}return this._setComputedPosition(t,n,e.timestamp)}},{key:"_placeAnchors",value:function(t,e){var n=this,i=this.instance.viewport.getPosition(t),o=function(e,o,s,r,a,l){if(s.length>0)for(var c=s.sort(Tn[e]),u=function(t,e,n,i,o){for(var s=n?t.w:t.h,r=n?t.h:t.w,a=[],l=s/(e.length+1),c=0;c<e.length;c++){var u=(c+1)*l,h=i*r;o&&(u=s-u);var d=n?u:h,p=t.x+d,f=d/t.w,v=n?h:u,y=t.y+v,g=v/t.h;if(0!==t.r&&null!=t.r){var m=E({x:p,y},t.c,t.r);p=m.x,y=m.y}a.push({x:p,y,xLoc:f,yLoc:g,c:e[c].c})}return a}(i,c,r,a,e===Ie||e===je),h=0;h<u.length;h++){var d=u[h].c,p=d.endpoints[0].elementId===t?d.endpoints[0]:d.endpoints[1];n._setComputedPosition(p._anchor,{curX:u[h].x,curY:u[h].y,x:u[h].xLoc,y:u[h].yLoc,ox:l[0],oy:l[1]})}};o(Oe,0,e.bottom,!0,1,[0,1]),o(je,0,e.top,!0,0,[0,-1]),o(Te,0,e.left,!1,0,[-1,0]),o(Ie,0,e.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(t,e,n,i,o,s,r,a,l,c,u){var h,p=i.endpoints[r],f=p.id,v=[1,0][r],y={theta:e,order:n,c:i,b:o,elId:s,epId:f},g=t[l],m=p._continuousAnchorEdge?t[p._continuousAnchorEdge]:null;if(m){var _=d(m,(function(t){return t.epId===f}));if(-1!==_){m.splice(_,1);for(var x=0;x<m.length;x++)!0!==(h=m[x].c).placeholder&&c.add(h),u.add(m[x].c.endpoints[r]),u.add(m[x].c.endpoints[v])}}for(var k=0;k<g.length;k++)!0!==(h=g[k].c).placeholder&&c.add(h),u.add(g[k].c.endpoints[r]),u.add(g[k].c.endpoints[v]);var b=a?0:g.length;g.splice(b,0,y),p._continuousAnchorEdge=l}},{key:"_removeEndpointFromAnchorLists",value:function(t){var e=this.anchorLists.get(t.elementId),n=0;!function(t,e){if(t){var i=function(t){return t.epId===e};y(t.top,i),y(t.left,i),y(t.bottom,i),y(t.right,i),n+=t.top.length,n+=t.left.length,n+=t.bottom.length,n+=t.right.length}}(e,t.id),0===n&&this.anchorLists.delete(t.elementId),this.anchorLocations.delete(t._anchor.id)}},{key:"computeAnchorLocation",value:function(t,e){var n;return n=In(t)?this.anchorLocations.get(t.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:On(t)?this._floatingAnchorCompute(t,e):this._defaultAnchorCompute(t,e),t.timestamp=e.timestamp,n}},{key:"computePath",value:function(t,e){var n=this.instance.viewport.getPosition(t.sourceId),i=this.instance.viewport.getPosition(t.targetId),o=t.endpoints[0],s=t.endpoints[1],r=this.getEndpointLocation(o,{xy:n,wh:n,element:o,timestamp:e,rotation:this.instance._getRotations(t.sourceId)}),a=this.getEndpointLocation(s,{xy:i,wh:i,element:s,timestamp:e,rotation:this.instance._getRotations(t.targetId)});t.connector.resetBounds(),t.connector.compute({sourcePos:r,targetPos:a,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1],strokeWidth:t.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function(t,e){e=e||{};var n=t._anchor,i=this.anchorLocations.get(n.id);return(null==i||null!=e.timestamp&&n.timestamp!==e.timestamp)&&(i=this.computeAnchorLocation(n,e),this._setComputedPosition(n,i,e.timestamp)),i}},{key:"getEndpointOrientation",value:function(t){return t._anchor?this.getAnchorOrientation(t._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(t,e){var n=this.anchorLocations.get(t.id);null!=n&&(n.ox=e[0],n.oy=e[1])}},{key:"isDynamicAnchor",value:function(t){return!!t._anchor&&(!In(t._anchor)&&t._anchor.locations.length>1)}},{key:"isFloating",value:function(t){return!!t._anchor&&On(t._anchor)}},{key:"prepareAnchor",value:function(t){return en(t)}},{key:"redraw",value:function(t,e,n){var i=this,o=new Set,s=new Set,r=new Set;if(!this.instance._suspendDrawing){var a=this.instance.endpointsByElement[t]||[];e=e||C();for(var l,c,u={},h=0;h<a.length;h++)if(c=a[h],s.add(c),l=c._anchor,0===c.connections.length)In(l)&&(this.anchorLists.has(t)||this.anchorLists.set(t,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(t),-Math.PI/2,0,{endpoints:[c,c],placeholder:!0},!1,t,0,!1,Be(l),o,s),r.add(t));else for(var d=0;d<c.connections.length;d++){var p=c.connections[d],f=p.sourceId,v=p.targetId,y=In(p.endpoints[0]._anchor),g=In(p.endpoints[1]._anchor);if(y||g){var m=[f,(p.endpoints[0]._anchor.faces||[]).join("-"),v,(p.endpoints[1]._anchor.faces||[]).join("-")].join("-"),_=u[m],x=p.sourceId===t?1:0;y&&!this.anchorLists.has(f)&&this.anchorLists.set(f,{top:[],right:[],bottom:[],left:[]}),g&&!this.anchorLists.has(v)&&this.anchorLists.set(v,{top:[],right:[],bottom:[],left:[]});var k=this.instance.viewport.getPosition(v),b=this.instance.viewport.getPosition(f);if(v===f&&(y||g))this._updateAnchorList(this.anchorLists.get(f),-Math.PI/2,0,p,!1,v,0,!1,je,o,s),this._updateAnchorList(this.anchorLists.get(v),-Math.PI/2,0,p,!1,f,1,!1,je,o,s);else{var E=this.instance._getRotations(f),S=this.instance._getRotations(v);_||(_=this._calculateOrientation(f,v,b,k,p.endpoints[0]._anchor,p.endpoints[1]._anchor,E,S),u[m]=_),y&&this._updateAnchorList(this.anchorLists.get(f),_.theta,0,p,!1,v,0,!1,_.a[0],o,s),g&&this._updateAnchorList(this.anchorLists.get(v),_.theta2,-1,p,!0,f,1,!0,_.a[1],o,s)}y&&r.add(f),g&&r.add(v),o.add(p),(y&&0===x||g&&1===x)&&s.add(p.endpoints[x])}else{var P=c.connections[d].endpoints[p.sourceId===t?1:0];if(Gn(P._anchor)){this.instance._paintEndpoint(P,{elementWithPrecedence:t,timestamp:e}),o.add(c.connections[d]);for(var w=0;w<P.connections.length;w++)P.connections[w]!==c.connections[d]&&o.add(P.connections[w])}else o.add(c.connections[d])}}r.forEach((function(t){i._placeAnchors(t,i.anchorLists.get(t))})),s.forEach((function(t){var n=i.instance.viewport.getPosition(t.elementId);i.instance._paintEndpoint(t,{timestamp:e,offset:n})})),o.forEach((function(t){i.instance._paintConnection(t,{timestamp:e})}))}return{c:o,e:s}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(t,e){null!=e&&(t._anchor=e)}},{key:"setConnectionAnchors",value:function(t,e){t.endpoints[0]._anchor=e[0],t.endpoints[1]._anchor=e[1]}},{key:"_calculateOrientation",value:function(t,e,n,i,o,s,r,a){var l=this;if(t===e)return{orientation:"identity",a:[je,je]};var c=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),u=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),h=[],d={};!function(t,e){for(var n=0;n<t.length;n++){var i;if(d[t[n]]=(at(i={},Te,{x:e[n][0].x,y:e[n][0].c.y}),at(i,Ie,{x:e[n][0].x+e[n][0].w,y:e[n][0].c.y}),at(i,je,{x:e[n][0].c.x,y:e[n][0].y}),at(i,Oe,{x:e[n][0].c.x,y:e[n][0].y+e[n][0].h}),i),null!=e[n][1]&&e[n][1].length>0)for(var o in d[t[n]])d[t[n]][o]=l.instance._applyRotationsXY(d[t[n]][o],e[n][1])}}([Ht,Rt],[[n,r],[i,a]]);for(var p=[je,Te,Ie,Oe],f=0;f<p.length;f++)for(var v=0;v<p.length;v++)h.push({source:p[f],target:p[v],dist:z(d.source[p[f]],d.target[p[v]])});h.sort((function(t,e){if(t.dist<e.dist)return-1;if(e.dist<t.dist)return 1;var n,i=(at(n={},Te,0),at(n,je,1),at(n,Ie,2),at(n,Oe,3),n),o=i[t.source],s=i[e.source],r=i[t.target],a=i[e.target];return o<s?-1:s<o?1:r<a?-1:a<r?1:0}));for(var y=h[0].source,g=h[0].target,m=0;m<h.length&&(y=In(o)&&o.locked?o.currentFace:!o.isContinuous||Xe(o,h[m].source)?h[m].source:null,g=s.isContinuous&&s.locked?s.currentFace:!s.isContinuous||Xe(s,h[m].target)?h[m].target:null,null==y||null==g);m++);return o.isContinuous&&this.setCurrentFace(o,y),s.isContinuous&&this.setCurrentFace(s,g),{a:[y,g],theta:c,theta2:u}}},{key:"setCurrentFace",value:function(t,e,n){t.currentFace=e,n&&null!=t.lockedFace&&(t.lockedFace=t.currentFace)}},{key:"lock",value:function(t){t.locked=!0,In(t)&&(t.lockedFace=t.currentFace)}},{key:"unlock",value:function(t){t.locked=!1,In(t)&&(t.lockedFace=null)}},{key:"selectAnchorLocation",value:function(t,e){var n=d(t.locations,(function(t){return t.x===e.x&&t.y===e.y}));return-1!==n&&(t.currentLocation=n,!0)}},{key:"lockCurrentAxis",value:function(t){null!=t.currentFace&&(t.lockedAxis=t.currentFace===Te||t.currentFace===Ie?Ge:Le)}},{key:"unlockCurrentAxis",value:function(t){t.lockedAxis=null}},{key:"anchorsEqual",value:function(t,e){if(!t||!e)return!1;var n=t.locations[t.currentLocation],i=e.locations[e.currentLocation];return n.x===i.x&&n.y===i.y&&n.offx===i.offx&&n.offy===i.offy&&n.ox===i.ox&&n.oy===i.oy}}]),t}();function Hn(t,e,n){var o=[],s=function(e){return i(e)?e:t.getId(e)};if(e)if("string"==typeof e){if("*"===e)return e;o.push(e)}else{var r;if(n)o=e;else if(null!=e.length)(r=o).push.apply(r,yt(yt(e).map(s)));else o.push(s(e))}return o}function Rn(t,e,n){null!=e&&(e.connections.push(t),1===e.connections.length&&t.instance.addClass(t.source,t.instance.connectedClass)),null!=n&&(null!=e&&t.sourceId===t.targetId||(n.connections.push(t),1===n.connections.length&&t.instance.addClass(t.target,t.instance.connectedClass)))}function Nn(t,e,n){if(null!=e){var i=e.connections.length;y(e.connections,(function(e){return t.id===e.id})),i>0&&0===e.connections.length&&t.instance.removeClass(t.source,t.instance.connectedClass)}if(null!=n){var o=n.connections.length;null!=e&&t.sourceId===t.targetId||y(n.connections,(function(e){return t.id===e.id})),o>0&&0===n.connections.length&&t.instance.removeClass(t.target,t.instance.connectedClass)}}var Bn=function(n){lt(s,n);var o=pt(s);function s(t,n){var i;return ot(this,s),(i=o.call(this))._instanceIndex=t,at(ht(i),"defaults",void 0),at(ht(i),"_initialDefaults",{}),at(ht(i),"isConnectionBeingDragged",!1),at(ht(i),"currentlyDragging",!1),at(ht(i),"hoverSuspended",!1),at(ht(i),"_suspendDrawing",!1),at(ht(i),"_suspendedAt",null),at(ht(i),"connectorClass",Zt),at(ht(i),"connectorOutlineClass","jtk-connector-outline"),at(ht(i),"connectedClass","jtk-connected"),at(ht(i),"endpointClass",Kt),at(ht(i),"endpointConnectedClass","jtk-endpoint-connected"),at(ht(i),"endpointFullClass","jtk-endpoint-full"),at(ht(i),"endpointDropAllowedClass","jtk-endpoint-drop-allowed"),at(ht(i),"endpointDropForbiddenClass","jtk-endpoint-drop-forbidden"),at(ht(i),"endpointAnchorClassPrefix","jtk-endpoint-anchor"),at(ht(i),"overlayClass",te),at(ht(i),"connections",[]),at(ht(i),"endpointsByElement",{}),at(ht(i),"endpointsByUUID",new Map),at(ht(i),"sourceSelectors",[]),at(ht(i),"targetSelectors",[]),at(ht(i),"allowNestedGroups",void 0),at(ht(i),"_curIdStamp",1),at(ht(i),"viewport",new Pn(ht(i))),at(ht(i),"router",void 0),at(ht(i),"groupManager",void 0),at(ht(i),"_connectionTypes",new Map),at(ht(i),"_endpointTypes",new Map),at(ht(i),"_container",void 0),at(ht(i),"_managedElements",{}),at(ht(i),"DEFAULT_SCOPE",void 0),at(ht(i),"_zoom",1),i.defaults={anchor:N.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:Tt.type,container:null,endpoint:Et.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},n&&e(i.defaults,n),e(i._initialDefaults,i.defaults),i.DEFAULT_SCOPE=i.defaults.scope,i.allowNestedGroups=!1!==i._initialDefaults.allowNestedGroups,i.router=new Fn(ht(i)),i.groupManager=new vn(ht(i)),i.setContainer(i._initialDefaults.container),i}return rt(s,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(t){return null!=t&&null!=t[0]&&null!=t[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(t,e){return this._zoom=t,this.fire(ae,this._zoom),e&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(t,e){var n=this.getListener(t),i=!0;if(n&&n.length>0){var o=Array.prototype.slice.call(arguments,1);try{for(var s=0,r=n.length;s<r;s++)i=i&&n[s].apply(n[s],o)}catch(e){w("cannot check condition ["+t+"]"+e)}}return i}},{key:"getId",value:function(t,e){if(null==t)return null;var n=this.getAttribute(t,Vt);return n&&"undefined"!==n||(2===arguments.length&&void 0!==arguments[1]?n=e:(1===arguments.length||3===arguments.length&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(t,Vt,n)),n}},{key:"getConnections",value:function(e,n){e?e.constructor===String&&(e={scope:e}):e={};for(var i=Hn(this,e.scope||this.defaultScope,!0),o=Hn(this,e.source),s=Hn(this,e.target),r=!n&&i.length>1?{}:[],a=function(t,e){if(!n&&i.length>1){var o=r[t];null==o&&(o=r[t]=[]),o.push(e)}else r.push(e)},l=0,c=this.connections.length;l<c;l++){var u=this.connections[l],h=u.proxies&&u.proxies[0]?u.proxies[0].originalEp.elementId:u.sourceId,d=u.proxies&&u.proxies[1]?u.proxies[1].originalEp.elementId:u.targetId;t(i,u.scope)&&t(o,h)&&t(s,d)&&a(u.scope,u)}return r}},{key:"select",value:function(t){return(t=t||{}).scope=t.scope||"*",new mn(this,t.connections||this.getConnections(t,!0))}},{key:"selectEndpoints",value:function(e){(e=e||{}).scope=e.scope||it;var n=!e.element&&!e.source&&!e.target,i=n?it:Hn(this,e.element),o=n?it:Hn(this,e.source),s=n?it:Hn(this,e.target),r=Hn(this,e.scope,!0),a=[];for(var l in this.endpointsByElement){var c=t(i,l,!0),u=t(o,l,!0),h="*"!==o,d=t(s,l,!0),p="*"!==s;if(c||u||d)t:for(var f=0,v=this.endpointsByElement[l].length;f<v;f++){var y=this.endpointsByElement[l][f];if(t(r,y.scope,!0)){var g=h&&o.length>0&&!y.isSource,m=p&&s.length>0&&!y.isTarget;if(g||m)continue t;a.push(y)}}}return new gn(this,a)}},{key:"setContainer",value:function(t){this._container=t,this.fire("container:change",this._container)}},{key:"_set",value:function(t,e,n){var i,o,s=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],r=t[s.elId],a=t.endpoints[n],l={index:n,originalEndpoint:a,originalSourceId:0===n?r:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?r:t.targetId,newTargetId:t.targetId,connection:t,newEndpoint:a};return e instanceof dn?(i=e).addConnection(t):i=(o=this.getId(e))===t[s.elId]?null:t.makeEndpoint(0===n,e,o),null!=i&&(l.newEndpoint=i,a.detachFromConnection(t),t.endpoints[n]=i,t[s.el]=i.element,t[s.elId]=i.elementId,l[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(l),this._paintConnection(t)),l}},{key:"setSource",value:function(t,e){Nn(t,this._managedElements[t.sourceId]);var n=this._set(t,e,0);Rn(t,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(t,e){Nn(t,this._managedElements[t.targetId]);var n=this._set(t,e,1);Rn(t,this._managedElements[n.newTargetId])}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(t,e){var n=this._suspendDrawing;return this._suspendDrawing=t,t?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),e&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(t,e){var n=!0===this._suspendDrawing;n||this.setSuspendDrawing(!0),t(),n||this.setSuspendDrawing(!1,!e)}},{key:"each",value:function(t,e){if(null!=t){if(null!=t.length)for(var n=0;n<t.length;n++)e(t[n]);else e(t);return this}}},{key:"updateOffset",value:function(t){var e=t.elId;return t.recalc?this.viewport.refreshElement(e):this.viewport.getPosition(e)}},{key:"deleteConnection",value:function(t,e){if(null!=t&&!0!==t.deleted&&((e=e||{}).force||c(!0,!1,[[t.endpoints[0],le,[t]],[t.endpoints[1],le,[t]],[t,le,[t]],[this,Jt,[ce,t]]]))){Nn(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this.fireDetachEvent(t,!t.pending&&!1!==e.fireEvent,e.originalEvent);var n=t.endpoints[0],i=t.endpoints[1];return n!==e.endpointToIgnore&&n.detachFromConnection(t,null,!0),i!==e.endpointToIgnore&&i.detachFromConnection(t,null,!0),y(this.connections,(function(e){return t.id===e.id})),t.destroy(),n!==e.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==e.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0}return!1}},{key:"deleteEveryConnection",value:function(t){var e=this;t=t||{};var n=this.connections.length,i=0;return this.batch((function(){for(var o=0;o<n;o++)i+=e.deleteConnection(e.connections[0],t)?1:0})),i}},{key:"deleteConnectionsForElement",value:function(t,e){var n=this.getId(t),i=this._managedElements[n];if(i)for(var o=i.connections.length,s=0;s<o;s++)this.deleteConnection(i.connections[0],e);return this}},{key:"fireDetachEvent",value:function(t,e,n){var i=null!=t.id?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&this.fire("connection:detach",i,n),this.fire(oe,i,n)}},{key:"fireMoveEvent",value:function(t,e){this.fire(ne,t,e)}},{key:"manageAll",value:function(t,e){for(var n=i(t)?this.getSelector(this.getContainer(),t):t,o=0;o<n.length;o++)this.manage(n[o],null,e)}},{key:"manage",value:function(t,e,n){null==this.getAttribute(t,Vt)&&(e=e||this.getAttribute(t,"id")||C(),this.setAttribute(t,Vt,e));var i=this.getId(t);if(this._managedElements[i])n&&(this._managedElements[i].viewportElement=this.updateOffset({elId:i,timestamp:null,recalc:!0}));else{var o={el:t,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[i]=o,this._suspendDrawing?o.viewportElement=this.viewport.registerElement(i,!0):o.viewportElement=this.updateOffset({elId:i,recalc:!0}),this.fire("element:manage",{el:t})}return this._managedElements[i]}},{key:"getManagedData",value:function(t,e,n){if(this._managedElements[t]){var i=this._managedElements[t].data[e];return null!=i?i[n]:null}}},{key:"setManagedData",value:function(t,e,n,i){this._managedElements[t]&&(this._managedElements[t].data[e]=this._managedElements[t].data[e]||{},this._managedElements[t].data[e][n]=i)}},{key:"getManagedElement",value:function(t){return this._managedElements[t]?this._managedElements[t].el:null}},{key:"unmanage",value:function(t,e){var n=this;this.removeAllEndpoints(t,!0);var i=function(t){var i=n.getId(t);n.removeAttribute(t,Vt),delete n._managedElements[i],n.viewport.remove(i),n.fire("element:unmanage",{el:t}),t&&e&&n._removeElement(t)};this._getAssociatedElements(t).map(i),i(t)}},{key:"rotate",value:function(t,e,n){var i=this.getId(t);return this._managedElements[i]&&(this._managedElements[i].rotation=e,this.viewport.rotateElement(i,e),!0!==n)?this.revalidate(t):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(t){var e=this._managedElements[t];return null!=e&&e.rotation||0}},{key:"_getRotations",value:function(t){var e=this,n=[],i=this._managedElements[t];return null!=i&&(n.push({r:i.viewportElement.r||0,c:i.viewportElement.c}),function t(i){if(null!=i.group){var o=e._managedElements[i.group];null!=o&&(n.push({r:o.viewportElement.r,c:o.viewportElement.c}),t(o))}}(i)),n}},{key:"_applyRotations",value:function(t,e){var n=t.slice(),i={x:n[0],y:n[1],cr:0,sr:0};return h(e,(function(t){i=E(i,t.c,t.r)})),i}},{key:"_applyRotationsXY",value:function(t,e){return h(e,(function(e){t=E(t,e.c,e.r)})),t}},{key:"_internal_newEndpoint",value:function(t){var n=e({},t),i=this.manage(n.element);n.elementId=this.getId(n.element),n.id="ep_"+this._idstamp();var o=new dn(this,n);return function(t,e){null!=t&&t.endpoints.push(e)}(i,o),t.uuid&&this.endpointsByUUID.set(t.uuid,o),_(this.endpointsByElement,o.elementId,o),this._suspendDrawing||this._paintEndpoint(o,{timestamp:this._suspendedAt}),o}},{key:"_deriveEndpointAndAnchorSpec",value:function(t,e){for(var n=((e?"":"default ")+t).split(/[\s]/),i=null,o=null,s=null,r=null,a=0;a<n.length;a++){var l=this.getConnectionType(n[a]);l&&(l.endpoints&&(i=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(r=l.anchors),l.anchor&&(s=l.anchor))}return{endpoints:i||[o,o],anchors:r||[s,s]}}},{key:"revalidate",value:function(t,e){var n=this.getId(t);return this.updateOffset({elId:n,recalc:!0,timestamp:e}),this.repaint(t)}},{key:"repaintEverything",value:function(){var t,e=C();for(t in this._managedElements)this.viewport.refreshElement(t,!0);for(t in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[t].el,e,!0);return this}},{key:"setElementPosition",value:function(t,e,n){var i=this.getId(t);return this.viewport.setPosition(i,e,n),this.repaint(t)}},{key:"repaint",value:function(t,e,n){var i={c:new Set,e:new Set},o=function(t){t.c.forEach((function(t){return i.c.add(t)})),t.e.forEach((function(t){return i.e.add(t)}))};if(!this._suspendDrawing){var s=this.getId(t);if(null!=t){var r=this._getAssociatedElements(t);if(null==e&&(e=C()),!n)for(var a=0;a<r.length;a++)this.updateOffset({elId:this.getId(r[a]),recalc:!0,timestamp:e});if(o(this.router.redraw(s,e,null)),r.length>0)for(var l=0;l<r.length;l++)o(this.router.redraw(this.getId(r[l]),e,null))}}return i}},{key:"unregisterEndpoint",value:function(t){var e=t.getUuid();e&&this.endpointsByUUID.delete(e),function(t,e){null!=t&&y(t.endpoints,(function(t){return t===e}))}(this._managedElements[t.elementId],t);var n=this.endpointsByElement[t.elementId];null!=n&&(n.length>1?this.endpointsByElement[t.elementId]=n.filter((function(e){return e!==t})):delete this.endpointsByElement[t.elementId]),this.fire(ie,t)}},{key:"_maybePruneEndpoint",value:function(t){return!(!t.deleteOnEmpty||0!==t.connections.length)&&(this.deleteEndpoint(t),!0)}},{key:"deleteEndpoint",value:function(t){var e=this,n="string"==typeof t?this.endpointsByUUID.get(t):t;if(n){var i=n.proxiedBy,o=n.connections.slice();h(o,(function(t){n.detachFromConnection(t,null,!0)})),this.unregisterEndpoint(n),n.destroy(),h(o,(function(t){e.deleteConnection(t,{force:!0,endpointToIgnore:n})})),null!=i&&this.deleteEndpoint(i)}return this}},{key:"addEndpoint",value:function(t,n,i){var o=e({},i=i||{});e(o,n||{});var s=e({element:t},o);return this._internal_newEndpoint(s)}},{key:"addEndpoints",value:function(t,e,n){for(var i=[],o=0,s=e.length;o<s;o++)i.push(this.addEndpoint(t,e[o],n));return i}},{key:"reset",value:function(){var t=this;this.silently((function(){t.endpointsByElement={},t._managedElements={},t.endpointsByUUID.clear(),t.viewport.reset(),t.router.reset(),t.groupManager.reset(),t.connections.length=0}))}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(t){return this.endpointsByElement[this.getId(t)]||[]}},{key:"getEndpoint",value:function(t){return this.endpointsByUUID.get(t)}},{key:"setEndpointUuid",value:function(t,e){t.uuid&&this.endpointsByUUID.delete(t.uuid),t.uuid=e,this.endpointsByUUID.set(e,t)}},{key:"connect",value:function(t,e){try{var n=this._prepareConnectionParams(t,e),i=this._newConnection(n);return this._finaliseConnection(i,n),i}catch(t){return void w(t)}}},{key:"_prepareConnectionParams",value:function(t,n){var i=e({},t);n&&e(i,n);var o=i;if(o.source&&o.source.endpoint&&(o.sourceEndpoint=o.source),o.target&&o.target.endpoint&&(o.targetEndpoint=o.target),t.uuids&&(o.sourceEndpoint=this.getEndpoint(t.uuids[0]),o.targetEndpoint=this.getEndpoint(t.uuids[1])),null!=o.sourceEndpoint){if(o.sourceEndpoint.isFull())throw"Cannot establish connection: source endpoint is full";if(o.type||(o.type=o.sourceEndpoint.edgeType),o.sourceEndpoint.connectorOverlays){o.overlays=o.overlays||[];for(var s=0,r=o.sourceEndpoint.connectorOverlays.length;s<r;s++)o.overlays.push(o.sourceEndpoint.connectorOverlays[s])}o.sourceEndpoint.scope&&(o.scope=o.sourceEndpoint.scope)}else if(null==o.source)throw"Cannot establish connection: source does not exist";if(null!=o.targetEndpoint){if(o.targetEndpoint.isFull())throw"Cannot establish connection: target endpoint is full"}else if(null==o.target)throw"Cannot establish connection: target does not exist";if(o.sourceEndpoint&&o.targetEndpoint&&!function(t,e){for(var n=t.scope.split(/\s/),i=e.scope.split(/\s/),o=0;o<n.length;o++)for(var s=0;s<i.length;s++)if(i[s]===n[o])return!0;return!1}(o.sourceEndpoint,o.targetEndpoint))throw"Cannot establish connection: scopes do not match";return o}},{key:"_newConnection",value:function(t){t.id="con_"+this._idstamp();var e=new un(this,t);return Rn(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this._paintConnection(e),e}},{key:"_finaliseConnection",value:function(t,e,n){e=e||{},t.suspendedEndpoint||this.connections.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,this.repaint(t.source);var i={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};this.fire(ee,i,n),e.doNotFireConnectionEvent||!1===e.fireEvent||this.fire("connection",i,n)}},{key:"removeAllEndpoints",value:function(t,e){var n=this,i=function(t){var e,i,o=n.getId(t),s=n.endpointsByElement[o];if(s)for(e=0,i=s.length;e<i;e++)n.deleteEndpoint(s[e]);delete n.endpointsByElement[o]};return e&&this._getAssociatedElements(t).map(i),i(t),this}},{key:"_createSourceDefinition",value:function(t,n){var i=e({},n);e(i,t),i.edgeType=i.edgeType||tt;var o=this._deriveEndpointAndAnchorSpec(i.edgeType);i.endpoint=i.endpoint||o.endpoints[0],i.anchor=i.anchor||o.anchors[0];var s=i.maxConnections||-1;return{def:e({},i),uniqueEndpoint:i.uniqueEndpoint,maxConnections:s,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createSourceDefinition(e),o=new An(t,i,n);return this.sourceSelectors.push(o),o}},{key:"removeSourceSelector",value:function(t){y(this.sourceSelectors,(function(e){return e===t}))}},{key:"removeTargetSelector",value:function(t){y(this.targetSelectors,(function(e){return e===t}))}},{key:"addTargetSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createTargetDefinition(e),o=new Dn(t,i,n);return this.targetSelectors.push(o),o}},{key:"_createTargetDefinition",value:function(t,n){var i=e({},n);e(i,t),i.edgeType=i.edgeType||tt;var o=i.maxConnections||-1;return{def:e({},i),uniqueEndpoint:i.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null}}},{key:"show",value:function(t,e){return this._setVisible(t,Nt,e)}},{key:"hide",value:function(t,e){return this._setVisible(t,Bt,e)}},{key:"_setVisible",value:function(t,e,n){var i=e===Nt,o=null;n&&(o=function(t){t.setVisible(i,!0,!0)});var s=this.getId(t);return this._operation(t,(function(t){if(i&&n){var e=t.sourceId===s?1:0;t.endpoints[e].isVisible()&&t.setVisible(!0)}else t.setVisible(i)}),o),this}},{key:"toggleVisible",value:function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),this._operation(t,(function(t){var e=t.isVisible();t.setVisible(!e)}),n)}},{key:"_operation",value:function(t,e,n){var i=this.getId(t),o=this.endpointsByElement[i];if(o&&o.length)for(var s=0,r=o.length;s<r;s++){for(var a=0,l=o[s].connections.length;a<l;a++){if(e(o[s].connections[a]))return}n&&n(o[s])}}},{key:"registerConnectionType",value:function(t,n){if(this._connectionTypes.set(t,e({},n)),n.overlays){for(var i={},o=0;o<n.overlays.length;o++){var s=he(n.overlays[o]);i[s.options.id]=s}this._connectionTypes.get(t).overlays=i}}},{key:"registerConnectionTypes",value:function(t){for(var e in t)this.registerConnectionType(e,t[e])}},{key:"registerEndpointType",value:function(t,n){if(this._endpointTypes.set(t,e({},n)),n.overlays){for(var i={},o=0;o<n.overlays.length;o++){var s=he(n.overlays[o]);i[s.options.id]=s}this._endpointTypes.get(t).overlays=i}}},{key:"registerEndpointTypes",value:function(t){for(var e in t)this.registerEndpointType(e,t[e])}},{key:"getType",value:function(t,e){return"connection"===e?this.getConnectionType(t):this.getEndpointType(t)}},{key:"getConnectionType",value:function(t){return this._connectionTypes.get(t)}},{key:"getEndpointType",value:function(t){return this._endpointTypes.get(t)}},{key:"importDefaults",value:function(t){for(var e in t)this.defaults[e]=t[e];return t.container&&this.setContainer(t.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=e({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(t,e,n,i,o){var s,r=null!=t.proxies[e],a=r?t.proxies[e].originalEp.elementId:t.endpoints[e].elementId,l=r?t.proxies[e].originalEp:t.endpoints[e],c=this.getId(n);t.proxies[e]?t.proxies[e].ep.elementId===c?s=t.proxies[e].ep:(t.proxies[e].ep.detachFromConnection(t,e),s=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}})):s=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}}),s.deleteOnEmpty=!0,t.proxies[e]={ep:s,originalEp:l},this.sourceOrTargetChanged(a,c,t,n,e),l.detachFromConnection(t,null,!0),s.connections=[t],t.endpoints[e]=s,l.proxiedBy=s,l.setVisible(!1),t.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(t,e){if(null!=t.proxies&&null!=t.proxies[e]){var n=t.proxies[e].originalEp.element,i=t.proxies[e].originalEp.elementId,o=t.proxies[e].ep.elementId;t.endpoints[e]=t.proxies[e].originalEp,delete t.proxies[e].originalEp.proxiedBy,this.sourceOrTargetChanged(o,i,t,n,e),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),t.proxies[e]=null,-1===d(t.proxies,(function(t){return null!=t}))&&(t.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(t,e,n,i,o){t!==e&&(0===o?(n.sourceId=e,n.source=i):1===o&&(n.targetId=e,n.target=i),Nn(n,this._managedElements[t]),Rn(n,this._managedElements[e]))}},{key:"getGroup",value:function(t){return this.groupManager.getGroup(t)}},{key:"getGroupFor",value:function(t){return this.groupManager.getGroupFor(t)}},{key:"addGroup",value:function(t){return this.groupManager.addGroup(t)}},{key:"addToGroup",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(e=this.groupManager).addToGroup.apply(e,[t,!1].concat(i))}},{key:"collapseGroup",value:function(t){this.groupManager.collapseGroup(t)}},{key:"expandGroup",value:function(t){this.groupManager.expandGroup(t)}},{key:"toggleGroup",value:function(t){this.groupManager.toggleGroup(t)}},{key:"removeGroup",value:function(t,e,n,i){return this.groupManager.removeGroup(t,e,n,i)}},{key:"removeAllGroups",value:function(t,e){this.groupManager.removeAllGroups(t,e,!1)}},{key:"removeFromGroup",value:function(t,e,n){this.groupManager.removeFromGroup(t,n,e),this._appendElement(e,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(e)})}},{key:"_paintEndpoint",value:function(t,e){var n=(e=e||{}).timestamp,i=!(!1===e.recalc);if(!n||t.timestamp!==n){var o=this.viewport.getPosition(t.elementId),s=e.offset?{x:e.offset.x,y:e.offset.y}:{x:o.x,y:o.y};if(null!=s){var r=e.anchorLoc;if(null==r){var a={xy:s,wh:o,element:t,timestamp:n};if(i&&this.router.isDynamicAnchor(t)&&t.connections.length>0){var l=function(t){var n=0;if(null!=e.elementWithPrecedence)for(var i=0;i<t.connections.length;i++)if(t.connections[i].sourceId===e.elementWithPrecedence||t.connections[i].targetId===e.elementWithPrecedence){n=i;break}return t.connections[n]}(t),c=l.endpoints[0]===t?1:0,u=0===c?l.sourceId:l.targetId,h=this.viewport.getPosition(u);a.index=0===c?1:0,a.connection=l,a.txy=h,a.twh=h,a.tElement=l.endpoints[c],a.tRotation=this._getRotations(u)}else t.connections.length>0&&(a.connection=t.connections[0]);a.rotation=this._getRotations(t.elementId),r=this.router.computeAnchorLocation(t._anchor,a)}for(var d in t.endpoint.compute(r,this.router.getEndpointOrientation(t),t.paintStyleInUse),this.renderEndpoint(t,t.paintStyleInUse),t.timestamp=n,t.overlays)if(t.overlays.hasOwnProperty(d)){var p=t.overlays[d];p.isVisible()&&(t.overlayPlacements[d]=this.drawOverlay(p,t.endpoint,t.paintStyleInUse,t.getAbsoluteOverlayPosition(p)),this._paintOverlay(p,t.overlayPlacements[d],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(t,e){if(!this._suspendDrawing&&!1!==t.visible){var n=(e=e||{}).timestamp;if(null!=n&&n===t.lastPaintedAt)return;if(null==n||n!==t.lastPaintedAt){this.router.computePath(t,n);var i={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var o in t.overlays)if(t.overlays.hasOwnProperty(o)){var s=t.overlays[o];s.isVisible()&&(t.overlayPlacements[o]=this.drawOverlay(s,t.connector,t.paintStyleInUse,t.getAbsoluteOverlayPosition(s)),i.xmin=Math.min(i.xmin,t.overlayPlacements[o].xmin),i.xmax=Math.max(i.xmax,t.overlayPlacements[o].xmax),i.ymin=Math.min(i.ymin,t.overlayPlacements[o].ymin),i.ymax=Math.max(i.ymax,t.overlayPlacements[o].ymax))}var r=parseFloat(""+t.paintStyleInUse.strokeWidth||"1")/2,a=parseFloat(""+t.paintStyleInUse.strokeWidth||"0"),l={xmin:Math.min(t.connector.bounds.xmin-(r+a),i.xmin),ymin:Math.min(t.connector.bounds.ymin-(r+a),i.ymin),xmax:Math.max(t.connector.bounds.xmax+(r+a),i.xmax),ymax:Math.max(t.connector.bounds.ymax+(r+a),i.ymax)};for(var c in this.paintConnector(t.connector,t.paintStyleInUse,l),t.overlays)if(t.overlays.hasOwnProperty(c)){var u=t.overlays[c];u.isVisible()&&this._paintOverlay(u,t.overlayPlacements[c],l)}}t.lastPaintedAt=n}}},{key:"_refreshEndpoint",value:function(t){t.connections.length>0?this.addEndpointClass(t,this.endpointConnectedClass):this.removeEndpointClass(t,this.endpointConnectedClass),t.isFull()?this.addEndpointClass(t,this.endpointFullClass):this.removeEndpointClass(t,this.endpointFullClass)}},{key:"_makeConnector",value:function(t,e,n){return Ot(t,e,n)}},{key:"addOverlay",value:function(t,e,n){if(t.addOverlay(e),!n){var i=t instanceof dn?t.element:t.source;this.revalidate(i)}}},{key:"getPathData",value:function(t){for(var e="",n=0;n<t.segments.length;n++)e+=t.segments[n].getPath(0===n),e+=" ";return e}}]),s}(B);function qn(t){var e=Math.floor(t),n=Math.ceil(t);return t-e<1e-10?e:n-t<1e-10?n:t}var Xn=function(t){lt(n,t);var e=pt(n);function n(t){var i;ot(this,n),at(ht(i=e.call(this,t)),"type",n.segmentType),at(ht(i),"cx",void 0),at(ht(i),"cy",void 0),at(ht(i),"radius",void 0),at(ht(i),"anticlockwise",void 0),at(ht(i),"startAngle",void 0),at(ht(i),"endAngle",void 0),at(ht(i),"sweep",void 0),at(ht(i),"length",void 0),at(ht(i),"circumference",void 0),at(ht(i),"frac",void 0),i.cx=t.cx,i.cy=t.cy,i.radius=t.r,i.anticlockwise=t.ac,t.startAngle&&t.endAngle?(i.startAngle=t.startAngle,i.endAngle=t.endAngle,i.x1=i.cx+i.radius*Math.cos(i.startAngle),i.y1=i.cy+i.radius*Math.sin(i.startAngle),i.x2=i.cx+i.radius*Math.cos(i.endAngle),i.y2=i.cy+i.radius*Math.sin(i.endAngle)):(i.startAngle=i._calcAngle(i.x1,i.y1),i.endAngle=i._calcAngle(i.x2,i.y2)),i.endAngle<0&&(i.endAngle+=Y),i.startAngle<0&&(i.startAngle+=Y);var o=i.endAngle<i.startAngle?i.endAngle+Y:i.endAngle;return i.sweep=Math.abs(o-i.startAngle),i.anticlockwise&&(i.sweep=Y-i.sweep),i.circumference=2*Math.PI*i.radius,i.frac=i.sweep/Y,i.length=i.circumference*i.frac,i.extents={xmin:i.cx-i.radius,xmax:i.cx+i.radius,ymin:i.cy-i.radius,ymax:i.cy+i.radius},i}return rt(n,[{key:"_calcAngle",value:function(t,e){return n={x:this.cx,y:this.cy},o=V(n,i={x:t,y:e}),s=Math.atan(o),4!=(r=U(n,i))&&3!=r||(s+=Math.PI),s<0&&(s+=2*Math.PI),s;var n,i,o,s,r}},{key:"_calcAngleForLocation",value:function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+Y:t.startAngle;return n-Math.abs(n-t.endAngle)*e}var i=t.endAngle<t.startAngle?t.endAngle+Y:t.endAngle,o=Math.abs(i-t.startAngle);return t.startAngle+o*e}},{key:"getPath",value:function(t){var e=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(t?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+e+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(t,e){if(0===t)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===t)return{x:this.x2,y:this.y2,theta:this.endAngle};e&&(t/=length);var n=this._calcAngleForLocation(this,t),i=this.cx+this.radius*Math.cos(n),o=this.cy+this.radius*Math.sin(n);return{x:qn(i),y:qn(o),theta:n}}},{key:"gradientAtPoint",value:function(t,e){var n=this.pointOnPath(t,e),i=-1/V({x:this.cx,y:this.cy},n);return this.anticlockwise||i!==1/0&&i!==-1/0||(i*=-1),i}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=e/this.circumference*2*Math.PI,s=this.anticlockwise?-1:1,r=i.theta+s*o;return{x:this.cx+this.radius*Math.cos(r),y:this.cy+this.radius*Math.sin(r)}}}]),n}($);at(Xn,"segmentType","Arc");var Yn=function(t){lt(n,t);var e=pt(n);function n(t,i,o){var s;return ot(this,n),(s=e.call(this,t,i,o)).instance=t,s.component=i,at(ht(s),"width",void 0),at(ht(s),"length",void 0),at(ht(s),"foldback",void 0),at(ht(s),"direction",void 0),at(ht(s),"location",.5),at(ht(s),"paintStyle",void 0),at(ht(s),"type",n.type),at(ht(s),"cachedDimensions",void 0),o=o||{},s.width=o.width||20,s.length=o.length||20,s.direction=(o.direction||1)<0?-1:1,s.foldback=o.foldback||.623,s.paintStyle=o.paintStyle||{strokeWidth:1},s.location=null==o.location?s.location:Array.isArray(o.location)?o.location[0]:o.location,s}return rt(n,[{key:"draw",value:function(t,e,n){if(t instanceof Mt){var i,o,s,r=t;if(this.location>1||this.location<0){var a=this.location<0?1:0;o=J(i=r.pointAlongPathFrom(a,this.location,!1),r.pointAlongPathFrom(a,this.location-this.direction*this.length/2,!1),this.length)}else if(1===this.location){if(o=J(i=r.pointOnPath(this.location),r.pointAlongPathFrom(this.location,-this.length),this.length),-1===this.direction){var l=o;o=i,i=l}}else if(0===this.location){if(i=J(o=r.pointOnPath(this.location),r.pointAlongPathFrom(this.location,this.length),this.length),-1===this.direction){var c=o;o=i,i=c}}else o=J(i=r.pointAlongPathFrom(this.location,this.direction*this.length/2),r.pointOnPath(this.location),this.length);var u={hxy:i,tail:s=function(t,e,n){var i=V(t,e),o=Math.atan(-1/i),s=n/2*Math.sin(o),r=n/2*Math.cos(o);return[{x:e.x+r,y:e.y+s},{x:e.x-r,y:e.y-s}]}(i,o,this.width),cxy:J(i,o,this.foldback*this.length)},h=this.paintStyle.stroke||e.stroke,d=this.paintStyle.fill||e.stroke;return{component:t,d:u,"stroke-width":this.paintStyle.strokeWidth||e.strokeWidth,stroke:h,fill:d,xmin:Math.min(i.x,s[0].x,s[1].x),xmax:Math.max(i.x,s[0].x,s[1].x),ymin:Math.min(i.y,s[0].y,s[1].y),ymax:Math.max(i.y,s[0].y,s[1].y)}}}},{key:"updateFrom",value:function(t){}}]),n}(de);function Vn(t){return t.type===Yn.type}at(Yn,"type","Arrow"),ve(Yn.type,Yn);var zn=function(t){lt(n,t);var e=pt(n);function n(t,i,o){var s;return ot(this,n),(s=e.call(this,t,i,o)).instance=t,at(ht(s),"type",n.type),s.foldback=1,s}return n}(Yn);function Un(t){return t.type===zn.type}at(zn,"type","PlainArrow"),ve("PlainArrow",zn);var Wn=function(t){lt(n,t);var e=pt(n);function n(t,i,o){var s;return ot(this,n),(s=e.call(this,t,i,o)).instance=t,at(ht(s),"type",n.type),s.length=s.length/2,s.foldback=2,s}return n}(Yn);function Jn(t){return t.type===Wn.type}at(Wn,"type","Diamond"),ve(Wn.type,Wn);var Zn=function(t){lt(n,t);var e=pt(n);function n(t,i,o){var s;return ot(this,n),(s=e.call(this,t,i,o)).instance=t,s.component=i,at(ht(s),"create",void 0),at(ht(s),"type",n.type),s.create=o.create,s}return rt(n,[{key:"updateFrom",value:function(t){}}]),n}(de);function Kn(t){return t.type===Zn.type}function $n(t){return $n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$n(t)}function Qn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ti(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ei(t,e,n){return e&&ti(t.prototype,e),n&&ti(t,n),t}function ni(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ii(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&si(t,e)}function oi(t){return oi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},oi(t)}function si(t,e){return si=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},si(t,e)}function ri(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ai(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?ri(t):e}function li(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=oi(t);if(e){var o=oi(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return ai(this,n)}}function ci(t,e,n){return ci="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=oi(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}},ci(t,e,n||t)}function ui(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,o,s=[],r=!0,a=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(s.push(i.value),!e||s.length!==e);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==n.return||n.return()}finally{if(a)throw o}}return s}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return hi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hi(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function di(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function pi(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()}function fi(t,e,n,i){if(i&&di(t,e,n))return t;for(t=t.parentNode;null!=t&&t!==n;){if(di(t,e))return t;t=t.parentNode}}function vi(t){return t.srcElement||t.target}function yi(t){return null!=t.className?void 0===t.className.baseVal?t.className:t.className.baseVal:""}function gi(t,e,n){var i=null==e?[]:Array.isArray(e)?e:e.split(/\s+/),o=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),s=yi(t).split(/\s+/),r=function(t,e){for(var n=0;n<e.length;n++)if(t)-1===s.indexOf(e[n])&&s.push(e[n]);else{var i=s.indexOf(e[n]);-1!==i&&s.splice(i,1)}};r(!0,i),r(!1,o),function(t,e,n){e=S(e),void 0!==t.className.baseVal?t.className.baseVal=e:t.className=e;try{var i=t.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var o=0;o<n.length;o++)n[o]&&i.add(n[o])}}catch(t){w("JSPLUMB: cannot set class list",t)}}(t,s.join(" "),s)}function mi(t){return!i(t)&&!Array.isArray(t)&&null!=t.length&&null==t.documentElement&&null==t.nodeType}function _i(t,e){var n=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?h(S(e).split(/\s+/),(function(e){t.classList.add(e)})):gi(t,e))};mi(t)?h(t,(function(t){return n(t,e)})):n(t,e)}function xi(t,e){var n=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?S(e).split(/\s+/).forEach((function(e){t.classList.remove(e)})):gi(t,null,e))};mi(t)?h(t,(function(t){return n(t,e)})):n(t,e)}function ki(t,e,n,i){return bi(null,t,e,n,i)}function bi(t,e,n,i,o){var s,r=null==t?document.createElement(e):document.createElementNS(t,e);for(s in n=n||{})r.style[s]=n[s];for(s in i&&(r.className=i),o=o||{})r.setAttribute(s,""+o[s]);return r}function Ci(t){var e=t.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,s=window.pageXOffset||i.scrollLeft||n.scrollLeft,r=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=e.top+o-r,c=e.left+s-a;return{x:Math.round(c),y:Math.round(l)}}at(Zn,"type","Custom"),ve(Zn.type,Zn),bt.registerHandler(St),bt.registerHandler(Dt),bt.registerHandler(wt),Gt(Tt.type,Tt);var Ei={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},Si="stroke-dasharray",Pi="svg",wi="path",Ai="http://www.w3.org/2000/svg";function Di(t,e){for(var n in e)t.setAttribute(n,""+e[n])}function Mi(t,e){return(e=e||{}).version="1.1",e.xmlns=Ai,bi(Ai,t,null,null,e)}function ji(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"}function Ti(t,e,n){if(e.setAttribute("fill",n.fill?n.fill:Bt),e.setAttribute("stroke",n.stroke?n.stroke:Bt),n.strokeWidth&&e.setAttribute("stroke-width",n.strokeWidth),n.dashstyle&&n.strokeWidth&&!n[Si]){var i=-1===n.dashstyle.indexOf(",")?" ":",",o=n.dashstyle.split(i),s="";h(o,(function(t){s+=Math.floor(t*n.strokeWidth)+i})),e.setAttribute(Si,s)}else n[Si]&&e.setAttribute(Si,n[Si]);for(var r in Ei)n[r]&&e.setAttribute(Ei[r],n[r])}function Ii(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)}function Oi(t,e,n,i,o){t.style.width=i+"px",t.style.height=o+"px",t.style.left=e+"px",t.style.top=n+"px",t.height=o,t.width=i}function Gi(t,e,n){var i=[t,e];return n&&i.push(n),i.join(":")}var Li="data-jtk-container",Fi="data-jtk-enabled",Hi="data-jtk-scope",Ri="endpoint",Ni="element",Bi="connection",qi="div",Xi="click",Yi="contextmenu",Vi="dblclick",zi="dbltap",Ui="mousedown",Wi="mouseenter",Ji="mouseexit",Zi="mousemove",Ki="mouseup",$i="mouseout",Qi="mouseover",to="tap",eo="revert",no="connection:drag",io=Gi(Ni,Xi),oo=Gi(Ni,Vi),so=Gi(Ni,zi),ro=Gi(Ni,$i),ao=Gi(Ni,Qi),lo=Gi(Ni,Zi),co=Gi(Ni,Ki),uo=Gi(Ni,Ui),ho=Gi(Ni,Yi),po=Gi(Ni,to),fo=Gi(Ri,Xi),vo=Gi(Ri,Vi),yo=(Gi(Ri,zi),Gi(Ri,$i)),go=Gi(Ri,Qi),mo=Gi(Ri,Ki),_o=Gi(Ri,Ui),xo=(Gi(Ri,to),Gi(Bi,Xi)),ko=Gi(Bi,Vi),bo=Gi(Bi,zi),Co=Gi(Bi,$i),Eo=Gi(Bi,Qi),So=Gi(Bi,Ki),Po=Gi(Bi,Ui),wo=Gi(Bi,Yi),Ao=Gi(Bi,to),Do="position",Mo=Lt(Zt),jo=Lt(Kt),To=Ft(Yt),Io=Ft("data-jtk-group-content"),Oo=Lt(te);function Go(t,e,n,i,o,s,r){return function(){var t=[];return t.push.apply(t,arguments),t.item=function(t){return this[t]},t}(function(t,e,n,i,o,s,r){return new Touch({target:t,identifier:C(),pageX:e,pageY:n,screenX:i,screenY:o,clientX:s||i,clientY:r||o})}(t,e,n,i,o,s,r))}function Lo(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function Fo(t){return t.srcElement||t.target}function Ho(t,e,n,i){if(i){if(void 0!==t.path&&t.path.indexOf)return{path:t.path,end:t.path.indexOf(n)};var o={path:[],end:-1};return function t(e){o.path.push(e),e===n?o.end=o.path.length-1:null!=e.parentNode&&t(e.parentNode)}(e),o}return{path:[e],end:1}}var Ro=1;function No(){return"ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function Bo(){return"onmousedown"in document.documentElement}var qo={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};function Xo(t,e){if(null==t)return{x:0,y:0};var n=function(t,e){return t.item?t.item(e):t[e]}(Vo(t),0);return{x:n[e+"X"],y:n[e+"Y"]}}function Yo(t){return Xo(t,"page")}function Vo(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]}function zo(t,e,n,i,o){if(Jo(t,e,n),i.__tauid=n.__tauid,t.addEventListener)t.addEventListener(e,n,!1,o);else if(t.attachEvent){var s=e+n.__tauid;t["e"+s]=n,t[s]=function(){t["e"+s]&&t["e"+s](window.event)},t.attachEvent("on"+e,t[s])}}function Uo(t,e,n){var i=this;null!=n&&Wo(t,(function(o){if(function(t,e,n){if(t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)Uo(t,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(o,e,n),null!=n.__tauid)if(o.removeEventListener)o.removeEventListener(e,n,!1),No()&&qo[e]&&o.removeEventListener(qo[e],n,!1);else if(i.detachEvent){var s=e+n.__tauid;o[s]&&o.detachEvent("on"+e,o[s]),o[s]=null,o["e"+s]=null}n.__taTouchProxy&&Uo(t,n.__taTouchProxy[1],n.__taTouchProxy[0])}))}function Wo(t,e){if(null!=t)for(var n="string"==typeof t?document.querySelectorAll(t):null!=t.length?t:[t],i=0;i<n.length;i++)e(n[i])}function Jo(t,e,n){var i=Ro++;return t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},t.__ta[e][i]=n,n.__tauid=i,i}var Zo=/:not\(([^)]+)\)/;function Ko(t,e,n,i){if(null==t)return n;var o=t.split(","),s=[],r=[];h(o,(function(t){var e=t.match(Zo);null!=e?r.push(e[1]):s.push(t)})),r.length>0&&0===s.length&&s.push(it);var a=function i(o){i.__tauid=n.__tauid;var a=Fo(o),l=!1,c=a,u=Ho(o,a,e,null!=t);if(-1!=u.end)for(var h=0;!l&&h<u.end;h++){c=u.path[h];for(var d=0;d<r.length;d++)if(Lo(c,r[d],e))return;for(var p=0;!l&&p<s.length;p++)if(Lo(c,s[p],e)){n.apply(c,[o,c]),l=!0;break}}};return function(t,e,n){t.__taExtra=t.__taExtra||[],t.__taExtra.push([e,n])}(n,i,a),a}var $o=function(t,e,n,i,o){if(No()&&qo[e]){var s=Ko(i,t,n,qo[e]);zo(t,qo[e],s,n,o)}"focus"===e&&null==t.getAttribute(Ut)&&t.setAttribute(Ut,"1"),zo(t,e,Ko(i,t,n,e),n,o)},Qo={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}};function ts(t,e,n,i){for(var o in n.__tamee[t])n.__tamee[t].hasOwnProperty(o)&&n.__tamee[t][o].apply(i,[e])}var es=function(){function t(){Qn(this,t)}return ei(t,null,[{key:"generate",value:function(t,e){return function(n,i,o,s){if(i==Yi&&Bo())$o(n,i,o,s);else{if(null==n.__taTapHandler){var r=n.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},a=function(i){for(var o=Fo(i),a=Ho(i,o,n,null!=s),l=!1,h=0;h<a.end;h++){if(l)return;o=a.path[h];for(var d=0;d<r.downSelectors.length;d++)if(null==r.downSelectors[d]||Lo(o,r.downSelectors[d],n)){r.down=!0,setTimeout(c,t),setTimeout(u,e),l=!0;break}}},l=function(t){if(r.down){var e,i,o=Fo(t);r.taps++;var s=function(t){return Vo(t).length}(t);for(var a in Qo)if(Qo.hasOwnProperty(a)){var l=Qo[a];if(l.touches===s&&(1===l.taps||l.taps===r.taps))for(var c=0;c<r[a].length;c++){i=Ho(t,o,n,null!=r[a][c][1]);for(var u=0;u<i.end;u++)if(e=i.path[u],null==r[a][c][1]||Lo(e,r[a][c][1],n)){r[a][c][0].apply(e,[t,e]);break}}}}},c=function(){r.down=!1},u=function(){r.taps=0};n.__taTapHandler.downHandler=a,n.__taTapHandler.upHandler=l,$o(n,Ui,a),$o(n,Ki,l)}n.__taTapHandler.downSelectors.push(s),n.__taTapHandler[i].push([o,s]),o.__taUnstore=function(){null!=n.__taTapHandler&&(y(n.__taTapHandler.downSelectors,(function(t){return t===s})),function(t,e){var n,i=0;for(i=0,n=t.length;i<n&&t[i][0]!==e;i++);i<t.length&&t.splice(i,1)}(n.__taTapHandler[i],o),0===n.__taTapHandler.downSelectors.length&&(Uo(n,Ui,n.__taTapHandler.downHandler),Uo(n,Ki,n.__taTapHandler.upHandler),delete n.__taTapHandler))}}}}}]),t}(),ns=function(){function t(){Qn(this,t)}return ei(t,null,[{key:"generate",value:function(){var t=[];return function(e,n,i,o){if(!e.__tamee){e.__tamee={over:!1,mouseenter:[],mouseexit:[]};var s=function(n){var i=Fo(n);(null==o&&i==e&&!e.__tamee.over||Lo(i,o,e)&&(null==i.__tamee||!i.__tamee.over))&&(ts(Wi,n,e,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,t.push(i))},r=function(n){for(var i=Fo(n),o=0;o<t.length;o++)i!=t[o]||Lo(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,t.splice(o,1),ts(Ji,n,e,i))};zo(e,Qi,Ko(o,e,s,Qi),s),zo(e,$i,Ko(o,e,r,$i),r)}i.__taUnstore=function(){delete e.__tamee[n][i.__tauid]},Jo(e,n,i),e.__tamee[n][i.__tauid]=i}}}]),t}(),is=function(){function t(e){Qn(this,t),ni(this,"clickThreshold",void 0),ni(this,"dblClickThreshold",void 0),ni(this,"tapHandler",void 0),ni(this,"mouseEnterExitHandler",void 0),e=e||{},this.clickThreshold=e.clickThreshold||250,this.dblClickThreshold=e.dblClickThreshold||450,this.mouseEnterExitHandler=ns.generate(),this.tapHandler=es.generate(this.clickThreshold,this.dblClickThreshold)}return ei(t,[{key:"_doBind",value:function(t,e,n,i,o){if(null!=n){var s=t;e===to||e===zi||e===Yi?this.tapHandler(s,e,n,i,o):e===Wi||e==Ji?this.mouseEnterExitHandler(s,e,n,i,o):$o(s,e,n,i,o)}}},{key:"on",value:function(t,e,n,i,o){var s=null==i?null:n,r=null==i?n:i;return this._doBind(t,e,r,s,o),this}},{key:"off",value:function(t,e,n){return Uo(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){var s=Bo()&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),r=No()&&!Bo()&&qo[e]?qo[e]:e,a=!(No()&&!Bo()&&qo[e]),l=Yo(n),c=Xo(n,"screen"),u=function(t){return Xo(t,"client")}(n);return Wo(t,(function(t){var h;n=n||{screenX:c.x,screenY:c.y,clientX:u.x,clientY:u.y};var d,p={TouchEvent:function(e){var n=Go(t,l.x,l.y,c.x,c.y,u.x,u.y);(e.initTouchEvent||e.initEvent)(r,!0,!0,window,null,c.x,c.y,u.x,u.y,!1,!1,!1,!1,n,n,n,1,0)},MouseEvents:function(e){e.initMouseEvent(r,!0,!0,window,null==o?1:o,c.x,c.y,u.x,u.y,!1,!1,!1,!1,1,t)}},f=!a&&!s&&No()&&qo[e]?"TouchEvent":"MouseEvents";h=document.createEvent(f),p[f](h),d=h,i&&(d.payload=i),t.dispatchEvent(h)})),this}}]),t}();function os(t,e,n){if(di(e,n,t))return e;for(var i=e.parentNode;null!=i&&i!==t;){if(di(i,n,t))return i;i=i.parentNode}}function ss(t){return{x:t.offsetLeft,y:t.offsetTop}}function rs(t){return{w:t.offsetWidth,h:t.offsetHeight}}function as(t,e){t.style.left=e.x+"px",t.style.top=e.y+"px"}function ls(t,e,n){var i=e.parentNode,o=t.getSize(i),s=t.getSize(e),r=n.x,a=r+s.w,l=n.y,c=l+s.h;return a>0&&r<o.w&&c>0&&l<o.h}var cs,us="start",hs="beforeStart",ds="drag",ps="stop",fs="katavorio-draggable",vs=function(){return!0},ys=function(){return!1},gs="katavorio-delegated-draggable",ms="katavorio-drag-no-select",_s="katavorio-ghost-proxy",xs="katavorio-clone-drag",ks=[ps,us,ds,"drop","over","out",hs],bs=function(){},Cs=function(t,e){if(null!=t){t=i(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])}},Es=function(){function t(e,n){Qn(this,t),this.el=e,this.k=n,ni(this,"_class",void 0),ni(this,"uuid",C()),ni(this,"enabled",!0),ni(this,"scopes",[])}return ei(t,[{key:"setEnabled",value:function(t){this.enabled=t}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(t){var e={};for(var n in Cs(this.scopes,(function(t){e[t]=!0})),Cs(t?t.split(/\s+/):[],(function(t){e[t]=!0})),this.scopes.length=0,e)this.scopes.push(n)}},{key:"removeScope",value:function(t){var e={};for(var n in Cs(this.scopes,(function(t){e[t]=!0})),Cs(t?t.split(/\s+/):[],(function(t){delete e[t]})),this.scopes.length=0,e)this.scopes.push(n)}},{key:"toggleScope",value:function(t){var e={};for(var n in Cs(this.scopes,(function(t){e[t]=!0})),Cs(t?t.split(/\s+/):[],(function(t){e[t]?delete e[t]:e[t]=!0})),this.scopes.length=0,e)this.scopes.push(n)}}]),t}();!function(t){t.notNegative="notNegative",t.parent="parent",t.parentEnclosed="parentEnclosed"}(cs||(cs={}));var Ss=function(t){ii(n,t);var e=li(n);function n(t,i,o){var s;if(Qn(this,n),ni(ri(s=e.call(this,t,o)),"_class",void 0),ni(ri(s),"rightButtonCanDrag",void 0),ni(ri(s),"consumeStartEvent",void 0),ni(ri(s),"clone",void 0),ni(ri(s),"scroll",void 0),ni(ri(s),"trackScroll",void 0),ni(ri(s),"_downAt",void 0),ni(ri(s),"_posAtDown",void 0),ni(ri(s),"_pagePosAtDown",void 0),ni(ri(s),"_pageDelta",{x:0,y:0}),ni(ri(s),"_moving",void 0),ni(ri(s),"_lastPosition",void 0),ni(ri(s),"_lastScrollValues",{x:0,y:0}),ni(ri(s),"_initialScroll",{x:0,y:0}),ni(ri(s),"_size",void 0),ni(ri(s),"_currentParentPosition",void 0),ni(ri(s),"_ghostParentPosition",void 0),ni(ri(s),"_dragEl",void 0),ni(ri(s),"_multipleDrop",void 0),ni(ri(s),"_ghostProxyOffsets",void 0),ni(ri(s),"_ghostDx",void 0),ni(ri(s),"_ghostDy",void 0),ni(ri(s),"_isConstrained",!1),ni(ri(s),"_ghostProxyParent",void 0),ni(ri(s),"_useGhostProxy",void 0),ni(ri(s),"_ghostProxyFunction",void 0),ni(ri(s),"_activeSelectorParams",void 0),ni(ri(s),"_availableSelectors",[]),ni(ri(s),"_canDrag",void 0),ni(ri(s),"_consumeFilteredEvents",void 0),ni(ri(s),"_parent",void 0),ni(ri(s),"_ignoreZoom",void 0),ni(ri(s),"_filters",{}),ni(ri(s),"_constrainRect",void 0),ni(ri(s),"_elementToDrag",void 0),ni(ri(s),"downListener",void 0),ni(ri(s),"moveListener",void 0),ni(ri(s),"upListener",void 0),ni(ri(s),"scrollTracker",void 0),ni(ri(s),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),s._class=s.k.css.draggable,_i(s.el,s._class),s.downListener=s._downListener.bind(ri(s)),s.upListener=s._upListener.bind(ri(s)),s.moveListener=s._moveListener.bind(ri(s)),s.rightButtonCanDrag=!0===i.rightButtonCanDrag,s.consumeStartEvent=!1!==i.consumeStartEvent,s._dragEl=s.el,s.clone=!0===i.clone,s.scroll=!0===i.scroll,s.trackScroll=!1!==i.trackScroll,s._multipleDrop=!1!==i.multipleDrop,s._canDrag=i.canDrag||vs,s._consumeFilteredEvents=i.consumeFilteredEvents,s._parent=i.parent,s._ignoreZoom=!0===i.ignoreZoom,s._ghostProxyParent=i.ghostProxyParent,s.trackScroll&&(s.scrollTracker=s._trackScroll.bind(ri(s)),document.addEventListener("scroll",s.scrollTracker)),!0===i.ghostProxy?s._useGhostProxy=vs:i.ghostProxy&&"function"==typeof i.ghostProxy?s._useGhostProxy=i.ghostProxy:s._useGhostProxy=function(t,e){return!(!s._activeSelectorParams||!s._activeSelectorParams.useGhostProxy)&&s._activeSelectorParams.useGhostProxy(t,e)},i.makeGhostProxy?s._ghostProxyFunction=i.makeGhostProxy:s._ghostProxyFunction=function(t){return s._activeSelectorParams&&s._activeSelectorParams.makeGhostProxy?s._activeSelectorParams.makeGhostProxy(t):t.cloneNode(!0)},i.selector){var r=s.el.getAttribute(fs);null==r&&(r=""+(new Date).getTime(),s.el.setAttribute("katavorio-draggable",r)),s._availableSelectors.push(i)}return s.k.eventManager.on(s.el,Ui,s.downListener),s}return ei(n,[{key:"_trackScroll",value:function(t){if(this._moving){var e={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=e.x-this._lastScrollValues.x,i=e.y-this._lastScrollValues.y,o={x:n+this._lastPosition.x,y:i+this._lastPosition.y},s=o.x-this._downAt.x,r=o.y-this._downAt.y,a=this._ignoreZoom?1:this.k.getZoom();this._dragEl&&this._dragEl.parentNode&&(s+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,r+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),s/=a,r/=a,this.moveBy(s,r,t),this._lastPosition=o,this._lastScrollValues=e}}},{key:"on",value:function(t,e){this.listeners[t]&&this.listeners[t].push(e)}},{key:"off",value:function(t,e){if(this.listeners[t]){for(var n=[],i=0;i<this.listeners[t].length;i++)this.listeners[t][i]!==e&&n.push(this.listeners[t][i]);this.listeners[t]=n}}},{key:"_upListener",value:function(t){this._downAt&&(this._downAt=null,this.k.eventManager.off(document,Zi,this.moveListener),this.k.eventManager.off(document,Ki,this.upListener),xi(document.body,ms),this.unmark(t),this.stop(t),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,ss(this._dragEl))&&(as(this._dragEl,this._posAtDown),this._dispatch(eo,this._dragEl)))}},{key:"_downListener",value:function(t){if(!t.defaultPrevented&&((this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this._canDrag())){var e=this._testFilter(t)&&function(t,e,n){return!di(t.srcElement||t.target,n.getInputFilterSelector(),e)}(t,this.el,this.k);if(e){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var n=t.target||t.srcElement,i=function(t,e,n){for(var i=null,o=e.getAttribute("katavorio-draggable"),s=null!=o?"[katavorio-draggable='"+o+"'] ":"",r=0;r<t.length;r++)if(null!=(i=os(e,n,s+t[r].selector))){if(t[r].filter){var a=di(n,t[r].filter,i);if(!0===t[r].filterExclude&&!a||a)return null}return[t[r],i]}return null}(this._availableSelectors,this.el,n);if(null!=i&&(this._activeSelectorParams=i[0],this._elementToDrag=i[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var o=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag):null;if(null!=o&&(this._elementToDrag=o),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),_i(this._dragEl,xs),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var s=ss(this.el);this._dragEl.style.left=s.x+"px",this._dragEl.style.top=s.y+"px",this._parent.appendChild(this._dragEl)}else{var r=Ci(this._elementToDrag);this._dragEl.style.left=r.x+"px",this._dragEl.style.top=r.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&pi(t),this._downAt=Yo(t),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=ss(this._dragEl),this._pagePosAtDown=Ci(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=rs(this._dragEl),this.k.eventManager.on(document,Zi,this.moveListener),this.k.eventManager.on(document,Ki,this.upListener),_i(document.body,ms),this._dispatch(hs,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size})}else this._consumeFilteredEvents&&pi(t)}}},{key:"_moveListener",value:function(t){if(this._downAt){if(!this._moving){var e=this._dispatch(us,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size});if(!1!==e){if(!this._downAt)return;this.mark(e),this._moving=!0}else this.abort()}if(this._downAt){var n=Yo(t),i=n.x-this._downAt.x,o=n.y-this._downAt.y,s=this._ignoreZoom?1:this.k.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,o+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),i/=s,o/=s,this.moveBy(i,o,t)}}}},{key:"mark",value:function(t){var e;this._posAtDown=ss(this._dragEl),this._pagePosAtDown=Ci(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=rs(this._dragEl),_i(this._dragEl,this.k.css.drag),this._constrainRect={w:(e=this._dragEl).parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop},this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(t){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,xi(this._dragEl,this.k.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(t,e,n){var i=this.toGrid({x:this._posAtDown.x+t,y:this._posAtDown.y+e}),o=this._doConstrain(i,this._dragEl,this._constrainRect,this._size);if(this._useGhostProxy(this.el,this._dragEl))if(i.x!==o.x||i.y!==o.y){if(!this._isConstrained){var s=this._ghostProxyFunction(this._elementToDrag);_i(s,_s),this._ghostProxyParent?(this._ghostProxyParent.appendChild(s),this._currentParentPosition=Ci(this._elementToDrag.parentNode),this._ghostParentPosition=Ci(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(s),this._dragEl=s,this._isConstrained=!0}o=i}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);as(this._dragEl,{x:o.x+this._ghostDx,y:o.y+this._ghostDy}),this._dispatch(ds,{el:this.el,pos:o,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(t){return t?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(t,e){if(e||this._moving){var n=[],i=ss(this._dragEl);n.push([this._dragEl,i,this,this._size]),this._dispatch(ps,{el:this._dragEl,pos:this._ghostProxyOffsets||i,finalPos:i,e:t,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(t,e){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[t])n=this._activeSelectorParams[t](e);else if(this.listeners[t])for(var i=0;i<this.listeners[t].length;i++)try{var o=this.listeners[t][i](e);null!=o&&(n=o)}catch(t){}return n}},{key:"resolveGrid",value:function(){var t={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(t.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(t.thresholdX=this._activeSelectorParams.snapThreshold,t.thresholdY=this._activeSelectorParams.snapThreshold)),t}},{key:"toGrid",value:function(t){var e=this.resolveGrid(),n=e.grid,i=e.thresholdX,o=e.thresholdY;return null==n?t:function(t,e,n,i){n=null==n?null==e.thresholdX?e.w/2:e.thresholdX:n,i=null==i?null==e.thresholdY?e.h/2:e.thresholdY:i;var o=Math.floor(t.x/e.w),s=e.w*o,r=s+e.w,a=Math.abs(t.x-s)<=n?s:Math.abs(r-t.x)<=n?r:t.x,l=Math.floor(t.y/e.h),c=e.h*l,u=c+e.h;return{x:a,y:Math.abs(t.y-c)<=i?c:Math.abs(u-t.y)<=i?u:t.y}}(t,n,n?n.w/2:i,n?n.h/2:o)}},{key:"setUseGhostProxy",value:function(t){this._useGhostProxy=t?vs:ys}},{key:"_doConstrain",value:function(t,e,n,i){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(t,e,n,i):t}},{key:"_testFilter",value:function(t){for(var e in this._filters){var n=this._filters[e],i=n[0](t);if(n[1]&&(i=!i),!i)return!1}return!0}},{key:"addFilter",value:function(t,e){var n,o=this;if(t){var s="function"==typeof(n=t)?(n._katavorioId=C(),n._katavorioId):n;this._filters[s]=[function(e){var n,s=e.srcElement||e.target;return i(t)?n=di(s,t,o.el):"function"==typeof t&&(n=t(e,o.el)),n},!1!==e]}}},{key:"removeFilter",value:function(t){var e="function"==typeof t?t._katavorioId:t;delete this._filters[e]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(t,e){t.selector&&(e?this._availableSelectors.unshift(t):this._availableSelectors.push(t))}},{key:"destroy",value:function(){this.k.eventManager.off(this.el,Ui,this.downListener),this.k.eventManager.off(document,Zi,this.moveListener),this.k.eventManager.off(document,Ki,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,null!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]),n}(Es),Ps=["input","textarea","select","button","option"].join(","),ws=function(){function t(n){Qn(this,t),ni(this,"eventManager",void 0),ni(this,"zoom",1),ni(this,"css",{}),ni(this,"inputFilterSelector",void 0),n=n||{},this.inputFilterSelector=n.inputFilterSelector||Ps,this.eventManager=new is,this.zoom=n.zoom||1;var i=n.css||{};e(this.css,i)}return ei(t,[{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(t){this.zoom=t}},{key:"_prepareParams",value:function(t){t=t||{};var e,n={events:{}};for(e in t)n[e]=t[e];for(e=0;e<ks.length;e++)n.events[ks[e]]=t[ks[e]]||bs;return n}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(t){return this.inputFilterSelector=t,this}},{key:"draggable",value:function(t,e){if(null==t._katavorioDrag){var n=this._prepareParams(e),i=new Ss(t,n,this);return _i(t,gs),t._katavorioDrag=i,i}return t._katavorioDrag}},{key:"destroyDraggable",value:function(t){t._katavorioDrag&&(t._katavorioDrag.destroy(),delete t._katavorioDrag)}}]),t}(),As="jtk-drag-selected",Ds=function(){function t(e){Qn(this,t),this.instance=e,ni(this,"_dragSelection",[]),ni(this,"_dragSizes",new Map),ni(this,"_dragElements",new Map),ni(this,"_dragElementStartPositions",new Map),ni(this,"_dragElementPositions",new Map),ni(this,"__activeSet",void 0)}return ei(t,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(t){var e=this;this.__activeSet=[],h(this._dragSelection,(function(n){t(n)&&e.__activeSet.push(n)}))}},{key:"clear",value:function(){var t=this;this.reset(),h(this._dragSelection,(function(e){return t.instance.removeClass(e.jel,As)})),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var t=this;h(this._activeSet,(function(e){var n={x:parseInt(""+e.jel.offsetLeft,10),y:parseInt(""+e.jel.offsetTop,10)};t._dragElementStartPositions.set(e.id,n),t._dragElementPositions.set(e.id,n),t._dragSizes.set(e.id,t.instance.getSize(e.jel))}))}},{key:"updatePositions",value:function(t,e,n){var i=this,o=t.x-e.x,s=t.y-e.y;h(this._activeSet,(function(t){var e=i._dragElementStartPositions.get(t.id);if(e){var r=e.x+o,a=e.y+s,l=i._dragSizes.get(t.id),c={x:r,y:a,w:l.w,h:l.h};if(t.jel._jsPlumbParentGroup&&t.jel._jsPlumbParentGroup.constrain){var u={w:t.jel.parentNode.offsetWidth+t.jel.parentNode.scrollLeft,h:t.jel.parentNode.offsetHeight+t.jel.parentNode.scrollTop};c.x=Math.max(c.x,0),c.y=Math.max(c.y,0),c.x=Math.min(c.x,u.w-l.w),c.y=Math.min(c.y,u.h-l.h)}i._dragElementPositions.set(t.id,{x:r,y:a}),t.jel.style.left=c.x+"px",t.jel.style.top=c.y+"px",n(t.jel,t.id,l,c)}}))}},{key:"each",value:function(t){var e=this;h(this._activeSet,(function(n){var i=e._dragSizes.get(n.id),o=e._dragElementPositions.get(n.id),s=e._dragElementStartPositions.get(n.id);t(n.jel,n.id,o,i,s)}))}},{key:"add",value:function(t,e){var n=t;e=e||this.instance.getId(n),-1===d(this._dragSelection,(function(t){return t.id===e}))&&(this.instance.addClass(t,As),this._dragSelection.push({id:e,jel:n}))}},{key:"remove",value:function(t){var e=this,n=t;this._dragSelection=this._dragSelection.filter((function(t){var i=t.jel!==n;return i||e.instance.removeClass(t.jel,As),i}))}},{key:"toggle",value:function(t){var e=t;-1!==d(this._dragSelection,(function(t){return t.jel===e}))?this.remove(e):this.add(t)}}]),t}(),Ms="jtk-drag-active",js="jtk-drag-hover",Ts=function(){function t(e,n,i){var o=this;Qn(this,t),this.instance=e,this.dragSelection=n,ni(this,"collicat",void 0),ni(this,"drag",void 0),ni(this,"_draggables",{}),ni(this,"_dlist",[]),ni(this,"_elementsWithEndpoints",{}),ni(this,"_draggablesForElements",{}),ni(this,"handlers",[]),ni(this,"_trackScroll",void 0),ni(this,"_filtersToAdd",[]),this.collicat=new ws({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:"jtk-delegated-draggable",draggable:"jtk-draggable",drag:"jtk-drag",selected:As,active:Ms,hover:js,ghostProxy:"jtk-ghost-proxy"}}),this.instance.bind(ae,(function(t){o.collicat.setZoom(t)})),i=i||{},this._trackScroll=!1!==i.trackScroll}return ei(t,[{key:"addHandler",value:function(t,n){var i=this,o=e({selector:t.selector},n||{});o.start=A(o.start,(function(e){return t.onStart(e)}),!1),o.drag=A(o.drag,(function(e){return t.onDrag(e)})),o.stop=A(o.stop,(function(e){return t.onStop(e)}));var s=(t.onBeforeStart||function(t){}).bind(t);if(o.beforeStart=A(o.beforeStart,(function(t){return s(t)})),o.dragInit=function(e){return t.onDragInit(e)},o.dragAbort=function(e){return t.onDragAbort(e)},t.useGhostProxy&&(o.useGhostProxy=t.useGhostProxy,o.makeGhostProxy=t.makeGhostProxy),null==o.constrainFunction&&null!=o.containment)switch(o.containment){case cs.notNegative:o.constrainFunction=function(t,e,n,i){return{x:Math.max(0,Math.min(t.x)),y:Math.max(0,Math.min(t.y))}};break;case cs.parent:var r=o.containmentPadding||5;o.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x>n.w-r?n.w-r:t.x,y:t.y<0?0:t.y>n.h-r?n.h-r:t.y}};break;case cs.parentEnclosed:o.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x+i.w>n.w?n.w-i.w:t.x,y:t.y<0?0:t.y+i.h>n.h?n.h-i.h:t.y}}}null==this.drag?(o.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),o),h(this._filtersToAdd,(function(t){return i.drag.addFilter(t[0],t[1])})),this.drag.on(eo,(function(t){i.instance.revalidate(t)}))):this.drag.addSelector(o),this.handlers.push({handler:t,options:o}),t.init(this.drag)}},{key:"addSelector",value:function(t,e){this.drag&&this.drag.addSelector(t,e)}},{key:"addFilter",value:function(t,e){null==this.drag?this._filtersToAdd.push([t,!0===e]):this.drag.addFilter(t,e)}},{key:"removeFilter",value:function(t){null!=this.drag&&this.drag.removeFilter(t)}},{key:"setFilters",value:function(t){var e=this;h(t,(function(t){e.drag.addFilter(t[0],t[1])}))}},{key:"reset",value:function(){var t=[];if(h(this.handlers,(function(t){t.handler.reset()})),this.handlers.length=0,null!=this.drag){var e=this.drag._filters;for(var n in e)t.push([n,e[n][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,t}},{key:"setOption",value:function(t,n){var i=p(this.handlers,(function(e){return e.handler===t}));null!=i&&e(i.options,n||{})}}]),t}();function Is(t,e){return i(e)?{id:e,active:!0}:{id:t.getId(e),active:e.active}}var Os=function(){function t(e,n){Qn(this,t),this.instance=e,this._dragSelection=n,ni(this,"selector","> "+ue+":not("+Lt(te)+")"),ni(this,"_dragOffset",null),ni(this,"_groupLocations",[]),ni(this,"_intersectingGroups",[]),ni(this,"_currentDragParentGroup",null),ni(this,"_dragGroupByElementIdMap",{}),ni(this,"_dragGroupMap",{}),ni(this,"_currentDragGroup",null),ni(this,"_currentDragGroupOffsets",new Map),ni(this,"_currentDragGroupSizes",new Map),ni(this,"_dragPayload",null),ni(this,"drag",void 0),ni(this,"originalPosition",void 0)}return ei(t,[{key:"onDragInit",value:function(t){return null}},{key:"onDragAbort",value:function(t){return null}},{key:"getDropGroup",value:function(){var t=null;if(this._intersectingGroups.length>0){var e=this._intersectingGroups[0].groupLoc.group,n=this._intersectingGroups[0].intersectingElement,i=n._jsPlumbParentGroup;i!==e&&(null!=i&&i.overrideDrop(n,e)||(t=this._intersectingGroups[0]))}return t}},{key:"onStop",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.getDropGroup(),o=[];if(o.push({el:n,id:this.instance.getId(n),pos:t.finalPos,originalGroup:n._jsPlumbParentGroup,redrawResult:null,originalPos:t.originalPos,reverted:!1,dropGroup:null!=i?i.groupLoc.group:null}),this._dragSelection.each((function(e,n,s,r,a){if(e!==t.el){var l={x:s.x,y:s.y},c=l.x,u=l.y;if(e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain){var h={w:e.parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop};c=Math.max(c,0),u=Math.max(u,0),c=Math.min(c,h.w-r.w),u=Math.min(u,h.h-r.h),l.x=c,l.y=u}o.push({el:e,id:n,pos:l,originalPos:a,originalGroup:e._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null!=i?i.groupLoc.group:null})}})),h(o,(function(t){var n=null!=t.originalGroup,o=n&&ls(e.instance,t.el,t.pos),s={x:0,y:0};if(n&&!o){if(null==i){var r=e._pruneOrOrphan(t,!0,!0);null!=r.pos?t.pos=r.pos.pos:!r.pruned&&t.originalGroup.revert&&(t.pos=t.originalPos,t.reverted=!0)}}else n&&o&&(s=e.instance.viewport.getPosition(t.originalGroup.elId));null==i||o?t.dropGroup=null:e.instance.groupManager.addToGroup(i.groupLoc.group,!1,t.el),t.reverted&&e.instance.setPosition(t.el,t.pos),t.redrawResult=e.instance.setElementPosition(t.el,t.pos.x+s.x,t.pos.y+s.y),e.instance.removeClass(t.el,"jtk-dragged"),e.instance.select({source:t.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:t.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0)})),null!=o[0].originalGroup){var s=n._jsPlumbParentGroup;if(s!==o[0].originalGroup){var r=t.drag.getDragElement(!0);if(o[0].originalGroup.ghost){var a=this.instance.getOffset(this.instance.getGroupContentArea(s)),l=this.instance.getOffset(this.instance.getGroupContentArea(o[0].originalGroup)),c={x:l.x+t.pos.x-a.x,y:l.y+t.pos.y-a.y};r.style.left=c.x+"px",r.style.top=c.y+"px",this.instance.revalidate(r)}}}this.instance.fire("drag:stop",{elements:o,e:t.e,el:n,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var t=this;h(this._groupLocations,(function(e){t.instance.removeClass(e.el,Ms),t.instance.removeClass(e.el,js)})),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(t){this.drag=t}},{key:"onDrag",value:function(t){var e=this,n=t.drag.getDragElement(),i=t.pos,o=this.instance.getSize(n),s={x:i.x,y:i.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(s.x+=this._dragOffset.x,s.y+=this._dragOffset.y);var r=function(n,i,o){if(o){var s=new Set;h(e._groupLocations,(function(n){!s.has(n.group.id)&&W(i,n.r)?(n.group!==e._currentDragParentGroup&&e.instance.addClass(n.el,js),e._intersectingGroups.push({groupLoc:n,intersectingElement:t.drag.getDragElement(!0),d:0}),h(e.instance.groupManager.getAncestors(n.group),(function(t){return s.add(t.id)}))):e.instance.removeClass(n.el,js)}))}e.instance.setElementPosition(n,i.x,i.y),e.instance.fire("drag:move",{el:n,e:t.e,pos:{x:i.x,y:i.y},originalPosition:e.originalPosition,payload:e._dragPayload})},a={x:s.x,y:s.y,w:o.w,h:o.h};r(n,a,!0),this._dragSelection.updatePositions(i,this.originalPosition,(function(t,e,n,i){r(t,i,!1)})),this._currentDragGroupOffsets.forEach((function(t,n){var i=e._currentDragGroupSizes.get(n),o={x:a.x+t[0].x,y:a.y+t[0].y,w:i.w,h:i.h};t[1].style.left=o.x+"px",t[1].style.top=o.y+"px",r(t[1],o,!1)}))}},{key:"onStart",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.instance.getOffset(n);this.originalPosition={x:t.pos.x,y:t.pos.y},n._jsPlumbParentGroup&&(this._dragOffset=this.instance.getOffset(n.offsetParent),this._currentDragParentGroup=n._jsPlumbParentGroup);var o=!0,s=n.getAttribute(zt);if((!1===this.instance.elementsDraggable||null!=s&&s!==nt)&&(o=!1),o){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var r=t.drag.getDragElement(!0),a=r.querySelectorAll(ue),l=function(t){for(var e=[],n=t._jsPlumbParentGroup;null!=n;)e.push(n.el),n=n.group;return e}(r),c=[];Array.prototype.push.apply(c,a),Array.prototype.push.apply(c,l),this._dragSelection.filterActiveSet((function(t){return-1===c.indexOf(t.jel)})),this._dragSelection.initialisePositions();var u=function(n){if(!n._isJsPlumbGroup||e.instance.allowNestedGroups){var i=!n._jsPlumbParentGroup,o=i||!0!==n._jsPlumbParentGroup.dropOverride,s=!i&&(n._jsPlumbParentGroup.ghost||!0!==n._jsPlumbParentGroup.constrain);(i||o&&s)&&(h(e.instance.groupManager.getGroups(),(function(t){var i=n._jsPlumbGroup;if(!1!==t.droppable&&!1!==t.enabled&&n._jsPlumbGroup!==t&&!e.instance.groupManager.isDescendant(t,i)){var o=t.el,s=e.instance.getSize(o),r=e.instance.getOffset(o),a={el:o,r:{x:r.x,y:r.y,w:s.w,h:s.h},group:t};e._groupLocations.push(a),t!==e._currentDragParentGroup&&e.instance.addClass(o,Ms)}})),e._groupLocations.sort((function(t,n){return e.instance.groupManager.isDescendant(t.group,n.group)?-1:e.instance.groupManager.isAncestor(n.group,t.group)?1:0})))}return e.instance.select({source:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0),e.instance.fire("drag:start",{el:n,e:t.e,originalPosition:e.originalPosition,pos:e.originalPosition})},d=this.instance.getId(n);this._currentDragGroup=this._dragGroupByElementIdMap[d],this._currentDragGroup&&!function(t,e){var n=f(t.members,(function(t){return t.el===e}));return null!==n&&!0===n.active}(this._currentDragGroup,n)&&(this._currentDragGroup=null);var p=u(n);if(!1===p)return this._cleanup(),!1;this._dragPayload=p,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach((function(t){var n=e.instance.getOffset(t.el);e._currentDragGroupOffsets.set(t.elId,[{x:n.x-i.x,y:n.y-i.y},t.el]),e._currentDragGroupSizes.set(t.elId,e.instance.getSize(t.el)),u(t.el)})))}return o}},{key:"addToDragGroup",value:function(t){var e=this,n=Is(this.instance,t),i=this._dragGroupMap[n.id];null==i&&(i={id:n.id,members:new Set},this._dragGroupMap[n.id]=i);for(var o=arguments.length,s=new Array(o>1?o-1:0),r=1;r<o;r++)s[r-1]=arguments[r];this.removeFromDragGroup.apply(this,s),h(s,(function(t){var o=e.instance.getId(t);i.members.add({elId:o,el:t,active:n.active}),e._dragGroupByElementIdMap[o]=i}))}},{key:"removeFromDragGroup",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];h(n,(function(e){var n=t.instance.getId(e),i=t._dragGroupByElementIdMap[n];if(null!=i){var o=new Set;i.members.forEach((function(t){t.el!==e&&o.add(t)})),i.members=o,delete t._dragGroupByElementIdMap[n]}}))}},{key:"setDragGroupState",value:function(t){for(var e=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var s=i.map((function(t){return e.instance.getId(t)}));h(s,(function(n){var i=e._dragGroupByElementIdMap[n];if(null!=i){var o=f(i.members,(function(t){return t.elId===n}));null!=o&&(o.active=t)}}))}},{key:"_pruneOrOrphan",value:function(t,e,n){var i=t.el,o={pruned:!1,pos:null};if(n||!ls(this.instance,i,t.pos)){var s=i._jsPlumbParentGroup;s.prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):s.remove(t.el,!0),o.pruned=!0):s.orphan&&(o.pos=this.instance.groupManager.orphan(t.el,e),i._isJsPlumbGroup?s.removeGroup(i._jsPlumbGroup):s.remove(t.el))}return o}}]),t}();function Gs(t,e,n,i,o){var s=function(t,e){return new Fe(t,e)}(o,i),r={paintStyle:t.getPaintStyle(),preparedAnchor:s,element:i,scope:t.scope};null!=e&&(M(e,Ct)?r.existingEndpoint=e:r.endpoint=e);var a=o._internal_newEndpoint(r);return o._paintEndpoint(a,{}),a}function Ls(t,e,n,i,o){for(var s=t.target||t.srcElement,r=!1,a=i.getSelector(e,n),l=0;l<a.length;l++)if(a[l]===s){r=!0;break}return o?!r:r}var Fs=Lt(Ms,js),Hs="sourceSelectorEndpoint",Rs=function(){function t(e){Qn(this,t),this.instance=e,ni(this,"jpc",void 0),ni(this,"existingJpc",void 0),ni(this,"_originalAnchorSpec",void 0),ni(this,"ep",void 0),ni(this,"endpointRepresentation",void 0),ni(this,"canvasElement",void 0),ni(this,"_activeDefinition",void 0),ni(this,"placeholderInfo",{id:null,element:null}),ni(this,"floatingIndex",void 0),ni(this,"floatingId",void 0),ni(this,"floatingElement",void 0),ni(this,"floatingEndpoint",void 0),ni(this,"floatingAnchor",void 0),ni(this,"_stopped",void 0),ni(this,"inPlaceCopy",void 0),ni(this,"endpointDropTargets",[]),ni(this,"currentDropTarget",null),ni(this,"payload",void 0),ni(this,"floatingConnections",{}),ni(this,"_forceReattach",void 0),ni(this,"_forceDetach",void 0),ni(this,"mousedownHandler",void 0),ni(this,"mouseupHandler",void 0),ni(this,"selector",Lt(Kt));var n=e.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),e.on(n,Ui,ue,this.mousedownHandler),e.on(n,Ki,[ue,Lt(Kt)].join(","),this.mouseupHandler)}return ei(t,[{key:"_resolveDragParent",value:function(t,e){var n=this.instance.getContainer(),i=fi(e,ue,n,!0);if(null!=t.parentSelector){var o=fi(e,t.parentSelector,n,!0);return null!=o&&(i=fi(o.parentNode,ue,n,!1)),o||i}return i}},{key:"_mousedownHandler",value:function(t){var n,i;if(3!==t.which&&2!==t.button){var o=t.target||t.srcElement;if((null==(i=this._getSourceDefinition(t))||null!=(n=this._resolveDragParent(i.def.def,o))&&n.getAttribute(Fi)!==nt)&&i){var s,r=t.currentTarget;if(o.getAttribute(Fi)!==nt){if(pi(t),this._activeDefinition=i,null!=(s=i.def.def).canAcceptNewConnection&&!s.canAcceptNewConnection(n,t))return!1;var a=Ws(t,n,this.instance.currentZoom),c={element:n};if(e(c,s),c.isTemporarySource=!0,s.scope)c.scope=s.scope;else{var u=o.getAttribute(Hi);null!=u&&(c.scope=u)}if(null!=(c=l(c,s.parameterExtractor?s.parameterExtractor(n,o,t):{})).maxConnections&&c.maxConnections>=0)if(this.instance.select({source:n}).length>=c.maxConnections)return pi(t),s.onMaxConnections&&s.onMaxConnections({element:n,maxConnections:c.maxConnections},t),t.stopImmediatePropagation&&t.stopImmediatePropagation(),!1;if(s.anchorPositionFinder){var h=s.anchorPositionFinder(n,a,s,t);null!=h&&(c.anchor=h)}this._originalAnchorSpec=c.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var d=this.instance.router.prepareAnchor(this._originalAnchorSpec),p=[a.x,a.y,0,0];if(d.locations.length>0)p[2]=d.locations[0].ox,p[3]=d.locations[0].oy;else if(d.isContinuous){var f=a.x<.5?a.x:1-a.x,v=a.y<.5?a.y:1-a.y;p[2]=f<v?a.x<.5?-1:1:0,p[3]=v<f?a.y<.5?-1:1:0}c.anchor=p,c.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(c);var y={};if(s.extract){for(var g in s.extract){var m=o.getAttribute(g);m&&(y[s.extract[g]]=m)}this.ep.mergeParameters(y)}if(c.uniqueEndpoint){var _=this.ep.elementId,x=this.instance.getManagedData(_,Hs,i.id);null==x?(this.instance.setManagedData(_,Hs,i.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=x}r._jsPlumbOrphanedEndpoints=r._jsPlumbOrphanedEndpoints||[],r._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,Ui,t,y)}}}}},{key:"_mouseupHandler",value:function(t){var e=t.currentTarget||t.srcElement;e._jsPlumbOrphanedEndpoints&&(!function(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)e(t[n])}(e._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),e._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(t){var e=this.instance.getOffset(t),n=this.instance.getSize(t);return this._makeDraggablePlaceholder(e,n),this.placeholderInfo.element.jtk=t.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(t){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(t,e){this.placeholderInfo=this.placeholderInfo||{};var n=ki(qi,{position:"absolute"});this.instance._appendElement(n,this.instance.getContainer());var i=this.instance.getId(n);return this.instance.setPosition(n,t),n.style.width=e.w+"px",n.style.height=e.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n,n}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var t=this.instance.getContainer();this.instance.off(t,Ki,this.mouseupHandler),this.instance.off(t,Ui,this.mousedownHandler)}},{key:"init",value:function(t){}},{key:"startNewConnectionDrag",value:function(t,e){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:t,data:e}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(no,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var t=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(no,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[t].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,t),this.jpc.suspendedEndpoint=this.jpc.endpoints[t],this.jpc.suspendedElement=this.jpc.endpoints[t].element,this.jpc.suspendedElementId=this.jpc.endpoints[t].elementId,this.jpc.suspendedElementType=0===t?Ht:Rt,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[t]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=t}},{key:"_shouldStartDrag",value:function(){var t=!0;this.ep.enabled||(t=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(t=!1),!this.ep.isSource||!this.ep.isFull()||null!=this.jpc&&this.ep.dragAllowedWhenFull||(t=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?t=!1:this.jpc=null);var n={},i=this.instance.checkCondition(null==this.jpc?"beforeDrag":"beforeStartDetach",{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===i?t=!1:"object"===$n(i)?e(n=i,this.payload||{}):n=this.payload||{},[t,n]}},{key:"_createFloatingEndpoint",value:function(t){var e=this.ep.endpoint;null!=this.ep.edgeType&&(e=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]);this.floatingEndpoint=Gs(this.ep,e,0,this.placeholderInfo.element,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(t,e,n){var i,o,s,r=this,a=this.jpc&&this.jpc.endpoints[0]===this.ep;if(h(this.instance.getContainer().querySelectorAll([".",Kt,"[",Wt,this.ep.scope,"]"].join("")),(function(e){if((null!=r.jpc||e!==t)&&e!==r.floatingElement&&!e.jtk.endpoint.isFull()&&(a&&e.jtk.endpoint.isSource||!a&&e.jtk.endpoint.isTarget)){var n=r.instance.getOffset(e),o=r.instance.getSize(e);i={x:n.x,y:n.y,w:o.w,h:o.h},r.endpointDropTargets.push({el:e,targetEl:e,r:i,endpoint:e.jtk.endpoint,def:null}),r.instance.addClass(e,Ms)}})),a){var l=p(this.instance.sourceSelectors,(function(t){return t.isEnabled()&&(null==t.def.def.scope||t.def.def.scope===r.ep.scope)}));if(null!=l)h(this.instance.getContainer().querySelectorAll("any"===l.redrop?ue:l.selector),(function(t){if(t.getAttribute(Fi)!==nt){var e=t.getAttribute(Hi);if(null!=e&&e!==r.ep.scope)return;var n={r:null,el:t};n.targetEl=fi(t,ue,r.instance.getContainer(),!0);var i=r.instance.getOffset(n.el),o=r.instance.getSize(n.el);n.r={x:i.x,y:i.y,w:o.w,h:o.h},null!=l.def.def.rank&&(n.rank=l.def.def.rank),n.def=l,r.endpointDropTargets.push(n),r.instance.addClass(n.targetEl,Ms)}}))}else{var c=(o=this.instance.targetSelectors,s=function(t,e){var n=[];if(t)for(var i=0;i<t.length;i++)e(t[i])&&n.push(i);return n}(o,(function(t){return t.isEnabled()})),s.map((function(t){return o[t]})));c.forEach((function(t){h(r.instance.getContainer().querySelectorAll(t.selector),(function(e){if(e.getAttribute(Fi)!==nt){var i=e.getAttribute(Hi);if(null!=i&&i!==r.ep.scope)return;var o={r:null,el:e};if(null!=t.def.def.parentSelector&&(o.targetEl=fi(e,t.def.def.parentSelector,r.instance.getContainer(),!0)),null==o.targetEl&&(o.targetEl=fi(e,ue,r.instance.getContainer(),!0)),(!1===t.def.def.allowLoopback||r._activeDefinition&&!1===r._activeDefinition.def.def.allowLoopback)&&o.targetEl===r.ep.element)return;if(null!=t.def.def.canAcceptNewConnection&&!t.def.def.canAcceptNewConnection(o.targetEl,n))return;var s=t.def.def.maxConnections;if(null!=s&&-1!==s&&r.instance.select({target:o.targetEl}).length>=s)return;var a=r.instance.getOffset(e),l=r.instance.getSize(e);o.r={x:a.x,y:a.y,w:l.w,h:l.h},o.def=t.def,null!=t.def.def.rank&&(o.rank=t.def.def.rank),r.endpointDropTargets.push(o),r.instance.addClass(o.targetEl,Ms)}}))}))}this.endpointDropTargets.sort((function(t,e){if(t.targetEl._isJsPlumbGroup&&!e.targetEl._isJsPlumbGroup)return 1;if(!t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup)return-1;if(t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup){if(r.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup))return-1;if(r.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup))return 1}else{if(null==t.rank||null==e.rank)return 0;if(t.rank>e.rank)return-1;if(t.rank<e.rank)return 1}}))}},{key:"onStart",value:function(t){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var e=t.drag.getDragElement();this.ep=e.jtk.endpoint;var n=t.e.srcElement||t.e.target;if(!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var i=ui(this._shouldStartDrag(),2),o=i[0],s=i[1];if(!1===o)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,n,t.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,s):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc,this.floatingEndpoint),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(t){this.payload=t.e.payload||{}}},{key:"onDrag",value:function(t){if(this._stopped)return!0;if(this.placeholderInfo.element){var e=this.instance.getSize(this.floatingElement);this.instance.setElementPosition(this.placeholderInfo.element,t.pos.x,t.pos.y);for(var n,i,o={x:t.pos.x,y:t.pos.y,w:e.w,h:e.h},s=0;s<this.endpointDropTargets.length;s++)if(W(o,this.endpointDropTargets[s].r)){n=this.endpointDropTargets[s];break}if(n!==this.currentDropTarget&&null!=this.currentDropTarget&&(i=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,js),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=n)if(this.instance.addClass(n.el,js),i=this._getFloatingAnchorIndex(),null!=n.endpoint)if(n.endpoint.isSource&&0===i||n.endpoint.isTarget&&0!==i||this.jpc.suspendedEndpoint&&n.endpoint.referenceEndpoint&&n.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id)this.instance.checkCondition("checkDropAllowed",{sourceEndpoint:this.jpc.endpoints[i],targetEndpoint:n.endpoint.endpoint,connection:this.jpc})?(n.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(n.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(n.endpoint),this.instance._paintConnection(this.jpc);else n=null;this.currentDropTarget=n}}},{key:"_maybeCleanup",value:function(t){t._mtNew&&0===t.connections.length?this.instance.deleteEndpoint(t):delete t._mtNew}},{key:"_reattachOrDiscard",value:function(t){var e=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return e&&this._shouldReattach(t)?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,t),!1)}},{key:"onStop",value:function(t){var e=this,n=t.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var i=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.join(" ")}(js,Ms);if(h(this.instance.getContainer().querySelectorAll(Fs),(function(t){e.instance.removeClass(t,i)})),this.jpc&&null!=this.jpc.endpoints){var o,s=null!=this.jpc.suspendedEndpoint,r=this._getFloatingAnchorIndex(),a=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget)if(null==(o=this._getDropEndpoint(t,this.jpc)))this._reattachOrDiscard(t.e);else if(a&&a.id===o.id)this._doForceReattach(r);else if(o.enabled)if(o.isFull())o.fire(re,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},n),this._reattachOrDiscard(t.e);else{0===r?(this.jpc.source=o.element,this.jpc.sourceId=o.elementId):(this.jpc.target=o.element,this.jpc.targetId=o.elementId);var l=!0;s&&this.jpc.suspendedEndpoint.id!==o.id&&(this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[r].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(l=!1)),(l=l&&o.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,o))?this._drop(o,r,n,l):this._reattachOrDiscard(t.e)}else this._reattachOrDiscard(t.e);else this._reattachOrDiscard(t.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=o&&this._maybeCleanup(o)}}},{key:"_getSourceDefinition",value:function(t){for(var e,n=0;n<this.instance.sourceSelectors.length;n++){if((e=this.instance.sourceSelectors[n]).isEnabled())if(!1!==Ls(t,this.instance.getContainer(),e.selector,this.instance,e.exclude))return e}}},{key:"_getDropEndpoint",value:function(t,n){var i;if(null==this.currentDropTarget.endpoint){var o=this.currentDropTarget.def,s=t.e.target||t.e.srcElement;if(null==o)return null;var r=this.currentDropTarget.targetEl,a=Ws(t.e,r,this.instance.currentZoom),c=this.instance._deriveEndpointAndAnchorSpec(n.getType().join(" "),!0),u=c.endpoints?e(t,{endpoint:o.def.endpoint||c.endpoints[1]}):t,h=this.instance.validAnchorsSpec(c.anchors)?c.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,d=o.def.anchor,p=o.def.anchorPositionFinder?o.def.anchorPositionFinder(r,a,o.def,t.e):null,f=null!=p?p:null!=d?d:null!=h&&null!=h[1]?h[1]:null;if(null!=f&&(u=e(u,{anchor:f})),null!=o.def.portId&&(u.portId=o.def.portId),(u=l(u,o.def.parameterExtractor?o.def.parameterExtractor(this.currentDropTarget.el,s,t.e):{})).element=r,(i=this.instance._internal_newEndpoint(u))._mtNew=!0,i.deleteOnEmpty=!0,o.def.parameters&&i.mergeParameters(o.def.parameters),o.def.extract){var v={};for(var y in o.def.extract){var g=this.currentDropTarget.el.getAttribute(y);g&&(v[o.def.extract[y]]=g)}i.mergeParameters(v)}}else i=this.currentDropTarget.endpoint;return i&&(i.removeClass(this.instance.endpointDropAllowedClass),i.removeClass(this.instance.endpointDropForbiddenClass)),i}},{key:"_doForceReattach",value:function(t){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,t),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(t){return this.jpc.isReattach()||this.jpc._forceReattach||!c(!0,!1,[[this.jpc.endpoints[0],le,[this.jpc]],[this.jpc.endpoints[1],le,[this.jpc]],[this.jpc,le,[this.jpc]],[this.instance,Jt,[ce,this.jpc]]])}},{key:"_discard",value:function(t,e){this.jpc.pending?this.instance.fire("connection:abort",this.jpc,e):(0===t?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:e,force:!0})}},{key:"_drop",value:function(t,e,n,i){if(this.jpc.endpoints[e].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[e]=t,t.addConnection(this.jpc),this.jpc.suspendedEndpoint){var o=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:e,originalSourceId:0===e?o:this.jpc.sourceId,newSourceId:0===e?t.elementId:this.jpc.sourceId,originalTargetId:1===e?o:this.jpc.targetId,newTargetId:1===e?t.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:t},n)}(1===e?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint)&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc));s(i)&&this.jpc.mergeData(i),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(t,e,n){this.floatingConnections[t.id]=e,_(this.instance.endpointsByElement,t.id,n)}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),t}(),Ns=function(t){ii(n,t);var e=li(n);function n(t,i){var o;return Qn(this,n),(o=e.call(this,t,i)).instance=t,o.dragSelection=i,ni(ri(o),"selector",[">",To,ue].join(" ")),ni(ri(o),"doRevalidate",void 0),o.doRevalidate=o._revalidate.bind(ri(o)),o}return ei(n,[{key:"reset",value:function(){this.drag.off(eo,this.doRevalidate)}},{key:"_revalidate",value:function(t){this.instance.revalidate(t)}},{key:"init",value:function(t){this.drag=t,t.on(eo,this.doRevalidate)}},{key:"useGhostProxy",value:function(t,e){var n=e._jsPlumbParentGroup;return null!=n&&!0===n.ghost}},{key:"makeGhostProxy",value:function(t){var e=t,n=e.cloneNode(!0);return n._jsPlumbParentGroup=e._jsPlumbParentGroup,n}}]),n}(Os),Bs=function(){function t(e,n){Qn(this,t),this.instance=e,this.overlay=n,ni(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=n}return ei(t,null,[{key:"getElement",value:function(t,e,n){if(null==t.canvas){if(n&&e){t.canvas=n(e);var i=t.instance.overlayClass+" "+(t.cssClass?t.cssClass:"");t.instance.addClass(t.canvas,i)}else t.canvas=ki(qi,{},t.instance.overlayClass+" "+(t.cssClass?t.cssClass:""));for(var o in t.instance.setAttribute(t.canvas,"jtk-overlay-id",t.id),t.attributes)t.instance.setAttribute(t.canvas,o,t.attributes[o]);t.canvas.style.position=qt,t.instance._appendElement(t.canvas,t.instance.getContainer()),t.instance.getId(t.canvas);var s="translate(-50%, -50%)";t.canvas.style.webkitTransform=s,t.canvas.style.mozTransform=s,t.canvas.style.msTransform=s,t.canvas.style.oTransform=s,t.canvas.style.transform=s,t.isVisible()||(t.canvas.style.display=Bt),t.canvas.jtk={overlay:t}}return t.canvas}},{key:"destroy",value:function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas,delete t.cachedDimensions}},{key:"_getDimensions",value:function(t,e){return(null==t.cachedDimensions||e)&&(t.cachedDimensions={w:1,h:1}),t.cachedDimensions}}]),t}(),qs=function(t){ii(i,t);var n=li(i);function i(){var t;Qn(this,i);for(var e=arguments.length,o=new Array(e),s=0;s<e;s++)o[s]=arguments[s];return ni(ri(t=n.call.apply(n,[this].concat(o))),"path",void 0),t}return ei(i,null,[{key:"ensurePath",value:function(t){if(null==t.path){var n=e({"jtk-overlay-id":t.id},t.attributes);t.path=Mi(wi,n);var i=null;if(t.component instanceof un){var o=t.component.connector;i=null!=o?o.canvas:null}else if(t.component instanceof dn){var s=t.component.endpoint;i=null!=s?s.svg:s}null!=i&&Ii(i,t.path,1);var r=t.instance.overlayClass+" "+(t.cssClass?t.cssClass:"");t.instance.addClass(t.path,r),t.path.jtk={overlay:t}}return t.path}},{key:"paint",value:function(t,e,n,i){this.ensurePath(t);var o=[0,0];i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin);var s={d:e,stroke:n.stroke?n.stroke:null,fill:n.fill?n.fill:null,transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"};Di(t.path,s)}},{key:"destroy",value:function(t,e){var n=t;null!=n.path&&null!=n.path.parentNode&&n.path.parentNode.removeChild(n.path),null!=n.bgPath&&null!=n.bgPath.parentNode&&n.bgPath.parentNode.removeChild(n.bgPath),delete n.path,delete n.bgPath}}]),i}(de),Xs=function(){function t(){Qn(this,t)}return ei(t,null,[{key:"paint",value:function(t,e,n,i){if(null!=n){var o,s=[t.x,t.y],r=[t.w,t.h];null!=i&&(i.xmin<0&&(s[0]+=i.xmin),i.ymin<0&&(s[1]+=i.ymin),r[0]=i.xmax+(i.xmin<0?-i.xmin:0),r[1]=i.ymax+(i.ymin<0?-i.ymin:0)),isFinite(r[0])&&isFinite(r[1])&&(e?(Oi(t.canvas,s[0],s[1],r[0],r[1]),s[0]=0,s[1]=0,o=ji([0,0]),Di(t.svg,{style:o,width:""+(r[0]||0),height:""+(r[1]||0)})):(o=ji([s[0],s[1]]),Di(t.canvas,{style:o,width:""+(r[0]||0),height:""+(r[1]||0)})))}}}]),t}();function Ys(t,n,i,o){!function(t,e){if(null!=e.canvas)return e.canvas;var n=Mi(Pi,{style:"",width:"0",height:"0","pointer-events":Bt,position:qt});e.canvas=n,t._appendElement(e.canvas,t.getContainer()),null!=e.cssClass&&t.addClass(n,e.cssClass),t.addClass(n,t.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=e}(t,n),Xs.paint(n,!1,i,o);var s=[0,0];if(o.xmin<0&&(s[0]=-o.xmin),o.ymin<0&&(s[1]=-o.ymin),n.segments.length>0){var r={d:t.getPathData(n),transform:"translate("+s[0]+","+s[1]+")","pointer-events":"visibleStroke"},a=null;if(i.outlineStroke){var l=i.outlineWidth||1,c=i.strokeWidth+2*l;(a=e({},i)).stroke=i.outlineStroke,a.strokeWidth=c,null==n.bgPath?(n.bgPath=Mi(wi,r),t.addClass(n.bgPath,t.connectorOutlineClass),Ii(n.canvas,n.bgPath,0)):Di(n.bgPath,r),Ti(n.canvas,n.bgPath,a)}var u=n;null==u.path?(u.path=Mi(wi,r),Ii(u.canvas,u.path,i.outlineStroke?1:0)):(u.path.parentNode!==u.canvas&&Ii(u.canvas,u.path,i.outlineStroke?1:0),Di(n.path,r)),Ti(n.canvas,n.path,i)}}var Vs=function(){function t(){Qn(this,t)}return ei(t,null,[{key:"getEndpointElement",value:function(t){if(null!=t.canvas)return t.canvas;var e=Mi(Pi,{style:"",width:"0",height:"0","pointer-events":Bt,position:qt});t.svg=e;var n=ki(qi,{position:qt});t.canvas=n;var i=t.classes.join(" ");t.instance.addClass(n,i);for(var o=t.endpoint.scope.split(/\s/),s=0;s<o.length;s++)t.instance.setAttribute(n,Wt+o[s],et);return t.instance._suspendDrawing||Oi(n,0,0,1,1),t.instance._appendElement(n,t.instance.getContainer()),n.appendChild(e),null!=t.cssClass&&t.instance.addClass(n,t.cssClass),t.instance.addClass(n,t.instance.endpointClass),n.jtk=n.jtk||{},n.jtk.endpoint=t.endpoint,n.style.display=!1!==t.endpoint.visible?Nt:Bt,n}},{key:"paint",value:function(t,n,i){if(!0!==t.endpoint.deleted){this.getEndpointElement(t),Xs.paint(t,!0,i);var o=e({},i);o.outlineStroke&&(o.stroke=o.outlineStroke),null==t.node?(t.node=n.makeNode(t,o),t.svg.appendChild(t.node)):null!=n.updateNode&&n.updateNode(t,t.node),Ti(t.canvas,t.node,o)}}}]),t}(),zs={};function Us(t,e){zs[t]=e}function Ws(t,e,n){var i=e,o=$n(e.getBoundingClientRect)!==Q?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},s=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||s.scrollTop,l=window.pageXOffset||r.scrollLeft||s.scrollLeft,c=r.clientTop||s.clientTop||0,u=r.clientLeft||s.clientLeft||0,h=o.top+a-c+0*n,d=o.left+l-u+0*n,p=Yo(t),f=o.width||i.offsetWidth*n,v=o.height||i.offsetHeight*n;return{x:(p.x-d)/f,y:(p.y-h)/v}}function Js(t){return Vn(t)||Jn(t)||Un(t)}function Zs(t,e){t.canvas&&(t.canvas.style.display=e?"block":"none")}function Ks(t){t.canvas&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas,delete t.svg}function $s(t){return t.canvas}function Qs(t){return Bs.getElement(t)}function tr(t){return Bs.getElement(t,t.component,(function(e){var n=t.create(e);return t.instance.addClass(n,t.instance.overlayClass),n}))}function er(t,e,n,i){var o=t.x,s=t.y;return e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain&&(o=Math.max(t.x,0),s=Math.max(t.y,0),o=Math.min(o,n.w-i.w),s=Math.min(s,n.h-i.h)),{x:o,y:s}}var nr=function(t){ii(n,t);var e=li(n);function n(t,i){var o;Qn(this,n),(o=e.call(this,t,i))._instanceIndex=t,ni(ri(o),"dragSelection",void 0),ni(ri(o),"dragManager",void 0),ni(ri(o),"_connectorClick",void 0),ni(ri(o),"_connectorDblClick",void 0),ni(ri(o),"_connectorTap",void 0),ni(ri(o),"_connectorDblTap",void 0),ni(ri(o),"_endpointClick",void 0),ni(ri(o),"_endpointDblClick",void 0),ni(ri(o),"_overlayClick",void 0),ni(ri(o),"_overlayDblClick",void 0),ni(ri(o),"_overlayTap",void 0),ni(ri(o),"_overlayDblTap",void 0),ni(ri(o),"_connectorMouseover",void 0),ni(ri(o),"_connectorMouseout",void 0),ni(ri(o),"_endpointMouseover",void 0),ni(ri(o),"_endpointMouseout",void 0),ni(ri(o),"_connectorContextmenu",void 0),ni(ri(o),"_connectorMousedown",void 0),ni(ri(o),"_connectorMouseup",void 0),ni(ri(o),"_endpointMousedown",void 0),ni(ri(o),"_endpointMouseup",void 0),ni(ri(o),"_overlayMouseover",void 0),ni(ri(o),"_overlayMouseout",void 0),ni(ri(o),"_elementClick",void 0),ni(ri(o),"_elementTap",void 0),ni(ri(o),"_elementDblTap",void 0),ni(ri(o),"_elementMouseenter",void 0),ni(ri(o),"_elementMouseexit",void 0),ni(ri(o),"_elementMousemove",void 0),ni(ri(o),"_elementMouseup",void 0),ni(ri(o),"_elementMousedown",void 0),ni(ri(o),"_elementContextmenu",void 0),ni(ri(o),"eventManager",void 0),ni(ri(o),"draggingClass","jtk-dragging"),ni(ri(o),"elementDraggingClass","jtk-element-dragging"),ni(ri(o),"hoverClass","jtk-hover"),ni(ri(o),"sourceElementDraggingClass","jtk-source-element-dragging"),ni(ri(o),"targetElementDraggingClass","jtk-target-element-dragging"),ni(ri(o),"hoverSourceClass","jtk-source-hover"),ni(ri(o),"hoverTargetClass","jtk-target-hover"),ni(ri(o),"dragSelectClass","jtk-drag-select"),ni(ri(o),"managedElementsSelector",void 0),ni(ri(o),"elementsDraggable",void 0),ni(ri(o),"elementDragHandler",void 0),ni(ri(o),"groupDragOptions",void 0),ni(ri(o),"elementDragOptions",void 0),ni(ri(o),"svg",{node:function(t,e){return Mi(t,e)},attr:function(t,e){return Di(t,e)},pos:function(t){return ji(t)}}),o.elementsDraggable=i&&!1!==i.elementsDraggable,o.managedElementsSelector=i&&i.managedElementsSelector||ue,o.eventManager=new is,o.dragSelection=new Ds(ri(o)),o.dragManager=new Ts(ri(o),o.dragSelection),o.dragManager.addHandler(new Rs(ri(o))),o.groupDragOptions={constrainFunction:er},o.dragManager.addHandler(new Ns(ri(o),o.dragSelection),o.groupDragOptions),o.elementDragHandler=new Os(ri(o),o.dragSelection),o.elementDragOptions=i&&i.dragOptions||{},o.dragManager.addHandler(o.elementDragHandler,o.elementDragOptions),i&&i.dragOptions&&i.dragOptions.filter&&o.dragManager.addFilter(i.dragOptions.filter);var s=function(t,e){if(!e.defaultPrevented&&null==e._jsPlumbOverlay){var n=fi(vi(e),Mo,this.getContainer(),!0);this.fire(t,n.jtk.connector.connection,e)}};o._connectorClick=s.bind(ri(o),xo),o._connectorDblClick=s.bind(ri(o),ko),o._connectorTap=s.bind(ri(o),Ao),o._connectorDblTap=s.bind(ri(o),bo);var r=function(t,e){var n=vi(e).parentNode;if(n.jtk&&n.jtk.connector){var i=n.jtk.connector,o=i.connection;this.setConnectorHover(i,t),t?(this.addClass(o.source,this.hoverSourceClass),this.addClass(o.target,this.hoverTargetClass)):(this.removeClass(o.source,this.hoverSourceClass),this.removeClass(o.target,this.hoverTargetClass)),this.fire(t?Eo:Co,n.jtk.connector.connection,e)}};o._connectorMouseover=r.bind(ri(o),!0),o._connectorMouseout=r.bind(ri(o),!1);var a=function(t,e){var n=vi(e).parentNode;n.jtk&&n.jtk.connector&&this.fire(t?So:Po,n.jtk.connector.connection,e)};o._connectorMouseup=a.bind(ri(o),!0),o._connectorMousedown=a.bind(ri(o),!1),o._connectorContextmenu=function(t){var e=vi(t).parentNode;e.jtk&&e.jtk.connector&&this.fire(wo,e.jtk.connector.connection,t)}.bind(ri(o));var l=function(t,e,n){e.defaultPrevented||null!=e._jsPlumbOverlay||this.fire(t,n.jtk.endpoint,e)};o._endpointClick=l.bind(ri(o),fo),o._endpointDblClick=l.bind(ri(o),vo);var c=function(t,e){var n=vi(e);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,t),this.fire(t?go:yo,n.jtk.endpoint,e))};o._endpointMouseover=c.bind(ri(o),!0),o._endpointMouseout=c.bind(ri(o),!1);var u=function(t,e){var n=vi(e);n.jtk&&n.jtk.endpoint&&this.fire(t?mo:_o,n.jtk.endpoint,e)};o._endpointMouseup=u.bind(ri(o),!0),o._endpointMousedown=u.bind(ri(o),!1);var h=function(t,e){var n=fi(vi(e),Oo,this.getContainer(),!0).jtk.overlay;n&&this.fireOverlayMethod(n,t,e)}.bind(ri(o));o._overlayClick=h.bind(ri(o),Xi),o._overlayDblClick=h.bind(ri(o),Vi),o._overlayTap=h.bind(ri(o),to),o._overlayDblTap=h.bind(ri(o),zi);var d=function(t,e){var n=fi(vi(e),Oo,this.getContainer(),!0).jtk.overlay;n&&this.setOverlayHover(n,t)};o._overlayMouseover=d.bind(ri(o),!0),o._overlayMouseout=d.bind(ri(o),!1);o._elementClick=function(t,e,n){e.defaultPrevented||this.fire(1===e.detail?io:oo,n,e)}.bind(ri(o),io);o._elementTap=function(t,e,n){e.defaultPrevented||this.fire(po,n,e)}.bind(ri(o),po);o._elementDblTap=function(t,e,n){e.defaultPrevented||this.fire(so,n,e)}.bind(ri(o),so);var p=function(t,e){this.fire(t?ao:ro,vi(e),e)};return o._elementMouseenter=p.bind(ri(o),!0),o._elementMouseexit=p.bind(ri(o),!1),o._elementMousemove=function(t){this.fire(lo,vi(t),t)}.bind(ri(o)),o._elementMouseup=function(t){this.fire(co,vi(t),t)}.bind(ri(o)),o._elementMousedown=function(t){this.fire(uo,vi(t),t)}.bind(ri(o)),o._elementContextmenu=function(t){this.fire(ho,vi(t),t)}.bind(ri(o)),o._attachEventDelegates(),o}return ei(n,[{key:"fireOverlayMethod",value:function(t,e,n){var i=Gi(t.component instanceof un?Bi:Ri,e);n._jsPlumbOverlay=t,t.fire(e,{e:n,overlay:t}),this.fire(i,t.component,n)}},{key:"addDragFilter",value:function(t,e){this.dragManager.addFilter(t,e)}},{key:"removeDragFilter",value:function(t){this.dragManager.removeFilter(t)}},{key:"setDragGrid",value:function(t){this.dragManager.setOption(this.elementDragHandler,{grid:t})}},{key:"_removeElement",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}},{key:"_appendElement",value:function(t,e){e&&e.appendChild(t)}},{key:"_getAssociatedElements",value:function(t){var e=[];if(3!==t.nodeType&&8!==t.nodeType){var n=t.querySelectorAll(ue);Array.prototype.push.apply(e,n)}return e.filter((function(t){return 3!==t.nodeType&&8!==t.nodeType}))}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getClass",value:function(t){return function(t){return yi(t)}(t)}},{key:"addClass",value:function(t,e){_i(t,e)}},{key:"hasClass",value:function(t,e){return function(t,e){return t.classList?t.classList.contains(e):-1!==yi(t).indexOf(e)}(t,e)}},{key:"removeClass",value:function(t,e){xi(t,e)}},{key:"toggleClass",value:function(t,e){!function(t,e){var n=this,i=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?t.classList.toggle(e):n.hasClass(t,e)?n.removeClass(t,e):n.addClass(t,e))};mi(t)?h(t,(function(t){return i(t,e)})):i(t,e)}(t,e)}},{key:"setAttribute",value:function(t,e,n){t.setAttribute(e,n)}},{key:"getAttribute",value:function(t,e){return t.getAttribute(e)}},{key:"setAttributes",value:function(t,e){for(var n in e)t.setAttribute(n,e[n])}},{key:"removeAttribute",value:function(t,e){t.removeAttribute&&t.removeAttribute(e)}},{key:"on",value:function(t,e,n,i){var o=this,s=function(t){null==i?o.eventManager.on(t,e,n):o.eventManager.on(t,e,n,i)};return mi(t)?h(t,(function(t){return s(t)})):s(t),this}},{key:"off",value:function(t,e,n){var i=this;return mi(t)?h(t,(function(t){return i.eventManager.off(t,e,n)})):this.eventManager.off(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){this.eventManager.trigger(t,e,n,i,o)}},{key:"getOffsetRelativeToRoot",value:function(t){return Ci(t)}},{key:"getOffset",value:function(t){for(var e,n=t,i=this.getContainer(),o={x:n.offsetLeft,y:n.offsetTop},s=t!==i&&n.offsetParent!==i?n.offsetParent:null;null!=s;)o.x+=s.offsetLeft,o.y+=s.offsetTop,null!=(e=s)&&e!==document.body&&(e.scrollTop>0||e.scrollLeft>0)&&(o.x-=e.scrollLeft,o.y-=e.scrollTop),s=s.offsetParent===i?null:s.offsetParent;if(null!=i&&(i.scrollTop>0||i.scrollLeft>0)){var r=null!=n.offsetParent?this.getStyle(n.offsetParent,Do):"static",a=this.getStyle(n,Do);a!==qt&&a!==Xt&&r!==qt&&r!==Xt&&(o.x-=i.scrollLeft,o.y-=i.scrollTop)}return o}},{key:"getSize",value:function(t){return function(t){return{w:t.offsetWidth,h:t.offsetHeight}}(t)}},{key:"getStyle",value:function(t,e){return $n(window.getComputedStyle)!==Q?getComputedStyle(t,null).getPropertyValue(e):t.currentStyle[e]}},{key:"getGroupContentArea",value:function(t){var e=this.getSelector(t.el,Io);return e&&e.length>0?e[0]:t.el}},{key:"getSelector",value:function(t,e){var n=null;if(1===arguments.length){if(!i(t)){var o=document.createDocumentFragment();return o.appendChild(t),g(o.childNodes)}n=g(document.querySelectorAll(t))}else n=g(t.querySelectorAll(e));return n}},{key:"setPosition",value:function(t,e){var n=t;n.style.left=e.x+"px",n.style.top=e.y+"px"}},{key:"setDraggable",value:function(t,e){e?this.removeAttribute(t,zt):this.setAttribute(t,zt,et)}},{key:"isDraggable",value:function(t){var e=this.getAttribute(t,zt);return null==e||e===nt}},{key:"toggleDraggable",value:function(t){var e=this.isDraggable(t);return this.setDraggable(t,!e),!e}},{key:"_attachEventDelegates",value:function(){var t=this.getContainer();this.eventManager.on(t,Xi,Oo,this._overlayClick),this.eventManager.on(t,Vi,Oo,this._overlayDblClick),this.eventManager.on(t,to,Oo,this._overlayTap),this.eventManager.on(t,zi,Oo,this._overlayDblTap),this.eventManager.on(t,Xi,Mo,this._connectorClick),this.eventManager.on(t,Vi,Mo,this._connectorDblClick),this.eventManager.on(t,to,Mo,this._connectorTap),this.eventManager.on(t,zi,Mo,this._connectorDblTap),this.eventManager.on(t,Xi,jo,this._endpointClick),this.eventManager.on(t,Vi,jo,this._endpointDblClick),this.eventManager.on(t,Xi,this.managedElementsSelector,this._elementClick),this.eventManager.on(t,to,this.managedElementsSelector,this._elementTap),this.eventManager.on(t,zi,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(t,Qi,Mo,this._connectorMouseover),this.eventManager.on(t,$i,Mo,this._connectorMouseout),this.eventManager.on(t,Yi,Mo,this._connectorContextmenu),this.eventManager.on(t,Ki,Mo,this._connectorMouseup),this.eventManager.on(t,Ui,Mo,this._connectorMousedown),this.eventManager.on(t,Qi,jo,this._endpointMouseover),this.eventManager.on(t,$i,jo,this._endpointMouseout),this.eventManager.on(t,Ki,jo,this._endpointMouseup),this.eventManager.on(t,Ui,jo,this._endpointMousedown),this.eventManager.on(t,Qi,Oo,this._overlayMouseover),this.eventManager.on(t,$i,Oo,this._overlayMouseout),this.eventManager.on(t,Qi,ue,this._elementMouseenter),this.eventManager.on(t,$i,ue,this._elementMouseexit),this.eventManager.on(t,Zi,ue,this._elementMousemove),this.eventManager.on(t,Ki,ue,this._elementMouseup),this.eventManager.on(t,Ui,ue,this._elementMousedown),this.eventManager.on(t,Yi,ue,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var t=this.getContainer();t&&(this.eventManager.off(t,Xi,this._connectorClick),this.eventManager.off(t,Vi,this._connectorDblClick),this.eventManager.off(t,to,this._connectorTap),this.eventManager.off(t,zi,this._connectorDblTap),this.eventManager.off(t,Xi,this._endpointClick),this.eventManager.off(t,Vi,this._endpointDblClick),this.eventManager.off(t,Xi,this._overlayClick),this.eventManager.off(t,Vi,this._overlayDblClick),this.eventManager.off(t,to,this._overlayTap),this.eventManager.off(t,zi,this._overlayDblTap),this.eventManager.off(t,Xi,this._elementClick),this.eventManager.off(t,to,this._elementTap),this.eventManager.off(t,zi,this._elementDblTap),this.eventManager.off(t,Qi,this._connectorMouseover),this.eventManager.off(t,$i,this._connectorMouseout),this.eventManager.off(t,Yi,this._connectorContextmenu),this.eventManager.off(t,Ki,this._connectorMouseup),this.eventManager.off(t,Ui,this._connectorMousedown),this.eventManager.off(t,Qi,this._endpointMouseover),this.eventManager.off(t,$i,this._endpointMouseout),this.eventManager.off(t,Ki,this._endpointMouseup),this.eventManager.off(t,Ui,this._endpointMousedown),this.eventManager.off(t,Qi,this._overlayMouseover),this.eventManager.off(t,$i,this._overlayMouseout),this.eventManager.off(t,Wi,this._elementMouseenter),this.eventManager.off(t,Ji,this._elementMouseexit),this.eventManager.off(t,Zi,this._elementMousemove),this.eventManager.off(t,Ki,this._elementMouseup),this.eventManager.off(t,Ui,this._elementMousedown),this.eventManager.off(t,Yi,this._elementContextmenu))}},{key:"setContainer",value:function(t){var e,i=this;if(t===document||t===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(e=this.dragManager.reset()),this.setAttribute(t,Li,C().replace("-",""));var o=this.getContainer();null!=o&&(o.removeAttribute(Li),h(g(o.childNodes).filter((function(t){return null!=t&&(i.hasClass(t,Zt)||i.hasClass(t,Kt)||i.hasClass(t,te)||t.getAttribute&&null!=t.getAttribute(Vt))})),(function(e){t.appendChild(e)})));ci(oi(n.prototype),"setContainer",this).call(this,t),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new Rs(this)),this.dragManager.addHandler(new Ns(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new Os(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=e&&this.dragManager.setFilters(e))}},{key:"reset",value:function(){ci(oi(n.prototype),"reset",this).call(this),h(this.getContainer().querySelectorAll([ue,jo,Mo,Oo].join(",")),(function(t){return t.parentNode&&t.parentNode.removeChild(t)}))}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),ci(oi(n.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(t,e){this.removeFromDragSelection(t),ci(oi(n.prototype),"unmanage",this).call(this,t,e)}},{key:"addToDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];h(n,(function(e){return t.dragSelection.add(e)}))}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];h(n,(function(e){return t.dragSelection.remove(e)}))}},{key:"toggleDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];h(n,(function(e){return t.dragSelection.toggle(e)}))}},{key:"addToDragGroup",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).addToDragGroup.apply(e,[t].concat(i))}},{key:"removeFromDragGroup",value:function(){var t;(t=this.elementDragHandler).removeFromDragGroup.apply(t,arguments)}},{key:"setDragGroupState",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).setDragGroupState.apply(e,[t].concat(i))}},{key:"consume",value:function(t,e){pi(t,e)}},{key:"rotate",value:function(t,e,i){var o=this.getId(t);return this._managedElements[o]?(this._managedElements[o].el.style.transform="rotate("+e+"deg)",this._managedElements[o].el.style.transformOrigin="center center",ci(oi(n.prototype),"rotate",this).call(this,t,e,i)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(t,e){if(ge(t))t.instance.addClass(Qs(t),e);else if(Js(t))t.instance.addClass(qs.ensurePath(t),e);else{if(!Kn(t))throw"Could not add class to overlay of type ["+t.type+"]";t.instance.addClass(tr(t),e)}}},{key:"removeOverlayClass",value:function(t,e){if(ge(t))t.instance.removeClass(Qs(t),e);else if(Js(t))t.instance.removeClass(qs.ensurePath(t),e);else{if(!Kn(t))throw"Could not remove class from overlay of type ["+t.type+"]";t.instance.removeClass(tr(t),e)}}},{key:"_paintOverlay",value:function(t,e,n){if(ge(t)){Qs(t);var i=t.component.getXY();t.canvas.style.left=i.x+e.d.minx+"px",t.canvas.style.top=i.y+e.d.miny+"px"}else if(Js(t)){var o=isNaN(e.d.cxy.x)||isNaN(e.d.cxy.y)?"M 0 0":"M"+e.d.hxy.x+","+e.d.hxy.y+" L"+e.d.tail[0].x+","+e.d.tail[0].y+" L"+e.d.cxy.x+","+e.d.cxy.y+" L"+e.d.tail[1].x+","+e.d.tail[1].y+" L"+e.d.hxy.x+","+e.d.hxy.y;qs.paint(t,o,e,n)}else{if(!Kn(t))throw"Could not paint overlay of type ["+t.type+"]";tr(t);var s=t.component.getXY();t.canvas.style.left=s.x+e.d.minx+"px",t.canvas.style.top=s.y+e.d.miny+"px"}}},{key:"setOverlayVisible",value:function(t,e){var n=e?"block":"none";function i(t){null!=t&&(t.style.display=n)}ge(t)?i(Qs(t)):Kn(t)?i(tr(t)):Js(t)&&i(t.path)}},{key:"reattachOverlay",value:function(t,e){ge(t)?t.instance._appendElement(Qs(t),this.getContainer()):Kn(t)?t.instance._appendElement(tr(t),this.getContainer()):Js(t)&&this._appendElement(qs.ensurePath(t),e.connector.canvas)}},{key:"setOverlayHover",value:function(t,e){var n;ge(t)?n=Qs(t):Kn(t)?n=tr(t):Js(t)&&(n=qs.ensurePath(t)),null!=n&&(null!=this.hoverClass&&(e?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(t.component,e))}},{key:"destroyOverlay",value:function(t){if(ge(t)){var e=Qs(t);e.parentNode.removeChild(e),delete t.canvas,delete t.cachedDimensions}else if(Vn(t)||Jn(t)||Un(t))qs.destroy(t);else if(Kn(t)){var n=tr(t);n.parentNode.removeChild(n),delete t.canvas,delete t.cachedDimensions}}},{key:"drawOverlay",value:function(t,e,n,o){if(ge(t)||Kn(t)){var s=Bs._getDimensions(t);if(null!=s&&null!=s.w&&null!=s.h){var r={x:0,y:0};if(o)r={x:o.x,y:o.y};else if(e instanceof Ct){var a=Array.isArray(t.location)?t.location:[t.location,t.location];r={x:a[0]*e.w,y:a[1]*e.h}}else{var l=t.location,c=!1;(i(t.location)||t.location<0||t.location>1)&&(l=parseInt(""+t.location,10),c=!0),r=e.pointOnPath(l,c)}var u=r.x-s.w/2,h=r.y-s.h/2;return{component:t,d:{minx:u,miny:h,td:s,cxy:r},xmin:u,xmax:u+s.w,ymin:h,ymax:h+s.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(Vn(t)||Jn(t)||Un(t))return t.draw(e,n,o);throw"Could not draw overlay of type ["+t.type+"]"}},{key:"updateLabel",value:function(t){if(r(t.label)){var e=t.label(this);Qs(t).innerText=null!=e?e:""}else null==t.labelText&&(t.labelText=t.label,null!=t.labelText?Qs(t).innerText=t.labelText:Qs(t).innerText="")}},{key:"setHover",value:function(t,e){t._hover=e,t instanceof dn&&null!=t.endpoint?this.setEndpointHover(t,e,-1):t instanceof un&&null!=t.connector&&this.setConnectorHover(t.connector,e)}},{key:"paintConnector",value:function(t,e,n){Ys(this,t,e,n)}},{key:"setConnectorHover",value:function(t,e,n){if(!1===e||!this.currentlyDragging&&!this.isHoverSuspended()){var i=t.canvas;null!=i&&(null!=t.hoverClass&&(e?this.addClass(i,t.hoverClass):this.removeClass(i,t.hoverClass)),e?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null!=t.connection.hoverPaintStyle&&(t.connection.paintStyleInUse=e?t.connection.hoverPaintStyle:t.connection.paintStyle,this._suspendDrawing||this._paintConnection(t.connection)),t.connection.endpoints[0]!==n&&this.setEndpointHover(t.connection.endpoints[0],e,0,!0),t.connection.endpoints[1]!==n&&this.setEndpointHover(t.connection.endpoints[1],e,1,!0)}}},{key:"destroyConnector",value:function(t){null!=t.connector&&Ks(t.connector)}},{key:"addConnectorClass",value:function(t,e){t.canvas&&this.addClass(t.canvas,e)}},{key:"removeConnectorClass",value:function(t,e){t.canvas&&this.removeClass(t.canvas,e)}},{key:"getConnectorClass",value:function(t){return t.canvas?t.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(t,e){Zs(t,e)}},{key:"applyConnectorType",value:function(t,e){if(t.canvas&&e.cssClass){var n=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(t.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(t,e){var n=$s(t.endpoint);null!=n&&this.addClass(n,e)}},{key:"applyEndpointType",value:function(t,e){if(e.cssClass){var n=$s(t.endpoint);if(n){var i=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(n,i.join(" "))}}}},{key:"destroyEndpoint",value:function(t){var e=this.endpointAnchorClassPrefix+(t.currentAnchorClass?"-"+t.currentAnchorClass:"");this.removeClass(t.element,e),Ks(t.endpoint)}},{key:"renderEndpoint",value:function(t,e){var n=zs[t.endpoint.type];null!=n?Vs.paint(t.endpoint,n,e):w("jsPlumb: no endpoint renderer found for type ["+t.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(t,e){var n=$s(t.endpoint);null!=n&&this.removeClass(n,e)}},{key:"getEndpointClass",value:function(t){var e=$s(t.endpoint);return null!=e?e.className:""}},{key:"setEndpointHover",value:function(t,e,n,i){if(null!=t&&(!1===e||!this.currentlyDragging&&!this.isHoverSuspended())){var o=$s(t.endpoint);if(null!=o&&(null!=t.hoverClass&&(e?this.addClass(o,t.hoverClass):this.removeClass(o,t.hoverClass)),0===n||1===n)){var s=0===n?this.hoverSourceClass:this.hoverTargetClass;e?this.addClass(o,s):this.removeClass(o,s)}if(null!=t.hoverPaintStyle&&(t.paintStyleInUse=e?t.hoverPaintStyle:t.paintStyle,this._suspendDrawing||this.renderEndpoint(t,t.paintStyleInUse)),!i)for(var r=0;r<t.connections.length;r++)this.setConnectorHover(t.connections[r].connector,e,t)}}},{key:"setEndpointVisible",value:function(t,e){Zs(t.endpoint,e)}},{key:"setGroupVisible",value:function(t,e){for(var n=t.el.querySelectorAll(ue),i=0;i<n.length;i++)e?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function(t,e){return null!=t&&!0!==t.deleted&&(!0!==t.endpoints[0].deleted&&this.setEndpointHover(t.endpoints[0],!1,0,!0),!0!==t.endpoints[1].deleted&&this.setEndpointHover(t.endpoints[1],!1,1,!0),ci(oi(n.prototype),"deleteConnection",this).call(this,t,e))}},{key:"addSourceSelector",value:function(t,e,i){return this.addDragFilter(t),ci(oi(n.prototype),"addSourceSelector",this).call(this,t,e,i)}},{key:"removeSourceSelector",value:function(t){this.removeDragFilter(t.selector),ci(oi(n.prototype),"removeSourceSelector",this).call(this,t)}}]),n}(Bn),ir={width:10,height:0,fill:"transparent",stroke:"transparent"};Us(Et.type,{makeNode:function(t,e){return Mi("circle",{cx:t.w/2,cy:t.h/2,r:t.radius})},updateNode:function(t,e){Di(e,{cx:""+t.w/2,cy:""+t.h/2,r:""+t.radius})}}),Us(Pt.type,{makeNode:function(t,e){return Mi("rect",ir)},updateNode:function(t,e){Di(e,ir)}}),Us(At.type,{makeNode:function(t,e){return Mi("rect",{width:t.w,height:t.h})},updateNode:function(t,e){Di(e,{width:t.w,height:t.h})}});var or=0;function sr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function rr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ar(t){return ar=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ar(t)}function lr(t,e){return lr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lr(t,e)}function cr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ur(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?cr(t):e}function hr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=ar(t);if(e){var o=ar(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return ur(this,n)}}function dr(t){return t<0?-1:0===t?0:1}function pr(t){return[dr(t[2]-t[0]),dr(t[3]-t[1])]}function fr(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))}function vr(t){var e=[];return e.push.apply(e,t),e}var yr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lr(t,e)}(s,t);var e,n,i,o=hr(s);function s(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,t,e)).connection=t,rr(cr(n),"type",s.type),rr(cr(n),"internalSegments",[]),rr(cr(n),"midpoint",void 0),rr(cr(n),"alwaysRespectStubs",void 0),rr(cr(n),"cornerRadius",void 0),rr(cr(n),"lastx",void 0),rr(cr(n),"lasty",void 0),rr(cr(n),"lastOrientation",void 0),rr(cr(n),"loopbackRadius",void 0),rr(cr(n),"isLoopbackCurrently",void 0),n.midpoint=null==e.midpoint||isNaN(e.midpoint)?.5:e.midpoint,n.cornerRadius=null!=e.cornerRadius?e.cornerRadius:0,n.alwaysRespectStubs=!0===e.alwaysRespectStubs,n.lastx=null,n.lasty=null,n.lastOrientation=null,n.loopbackRadius=e.loopbackRadius||25,n.isLoopbackCurrently=!1,n}return e=s,n=[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(t,e,n){if(this.lastx!==t||this.lasty!==e){var i=null==this.lastx?n.sx:this.lastx,o=null==this.lasty?n.sy:this.lasty,s=i===t?"v":"h";this.lastx=t,this.lasty=e,this.internalSegments.push([i,o,t,e,s])}}},{key:"writeSegments",value:function(t){for(var e,n,i,o=null,s=0;s<this.internalSegments.length-1;s++){if(o=o||vr(this.internalSegments[s]),e=vr(this.internalSegments[s+1]),n=pr(o),i=pr(e),this.cornerRadius>0&&o[4]!==e[4]){var r=Math.min(fr(o),fr(e)),a=Math.min(this.cornerRadius,r/2);o[2]-=n[0]*a,o[3]-=n[1]*a,e[0]+=i[0]*a,e[1]+=i[1]*a;var l=n[1]===i[0]&&1===i[0]||n[1]===i[0]&&0===i[0]&&n[0]!==i[1]||n[1]===i[0]&&-1===i[0],c=(e[1]>o[3]?1:-1)==(e[0]>o[2]?1:-1),u=c&&l||!c&&!l?e[0]:o[2],h=c&&l||!c&&!l?o[3]:e[1];this._addSegment(jt,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]}),this._addSegment(Xn,{r:a,x1:o[2],y1:o[3],x2:e[0],y2:e[1],cx:u,cy:h,ac:l})}else this._addSegment(jt,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]});o=e}null!=e&&this._addSegment(jt,{x1:e[0],y1:e[1],x2:e[2],y2:e[3]})}},{key:"_compute",value:function(t,e){var n=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var i=function(e){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},o={perpendicular:i,orthogonal:i,opposite:function(e){var i=t,o="x"===e?0:1,s={x:function(){return 1===i.so[o]&&(i.startStubX>i.endStubX&&i.tx>i.startStubX||i.sx>i.endStubX&&i.tx>i.sx)||-1===i.so[o]&&(i.startStubX<i.endStubX&&i.tx<i.startStubX||i.sx<i.endStubX&&i.tx<i.sx)},y:function(){return 1===i.so[o]&&(i.startStubY>i.endStubY&&i.ty>i.startStubY||i.sy>i.endStubY&&i.ty>i.sy)||-1===i.so[o]&&(i.startStubY<i.endStubY&&i.ty<i.startStubY||i.sy<i.endStubY&&i.ty<i.sy)}};return!n.alwaysRespectStubs&&s[e]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[e]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}},s=o[t.anchorOrientation](t.sourceAxis),r="x"===t.sourceAxis?0:1,a="x"===t.sourceAxis?1:0,l=s[r],c=s[a],u=s[r+2],h=s[a+2];this.addASegment(s[0],s[1],t);var d=t.startStubX+(t.endStubX-t.startStubX)*this.midpoint,p=t.startStubY+(t.endStubY-t.startStubY)*this.midpoint,f={x:[0,1],y:[1,0]},v={perpendicular:function(e,n,i,o,s){var r=t,a={x:[[r.startStubX,r.endStubX],null,[r.endStubX,r.startStubX]],y:[[r.startStubY,r.endStubY],null,[r.endStubY,r.startStubY]]},l={x:[[d,r.startStubY],[d,r.endStubY]],y:[[r.startStubX,p],[r.endStubX,p]]},c={x:[[r.endStubX,r.startStubY]],y:[[r.startStubX,r.endStubY]]},u={x:[[r.startStubX,r.endStubY],[r.endStubX,r.endStubY]],y:[[r.endStubX,r.startStubY],[r.endStubX,r.endStubY]]},h={x:[[r.startStubX,p],[r.endStubX,p],[r.endStubX,r.endStubY]],y:[[d,r.startStubY],[d,r.endStubY],[r.endStubX,r.endStubY]]},v={x:[r.startStubY,r.endStubY],y:[r.startStubX,r.endStubX]},y=f[e][0],g=f[e][1],m=r.so[y]+1,_=r.to[g]+1,x=-1===r.to[g]&&v[e][1]<v[e][0]||1===r.to[g]&&v[e][1]>v[e][0],k=a[e][m][0],b=a[e][m][1],C={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[e][m][_];return r.segment===C[3]||r.segment===C[2]&&x?l[e]:r.segment===C[2]&&b<k?c[e]:r.segment===C[2]&&b>=k||r.segment===C[1]&&!x?h[e]:r.segment===C[0]||r.segment===C[1]&&x?u[e]:void 0},orthogonal:function(e,n,i,o,s){var r=t,a={x:-1===r.so[0]?Math.min(n,o):Math.max(n,o),y:-1===r.so[1]?Math.min(n,o):Math.max(n,o)}[e];return{x:[[a,i],[a,s],[o,s]],y:[[i,a],[s,a],[s,o]]}[e]},opposite:function(i,o,s,a,l){var c=t,u={x:"y",y:"x"}[i],h={x:"h",y:"w"}[i],f=c["is"+i.toUpperCase()+"GreaterThanStubTimes2"];if(e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var v=s+(1-e.sourceEndpoint._anchor.computedPosition[u])*e.sourceInfo[h]+n.maxStub;return{x:[[o,v],[a,v]],y:[[v,o],[v,a]]}[i]}return!f||1===c.so[r]&&o>a||-1===c.so[r]&&o<a?{x:[[o,p],[a,p]],y:[[d,o],[d,a]]}[i]:1===c.so[r]&&o<a||-1===c.so[r]&&o>a?{x:[[d,c.sy],[d,c.ty]],y:[[c.sx,p],[c.tx,p]]}[i]:void 0}},y=v[t.anchorOrientation](t.sourceAxis,l,c,u,h);if(y)for(var g=0;g<y.length;g++)this.addASegment(y[g][0],y[g][1],t);this.addASegment(s[2],s[3],t),this.addASegment(t.tx,t.ty,t),this.writeSegments(t)}},{key:"transformGeometry",value:function(t,e,n){return t}}],n&&sr(e.prototype,n),i&&sr(e,i),s}(Mt);function gr(t,e,n){let i=document.createElement("div");i.id=t,i.className="position-absolute border-2 card";let o=document.createElement("div");return o.className="card-body",o.innerHTML=n,i.style.width=e,i.append(o),document.getElementById("container").append(i),i}rr(yr,"type","Flowchart"),Gt(yr.type,yr);let mr=document.getElementById("container"),_r=(xr={container:mr},new nr(function(){var t=or+1;return or++,t}(),xr));var xr;!function(t,e,n,i){!function(t,e,n){let i='<h5 class="card-title text-center">Start</h5><hr><p class="card-text text-center text-truncate">'+t.text+"</p>",o=gr(t.question_id,"10rem",i);e.manage(o,o.id),e.addEndpoint(o,n)}(t.questions.find((t=>"start"===t.type)),e,n),function(t,e,n){let i='<h5 class="card-title text-center">Finish</h5><hr><p class="card-text text-center text-truncate">'+t.text+"</p>",o=gr(t.question_id,"10rem",i);e.manage(o,o.id),e.addEndpoint(o,n)}(t.questions.find((t=>"end"===t.type)),e,i),function(t,e,n,i){let o='<h5 class="card-title text-center">Open</h5><hr><p class="card-text text-center text-truncate">'+t.text+"</p>";console.log(t.answer_options);let s=gr(t.question_id,"15rem",o),r=document.createElement("ul");r.className="list-group list-group-flush";for(let i of t.answer_options){let t=document.createElement("li");t.innerHTML=i.text,t.className="list-group-item",r.append(t),e.addEndpoint(t,{anchor:["Right","Left"]},n)}s.append(r),e.manage(s,s.id),e.addEndpoint(s,i)}(t.questions.find((t=>"open"===t.type)),e,n,i)}({author:"Главный Музей Страны",cover_url:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/Winter_Palace_Panorama_4.jpg/548px-Winter_Palace_Panorama_4.jpg",description:"Главный музейный комплекс включает в себя шесть связанных между собой зданий — Зимний дворец, Запасной дом Зимнего дворца, Малый Эрмитаж, Большой (Старый) Эрмитаж, Новый Эрмитаж и Эрмитажный театр. В них открыты для посещения 365 залов. Также в распоряжении музея находятся Главный штаб, Музей Императорского фарфорового завода, реставрационно-хранительский центр «Старая Деревня» и Меншиковский дворец.\r\nОбщая площадь помещений (зданий) Государственного Эрмитажа составляет 233 345 м², экспозиционно-выставочная площадь — 100 000 м².\r\nСвою историю музей начинал с коллекции произведений искусства, приобретённых в частном порядке российской императрицей Екатериной II в 1764 году. Первоначально это собрание размещалось в специальном дворцовом флигеле — Эрмитаже (от фр. ermitage — место уединения, келья, приют отшельника, затворничество; ныне Малый Эрмитаж) — откуда и закрепилось общее название будущего музея. В 1852 году из сильно разросшейся коллекции был сформирован и открыт для посещения публичный музей, расположившийся в специально для этого построенном здании Нового Эрмитажа.\r\nСовременный Государственный Эрмитаж представляет собой сложный музейный комплекс. Основная экспозиционная часть музея занимает пять зданий, расположенных вдоль набережной реки Невы, главным из которых принято считать Зимний дворец, также музею принадлежат Восточное крыло Главного штаба на Дворцовой площади, Меншиковский дворец на другой стороне Невы, фондохранилище в «Старой Деревне» и другие здания.\r\nКоллекция музея насчитывает около трёх миллионов произведений искусства и памятников мировой культуры, собранных начиная с каменного века и до нашего столетия. В составе коллекции — живопись, графика, скульптура и предметы прикладного искусства, археологические находки и нумизматический материал.\r\nВ 2013 году Государственный Эрмитаж вошёл в число двадцати самых посещаемых художественных музеев мира. По результатам 2018 года он занял 9-е место по посещаемости среди музеев мира (в 2018 году там побывали 4,2 миллиона человек)[7]. В 2019 году Эрмитаж принял 4 956 524 посетителя, заняв восьмое место среди самых посещаемых художественных музеев мира.",files:[],hidden:!1,lead_time:15552e3,password:"password",quest_id:"1",questions:[{answer_options:[],files:[],hints:[],movements:[],question_id:14,text:"Квест закончен",type:"end"},{answer_options:[{next_question_id:14,points:100,text:"да"},{next_question_id:14,points:-100,text:"нет"}],files:[],hints:[{files:[{type:"image",url:"https://habrastorage.org/getpro/habr/post_images/a42/97b/c0b/a4297bc0b36fbf9878dd6173c0f0fbb4.jpg"}],fine:50,hint_text:"Правильный ответ - да"}],movements:[],question_id:13,text:"Понравился ли квест?",type:"choice"},{answer_options:[{next_question_id:13,points:0,text:"skip"},{next_question_id:13,points:3,text:"1782"}],files:[],hints:[],movements:[],question_id:12,text:"В каком году был основан Эрмитажный театр?",type:"open"},{answer_options:[{next_question_id:12,points:3,text:""}],files:[],hints:[],movements:[{next_question_id:12,place:{coords:"(59.942345,30.316612)",radius:15.6,time_close:"Sun, 12 Aug 2001 19:00:00 GMT",time_open:"Sun, 12 Aug 2001 09:00:00 GMT"}}],question_id:11,text:"Двиньтесь к Эрмитажному театру",type:"movement"},{answer_options:[{next_question_id:11,points:10,text:"1764—1775"}],files:[],hints:[],movements:[],question_id:8,text:"В какие годы строился Малый Эрмитаж? Укажите годы через дефис.",type:"open"},{answer_options:[{next_question_id:8,points:3,text:""}],files:[],hints:[],movements:[{next_question_id:8,place:{coords:"(59.940742,30.316448)",radius:15.7,time_close:"Sun, 12 Aug 2001 19:00:00 GMT",time_open:"Sun, 12 Aug 2001 09:00:00 GMT"}}],question_id:5,text:"Двиньтесь к Малому Эрмитажу",type:"movement"},{answer_options:[{next_question_id:11,points:10,text:"1771—1787"}],files:[],hints:[],movements:[],question_id:9,text:"В какие годы строился Большой Эрмитаж? Укажите годы через дефис.",type:"open"},{answer_options:[{next_question_id:9,points:3,text:""}],files:[],hints:[],movements:[{next_question_id:9,place:{coords:"(59.942178,30.316193)",radius:50.3,time_close:"Sun, 12 Aug 2001 20:00:00 GMT",time_open:"Sun, 12 Aug 2001 09:00:00 GMT"}}],question_id:6,text:"Двиньтесь к Большому Эрмитажу",type:"movement"},{answer_options:[{next_question_id:11,points:10,text:"1842—1851"}],files:[],hints:[],movements:[],question_id:10,text:"В какие годы строился Новый Эрмитаж? Укажите годы через дефис.",type:"open"},{answer_options:[{next_question_id:10,points:3,text:""}],files:[],hints:[],movements:[{next_question_id:10,place:{coords:"(59.941711,30.316884)",radius:48,time_close:"Sun, 12 Aug 2001 19:00:00 GMT",time_open:"Sun, 12 Aug 2001 09:00:00 GMT"}}],question_id:7,text:"Двиньтесь к Новому Эрмитажу",type:"movement"},{answer_options:[{next_question_id:5,points:-1,text:"1"},{next_question_id:6,points:-1,text:"2"},{next_question_id:7,points:3,text:"3"}],files:[{type:"image",url:"https://upload.wikimedia.org/wikipedia/commons/0/0e/Elizabeth_of_Russia_by_V.Eriksen.jpg"},{type:"image",url:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/Mikola_II_%28cropped%29-2.jpg/548px-Mikola_II_%28cropped%29-2.jpg"},{type:"image",url:"https://azbyka.ru/days/storage/images/icons-of-saints/2280/p1ann1j7utlc61pgcs2p1gle1olc4.jpg"}],hints:[],movements:[],question_id:4,text:"На каком из представленых изображений находится правитель России по указу которого был построен Русский музей?",type:"choice"},{answer_options:[{next_question_id:4,points:-5,text:"Андрей Воронихин"},{next_question_id:4,points:-5,text:"Огюст Монферран"},{next_question_id:4,points:5,text:"Франческо Растрелли"},{next_question_id:4,points:-5,text:"Карл Росси"}],files:[],hints:[],movements:[],question_id:3,text:"Кто архитектор?",type:"choice"},{answer_options:[{next_question_id:3,points:10,text:"1754"}],files:[],hints:[{files:[],fine:1,hint_text:"Здание основано в шестидесятые годы 18 века."}],movements:[],question_id:2,text:"В каком году был основан Зимний дворец?",type:"open"},{answer_options:[{next_question_id:2,points:0,text:""}],files:[],hints:[],movements:[{next_question_id:2,place:{coords:"(59.940925,30.312946)",radius:26.5,time_close:"Sun, 12 Aug 2001 19:00:00 GMT",time_open:"Sun, 12 Aug 2001 09:00:00 GMT"}}],question_id:1,text:"Идите к Зимнему Дворцу",type:"start"}],rating:{five:0,four:0,one:0,three:0,two:0},start_question_id:1,tags:["educational","historical"],time_close:"Sat, 01 Jan 2022 00:00:00 GMT",time_open:"Sat, 01 Jan 2011 00:00:00 GMT",title:"По залам Эрмитажа"},_r,{endpoint:{type:"Dot",options:{radius:5}},connector:{type:"Flowchart",options:{cornerRadius:2}},source:!0},{endpoint:{type:"Rectangle"},maxConnections:-1,source:!1,target:!0,connectionsDetachable:!0,anchor:[.5,0,0,-1]})})();